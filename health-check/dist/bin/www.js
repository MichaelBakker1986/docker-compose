#!/usr/bin/env node
'use strict';

var cov_sly0nwht9 = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\health-check\\bin\\www',
	    hash = '5756cfbc033a9e93ab8cf527a18e7f41206c570a',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\health-check\\bin\\www',
		statementMap: {
			'0': {
				start: {
					line: 10,
					column: 14
				},
				end: {
					line: 10,
					column: 43
				}
			},
			'1': {
				start: {
					line: 15,
					column: 11
				},
				end: {
					line: 15,
					column: 52
				}
			},
			'2': {
				start: {
					line: 16,
					column: 0
				},
				end: {
					line: 16,
					column: 21
				}
			},
			'3': {
				start: {
					line: 22,
					column: 13
				},
				end: {
					line: 22,
					column: 35
				}
			},
			'4': {
				start: {
					line: 28,
					column: 0
				},
				end: {
					line: 28,
					column: 19
				}
			},
			'5': {
				start: {
					line: 29,
					column: 0
				},
				end: {
					line: 29,
					column: 27
				}
			},
			'6': {
				start: {
					line: 30,
					column: 0
				},
				end: {
					line: 30,
					column: 35
				}
			},
			'7': {
				start: {
					line: 37,
					column: 12
				},
				end: {
					line: 37,
					column: 29
				}
			},
			'8': {
				start: {
					line: 39,
					column: 1
				},
				end: {
					line: 42,
					column: 2
				}
			},
			'9': {
				start: {
					line: 41,
					column: 2
				},
				end: {
					line: 41,
					column: 12
				}
			},
			'10': {
				start: {
					line: 44,
					column: 1
				},
				end: {
					line: 47,
					column: 2
				}
			},
			'11': {
				start: {
					line: 46,
					column: 2
				},
				end: {
					line: 46,
					column: 13
				}
			},
			'12': {
				start: {
					line: 49,
					column: 1
				},
				end: {
					line: 49,
					column: 13
				}
			},
			'13': {
				start: {
					line: 57,
					column: 1
				},
				end: {
					line: 59,
					column: 2
				}
			},
			'14': {
				start: {
					line: 58,
					column: 2
				},
				end: {
					line: 58,
					column: 13
				}
			},
			'15': {
				start: {
					line: 61,
					column: 12
				},
				end: {
					line: 63,
					column: 18
				}
			},
			'16': {
				start: {
					line: 66,
					column: 1
				},
				end: {
					line: 77,
					column: 2
				}
			},
			'17': {
				start: {
					line: 68,
					column: 2
				},
				end: {
					line: 68,
					column: 55
				}
			},
			'18': {
				start: {
					line: 69,
					column: 2
				},
				end: {
					line: 69,
					column: 17
				}
			},
			'19': {
				start: {
					line: 70,
					column: 2
				},
				end: {
					line: 70,
					column: 7
				}
			},
			'20': {
				start: {
					line: 72,
					column: 2
				},
				end: {
					line: 72,
					column: 44
				}
			},
			'21': {
				start: {
					line: 73,
					column: 2
				},
				end: {
					line: 73,
					column: 17
				}
			},
			'22': {
				start: {
					line: 74,
					column: 2
				},
				end: {
					line: 74,
					column: 7
				}
			},
			'23': {
				start: {
					line: 76,
					column: 2
				},
				end: {
					line: 76,
					column: 13
				}
			},
			'24': {
				start: {
					line: 85,
					column: 12
				},
				end: {
					line: 85,
					column: 28
				}
			},
			'25': {
				start: {
					line: 86,
					column: 12
				},
				end: {
					line: 88,
					column: 23
				}
			},
			'26': {
				start: {
					line: 89,
					column: 1
				},
				end: {
					line: 89,
					column: 30
				}
			}
		},
		fnMap: {
			'0': {
				name: 'normalizePort',
				decl: {
					start: {
						line: 36,
						column: 9
					},
					end: {
						line: 36,
						column: 22
					}
				},
				loc: {
					start: {
						line: 36,
						column: 28
					},
					end: {
						line: 50,
						column: 1
					}
				},
				line: 36
			},
			'1': {
				name: 'onError',
				decl: {
					start: {
						line: 56,
						column: 9
					},
					end: {
						line: 56,
						column: 16
					}
				},
				loc: {
					start: {
						line: 56,
						column: 24
					},
					end: {
						line: 78,
						column: 1
					}
				},
				line: 56
			},
			'2': {
				name: 'onListening',
				decl: {
					start: {
						line: 84,
						column: 9
					},
					end: {
						line: 84,
						column: 20
					}
				},
				loc: {
					start: {
						line: 84,
						column: 23
					},
					end: {
						line: 90,
						column: 1
					}
				},
				line: 84
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 15,
						column: 25
					},
					end: {
						line: 15,
						column: 51
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 15,
						column: 25
					},
					end: {
						line: 15,
						column: 41
					}
				}, {
					start: {
						line: 15,
						column: 45
					},
					end: {
						line: 15,
						column: 51
					}
				}],
				line: 15
			},
			'1': {
				loc: {
					start: {
						line: 39,
						column: 1
					},
					end: {
						line: 42,
						column: 2
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 39,
						column: 1
					},
					end: {
						line: 42,
						column: 2
					}
				}, {
					start: {
						line: 39,
						column: 1
					},
					end: {
						line: 42,
						column: 2
					}
				}],
				line: 39
			},
			'2': {
				loc: {
					start: {
						line: 44,
						column: 1
					},
					end: {
						line: 47,
						column: 2
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 44,
						column: 1
					},
					end: {
						line: 47,
						column: 2
					}
				}, {
					start: {
						line: 44,
						column: 1
					},
					end: {
						line: 47,
						column: 2
					}
				}],
				line: 44
			},
			'3': {
				loc: {
					start: {
						line: 57,
						column: 1
					},
					end: {
						line: 59,
						column: 2
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 57,
						column: 1
					},
					end: {
						line: 59,
						column: 2
					}
				}, {
					start: {
						line: 57,
						column: 1
					},
					end: {
						line: 59,
						column: 2
					}
				}],
				line: 57
			},
			'4': {
				loc: {
					start: {
						line: 61,
						column: 12
					},
					end: {
						line: 63,
						column: 18
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 62,
						column: 4
					},
					end: {
						line: 62,
						column: 18
					}
				}, {
					start: {
						line: 63,
						column: 4
					},
					end: {
						line: 63,
						column: 18
					}
				}],
				line: 61
			},
			'5': {
				loc: {
					start: {
						line: 66,
						column: 1
					},
					end: {
						line: 77,
						column: 2
					}
				},
				type: 'switch',
				locations: [{
					start: {
						line: 67,
						column: 1
					},
					end: {
						line: 70,
						column: 7
					}
				}, {
					start: {
						line: 71,
						column: 1
					},
					end: {
						line: 74,
						column: 7
					}
				}, {
					start: {
						line: 75,
						column: 1
					},
					end: {
						line: 76,
						column: 13
					}
				}],
				line: 66
			},
			'6': {
				loc: {
					start: {
						line: 86,
						column: 12
					},
					end: {
						line: 88,
						column: 23
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 87,
						column: 4
					},
					end: {
						line: 87,
						column: 18
					}
				}, {
					start: {
						line: 88,
						column: 4
					},
					end: {
						line: 88,
						column: 23
					}
				}],
				line: 86
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0, 0],
			'6': [0, 0]
		},
		_coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

/**
 * Module dependencies.
 */


var _app = require('../app');

var _app2 = _interopRequireDefault(_app);

var _http = require('http');

var _http2 = _interopRequireDefault(_http);

var _debug = require('debug');

var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var debug = (cov_sly0nwht9.s[0]++, (0, _debug2.default)('health-check:server'));
/**
 * Get port from environment and store in Express.
 */

var port = (cov_sly0nwht9.s[1]++, normalizePort((cov_sly0nwht9.b[0][0]++, process.env.PORT) || (cov_sly0nwht9.b[0][1]++, '3000')));
cov_sly0nwht9.s[2]++;
_app2.default.set('port', port);

/**
 * Create HTTP server.
 */

var server = (cov_sly0nwht9.s[3]++, _http2.default.createServer(_app2.default));

/**
 * Listen on provided port, on all network interfaces.
 */

cov_sly0nwht9.s[4]++;
server.listen(port);
cov_sly0nwht9.s[5]++;
server.on('error', onError);
cov_sly0nwht9.s[6]++;
server.on('listening', onListening);

/**
 * Normalize a port into a number, string, or false.
 */

function normalizePort(val) {
	cov_sly0nwht9.f[0]++;

	var port = (cov_sly0nwht9.s[7]++, parseInt(val, 10));

	cov_sly0nwht9.s[8]++;
	if (isNaN(port)) {
		cov_sly0nwht9.b[1][0]++;
		cov_sly0nwht9.s[9]++;

		// named pipe
		return val;
	} else {
		cov_sly0nwht9.b[1][1]++;
	}

	cov_sly0nwht9.s[10]++;
	if (port >= 0) {
		cov_sly0nwht9.b[2][0]++;
		cov_sly0nwht9.s[11]++;

		// port number
		return port;
	} else {
		cov_sly0nwht9.b[2][1]++;
	}

	cov_sly0nwht9.s[12]++;
	return false;
}

/**
 * Event listener for HTTP server "error" event.
 */

function onError(error) {
	cov_sly0nwht9.f[1]++;
	cov_sly0nwht9.s[13]++;

	if (error.syscall !== 'listen') {
		cov_sly0nwht9.b[3][0]++;
		cov_sly0nwht9.s[14]++;

		throw error;
	} else {
		cov_sly0nwht9.b[3][1]++;
	}

	var bind = (cov_sly0nwht9.s[15]++, typeof port === 'string' ? (cov_sly0nwht9.b[4][0]++, 'Pipe ' + port) : (cov_sly0nwht9.b[4][1]++, 'Port ' + port));

	// handle specific listen errors with friendly messages
	cov_sly0nwht9.s[16]++;
	switch (error.code) {
		case 'EACCES':
			cov_sly0nwht9.b[5][0]++;
			cov_sly0nwht9.s[17]++;

			console.error(bind + ' requires elevated privileges');
			cov_sly0nwht9.s[18]++;
			process.exit(1);
			cov_sly0nwht9.s[19]++;
			break;
		case 'EADDRINUSE':
			cov_sly0nwht9.b[5][1]++;
			cov_sly0nwht9.s[20]++;

			console.error(bind + ' is already in use');
			cov_sly0nwht9.s[21]++;
			process.exit(1);
			cov_sly0nwht9.s[22]++;
			break;
		default:
			cov_sly0nwht9.b[5][2]++;
			cov_sly0nwht9.s[23]++;

			throw error;
	}
}

/**
 * Event listener for HTTP server "listening" event.
 */

function onListening() {
	cov_sly0nwht9.f[2]++;

	var addr = (cov_sly0nwht9.s[24]++, server.address());
	var bind = (cov_sly0nwht9.s[25]++, typeof addr === 'string' ? (cov_sly0nwht9.b[6][0]++, 'pipe ' + addr) : (cov_sly0nwht9.b[6][1]++, 'port ' + addr.port));
	cov_sly0nwht9.s[26]++;
	debug('Listening on ' + bind);
}