'use strict';

var cov_293z5ucaer = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\health-check\\trader-connector\\ThuisSpeedTest.js',
	    hash = '0ad7d733e0b7c33ecfa84d84191237bc3835da9a',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\health-check\\trader-connector\\ThuisSpeedTest.js',
		statementMap: {
			'0': {
				start: {
					line: 7,
					column: 15
				},
				end: {
					line: 7,
					column: 20
				}
			},
			'1': {
				start: {
					line: 10,
					column: 14
				},
				end: {
					line: 10,
					column: 27
				}
			},
			'2': {
				start: {
					line: 11,
					column: 1
				},
				end: {
					line: 11,
					column: 55
				}
			},
			'3': {
				start: {
					line: 11,
					column: 25
				},
				end: {
					line: 11,
					column: 54
				}
			},
			'4': {
				start: {
					line: 12,
					column: 1
				},
				end: {
					line: 15,
					column: 3
				}
			},
			'5': {
				start: {
					line: 13,
					column: 2
				},
				end: {
					line: 13,
					column: 20
				}
			},
			'6': {
				start: {
					line: 14,
					column: 2
				},
				end: {
					line: 14,
					column: 58
				}
			},
			'7': {
				start: {
					line: 19,
					column: 13
				},
				end: {
					line: 19,
					column: 21
				}
			},
			'8': {
				start: {
					line: 20,
					column: 28
				},
				end: {
					line: 20,
					column: 34
				}
			},
			'9': {
				start: {
					line: 21,
					column: 38
				},
				end: {
					line: 21,
					column: 44
				}
			},
			'10': {
				start: {
					line: 22,
					column: 17
				},
				end: {
					line: 22,
					column: 23
				}
			},
			'11': {
				start: {
					line: 23,
					column: 15
				},
				end: {
					line: 23,
					column: 204
				}
			},
			'12': {
				start: {
					line: 24,
					column: 1
				},
				end: {
					line: 24,
					column: 14
				}
			},
			'13': {
				start: {
					line: 25,
					column: 1
				},
				end: {
					line: 28,
					column: 34
				}
			},
			'14': {
				start: {
					line: 29,
					column: 1
				},
				end: {
					line: 31,
					column: 13
				}
			},
			'15': {
				start: {
					line: 30,
					column: 2
				},
				end: {
					line: 30,
					column: 23
				}
			},
			'16': {
				start: {
					line: 34,
					column: 0
				},
				end: {
					line: 39,
					column: 2
				}
			},
			'17': {
				start: {
					line: 35,
					column: 1
				},
				end: {
					line: 35,
					column: 41
				}
			},
			'18': {
				start: {
					line: 36,
					column: 1
				},
				end: {
					line: 36,
					column: 16
				}
			},
			'19': {
				start: {
					line: 37,
					column: 1
				},
				end: {
					line: 37,
					column: 17
				}
			},
			'20': {
				start: {
					line: 38,
					column: 1
				},
				end: {
					line: 38,
					column: 47
				}
			}
		},
		fnMap: {
			'0': {
				name: 'redoTheTest',
				decl: {
					start: {
						line: 9,
						column: 15
					},
					end: {
						line: 9,
						column: 26
					}
				},
				loc: {
					start: {
						line: 9,
						column: 31
					},
					end: {
						line: 16,
						column: 1
					}
				},
				line: 9
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 11,
						column: 17
					},
					end: {
						line: 11,
						column: 18
					}
				},
				loc: {
					start: {
						line: 11,
						column: 25
					},
					end: {
						line: 11,
						column: 54
					}
				},
				line: 11
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 12,
						column: 18
					},
					end: {
						line: 12,
						column: 19
					}
				},
				loc: {
					start: {
						line: 12,
						column: 25
					},
					end: {
						line: 15,
						column: 2
					}
				},
				line: 12
			},
			'3': {
				name: 'printResultsAndRedoTest',
				decl: {
					start: {
						line: 18,
						column: 9
					},
					end: {
						line: 18,
						column: 32
					}
				},
				loc: {
					start: {
						line: 18,
						column: 61
					},
					end: {
						line: 32,
						column: 1
					}
				},
				line: 18
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 28,
						column: 9
					},
					end: {
						line: 28,
						column: 10
					}
				},
				loc: {
					start: {
						line: 28,
						column: 15
					},
					end: {
						line: 28,
						column: 17
					}
				},
				line: 28
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 28,
						column: 25
					},
					end: {
						line: 28,
						column: 26
					}
				},
				loc: {
					start: {
						line: 28,
						column: 31
					},
					end: {
						line: 28,
						column: 33
					}
				},
				line: 28
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 29,
						column: 12
					},
					end: {
						line: 29,
						column: 13
					}
				},
				loc: {
					start: {
						line: 29,
						column: 24
					},
					end: {
						line: 31,
						column: 2
					}
				},
				line: 29
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 34,
						column: 10
					},
					end: {
						line: 34,
						column: 11
					}
				},
				loc: {
					start: {
						line: 34,
						column: 24
					},
					end: {
						line: 39,
						column: 1
					}
				},
				line: 34
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 38,
						column: 22
					},
					end: {
						line: 38,
						column: 23
					}
				},
				loc: {
					start: {
						line: 38,
						column: 28
					},
					end: {
						line: 38,
						column: 30
					}
				},
				line: 38
			},
			'9': {
				name: '(anonymous_9)',
				decl: {
					start: {
						line: 38,
						column: 38
					},
					end: {
						line: 38,
						column: 39
					}
				},
				loc: {
					start: {
						line: 38,
						column: 44
					},
					end: {
						line: 38,
						column: 46
					}
				},
				line: 38
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 20,
						column: 9
					},
					end: {
						line: 20,
						column: 23
					}
				},
				type: 'default-arg',
				locations: [{
					start: {
						line: 20,
						column: 16
					},
					end: {
						line: 20,
						column: 23
					}
				}],
				line: 20
			},
			'1': {
				loc: {
					start: {
						line: 21,
						column: 9
					},
					end: {
						line: 21,
						column: 21
					}
				},
				type: 'default-arg',
				locations: [{
					start: {
						line: 21,
						column: 20
					},
					end: {
						line: 21,
						column: 21
					}
				}],
				line: 21
			},
			'2': {
				loc: {
					start: {
						line: 21,
						column: 23
					},
					end: {
						line: 21,
						column: 33
					}
				},
				type: 'default-arg',
				locations: [{
					start: {
						line: 21,
						column: 32
					},
					end: {
						line: 21,
						column: 33
					}
				}],
				line: 21
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0
		},
		b: {
			'0': [0],
			'1': [0],
			'2': [0]
		},
		_coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _objectDestructuringEmpty2 = require('babel-runtime/helpers/objectDestructuringEmpty');

var _objectDestructuringEmpty3 = _interopRequireDefault(_objectDestructuringEmpty2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var redoTheTest = function () {
	var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(_ref2) {
		var test;
		return _regenerator2.default.wrap(function _callee$(_context) {
			while (1) {
				switch (_context.prev = _context.next) {
					case 0:
						(0, _objectDestructuringEmpty3.default)(_ref2);
						cov_293z5ucaer.f[0]++;
						test = (cov_293z5ucaer.s[1]++, (0, _speedtestNet2.default)({}));
						cov_293z5ucaer.s[2]++;

						test.on('data', function (data) {
							cov_293z5ucaer.f[1]++;
							cov_293z5ucaer.s[3]++;
							return printResultsAndRedoTest(data);
						});
						cov_293z5ucaer.s[4]++;
						test.on('error', function (err) {
							cov_293z5ucaer.f[2]++;
							cov_293z5ucaer.s[5]++;

							console.error(err);
							cov_293z5ucaer.s[6]++;
							printResultsAndRedoTest({ speeds: { download: 'err' } });
						});

					case 7:
					case 'end':
						return _context.stop();
				}
			}
		}, _callee, this);
	}));

	return function redoTheTest(_x) {
		return _ref.apply(this, arguments);
	};
}();

var _speedtestNet = require('speedtest-net');

var _speedtestNet2 = _interopRequireDefault(_speedtestNet);

var _log = require('log6');

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _TraderConnect = require('./TraderConnect');

var _publicIp = require('public-ip');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var interval = (cov_293z5ucaer.s[0]++, 10000),
    ip = void 0;

function printResultsAndRedoTest(_ref3) {
	var _this = this;

	var client = _ref3.client,
	    server = _ref3.server,
	    speeds = _ref3.speeds;
	cov_293z5ucaer.f[3]++;

	var now = (cov_293z5ucaer.s[7]++, (0, _moment2.default)());

	var _ref4 = (cov_293z5ucaer.s[8]++, server),
	    _ref4$ping = _ref4.ping,
	    ping = _ref4$ping === undefined ? (cov_293z5ucaer.b[0][0]++, 999.999) : _ref4$ping;

	var _ref5 = (cov_293z5ucaer.s[9]++, speeds),
	    _ref5$download = _ref5.download,
	    download = _ref5$download === undefined ? (cov_293z5ucaer.b[1][0]++, 0) : _ref5$download,
	    _ref5$upload = _ref5.upload,
	    upload = _ref5$upload === undefined ? (cov_293z5ucaer.b[2][0]++, 0) : _ref5$upload;

	var _ref6 = (cov_293z5ucaer.s[10]++, client),
	    isp = _ref6.isp;

	var message = (cov_293z5ucaer.s[11]++, ip + ' : ' + String(now.format('YY-MM-DD hh:mm:ssa')).padEnd(19) + ' ' + ping.toFixed(1).padStart(4) + 'ms ' + String(download.toFixed(0).padStart(3)) + '/' + upload.toFixed(0).padEnd(3) + ' ' + isp.padEnd(30));
	cov_293z5ucaer.s[12]++;
	(0, _log.info)(message);
	cov_293z5ucaer.s[13]++;
	_TraderConnect.audit.insert({
		create_time: new Date().getTime(),
		ping: ping, download: download, upload: upload, isp: isp, ip: ip, interval: interval
	}).then(function () {
		cov_293z5ucaer.f[4]++;
	}).catch(function () {
		cov_293z5ucaer.f[5]++;
	});
	cov_293z5ucaer.s[14]++;
	setTimeout((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
		return _regenerator2.default.wrap(function _callee2$(_context2) {
			while (1) {
				switch (_context2.prev = _context2.next) {
					case 0:
						cov_293z5ucaer.f[6]++;
						cov_293z5ucaer.s[15]++;
						_context2.next = 4;
						return redoTheTest({});

					case 4:
					case 'end':
						return _context2.stop();
				}
			}
		}, _callee2, _this);
	})), interval);
}

cov_293z5ucaer.s[16]++;
(0, _publicIp.v4)().then(function (ip_address) {
	cov_293z5ucaer.f[7]++;
	cov_293z5ucaer.s[17]++;

	(0, _log.info)('Current ip address ' + ip_address);
	cov_293z5ucaer.s[18]++;
	ip = ip_address;
	cov_293z5ucaer.s[19]++;
	interval = 10000;
	cov_293z5ucaer.s[20]++;
	redoTheTest({}).then(function () {
		cov_293z5ucaer.f[8]++;
	}).catch(function () {
		cov_293z5ucaer.f[9]++;
	});
});