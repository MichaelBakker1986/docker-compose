<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">dist/Register.js | ffl-pack</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="core package converting ffl"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="ffl-pack"><meta property="twitter:description" content="core package converting ffl"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">dist/Register.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

Object.defineProperty(exports, &quot;__esModule&quot;, {
	value: true
});
exports.Register = undefined;

var _slicedToArray2 = require(&apos;babel-runtime/helpers/slicedToArray&apos;);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _classCallCheck2 = require(&apos;babel-runtime/helpers/classCallCheck&apos;);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require(&apos;babel-runtime/helpers/createClass&apos;);

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }

var Register = function () {
	function Register() {
		var _this = this;

		var schema_defaults = arguments.length &gt; 0 &amp;&amp; arguments[0] !== undefined ? arguments[0] : [&apos;desc&apos;, &apos;start&apos;, &apos;end&apos;, &apos;name&apos;, &apos;index&apos;, &apos;modifier&apos;, &apos;parentId&apos;, &apos;tuple&apos;, &apos;refersto&apos;, &apos;tree_index&apos;, &apos;children&apos;, &apos;valid&apos;, &apos;title&apos;, &apos;type&apos;, &apos;parent_name&apos;];
		(0, _classCallCheck3.default)(this, Register);
		this.header = &apos;&apos;;
		this.schema = [];
		this.createdIndexes = [];
		this.schema_defaults = [];
		this.changes = [];

		this.print = function (idxMap, start, filter) {
			return _this.printArr(_this.i, idxMap, _this.mark || start, filter);
		};

		this.schema_defaults = schema_defaults;
		this.clean();
	}

	(0, _createClass3.default)(Register, [{
		key: &apos;clean&apos;,
		value: function clean() {
			this.header = null;
			this.constants = [];
			this.formatters = [];
			for (var j = 0; j &lt; this.createdIndexes.length; j++) {
				delete this[this.createdIndexes[j]];
			}this.createdIndexes = [];
			this.schema.length = 0;
			this.i = [];
			this.schemaIndexes = {};

			for (var _j = 0; _j &lt; this.schema_defaults.length; _j++) {
				this.addColumn(this.schema_defaults[_j]);
			}
		}
	}, {
		key: &apos;setFormatters&apos;,
		value: function setFormatters(formatters) {
			for (var i = 0; i &lt; formatters.length; i++) {
				this.formatters[i] = formatters[i];
			}
		}
	}, {
		key: &apos;findByName&apos;,
		value: function findByName(n) {
			return this.getNames()[n];
		}
	}, {
		key: &apos;getNames&apos;,
		value: function getNames() {
			return this.getIndex(&apos;name&apos;);
		}
	}, {
		key: &apos;getIndex&apos;,
		value: function getIndex(name) {
			if (!this[name]) this.createIndex(name);
			return this[name];
		}
	}, {
		key: &apos;lastRowIndex&apos;,
		value: function lastRowIndex() {
			return this.i.length - 1;
		}
	}, {
		key: &apos;addColumns&apos;,
		value: function addColumns(names) {
			var _this2 = this;

			names.forEach(function (name) {
				return _this2.addColumn(name);
			});
		}
	}, {
		key: &apos;addColumn&apos;,
		value: function addColumn(name) {
			if (this.schemaIndexes[name] == null) {
				this.schemaIndexes[name] = this.schema.length;
				this.schema.push(name);
			}
		}
	}, {
		key: &apos;removeColumn&apos;,
		value: function removeColumn(name) {
			var schemaIds = this.schemaIndexes;
			if (schemaIds[name] != null) {
				var index = schemaIds[name];
				for (var i = 0; i &lt; this.i.length; i++) {
					this.i[i].splice(index, 1);
				}
				delete schemaIds[name];
				this.schema.splice(index, 1);
				this.schema.forEach(function (el, i) {
					return schemaIds[el] = i;
				});
			}
		}
	}, {
		key: &apos;flush&apos;,
		value: function flush() {
			for (var i = 0; i &lt; this.i.length; i++) {
				this.i[i].length = this.schema.length;
			}
		}
	}, {
		key: &apos;value&apos;,
		value: function value(idx, key, _value) {
			this.i[idx][this.schemaIndexes[key]] = _value;
		}
	}, {
		key: &apos;findStream&apos;,
		value: function findStream(key, value, start) {
			return this.find(key, value, this.mark);
		}
	}, {
		key: &apos;find&apos;,
		value: function find(key, value, start) {
			var result = [];
			for (var i = start || 0; i &lt; this.i.length; i++) {
				if (this.i[i][this.schemaIndexes[key]] === value) result.push(this.i[i]);
			}return result;
		}
	}, {
		key: &apos;distinct&apos;,
		value: function distinct(schema, start) {
			return this.distinctArr(this.i, schema, start || this.mark);
		}
	}, {
		key: &apos;distinctArr&apos;,
		value: function distinctArr(arr, schema, start) {
			var result = [];
			var combi = {};
			var schemaIndexes = this.schemaIndexes;
			var distinctIndex = schema.map(function (el) {
				return schemaIndexes[el];
			});
			for (var i = start || 0; i &lt; arr.length; i++) {
				var row = arr[i];
				var key = &apos;&apos;;
				for (var j = 0; j &lt; distinctIndex.length; j++) {
					key += &apos;_&apos; + row[distinctIndex[j]];
				}if (!combi[key]) {
					result.push(row);
					combi[key] = true;
				}
			}
			return result;
		}
	}, {
		key: &apos;addIndex&apos;,
		value: function addIndex(name) {
			this.createIndex(name);
			return this[name];
		}
	}, {
		key: &apos;createIndex&apos;,
		value: function createIndex(name) {
			if (!this[name]) {
				this.createdIndexes.push(name);
				var index = {},
				    i = this.i,
				    ni = this.schemaIndexes[name];
				for (var c = 0; c &lt; i.length; c++) {
					index[i[c][ni]] = i[c];
				}this[name] = index;
			}
		}
	}, {
		key: &apos;addRowSave&apos;,
		value: function addRowSave(row) {
			this.i.push(row);
			for (var i = 0; i &lt; this.createdIndexes.length; i++) {
				var index = this.createdIndexes[i];
				this[index][row[this.schemaIndexes[index]]] = row;
			}
			return this.i.length - 1;
		}
	}, {
		key: &apos;addRows&apos;,
		value: function addRows(rows) {
			var _this3 = this;

			return rows.map(function (row) {
				return _this3.addRow(row);
			});
		}
	}, {
		key: &apos;initRows&apos;,
		value: function initRows(rows) {
			var _this4 = this;

			return rows.map(function (_ref) {
				var _ref2 = (0, _slicedToArray3.default)(_ref, 2),
				    row = _ref2[0],
				    extra = _ref2[1];

				return _this4.initRow(row, extra);
			});
		}
	}, {
		key: &apos;initRow&apos;,
		value: function initRow(row, extra) {
			var indexes = this.schemaIndexes;
			return this.addRow(extra.reduce(function (init, _ref3) {
				var col = _ref3.col,
				    val = _ref3.val;

				init[indexes[col]] = val;
				return init;
			}, row));
		}
	}, {
		key: &apos;addRow&apos;,
		value: function addRow(row) {
			this.i.push(row);
			return this.i.length - 1;
		}
	}, {
		key: &apos;inheritProperty&apos;,
		value: function inheritProperty(name, paramIndex) {
			var variable = this.getIndex(&apos;name&apos;)[name];
			if (variable[paramIndex]) return variable[paramIndex];
			if (variable[this.schemaIndexes.refersto]) return this.inheritProperty(variable[this.schemaIndexes.refersto], paramIndex);
			return &apos;&apos;;
		}
	}, {
		key: &apos;doProx&apos;,
		value: function doProx(name, metaData, param) {
			var register = this;
			var variable = this.getIndex(&apos;name&apos;)[name];
			Object.defineProperty(metaData, &apos;value&apos;, {
				set: function set(value) {
					variable[param] = value;
					register.changes.push({ name: name, param: param });
				},
				get: function get() {
					return register.inheritProperty(name, param);
				}
			});
		}
	}, {
		key: &apos;createInformationObject&apos;,
		value: function createInformationObject(name, hidden) {
			var variable = [];
			for (var paramIndex = 0; paramIndex &lt; this.schema.length; paramIndex++) {
				var propertyName = this.schema[paramIndex];

				if (hidden.indexOf(paramIndex) !== -1) continue;
				var metaData = { name: propertyName };
				this.doProx(name, metaData, paramIndex);
				variable.push(metaData);
			}
			return variable;
		}
	}, {
		key: &apos;getAll&apos;,
		value: function getAll(name) {
			var r = [],
			    index = this.i,
			    indexpos = this.schemaIndexes[name];
			for (var i = 0; i &lt; index.length; i++) {
				r[i] = index[i][indexpos];
			}return r;
		}
	}, {
		key: &apos;walk&apos;,
		value: function walk(node, depth, visitor) {
			visitor(node, depth);
			var children = node[this.schemaIndexes.children];
			for (var i = 0; i &lt; children.length; i++) {
				this.walk(children[i], depth + 1, visitor);
			}
		}
	}, {
		key: &apos;printArr&apos;,
		value: function printArr(arr, idxMap, start, filter) {
			filter = filter || [];
			var tout = [];
			var self = this;
			var filtermap = [];
			for (var i = 0; i &lt; filter.length; i++) {
				filtermap[this.schemaIndexes[filter[i]]] = true;
			}var f = function f(el, idx) {
				return filtermap[idx];
			};
			for (var _i = start || 0; _i &lt; arr.length; _i++) {
				var el = arr[_i];
				tout.push((filter.length &gt; 0 ? el.filter(f) : el).map(function (innerEl, idx) {
					var v = self.formatters[idx] ? self.formatters[idx](innerEl) : innerEl;
					var prefix = [];
					prefix.length = Math.max(idxMap[idx] - String(v).length, 0);
					return String(v).slice(0, idxMap[idx] - 1) + prefix.join(&apos; &apos;);
				}).join(&apos;|&apos;));
			}
			return tout;
		}
	}, {
		key: &apos;translateKeys&apos;,
		value: function translateKeys(formula) {
			var constants = this.constants;
			return formula.replace(/__(\d+)/gm, function ($1, $2) {
				return constants[parseInt($2)];
			}) || &apos;&apos;;
		}
	}, {
		key: &apos;iterateRows&apos;,
		value: function iterateRows(addition_property, stream) {
			var _this5 = this;

			var names = this.getNames(),
			    parent_name_index = this.schemaIndexes.parent_name,
			    extra = this.schemaIndexes[addition_property],
			    root = names.root;
			this.i.filter(function (row) {
				return row[_this5.schemaIndexes.name] !== &apos;root&apos;;
			}).forEach(function (row, index) {
				return stream(index, row, names[row[parent_name_index]] || root, row[extra]);
			});
		}
	}, {
		key: &apos;markNow&apos;,
		value: function markNow() {
			this.mark = this.i.length;
		}
	}, {
		key: &apos;toString&apos;,
		value: function toString() {
			return &apos;variables:[&apos; + this.i.length + &apos;]\nSchema:[&apos; + this.schema.map(function (el, i) {
				return el + &apos;:&apos; + i;
			}).join(&apos;,&apos;) + &apos;]\n&apos; + this.i.join(&apos;\n&apos;);
		}
	}]);
	return Register;
}();

exports.Register = Register;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
