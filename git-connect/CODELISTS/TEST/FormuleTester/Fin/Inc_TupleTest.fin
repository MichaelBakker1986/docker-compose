{&&Language=English};Inc_TupleTest.fin

.Variables
PPPP     X     1               Tuple Test model                 \TupleTest

PIII    BN   1 2               "Totaal boekwaarde"              \SumBookValue -> SumBookValue
PIII    BN  *  3               &AssetsTuple[0]                  \BookValueList=AssetsTuple_tpBookValue -> AssetsTuple_tpBookValue    ; kopie van tuple property geeft lijst ("flatview") in presentationmodel
PIII   =BN    -3=              =SumBookValue                    \=SumBookValue
PPPP    BN   1 3               "Tuple Sum" 				        \TSumBookValue
PPPP    BN   1 3               "Tuple Avg" 				        \TAvgBookValue
PPPP    BN   1 3               "Tuple Min" 				        \TMinBookValue
PPPP    BN   1 3               "Tuple Max" 				        \TMaxBookValue
PPPP    BN   1 3               "Tuple Count"			        \TCountBookValue


IIII     T   1 2               "Aktiva"+" ("+Str(TupleInstanceIndex, 0, 0)+")"	\AssetsTuple ;  expression to get tuple title with tuple instance number: & " (" & Str(TupleInstanceIndex + 1, 0, 0) & ")"
PIII    1A     3               "Omschrijving"                   \AssetsTuple_tpDescription
PIII    BN   1 3               "Boekwaarde"                     \AssetsTuple_tpBookValue
PIII    BN     3               "Investering"                    \AssetsTuple_tpInvestment
PIII    FN     3               "Afschrijving"                   \AssetsTuple_tpDepreciation
PIII    FN     3               "Total" 			                \AssetsTuple_tpTotalView;=AssetsTuple_tpTotal
PIII    FN     4               "TotalPart1"                     \AssetsTuple_tpTotalPart1
PIII    FN     4               "TotalPart2"                     \AssetsTuple_tpTotalPart2
PIII    FN     4               "Total"		                    \AssetsTuple_tpTotal


PPPP    BN   1 2               "Totaal boekwaarde Bedrijven"    \SumBookValueBedrijven

PIII    BN     2         T     "Assets Tuple Presentation View" \AssetsTupleView=AssetsTuple_tpBookValue
PIII    BN   1 3               "View Boekwaarde"                \AssetsTupleView_tpBookValue=AssetsTuple_tpBookValue 
PIII    FN   1 3               "View Afschrijving"              \AssetsTupleView_tpDepreciation=AssetsTuple_tpDepreciation 


IIII     T   1 2               "Bedrijven tuple"        		\BedrijvenTuple
PIII    1A     3               "Bedrijfsnaam"   		        \BedrijvenTuple_tpBedrijfsnaam
PPPP    BN   1 3               "Nested totaal boekwaarde"       \NestedSumBookValueBedrijven
IIII     T   1 3               "Nested Aktiva tuple"            \NestedAssetsTuple
PIII    1A     4               "Nested Omschrijving"            \NestedAssetsTuple_tpDescription
PIII    BN   1 4               "Nested Boekwaarde"              \NestedAssetsTuple_tpBookValue
PIII    BN     4               "Nested Investering"             \NestedAssetsTuple_tpInvestment
PIII    FN     4               "Nested Afschrijving"            \NestedAssetsTuple_tpDepreciation

PPPP    BN   1 2               "TupleSum formula used in formula test"    	\TupleSumUsedInFormula
PIII     T   1 3               "TupleSum formula TD"            			\TupleSumUsedInFormula_TD
PIII    1N   1 4               "TupleSum formula TP" 						\TupleSumUsedInFormula_TP
PIII    1N   1 3               "TupleSum formula Sum"						\TupleSumUsedInFormula_SUM
PIII    1N   1 3  +            "TupleSum formula Sum SaveCalc"				\TupleSumUsedInFormula_SUM_SaveCalc

PIII     T   1 3               "TupleSum formula external TD"            	\TupleSumUsedInFormula_TD_User
PIII    1N   1 4               "TupleSum formula external TP" 				\TupleSumUsedInFormula_TP_User

IIII    FN   1 2               "Simulated Tuples"                                                               \SimulatedTuples
IIII    FN     3               "Simulated Tuple 1"                                     	 						\SimulatedTuple_ti001
IIII    FN     4               "Simulated Tuple Property 1"                                     	 			\SimulatedTupleProperty_ti001
IIII    FN     5               "Simulated Tuple SubProperty 1"                                     	 			\SimulatedTupleSubProperty_ti001
IIII    FN     3               "Simulated Tuple 2"                                       						\SimulatedTuple_ti002
IIII    FN     4               "Simulated Tuple Property 2"                                     	 			\SimulatedTupleProperty_ti002
IIII    FN     5               "Simulated Tuple SubProperty 2"                                     	 			\SimulatedTupleSubProperty_ti002
IIII    FN     3               "Simulated Tuple 3"                                       						\SimulatedTuple_ti003
IIII    FN     4               "Simulated Tuple Property 3"                                     	 			\SimulatedTupleProperty_ti003
IIII    FN     5               "Simulated Tuple SubProperty 3"                                     	 			\SimulatedTupleSubProperty_ti003

.Formulas NoTrend,Trend
AssetsTupleView = AssetsTuple_tpBookValue
TSumBookValue = TupleSum(AssetsTuple_tpBookValue)
;TAvgBookValue = TupleAvg(AssetsTuple_tpBookValue)      
;TMinBookValue = TupleMin(AssetsTuple_tpBookValue)      
;TMaxBookValue = TupleMax(AssetsTuple_tpBookValue)      
;TCountBookValue = TupleCount(AssetsTuple_tpBookValue)  

AssetsTuple_tpInvestment= AssetsTuple_tpBookValue-AssetsTuple_tpBookValue[T-1]+AssetsTuple_tpDepreciation    ; test formule binnen tuple, moet werken voor alle instances
AssetsTuple_tpTotal = AssetsTuple_tpTotalPart1 + AssetsTuple_tpTotalPart2
AssetsTuple_tpTotalView = AssetsTuple_tpTotal ; temporary instead of a reference variable to AssetsTuple_tpTotal
SumBookValueBedrijven= TupleSum(NestedAssetsTuple_tpBookValue)

NestedSumBookValueBedrijven= TupleSum(NestedAssetsTuple_tpBookValue)

NestedAssetsTuple_tpInvestment= NestedAssetsTuple_tpBookValue-NestedAssetsTuple_tpBookValue[T-1]+NestedAssetsTuple_tpDepreciation    ; test formule binnen tuple, moet werken voor alle instances

TupleSumUsedInFormula_SUM = TupleSum(TupleSumUsedInFormula_TP)
TupleSumUsedInFormula_SUM_SaveCalc = TupleSum(TupleSumUsedInFormula_TP)
TupleSumUsedInFormula_TP_User = TupleSumUsedInFormula_SUM * 2 

; TODO: avg/min/max/count

;------------------------------
; Test for a nested tuple that uses its base tuple's value in its formula
.Variables
IIII     T   1 2               "Tuple"        					\BaseTuple
PIII    1N     3               "Tuple Value"   		        	\BaseTupleValue
IIII     T   1 3               "Nested Tuple"            		\NestedTuple
PIII    1N   1 4               "Nested Tuple Value"             \NestedTupleValue
IIII     T   1 3               "Nested Nested Tuple"            \NestedNestedTuple
PIII    1N   1 4               "Nested Nested Tuple Value 1"    \NestedNestedTupleValue1
PIII    1N   1 4               "Nested Nested Tuple Value 2"    \NestedNestedTupleValue2

.Formulas NoTrend,Trend
BaseTupleValue			= 1000
NestedTupleValue		= 2 * BaseTupleValue
NestedNestedTupleValue1	= 3 * BaseTupleValue
NestedNestedTupleValue2	= 2 * NestedTupleValue