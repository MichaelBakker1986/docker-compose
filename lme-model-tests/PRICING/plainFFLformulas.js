RootSub1_value=undefined;
RootSub1_title='General variables for webclient';
RootSub1_locked=1;
RootSub1_visible=0;
FES_LAYOUTNR_value=If(Pos('IFRS-EU',FES_LAYOUT[doc])>0,1,If(Pos('IFRS-PL',FES_LAYOUT[doc])>0,48,If(Pos('IFRS-Intl',FES_LAYOUT[doc])>0,2,0)));
FES_LAYOUTNR_title='Layout';
FES_LAYOUTNR_choices=[{'name':' 0','value':' NA'},{'name':'1','value':' IFRS-EU'},{'name':'2','value':' IFRS'},{'name':'48','value':' Polish'}];
FES_EXCHANGE_RATES_value=undefined;
FES_EXCHANGE_RATES_title='Exchange Rates';
FES_LAYOUT_value=undefined;
FES_LAYOUT_title='Layout name';
FES_FLATINPUT_value=undefined;
FES_FLATINPUT_title='Is flat input used (1==yes)';
FES_PROJECTION_PROFILE_value=undefined;
FES_PROJECTION_PROFILE_title='Projection Profile';
FES_COLUMN_ORDER_value=undefined;
FES_COLUMN_ORDER_title='Column order';
FES_COLUMN_VISIBLE_value=1;
FES_COLUMN_VISIBLE_title='Column visible';
FES_StartDatePERIOD_value=undefined;
FES_StartDatePERIOD_title='Start Date Period';
FES_ENDDATEPERIOD_value=undefined;
FES_ENDDATEPERIOD_title='End Date Period';
FES_BASECURRENCYPERIOD_value=undefined;
FES_BASECURRENCYPERIOD_title='Base Currency Period';
FES_VIEWCURRENCYPERIOD_value=undefined;
FES_VIEWCURRENCYPERIOD_title='View Currency Period';
FES_COLUMNTYPE_value=undefined;
FES_COLUMNTYPE_title='Column Type';
FES_COLUMNTYPE_choices=[{'name':' 0','value':'History'},{'name':'1','value':'Projection'}];
RootSub2_value=undefined;
RootSub2_title='General variables for FPS database';
FPS_VAR_Naam_value=undefined;
FPS_VAR_Naam_title='NAME';
FPS_VAR_Relatienummer_value=undefined;
FPS_VAR_Relatienummer_title='CUSTOMERNUMBER';
FPS_VAR_KVKnr_value=undefined;
FPS_VAR_KVKnr_title='CHAMBEROFCOMMERCENUMBER';
FPS_VAR_Rechtsvorm_nr_value=undefined;
FPS_VAR_Rechtsvorm_nr_title='LEGALSTATUSCODE';
FPS_VAR_Rechtsvorm_omschr_value=undefined;
FPS_VAR_Rechtsvorm_omschr_title='LEGALSTATUSDESCRIPTION';
FPS_VAR_BIK_CODE_value=undefined;
FPS_VAR_BIK_CODE_title='SECTOROFINDUSTRYCODE';
FPS_VAR_SECTOR_OF_INDUSTRY_CODE_TYPE_value=undefined;
FPS_VAR_SECTOR_OF_INDUSTRY_CODE_TYPE_title='SECTOROFINDUSTRYCODETYPE';
FPS_VAR_BIK_Omschr_value=undefined;
FPS_VAR_BIK_Omschr_title='SECTOROFINDUSTRYDESCRIPTION';
FPS_VAR_GridId_value=undefined;
FPS_VAR_GridId_title='GRIDID';
FPS_VAR_Accountmanager_value=undefined;
FPS_VAR_Accountmanager_title='ACCOUNTMANAGER';
FPS_VAR_Kantoor_value=undefined;
FPS_VAR_Kantoor_title='OFFICENUMBER';
FPS_VAR_Straat_value=undefined;
FPS_VAR_Straat_title='STREET';
FPS_VAR_Housenumber_value=undefined;
FPS_VAR_Housenumber_title='HOUSENUMBER';
FPS_VAR_Postcode_value=undefined;
FPS_VAR_Postcode_title='ZIPCODE';
FPS_VAR_Woonplaats_value=undefined;
FPS_VAR_Woonplaats_title='CITY';
FPS_VAR_Provincie_value=undefined;
FPS_VAR_Provincie_title='STATEORPROVINCE';
FPS_VAR_Land_value=undefined;
FPS_VAR_Land_title='COUNTRY';
FPS_VAR_BvDID_value=undefined;
FPS_VAR_BvDID_title='Bureau van Dijk ID';
FPS_VAR_Telefoon_value=undefined;
FPS_VAR_Telefoon_title='Telefoonnummer';
FPS_VAR_Emailadres_value=undefined;
FPS_VAR_Emailadres_title='Emailadres';
FPS_FINAN_USER_ROLES_value=undefined;
FPS_FINAN_USER_ROLES_title='FPS_FINAN_USER_ROLES';
FPS_FINAN_USER_value=undefined;
FPS_FINAN_USER_title='FPS_FINAN_USER';
Q_ROOT_value=If(Q_MAP01[doc]==1||Length(scKnockoutsCombi[doc])>0,1,0);
Q_ROOT_title='FiNiS Pricing';
Q_ROOT_choices=[{'name':' 0','value':'Complete.'},{'name':'1','value':'Not complete.'}];
Q_MAP01_value=Q_MAP01_ENTEREDREQUIREDVARS==Q_MAP01_REQUIREDVARS;
Q_MAP01_title='AAB Pricing';
Q_MAP01_WARNING_value=String(Q_WARNING_GLOBAL[doc]);
Q_MAP01_WARNING_title='Warning voor map';
Q_MAP01_INFO_value=undefined;
Q_MAP01_INFO_title='Info bij stap';
Q_MAP01_VALIDATION_value=String(If(Q_MAP01[doc]==0,'Not all required questions in this step are completed. [BR][/BR]Mandatory questions are marked with a *.',''));
Q_MAP01_VALIDATION_title='Validatie stap';
Agreement_value=undefined;
Agreement_title='Agreement';
AgreementSub1_value=undefined;
AgreementIdentifier_value=undefined;
AgreementIdentifier_title='Agreement identifier';
ShowTestVariables_value=0;
ShowTestVariables_title='Show Test Variables';
ShowTestVariables_choices=[{'name':' 1','value':'Yes'},{'name':'0','value':'No'}];
TargetRaRoRaCDriven_value=If(TupleSum(Facility_tpCustomerSpread2)==NA,1,0);
TargetRaRoRaCDriven_title='Target RaRoRaC Driven Calculation';
AgreementHiddenfields_value=undefined;
AgreementHiddenfields_title='Hidden fields for calculations';
AgreementHiddenfields_visible=ShowTestVariables;
AgreementNumber_value=undefined;
AgreementDiversificationOR_value=MatrixLookup('CalculationParameters','OPERATIONALRISK',2);
AgreementDiversificationOR_title='Diversifivation Factor for Operational Risk';
AgreementDiversificationBR_value=MatrixLookup('CalculationParameters','BUSINESSRISK',2);
AgreementDiversificationBR_title='Diversifivation Factor for Business Risk';
AgreementDiversificationCR_value=MatrixLookup('CalculationParameters','CREDITRISK',2);
AgreementDiversificationCR_title='Diversifivation Factor for Credit Risk';
AgreementMaxRemainingTenor_value=TupleMax(Facility_tpRemainingTenor);
AgreementMaxRemainingTenor_title='Maximum Remaining Tenor Agreement (months)';
AgreementNumberOfBorrowers_value=1;
AgreementNumberOfBorrowers_title='Number of Borrowers';
AgreementFixedCostOperatingConcept_value=Borrower_tpAmountFixedCostOperatingConceptClientGroup;
AgreementFixedCostOperatingConcept_title='Cost per Service Concept - Fixed Cost Operating Concept';
AgreementPercentageOperatingConcept_value=Borrower_tpPercentageOperatingConcept;
AgreementPercentageOperatingConcept_title='Percentage Service Concept';
AgreementSubDebtRatio_value=MatrixLookup('CalculationParameters','SUBORDDEBTRATIOPERC',2);
AgreementSubDebtRatio_title='Subordinated Debt Capital Charge - Sub Debt Ratio ()';
AgreementCostOfSubordination_value=MatrixLookup('CalculationParameters','COSTOFSUBORDBP',2);
AgreementCostOfSubordination_title='Subordinated Debt Capital Charge - Cost of Subordination (bp)';
AgreementAvailableAmountOfEquity_value=0;
AgreementAvailableAmountOfEquity_title='Available Amount of Equity';
AgreementSub6_value=undefined;
AgreementSub6_title='Profit&&Losses';
AgreementProfitAndLoss_value=undefined;
AgreementProfitAndLoss_title='Profit&&Losses - Clients';
AgreementIncome_value=Borrower_tpIncome;
AgreementIncome_title='Revenues';
AgreementInterestIncome_value=Borrower_tpInterestIncome;
AgreementInterestIncome_title='Interest income';
AgreementCreditRelatedFee_value=Borrower_tpCreditRelatedFee;
AgreementCreditRelatedFee_title='Credit related fees';
AgreementIndirectLiquidityCosts_value=Borrower_tpIndirectLiquidityCosts;
AgreementIndirectLiquidityCosts_title='Indirect Liquidity Costs';
AgreementDirectLiquidityPremium_value=Borrower_tpDirectLiquidityPremium;
AgreementDirectLiquidityPremium_title='Direct Liquidity Premium';
AgreementSubordinatedDebtCapitalCharge_value=Borrower_tpSubordinatedDebtCapitalCharge;
AgreementSubordinatedDebtCapitalCharge_title='Subordinated Debt Capital Charge';
AgreementEquityFundingAdjustment_value=Borrower_tpEquityFundingAdjustment;
AgreementEquityFundingAdjustment_title='Equity Funding Adjustment';
AgreementOperationalCosts_value=Borrower_tpOperationalCosts;
AgreementOperationalCosts_title='Operational Costs';
AgreementInternalExpectedLoss_value=Borrower_tpInternalExpectedLoss;
AgreementInternalExpectedLoss_title='Internal Expected Loss';
AgreementTax_value=Borrower_tpTax;
AgreementTax_title='Tax';
AgreementRiskAdjustedReturn_value=Borrower_tpRiskAdjustedReturn;
AgreementRiskAdjustedReturn_title='Risk adjusted return';
AgreementReturnOnEquity_value=OnER(AgreementRiskAdjustedReturn/AgreementRiskAdjustedCapital,NA);
AgreementReturnOnEquity_title='Return On Equity';
AgreementRiskAdjustedCapital_value=undefined;
AgreementRiskAdjustedCapital_title='Risk Adjusted Capital';
AgreementRaRoRaC_value=OnER(AgreementRiskAdjustedReturn/AgreementEconomicCapital,NA);
AgreementRaRoRaC_title='RaRoRaC';
AgreementEconomicCapital_value=AgreementOperationalRisk+AgreementBusinessRisk+AgreementCreditRisk;
AgreementEconomicCapital_title='Economic Capital';
AgreementOperationalRisk_value=Borrower_tpOperationalRisk;
AgreementOperationalRisk_title='Economic Capital - Operational Risk';
AgreementBusinessRisk_value=Borrower_tpBusinessRisk;
AgreementBusinessRisk_title='Economic Capital - Business Risk';
AgreementCreditRisk_value=Borrower_tpCreditRisk;
AgreementCreditRisk_title='Economic Capital - Credit Risk';
AgreementRegulatoryProfit_value=OnER(AgreementRiskAdjustedReturn-AgreementEquityCapitalCharge,NA);
AgreementRegulatoryProfit_title='Regulatory Profit';
AgreementEquityCapitalCharge_value=Borrower_tpEquityCapitalCharge;
AgreementEquityCapitalCharge_title='Equity Capital Charge';
AgreementEconomicProfit_value=OnER(Borrower_tpRiskAdjustedReturn-AgreementEconomicCapital*Borrower_tpEffectiveCostOfCapital,NA);
AgreementEconomicProfit_title='Economic Profit';
AgreementEffectiveCostOfCapital_value=undefined;
AgreementEffectiveCostOfCapital_title='Effective Cost Of Capital';
AgreementOtherMetrics_value=undefined;
AgreementOtherMetrics_title='Other Metrics';
AgreementPrincipalLimit_value=Borrower_tpPrincipalLimit;
AgreementPrincipalLimit_title='Principal Limit';
AgreementExpectedAverageOutstanding_value=Borrower_tpExpectedAverageOutstanding;
AgreementExpectedAverageOutstanding_title='Expected Average Outstanding';
AgreementRWA_value=Borrower_tpRWA;
AgreementRWA_title='RWA';
AgreementRWACreditRisk_value=Borrower_tpRWACreditRisk;
AgreementRWACreditRisk_title='RWA Credit Risk';
AgreementRWAOperationalRisk_value=Borrower_tpRWAOperationalRisk;
AgreementRWAOperationalRisk_title='RWA Operational Risk';
AgreementEAD_value=Borrower_tpEAD;
AgreementEAD_title='EAD';
Borrower_value=undefined;
Borrower_title='Borrower';
Borrower_tpInput_value=undefined;
Borrower_tpInput_title='Client details';
Borrower_tpReferenceNumber_value=String(FPS_VAR_Relatienummer);
Borrower_tpReferenceNumber_title='Borrower Reference';
Borrower_tpBaseCurrencyChoice_value=1;
Borrower_tpBaseCurrencyChoice_title='Base Currency of Borrower';
Borrower_tpBaseCurrencyChoice_choices=[{'name':' 01','value':'EUR'},{'name':'02','value':'BRL'},{'name':'03','value':'CAD'},{'name':'04','value':'CHF'},{'name':'05','value':'GBP'},{'name':'06','value':'HKD'},{'name':'07','value':'INR'},{'name':'08','value':'MXN'},{'name':'09','value':'NOK'},{'name':'10','value':'SGD'},{'name':'11','value':'USD'}];
Borrower_tpBaseCurrency_value=String(Case(Borrower_tpBaseCurrencyChoice,[1,'EUR'||2,'BRL'||3,'CAD'||4,'CHF'||5,'GBP'||6,'HKD'||7,'INR'||8,'MXN'||9,'NOK'||10,'SGD'||11,'USD']));
Borrower_tpBaseCurrency_title='Currency';
Borrower_tpClientGroup_value=String(SubStr(Case(Borrower_tpClientGroupChoice,[1,'PAR - Particulieren/Medici'||2,'PBN - PBNL'||3,'PBI - PBI'||4,'PBF - PBI - France'||5,'PBD - PBI - Germany'||6,'PBG - PBI - Guernsey'||7,'PBH - PBI - Hong Kong'||8,'PBJ - PBI - Jersey'||9,'PBL - PBI - Luxembourg'||10,'PBS - PBI - Singapore'||11,'PBU - PBI - UAE'||12,'PBB - PBI - Belgium'||13,'IDJ - IC-D+J Clients'||14,'YBB - Retail Banking-YBB'||15,'BRM - Commercial Clients-REC'||16,'CR1 - Commercial Clients-RM_A1'||17,'CR2 - Commercial Clients-RM_A2'||18,'CR3 - Commercial Clients-RM_A3'||19,'CCL - Commercial Clients-CC'||20,'PUB - Commercial Clients-PublicSector'||21,'DDP - Commercial Clients-Deal Desk Public'||22,'LMF - IC-FinancialInstitutions'||23,'LMR - IC-RealEstate'||24,'LML - IC-LargeCorporates'||25,'LME - IC-ECT Clients'||26,'LMD - IC-DebtSolutions'||27,'LMC - IC-exCC Clients']),0,3));
Borrower_tpClientGroup_title='Client Group Code';
Borrower_tpClientGroupChoice_value=18;
Borrower_tpClientGroupChoice_title='Client Group';
Borrower_tpAGICOrSBI_value=If(Borrower_tpSectorType=='AGIC',0,If(Borrower_tpSectorType=='SBI',1,NA));
Borrower_tpAGICOrSBI_title='Do you want to use an AGIC || SBI identification code';
Borrower_tpAGICOrSBI_choices=[{'name':' 0','value':'AGIC'},{'name':'1','value':'SBI'}];
Borrower_tpAGICChoice_value=undefined;
Borrower_tpAGICChoice_title='AGIC Sector';
Borrower_tpAGICChoice_visible=Borrower_tpAGICOrSBI==0;
Borrower_tpAGIC_value=undefined;
Borrower_tpAGIC_title='AGIC Code';
Borrower_tpFinancialInstitutionChoice_value=If(Borrower_tpAGICOrSBI==0,If(MatrixLookup('AGICMapping',''+Borrower_tpAGIC,3)==1,1,0),If(MatrixLookup('SBIMapping',''+Borrower_tpSBI,3)==1,1,0));
Borrower_tpFinancialInstitutionChoice_title='Financial Institution Choice';
Borrower_tpUnderSupervision_value=0;
Borrower_tpUnderSupervision_title='Under Supervision';
Borrower_tpBookingLocationChoice_value=20;
Borrower_tpBookingLocationChoice_title='Booking location';
Borrower_tpBookingLocationChoice_choices=[{'name':' 01','value':'Australia'},{'name':'02','value':'Austria'},{'name':'03','value':'Belgium'},{'name':'04','value':'Brazil'},{'name':'05','value':'Canada'},{'name':'06','value':'China'},{'name':'07','value':'Czech Republic'},{'name':'08','value':'Denmark'},{'name':'09','value':'France'},{'name':'10','value':'Germany'},{'name':'11','value':'Greece'},{'name':'12','value':'Hong Kong'},{'name':'13','value':'Hungary'},{'name':'14','value':'Indonesia'},{'name':'15','value':'India'},{'name':'16','value':'Ireland'},{'name':'17','value':'Italy'},{'name':'18','value':'Japan'},{'name':'19','value':'Luxembourg'},{'name':'20','value':'Netherlands'},{'name':'21','value':'Norway'},{'name':'22','value':'Poland'},{'name':'23','value':'Portugal'},{'name':'24','value':'Romania'},{'name':'25','value':'Singapore'},{'name':'26','value':'South Africa'},{'name':'27','value':'Spain'},{'name':'28','value':'Sweden'},{'name':'29','value':'Switzerland'},{'name':'30','value':'Turkey'},{'name':'31','value':'United Arab Emirates'},{'name':'32','value':'United Kingdom'},{'name':'33','value':'United States'}];
Borrower_tpAssetSize2_value=MatrixLookup('CalculationParameters','DEFAULT_ASSET_SIZE',2);
Borrower_tpAssetSize2_title='Asset Size (mio)';
Borrower_tpDataImportedFromForce_value=undefined;
Borrower_tpDataImportedFromForce_title=String('Imported Data');
Borrower_tpMainBorrowerLabeledRating_value=undefined;
Borrower_tpMainBorrowerLabeledRating_title='UCR';
Borrower_tpName_value=String(FPS_VAR_Naam);
Borrower_tpName_title='Borrower Name';
Borrower_tpSBI_value=String(If(Borrower_tpSectorType=='SBI',Borrower_tpSectorCode,NA));
Borrower_tpSBI_title='SBI branche code (Geen lijst)';
Borrower_tpSBI_visible=Borrower_tpAGICOrSBI==1;
Borrower_tpPDModel_value=undefined;
Borrower_tpPDModel_title='PD Model';
Borrower_tpAutomaticInput_value=undefined;
Borrower_tpAutomaticInput_title='Automatic Input';
Borrower_tpClientGroupFullName_value=String(SubStr(Case(Borrower_tpClientGroupChoice,[1,'PAR - Particulieren/Medici'||2,'PBN - PBNL'||3,'PBI - PBI'||4,'PBF - PBI - France'||5,'PBD - PBI - Germany'||6,'PBG - PBI - Guernsey'||7,'PBH - PBI - Hong Kong'||8,'PBJ - PBI - Jersey'||9,'PBL - PBI - Luxembourg'||10,'PBS - PBI - Singapore'||11,'PBU - PBI - UAE'||12,'PBB - PBI - Belgium'||13,'IDJ - IC-D+J Clients'||14,'YBB - Retail Banking-YBB'||15,'BRM - Commercial Clients-REC'||16,'CR1 - Commercial Clients-RM_A1'||17,'CR2 - Commercial Clients-RM_A2'||18,'CR3 - Commercial Clients-RM_A3'||19,'CCL - Commercial Clients-CC'||20,'PUB - Commercial Clients-PublicSector'||21,'DDP - Commercial Clients-Deal Desk Public'||22,'LMF - IC-FinancialInstitutions'||23,'LMR - IC-RealEstate'||24,'LML - IC-LargeCorporates'||25,'LME - IC-ECT Clients'||26,'LMD - IC-DebtSolutions'||27,'LMC - IC-exCC Clients']),7,99));
Borrower_tpSectorType_value=String(FPS_VAR_SECTOR_OF_INDUSTRY_CODE_TYPE);
Borrower_tpSectorType_title='Sector type (SBI || AGIC)';
Borrower_tpSectorCode_value=String(FPS_VAR_BIK_CODE);
Borrower_tpSectorCode_title='Sector code';
Borrower_tpBookingLocation_value=String(Case(Borrower_tpBookingLocationChoice,[1,'Australia'||2,'Austria'||3,'Belgium'||4,'Brazil'||5,'Canada'||6,'China'||7,'Czech Republic'||8,'Denmark'||9,'France'||10,'Germany'||11,'Greece'||12,'Hong Kong'||13,'Hungary'||14,'Indonesia'||15,'India'||16,'Ireland'||17,'Italy'||18,'Japan'||19,'Luxembourg'||20,'Netherlands'||21,'Norway'||22,'Poland'||23,'Portugal'||24,'Romania'||25,'Singapore'||26,'South Africa'||27,'Spain'||28,'Sweden'||29,'Switzerland'||30,'Turkey'||31,'United Arab Emirates'||32,'United Kingdom'||33,'United States']));
Borrower_tpBookingLocation_title='Booking location Tekst';
Borrower_tpTaxRate_value=MatrixLookup('TaxRate',Borrower_tpBookingLocation,1);
Borrower_tpTaxRate_title='Tax Rate';
Borrower_tpRating_value=String(Borrower_tpMainBorrowerLabeledRating);
Borrower_tpRating_title='UCR Rating';
Borrower_tpPD_value=MatrixLookup('PD',Borrower_tpRating,1);
Borrower_tpPD_title='Probability of Default ()';
Borrower_tpPDMoC_value=Borrower_tpPD*Borrower_tpMoCFactor;
Borrower_tpPDMoC_title='Probability of Default MoC ()';
Borrower_tpAssetSize_value=Borrower_tpAssetSize2;
Borrower_tpPDModelFullName_value=String(MatrixLookup('VertaaltabelPDModel',Borrower_tpPDModel,1));
Borrower_tpMoCFactor_value=MatrixLookup('MOCFactorPD',Borrower_tpPDModel,1);
Borrower_tpMoCFactor_title='MoC Factor';
Borrower_tpARCAddOn_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,2);
Borrower_tpARCAddOn_title='ARC Add-on';
Borrower_tpRiskWeight_value=CumNormal((InvNormal(Borrower_tpPDMoC)-(Borrower_tpRho^.5)*InvNormal(1-Borrower_tpConfidenceLevel))/(1-Borrower_tpRho^.5));
Borrower_tpRiskWeight_title='Risk Weight';
Borrower_tpRho_value=MatrixLookup('EquityIndex',Borrower_tpEquityIndex,4);
Borrower_tpRho_title='Rho';
Borrower_tpEquityIndex_value=If(Borrower_tpAGICOrSBI==0,MatrixLookup('AGICMapping',''+Borrower_tpAGIC,2),MatrixLookup('SBIMapping',''+Borrower_tpSBI,2));
Borrower_tpEquityIndex_title='Equity Index';
Borrower_tpFinancialInstitution_value=String(If(Borrower_tpAGICOrSBI==0,MatrixLookup('AGICMapping',''+Borrower_tpAGIC,4),MatrixLookup('SBIMapping',''+Borrower_tpSBI,4)));
Borrower_tpFinancialInstitution_title='Financial Institution Description';
Borrower_tpCalibrationFactor_value=MatrixLookup('CalibrationFactor',Borrower_tpCalibrationFactorID,3);
Borrower_tpCalibrationFactor_title='Calibration Factor';
Borrower_tpCalibrationFactorID_value=String(Borrower_tpRating+'_'+Borrower_tpClientGroup);
Borrower_tpCalibrationFactorID_title='Calibration Factor ID';
Borrower_tpEAD_value=TupleSum(Facility_tpEAD);
Borrower_tpEAD_title='Exposure At Default';
Borrower_tpAverageEAD_value=undefined;
Borrower_tpAverageEAD_title='Average EAD';
Borrower_tpSumExpectedAverageOutstanding_value=TupleSum(Facility_tpExpectedAverageOutstanding);
Borrower_tpSumExpectedAverageOutstanding_title='Total Expected Average Outstanding Borrower';
Borrower_tpNrOfFacilities_value=TupleCount(Facility_tpID);
Borrower_tpNrOfFacilities_title='Number of Facilities';
Borrower_tpEquityRatio_value=MatrixLookup('CalculationParameters','AllocatedEquityRatio',2);
Borrower_tpEquityRatio_title='Equity Ratio';
Borrower_tpCostofEquity_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,6);
Borrower_tpCostofEquity_title='Cost of Equity';
Borrower_tpConfidenceLevel_value=MatrixLookup('CalculationParameters','ConfidenceLevel',2);
Borrower_tpConfidenceLevel_title='Confidence Level';
Borrower_tpEffectiveCostOfCapital_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,8);
Borrower_tpEffectiveCostOfCapital_title='Effective Cost of Capital ()';
Borrower_tpFixedCostOperatingConcept_value=AgreementFixedCostOperatingConcept/AgreementNumberOfBorrowers;
Borrower_tpFixedCostOperatingConcept_title='Fixed Cost Operating Concept';
Borrower_tpAmountFixedCostOperatingConceptClientGroup_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,4);
Borrower_tpAmountFixedCostOperatingConceptClientGroup_title='Amount Fixed Cost Operating Concept for Client Group';
Borrower_tpPLorNPL_value=1;
Borrower_tpPLorNPL_title='PL / NPL account';
Borrower_tpPLorNPL_choices=[{'name':' 1','value':'PL'},{'name':'0','value':'NPL'}];
Borrower_tpNonCreditIncome_Total_value=TupleSum(Borrower_tpNonCredit_tpIncome_Amount);
Borrower_tpNonCreditIncome_Total_title='Cross Sell Total Income';
Borrower_tpNonCreditCosts_Total_value=TupleSum(Borrower_tpNonCredit_tpCosts)+Borrower_tpNonCreditCostsCostPerServiceConcept;
Borrower_tpNonCreditCosts_Total_title='Cross Sell Total Costs';
Borrower_tpNonCreditCostsCostPerServiceConcept_value=(1-AgreementPercentageOperatingConcept)*Borrower_tpFixedCostOperatingConcept;
Borrower_tpNonCreditCostsCostPerServiceConcept_title='Non Credit Costs - Cost Per Service Concept';
Borrower_tpPercentageOperatingConcept_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,5);
Borrower_tpPercentageOperatingConcept_title='Credit Cost per Service Concept - Percentage Operating Concept';
Borrower_tpSBIName_value=String(MatrixLookup('SBIMapping',''+Borrower_tpSBI,1));
Borrower_tpSBIName_title='SBI branche naam';
Borrower_tpHiddenVariablesBorrowerInformation_value=undefined;
Borrower_tpHiddenVariablesBorrowerInformation_title='Hidden variables for Borrower section Compact Report';
Borrower_tpBrancheDescriptionCompactReport_value=String(If(Borrower_tpAGICOrSBI==0,Borrower_tpAGICChoiceName,Borrower_tpSBIName));
Borrower_tpBrancheDescriptionCompactReport_title='AGIC/SBI Code';
Borrower_tpAGICChoiceName_value=undefined;
Borrower_tpAGICChoiceName_title='AGIC Sector Description';
Borrower_tpProfitAndLossClient_value=undefined;
Borrower_tpProfitAndLossClient_title='Profit&&Losses - Credit';
Borrower_tpIncome_value=Borrower_tpInterestIncome+Borrower_tpCreditRelatedFee;
Borrower_tpInterestIncome_value=TupleSum(Facility_tpInterestIncome);
Borrower_tpCreditRelatedFee_value=TupleSum(Facility_tpCreditRelatedFee);
Borrower_tpOptionCostsIndLiqPremium_value=TupleSum(Facility_tpOptionCostsIndLiqPrem);
Borrower_tpOptionCostsIndLiqPremium_title='Option Costs/Ind. Liq. Premium';
Borrower_tpIndirectLiquidityCosts_value=TupleSum(Facility_tpIndirectLiquidityCosts);
Borrower_tpPrepaymentCosts_value=TupleSum(Facility_tpPrepaymentCosts);
Borrower_tpPrepaymentCosts_title='Prepayment Costs';
Borrower_tpPipelineRisk_value=TupleSum(Facility_tpPipelineRisk);
Borrower_tpPipelineRisk_title='Pipeline Risk';
Borrower_tpDirectLiquidityPremium_value=TupleSum(Facility_tpDirectLiquidityPremium);
Borrower_tpSubordinatedDebtCapitalCharge_value=TupleSum(Facility_tpSubordinatedDebtCapitalCharge);
Borrower_tpEquityFundingAdjustment_value=TupleSum(Facility_tpEquityFundingAdjustment);
Borrower_tpOperationalCosts_value=Borrower_tpCostPerContract+Borrower_tpCostOverVolume+Borrower_tpCostPerServiceConcept;
Borrower_tpCostPerContract_value=TupleSum(Facility_tpCostPerContract);
Borrower_tpCostPerContract_title='Cost per Contract';
Borrower_tpCostPerServiceConcept_value=Borrower_tpFixedCostOperatingConcept*AgreementPercentageOperatingConcept;
Borrower_tpCostPerServiceConcept_title='Cost per Service Concept';
Borrower_tpCostOverVolume_value=TupleSum(Facility_tpCostOverVolume);
Borrower_tpCostOverVolume_title='Cost over Volume';
Borrower_tpInternalExpectedLoss_value=TupleSum(Facility_tpInternalExpectedLoss);
Borrower_tpTax_value=(Borrower_tpIncome-Borrower_tpPrepaymentCosts-Borrower_tpPipelineRisk-Borrower_tpIndirectLiquidityCosts-Borrower_tpDirectLiquidityPremium-Borrower_tpOperationalCosts-Borrower_tpSubordinatedDebtCapitalCharge+Borrower_tpEquityFundingAdjustment-Borrower_tpInternalExpectedLoss)*Borrower_tpTaxRate;
Borrower_tpRiskAdjustedReturn_value=Borrower_tpIncome-Borrower_tpPrepaymentCosts-Borrower_tpPipelineRisk-Borrower_tpIndirectLiquidityCosts-Borrower_tpDirectLiquidityPremium-Borrower_tpOperationalCosts-Borrower_tpSubordinatedDebtCapitalCharge+Borrower_tpEquityFundingAdjustment-Borrower_tpInternalExpectedLoss-Borrower_tpTax;
Borrower_tpRiskAdjustedReturn_title='Risk Adjusted Return';
Borrower_tpReturnOnEquity_value=OnER(Borrower_tpRiskAdjustedReturn/Borrower_tpRequiredAmountOfEquity,NA);
Borrower_tpRequiredAmountOfEquity_value=TupleSum(Facility_tpRequiredAmountofEquity);
Borrower_tpRequiredAmountOfEquity_title='Required Amount of Equity';
Borrower_tpRaRoRaC_value=OnER(Borrower_tpRiskAdjustedReturn/Borrower_tpEconomicCapital,NA);
Borrower_tpEconomicCapital_value=Borrower_tpOperationalRisk+Borrower_tpBusinessRisk+Borrower_tpCreditRisk;
Borrower_tpOperationalRisk_value=TupleSum(Facility_tpORCreditRisk);
Borrower_tpBusinessRisk_value=TupleSum(Facility_tpBRCreditRisk);
Borrower_tpCreditRisk_value=TupleSum(Facility_tpCreditRisk);
Borrower_tpRegulatoryProfit_value=OnER(Borrower_tpRiskAdjustedReturn-Borrower_tpEquityCapitalCharge,NA);
Borrower_tpEquityCapitalCharge_value=TupleSum(Facility_tpEquityCapitalCharge);
Borrower_tpEconomicProfit_value=OnER(Borrower_tpRiskAdjustedReturn-Borrower_tpEconomicCapital*Borrower_tpEffectiveCostOfCapital,NA);
Borrower_tpEconomicProfitSub1_value=undefined;
Borrower_tpCostOfEconomicCapital_value=Borrower_tpEconomicCapital*Borrower_tpEffectiveCostOfCapital;
Borrower_tpCostOfEconomicCapital_title='Cost of Economic Capital';
Borrower_tpCostOfEconomicCapitalSub1_value=undefined;
Borrower_tpCostOfEconomicCapitalSub2_value=undefined;
Borrower_tpCostOfEconomicCapitalSub2_title='Effective Cost of Capital';
Borrower_tpOtherMetrics_value=undefined;
Borrower_tpPrincipalLimit_value=TupleSum(Facility_tpPrincipalLimit);
Borrower_tpExpectedAverageOutstanding_value=TupleSum(Facility_tpExpectedAverageOutstanding);
Borrower_tpExpectedAverageOutstanding_title='ExpectedAverageOutstanding';
Borrower_tpRWA_value=Borrower_tpRWACreditRisk+Borrower_tpRWAOperationalRisk;
Borrower_tpRWACreditRisk_value=TupleSum(Facility_tpRWACreditRisk);
Borrower_tpRWAOperationalRisk_value=TupleSum(Facility_tpRWAOperationalRisk);
Borrower_tpOtherMetricsSub4_value=undefined;
Borrower_tpHiddenVariables_value=undefined;
Borrower_tpHiddenVariables_title='Hidden variables voor P/L Compact Report';
Borrower_tpFacilityEquityFundingAdjustmentTotal_value=undefined;
Borrower_tpFacilityEquityFundingAdjustmentTotal_title='Total Facility Equity Funding Adjustment';
Borrower_tpFacilityRWATotal_value=TupleSum(Facility_tpRWA);
Borrower_tpFacilityRWATotal_title='Total Facility RWA excl. X-sell';
Borrower_tpTaxAndOther_value=Borrower_tpSubordinatedDebtCapitalCharge+Borrower_tpEquityFundingAdjustment+Borrower_tpTax;
Borrower_tpTaxAndOther_title='Tax&&Other';
Borrower_tpCrossSellProfitAndLossClient_value=undefined;
Borrower_tpCrossSellProfitAndLossClient_title='Profit&&Losses - Cross Sell';
Borrower_tpCrossSellIncome_value=OnNA(Borrower_tpNonCreditIncome_Total,0);
Borrower_tpCrossSellIndirectLiquidityCosts_value=0;
Borrower_tpCrossSellDirectLiquidityPremium_value=0;
Borrower_tpCrossSellSubordinatedDebtCapitalCharge_value=OnNA(If(AgreementMaxRemainingTenor<12,Borrower_tpCrossSellRWAOperationalRisk*AgreementSubDebtRatio*(AgreementCostOfSubordination/1e4)*(AgreementMaxRemainingTenor/12),Borrower_tpCrossSellRWAOperationalRisk*AgreementSubDebtRatio*(AgreementCostOfSubordination/1e4)),0);
Borrower_tpCrossSellEquityFundingAdjustment_value=OnER(If(AgreementMaxRemainingTenor<12,(Borrower_tpCrossSellRWAOperationalRisk*Borrower_tpEquityRatio-AgreementAvailableAmountOfEquity)*(MatrixLookup('CalculationParameters','3MAANDSEURIBORBP',2)/1e4)*(AgreementMaxRemainingTenor/12),(Borrower_tpCrossSellRWAOperationalRisk*Borrower_tpEquityRatio-AgreementAvailableAmountOfEquity)*(MatrixLookup('CalculationParameters','3MAANDSEURIBORBP',2)/1e4)),NA);
Borrower_tpCrossSellOperationalCosts_value=OnNA(Borrower_tpNonCreditCosts_Total,0);
Borrower_tpCrossSellInternalExpectedLoss_value=0;
Borrower_tpCrossSellTax_value=(Borrower_tpNonCreditIncome_Total-Borrower_tpNonCreditCosts_Total)*Borrower_tpTaxRate;
Borrower_tpCrossSellRiskAdjustedReturn_value=Borrower_tpCrossSellIncome-Borrower_tpCrossSellIndirectLiquidityCosts-Borrower_tpCrossSellDirectLiquidityPremium-Borrower_tpCrossSellOperationalCosts-Borrower_tpCrossSellSubordinatedDebtCapitalCharge+Borrower_tpCrossSellEquityFundingAdjustment-Borrower_tpCrossSellInternalExpectedLoss-Borrower_tpCrossSellTax;
Borrower_tpCrossSellReturnOnEquity_value=OnER(Borrower_tpCrossSellRiskAdjustedReturn/Borrower_tpCrossSellRequiredAmountOfEquity,NA);
Borrower_tpCrossSellRequiredAmountOfEquity_value=OnNA(Borrower_tpCrossSellRWA*Borrower_tpEquityRatio,0);
Borrower_tpCrossSellRaRoRaC_value=OnER(Borrower_tpCrossSellRiskAdjustedReturn/Borrower_tpCrossSellEconomicCapital,NA);
Borrower_tpCrossSellEconomicCapital_value=OnNA(Borrower_tpCrossSellOperationalRisk+Borrower_tpCrossSellBusinessRisk,0);
Borrower_tpCrossSellOperationalRisk_value=OnNA(TupleSum(Borrower_tpNonCredit_tpORNonCreditRisk),0);
Borrower_tpCrossSellBusinessRisk_value=OnNA(TupleSum(Borrower_tpNonCredit_tpBRNonCreditRisk),0);
Borrower_tpCrossSellRegulatoryProfit_value=OnER(Borrower_tpCrossSellRiskAdjustedReturn-Borrower_tpCrossSellEquityCapitalCharge,NA);
Borrower_tpCrossSellEquityCapitalCharge_value=OnNA(TupleSum(Borrower_tpNonCredit_tpEquityCapitalCharge),0);
Borrower_tpCrossSellEconomicProfit_value=OnER(Borrower_tpCrossSellRiskAdjustedReturn-Borrower_tpCrossSellEconomicCapital*Borrower_tpEffectiveCostOfCapital,NA);
Borrower_tpCrossSellEconomicProfitSub1_value=undefined;
Borrower_tpCrossSellCostOfEconomicCapital_value=Borrower_tpCrossSellEconomicCapital*Borrower_tpEffectiveCostOfCapital;
Borrower_tpCrossSellCostOfEconomicCapitalSub1_value=undefined;
Borrower_tpCrossSellCostOfEconomicCapitalSub2_value=undefined;
Borrower_tpCrossSellOtherMetrics_value=undefined;
Borrower_tpCrossSellRWA_value=OnNA(Borrower_tpCrossSellRWAOperationalRisk,0);
Borrower_tpCrossSellRWAOperationalRisk_value=OnNA(TupleSum(Borrower_tpNonCredit_tpRWAORNonCredit),0);
Borrower_tpCrossSellNonCreditNetIncome_Total_value=Borrower_tpNonCreditIncome_Total-Borrower_tpNonCreditCosts_Total;
Borrower_tpCrossSellNonCreditNetIncome_Total_title='Total Non Credit Net Income';
Borrower_tpClientProfitAndLossClient_value=undefined;
Borrower_tpClientProfitAndLossClient_title='Profit&&Losses - Client';
Borrower_tpClientIncome_value=Borrower_tpIncome+Borrower_tpCrossSellIncome;
Borrower_tpClientInterestIncome_value=Borrower_tpInterestIncome;
Borrower_tpClientCreditRelatedFee_value=Borrower_tpCreditRelatedFee;
Borrower_tpClientNonCreditIncome_Total_value=OnNA(Borrower_tpNonCreditIncome_Total,0);
Borrower_tpClientNonCreditIncome_Total_title='Total Non Credit Income';
Borrower_tpClientOptionCostsIndLiqPremium_value=Borrower_tpOptionCostsIndLiqPremium;
Borrower_tpClientOptionCostsIndLiqPremium_title='Option Costs/Indirect Liquidity Costs';
Borrower_tpClientIndirectLiquidityCosts_value=Borrower_tpIndirectLiquidityCosts+Borrower_tpCrossSellIndirectLiquidityCosts;
Borrower_tpClientPrepaymentCosts_value=Borrower_tpPrepaymentCosts;
Borrower_tpClientPipelineRisk_value=Borrower_tpPipelineRisk;
Borrower_tpClientDirectLiquidityPremium_value=Borrower_tpDirectLiquidityPremium+Borrower_tpCrossSellDirectLiquidityPremium;
Borrower_tpClientSubordinatedDebtCapitalCharge_value=Borrower_tpSubordinatedDebtCapitalCharge+Borrower_tpCrossSellSubordinatedDebtCapitalCharge;
Borrower_tpClientEquityFundingAdjustment_value=Borrower_tpEquityFundingAdjustment+Borrower_tpCrossSellEquityFundingAdjustment;
Borrower_tpClientOperationalCosts_value=Borrower_tpOperationalCosts+Borrower_tpCrossSellOperationalCosts;
Borrower_tpClientCostPerServiceConcept_value=Borrower_tpCostPerServiceConcept;
Borrower_tpClientCostPerContract_value=Borrower_tpCostPerContract;
Borrower_tpClientCostOverVolume_value=Borrower_tpCostOverVolume;
Borrower_tpClientCostOverVolume_title='Cost Over Volume';
Borrower_tpClientNonCreditCosts_Total_value=OnNA(Borrower_tpNonCreditCosts_Total,0);
Borrower_tpClientNonCreditCosts_Total_title='Total Non Credit Costs';
Borrower_tpClientInternalExpectedLoss_value=Borrower_tpInternalExpectedLoss+Borrower_tpCrossSellInternalExpectedLoss;
Borrower_tpClientTax_value=Borrower_tpTax+Borrower_tpCrossSellTax;
Borrower_tpClientRiskAdjustedReturn_value=Borrower_tpRiskAdjustedReturn+Borrower_tpCrossSellRiskAdjustedReturn;
Borrower_tpClientReturnOnEquity_value=OnER(Borrower_tpClientRiskAdjustedReturn/Borrower_tpClientRequiredAmountOfEquity,NA);
Borrower_tpClientRequiredAmountOfEquity_value=Borrower_tpRequiredAmountOfEquity+Borrower_tpCrossSellRequiredAmountOfEquity;
Borrower_tpClientRequiredAmountOfEquity_title='Required Amount Of Equity';
Borrower_tpClientRaRoRaC_value=OnER(Borrower_tpClientRiskAdjustedReturn/Borrower_tpClientEconomicCapital,NA);
Borrower_tpClientEconomicCapital_value=Borrower_tpEconomicCapital+Borrower_tpCrossSellEconomicCapital;
Borrower_tpClientOperationalRisk_value=Borrower_tpOperationalRisk+Borrower_tpCrossSellOperationalRisk;
Borrower_tpClientBusinessRisk_value=Borrower_tpBusinessRisk+Borrower_tpCrossSellBusinessRisk;
Borrower_tpClientCreditRisk_value=Borrower_tpCreditRisk;
Borrower_tpClientRegulatoryProfit_value=OnER(Borrower_tpClientRiskAdjustedReturn-Borrower_tpClientEquityCapitalCharge,NA);
Borrower_tpClientEquityCapitalCharge_value=Borrower_tpEquityCapitalCharge+Borrower_tpCrossSellEquityCapitalCharge;
Borrower_tpClientEconomicProfit_value=OnER(Borrower_tpClientRiskAdjustedReturn-Borrower_tpClientEconomicCapital*Borrower_tpEffectiveCostOfCapital,NA);
Borrower_tpClientEconomicProfitSub1_value=undefined;
Borrower_tpClientCostOfEconomicCapital_value=Borrower_tpClientEconomicCapital*Borrower_tpEffectiveCostOfCapital;
Borrower_tpClientCostOfEconomicCapitalSub1_value=undefined;
Borrower_tpClientCostOfEconomicCapitalSub2_value=undefined;
Borrower_tpClientOtherMetrics_value=undefined;
Borrower_tpClientPrincipalLimit_value=Borrower_tpPrincipalLimit;
Borrower_tpClientOutstanding_value=Borrower_tpExpectedAverageOutstanding;
Borrower_tpClientRWA_value=Borrower_tpRWA+Borrower_tpCrossSellRWA;
Borrower_tpClientRWACreditRisk_value=Borrower_tpRWACreditRisk;
Borrower_tpClientRWAOperationalRisk_value=Borrower_tpRWAOperationalRisk+Borrower_tpCrossSellRWAOperationalRisk;
Borrower_tpClientEAD_value=Borrower_tpEAD;
Borrower_tpClientNonCreditNetIncome_Total_value=Borrower_tpCrossSellNonCreditNetIncome_Total;
Borrower_tpClientHiddenVariables_value=undefined;
Borrower_tpClientTaxAndOther_value=Borrower_tpClientSubordinatedDebtCapitalCharge+Borrower_tpClientEquityFundingAdjustment+Borrower_tpClientTax;
Borrower_tpNonCredit_value=undefined;
Borrower_tpNonCredit_title='A Cross Sell item';
Borrower_tpNonCredit_tpDataImportedFromForce_value=undefined;
Borrower_tpNonCredit_tpDataImportedFromForce_title=String('Imported Data for Cross Sell Items');
Borrower_tpNonCredit_tpCategoryCode_value=undefined;
Borrower_tpNonCredit_tpCategoryCode_title='Cross Sell Item Category Code';
Borrower_tpNonCredit_tpCategoryName_value=undefined;
Borrower_tpNonCredit_tpCategoryName_title='Cross Sell Item Name';
Borrower_tpNonCredit_tpPrognosedIncomeNext12MonthsAmount_value=undefined;
Borrower_tpNonCredit_tpPrognosedIncomeNext12MonthsAmount_title='Prognosed Income for the next 12 months';
Borrower_tpNonCredit_tpRealizedIncomePast12MonthsAmount_value=undefined;
Borrower_tpNonCredit_tpRealizedIncomePast12MonthsAmount_title='Realized Income for the next 12 months';
Borrower_tpNonCredit_tpName_value=String(Borrower_tpNonCredit_tpCategoryName);
Borrower_tpNonCredit_tpName_title='Item Description';
Borrower_tpNonCredit_tpIncome_Amount_value=Borrower_tpNonCredit_tpPrognosedIncomeNext12MonthsAmount;
Borrower_tpNonCredit_tpIncome_Amount_title='Expected Income Upcoming 12 months';
Borrower_tpNonCredit_tpCosts_value=Borrower_tpNonCredit_tpIncome_Amount*Borrower_tpNonCredit_tpCosts_EffRatio;
Borrower_tpNonCredit_tpCosts_title='Costs';
Borrower_tpNonCredit_tpNetIncome_value=Borrower_tpNonCredit_tpIncome_Amount-Borrower_tpNonCredit_tpCosts;
Borrower_tpNonCredit_tpNetIncome_title='Net Income';
Borrower_tpNonCredit_tpIncome_ClientGroup_value=undefined;
Borrower_tpNonCredit_tpIncome_ClientGroup_title='Borrower Client Group';
Borrower_tpNonCredit_tpIncome_ID_value=String(SubStr(Borrower_tpNonCredit_tpCategoryCode,0,2));
Borrower_tpNonCredit_tpIncome_ID_title='ID';
Borrower_tpNonCredit_tpIncome_IDtotal_value=String(Borrower_tpNonCredit_tpCategoryCode);
Borrower_tpNonCredit_tpIncome_IDtotal_title='ID Total';
Borrower_tpNonCredit_tpCosts_EffRatio_value=MatrixLookup('NonCreditIncomeEffRatio',Borrower_tpNonCredit_tpIncome_IDtotal,3);
Borrower_tpNonCredit_tpCosts_EffRatio_title='Risk Adjusted Return - Other Expenses - Operational Costs - Non Credit Costs - Eff. ratio';
Borrower_tpNonCredit_tpEC_value=Borrower_tpNonCredit_tpORNonCreditRisk+Borrower_tpNonCredit_tpBRNonCreditRisk;
Borrower_tpNonCredit_tpEC_title='Non Credit Economic Capital';
Borrower_tpNonCredit_tpBRNonCreditRisk_value=Borrower_tpARCAddOn*AgreementDiversificationBR*(Borrower_tpNonCredit_tpCosts*(Borrower_tpNonCredit_tpECbusr/1e4));
Borrower_tpNonCredit_tpBRNonCreditRisk_title='Risk Adjusted Return - Non Credit EC Business Risk';
Borrower_tpNonCredit_tpECbusr_value=MatrixLookup('NonCreditECoprECBusr',Borrower_tpNonCredit_tpIncome_ID,3);
Borrower_tpNonCredit_tpECbusr_title='Risk Adjusted Return - EC Business Risk factor';
Borrower_tpNonCredit_tpORNonCreditRisk_value=Borrower_tpARCAddOn*AgreementDiversificationOR*(Borrower_tpNonCredit_tpIncome_Amount*(Borrower_tpNonCredit_tpECopr/1e4));
Borrower_tpNonCredit_tpORNonCreditRisk_title='Risk Adjusted Return - Non Credit EC Operational Risk';
Borrower_tpNonCredit_tpECopr_value=MatrixLookup('NonCreditECoprECBusr',Borrower_tpNonCredit_tpIncome_ID,2);
Borrower_tpNonCredit_tpECopr_title='Risk Adjusted Return - EC Operational Risk factor';
Borrower_tpNonCredit_tpRWAORNonCredit_value=Borrower_tpNonCredit_tpIncome_Amount*MatrixLookup('ClientGroup',Borrower_tpClientGroup,7);
Borrower_tpNonCredit_tpRWAORNonCredit_title='Risk Weighted Assets - RWA || Non Credit';
Borrower_tpNonCredit_tpEquityCapitalCharge_value=Borrower_tpNonCredit_tpRWAORNonCredit*Borrower_tpEquityRatio*Borrower_tpCostofEquity;
Facility_value=undefined;
Facility_title='Facility';
Facility_tpDataForUserView_value=undefined;
Facility_tpDataForUserView_title=String('Data for UserView');
Facility_tpSummary_value=String('Margin '+Str(Facility_tpCustomerSpread+Facility_tpCustomerSpreadAddMargin,0,3)+' (RaRoRaC '+Str(Facility_tpRaRoRaC,0,2)+')');
Facility_tpSummary_title=String(Facility_tpProductname[doc]);
Facility_tpInputRequired_value=String(If(Facility_tpPrincipalLimit!=NA,'Complete','Incomplete'));
Facility_tpInputRequired_title='Required fields';
Facility_tpProfitAndLoss_value=undefined;
Facility_tpProfitAndLoss_title='Profit&&losses';
Facility_tpRaRoRaC_value=OnER(Facility_tpRiskAdjustedReturn/Facility_tpEconomicCapital,NA);
Facility_tpRaRoRaC_title='RaRoRaC ()';
Facility_tpEconomicProfit_value=OnER(Facility_tpRiskAdjustedReturn-Facility_tpCostOfEconomicCapital,NA);
Facility_tpCostOfEconomicCapital_value=OnER(Facility_tpEconomicCapital*Borrower_tpEffectiveCostOfCapital*Facility_tpDeannualize,NA);
Facility_tpEffectiveCostOfCapital_value=OnER(Borrower_tpEffectiveCostOfCapital,NA);
Facility_tpEffectiveCostOfCapital_title='Effective Cost of Economic Capital';
Facility_tpReturnOnEquity_value=OnER(Facility_tpRiskAdjustedReturn/(Facility_tpRWA*Borrower_tpEquityRatio*Facility_tpDeannualize),NA);
Facility_tpReturnOnEquity_title='Return on Equity ()';
Facility_tpRegulatoryProfit_value=OnER(Facility_tpRiskAdjustedReturn-Facility_tpEquityCapitalCharge,NA);
Facility_tpOtherMetrics_value=undefined;
Facility_tpRequiredInput_value=undefined;
Facility_tpRequiredInput_title=String('Required Input');
Facility_tpProductname_value=String(MatrixLookup('VertaaltabelProductType',Facility_tpType,1));
Facility_tpProductname_title='Product Name';
Facility_tpBaseCurrencyChoice_value=1;
Facility_tpBaseCurrencyChoice_title='Base Currency of Facility';
Facility_tpBaseCurrency_value=String(Case(Facility_tpBaseCurrencyChoice,[1,'EUR'||2,'BRL'||3,'CAD'||4,'CHF'||5,'GBP'||6,'HKD'||7,'INR'||8,'MXN'||9,'NOK'||10,'SGD'||11,'USD']));
Facility_tpBaseCurrency_title='Base Currency';
Facility_tpProductinterestDetailsInterestProductName_value=String(MatrixLookup('VertaaltabelInterestProductType',Facility_tpInterestProductCode,1));
Facility_tpProductinterestDetailsInterestProductName_title='Interest Product';
Facility_tpFixedInterestPeriodChoice_value=Case(Val(Facility_tpProductinterestDetailsFixedInterestPeriod),[1,2||3,3||6,4||99,1]);
Facility_tpFixedInterestPeriodChoice_title='Fixed Interest Period';
Facility_tpFixedInterestPeriodChoice_choices=[{'name':' 1','value':'Base rate'},{'name':'2','value':'1 months'},{'name':'3','value':'3 months'},{'name':'4','value':'6 months'}];
Facility_tpFixedInterestPeriod_value=Facility_tpFixedInterestPeriodChoice;
Facility_tpDateLastInterestReview_value=undefined;
Facility_tpDateLastInterestReview_title='Date Last Review';
Facility_tpPrepaymentPrec_value=0;
Facility_tpPrepaymentPrec_title='Prepayment of limit Amount ()';
Facility_tpOfferPeriodChoice_value=4;
Facility_tpOfferPeriodChoice_title='Offer period';
Facility_tpOfferPeriodChoice_choices=[{'name':' 01','value':'0'},{'name':'02','value':'1D'},{'name':'03','value':'1W'},{'name':'04','value':'2W'},{'name':'05','value':'4W'},{'name':'06','value':'2M'},{'name':'07','value':'3M'},{'name':'08','value':'6M'}];
Facility_tpOfferPeriod_value=String(Case(Facility_tpOfferPeriodChoice,[1,'0'||2,'1D'||3,'1W'||4,'2W'||5,'4W'||6,'2M'||7,'3M'||8,'6M']));
Facility_tpOfferPeriod_title='Offer period text';
Facility_tpBaseRate2_value=100;
Facility_tpBaseRate2_title='Base Rate (Bps)';
Facility_tpCustomerSpreadAddMargin2_value=Facility_tpCustomerSpreadAddMargin;
Facility_tpCustomerSpreadAddMargin2_title='Customer Spread Additional Margin';
Facility_tpRemainingAverageTenor_value=If(Facility_tpRevolvingCredit==0,If(Facility_tpRepaymentChoice==0,Facility_tpRemainingAverageTenorBullet,Facility_tpRemainingAverageTenorNoBullet),1);
Facility_tpRemainingAverageTenor_title='Remaining Average Tenor (Years)';
Facility_tpExpectedAverageOutstanding_value=If(Facility_tpRepaymentChoice==4||Facility_tpWithdrawalChoice==2,Facility_tpEAORevolving,If(Facility_tpWithdrawalChoice==0&&Facility_tpRepaymentChoice==0,Facility_tpPrincipalLimit,If(Facility_tpWithdrawalChoice==0&&Facility_tpRepaymentChoice==1,Facility_tpEAOOnceLinear,If(Facility_tpWithdrawalChoice==0&&Facility_tpRepaymentChoice==2,Facility_tpEAOOnceAnnuity,If(Facility_tpWithdrawalChoice==0&&Facility_tpRepaymentChoice==3,Facility_tpExpectedAverageOutstandingScheme,If(Facility_tpWithdrawalChoice==3&&Facility_tpRepaymentChoice==0,Facility_tpExpectedAverageOutstandingScheme,If(Facility_tpWithdrawalChoice==3&&Facility_tpRepaymentChoice==1,Facility_tpEAOSchemeLinear,If(Facility_tpWithdrawalChoice==3&&Facility_tpRepaymentChoice==2,Facility_tpEAOSchemeAnnuity,If(Facility_tpWithdrawalChoice==3&&Facility_tpRepaymentChoice==3,Facility_tpExpectedAverageOutstandingScheme,Facility_tpEAORevolving)))))))));
Facility_tpExpectedAverageOutstanding_title='Expected Average Outstanding (For upcoming 12 months after Current Date)';
Facility_tpUncommitted2_value=0;
Facility_tpUncommitted2_title='Facility is uncommitted';
Facility_tp31DgDebet_value=0;
Facility_tp31DgDebet_title='31 Dg Debet';
Facility_tpDataImportedFromForce_value=undefined;
Facility_tpType_value=undefined;
Facility_tpType_title='Abbreviated Facility Type';
Facility_tpID_value=undefined;
Facility_tpID_title='Accountnumber';
Facility_tpStatusName_value=undefined;
Facility_tpStatusName_title='Status';
Facility_tpProductReferenceNumber_value=undefined;
Facility_tpProductReferenceNumber_title='Product Reference Number';
Facility_tpPrincipalLimit_value=undefined;
Facility_tpPrincipalLimit_title='Facility Limit';
Facility_tpProductStartDate_value=undefined;
Facility_tpProductStartDate_title='Start Date';
Facility_tpProductduration_value=undefined;
Facility_tpProductduration_title='Product Duration/ Maturity (months)';
Facility_tpProductEndDate_value=undefined;
Facility_tpProductEndDate_title='End date';
Facility_tpProductuptakeDetailsUptakeType_value=undefined;
Facility_tpProductuptakeDetailsUptakeType_title='Withdrawal - WithdrawalType';
Facility_tpProductuptakeDetailsUptakeFrequency_value=undefined;
Facility_tpProductuptakeDetailsUptakeFrequency_title='Withdrawal - WithdrawalFrequency';
Facility_tpProductWithdrawalDetailsLastPossibleWithdrawalDate_value=undefined;
Facility_tpProductWithdrawalDetailsLastPossibleWithdrawalDate_title='Withdrawal - Last Possible Withdrawal Date';
Facility_tpProductWithdrawalDetailsPercentageUsedOfLimit_value=undefined;
Facility_tpProductWithdrawalDetailsPercentageUsedOfLimit_title='Withdrawal - Percentage used of Limits';
Facility_tpProductredemptionDetailsRedemptionType_value=undefined;
Facility_tpProductredemptionDetailsRedemptionType_title='Repayment - RepaymentType';
Facility_tpProductredemptionDetailsPeriodicity_value=undefined;
Facility_tpProductredemptionDetailsPeriodicity_title='Repayment - Periodicity';
Facility_tpProductredemptionDetailsFirstRedemptionAfterXMonths_value=undefined;
Facility_tpProductredemptionDetailsFirstRedemptionAfterXMonths_title='Repayment - FirstRepaymentAfterXMonths';
Facility_tpInterestProductCode_value=undefined;
Facility_tpInterestProductCode_title='Interest - Interest Product Code';
Facility_tpProductinterestDetailsFixedInterestPeriod_value=undefined;
Facility_tpProductinterestDetailsFixedInterestPeriod_title='Interest - Fixed Interest Period';
Facility_tpLGD_value=undefined;
Facility_tpLGD_title='Loss Given Default (LGD) ()';
Facility_tpLGDMoC_value=undefined;
Facility_tpLGDMoC_title='Loss Given Default (LGD) MoC ()';
Facility_tpDLGDMoC_value=undefined;
Facility_tpDLGDMoC_title='Loss Given Default Downturn (LGD) MoC ()';
Facility_tpIsRevolving_value=undefined;
Facility_tpIsRevolving_title='Facility is revolving';
Facility_tpCustomerSpread2_value=undefined;
Facility_tpCustomerSpread2_title='Customer Spread (Bps)';
Facility_tpMarketSpread_value=undefined;
Facility_tpMarketSpread_title='Market Spread';
Facility_tpOneOffFeeAmount2_value=0;
Facility_tpOneOffFeeAmount2_title='One Off Fee Amount';
Facility_tpCreditFeeBp_value=0;
Facility_tpCreditFeeBp_title='Credit fee (Bp)';
Facility_tpCommitmentFeeBp_value=0;
Facility_tpCommitmentFeeBp_title='Commitment Fee (Bp)';
Facility_tpTargetRaRoRaC_value=undefined;
Facility_tpTargetRaRoRaC_title='Target RaRoRaC';
Facility_tpAutomaticInput_value=undefined;
Facility_tpAutomaticInput_title=String('Automatic Input Facility');
Facility_tpNonRevolvingProduct_value=If(MatrixLookup('ProductType',Facility_tpType,9)==0,1,0);
Facility_tpNonRevolvingProduct_title='Non Revolving Product (Y/N)';
Facility_tpRevolvingProduct_value=If(MatrixLookup('ProductType',Facility_tpType,9)!=0,1,0);
Facility_tpRevolvingProduct_title='Revolving Product (Y/N)';
Facility_tpRevolvingCredit_value=If(MatrixLookup('ProductType',Facility_tpType,9)!=0,1,0);
Facility_tpRevolvingCredit_title='Revolving Credit (Y/N)';
Facility_tpPDMultiplierUnder1Year_value=If(Facility_tpRemainingTenor==NA,1,If(Facility_tpRemainingTenor<12,Facility_tpRemainingTenor/12,1));
Facility_tpPDMultiplierUnder1Year_title='Remaning Tenor Under 1 Year';
Facility_tpBorrower_tpPD_value=Borrower_tpPD*Facility_tpPDMultiplierUnder1Year;
Facility_tpBorrower_tpPD_title='Probability of Default of the Borrower Specific for Facility';
Facility_tpBorrower_tpPDMoC_value=Borrower_tpPD*Borrower_tpMoCFactor*Facility_tpPDMultiplierUnder1Year;
Facility_tpBorrower_tpPDMoC_title='Probability of Default MoC of the Borrower Specific for Facility';
Facility_tpBorrower_tpRiskWeight_value=CumNormal((InvNormal(Facility_tpBorrower_tpPDMoC)-(Borrower_tpRho^.5)*InvNormal(1-Borrower_tpConfidenceLevel))/(1-Borrower_tpRho^.5));
Facility_tpBorrower_tpRiskWeight_title='Risk Weight of the Borrower Specific for Facility';
Facility_tpDeannualize_value=If(Facility_tpRemainingAverageTenor<1,Facility_tpRemainingAverageTenor,1);
Facility_tpDeannualize_title='De-annualization fraction (years)';
Facility_tpBorrower_tpPLorNPL_value=Borrower_tpPLorNPL;
Facility_RepaymentScheme_value=undefined;
Facility_RepaymentScheme_title='Repayment Scheme';
Facility_tpOriginalTenor_value=OnNeg(OnER(DateToYear(Facility_tpEndDate-1)*12+DateToMonth(Facility_tpEndDate-1)+If(DateToDay(Facility_tpEndDate)>DateToDay(Facility_tpStartDate)||DateToDay(Facility_tpEndDate)==1,1,0)-(DateToYear(Facility_tpStartDate)*12+DateToMonth(Facility_tpStartDate)),NA),NA);
Facility_tpOriginalTenor_title='Original Tenor (using the start date) (Months)';
Facility_tpOriginalTenorYears_value=OnNeg(OnER(Facility_tpOriginalTenor/12,NA),NA);
Facility_tpOriginalTenorYears_title='Original Tenor (using the start date) (Years)';
Facility_tpRemainingTenor_value=OnNeg(OnER(DateToYear(Facility_tpEndDate-1)*12+DateToMonth(Facility_tpEndDate-1)+If(DateToDay(Facility_tpEndDate)>DateToDay(Facility_tpStartDate)||DateToDay(Facility_tpEndDate)==1,1,0)-(DateToYear(If(Facility_tpCurrentDate<=Facility_tpStartDate,Facility_tpStartDate,Facility_tpCurrentDate))*12+DateToMonth(If(Facility_tpCurrentDate<=Facility_tpStartDate,Facility_tpStartDate,Facility_tpCurrentDate))),NA),NA);
Facility_tpRemainingTenor_title='Remaining Tenor (using the current date) (Months)';
Facility_tpRemainingTenorYears_value=OnNeg(OnER(Facility_tpRemainingTenor/12,NA),NA);
Facility_tpRemainingTenorYears_title='Remaining Tenor (using the current date) (Years)';
Facility_tpOriginalAverageTenor_value=If(Facility_tpRevolvingCredit==0,If(Facility_tpRepaymentChoice==0,Facility_tpOriginalAverageTenorBullet,Facility_tpOriginalAverageTenorNoBullet),1);
Facility_tpOriginalAverageTenor_title='Original Average Tenor (Years)';
Facility_tpOriginalAverageTenorBullet_value=OnER(Facility_tpOriginalTenorYears,NA);
Facility_tpOriginalAverageTenorBullet_title='Original Average Tenor - Bullet';
Facility_tpOriginalAverageTenorNoBullet_value=If(Facility_tpRepaymentChoice==3,Facility_tpOriginalAverageTenorScheme,If(Facility_tpRepaymentChoice==2,Facility_tpAnnuityOAT,If(Facility_tpRepaymentChoice==1,Facility_tpLinearOAT,OnER(HSum(Facility_tpWeightedAmountRepayment,DateToT(Facility_tpStartDate,1),DateToT(Facility_tpEndDateMax10,1))/(12*HSum(Facility_tpRepayment,DateToT(Facility_tpStartDate,1),DateToT(Facility_tpEndDateMax10,1))),NA))));
Facility_tpOriginalAverageTenorNoBullet_title='Original Average Tenor - No Bullet';
Facility_tpOriginalAverageTenorTHsum_value=OnER(HSum(Facility_tpWeightedAmountRepayment,DateToT(Facility_tpStartDate,1),DateToT(Facility_tpEndDateMax10,1)),NA);
Facility_tpOriginalAverageTenorTHsum_title='Original Average Tenor Teller';
Facility_tpOriginalAverageTenorNHsum_value=OnER(12*HSum(Facility_tpRepayment,DateToT(Facility_tpStartDate,1),DateToT(Facility_tpEndDateMax10,1)),NA);
Facility_tpOriginalAverageTenorNHsum_title='Original Average Tenor Noemer';
Facility_tpRemainingAverageTenor2_value=Facility_tpRemainingAverageTenor;
Facility_tpRemainingAverageTenorBullet_value=OnER(Facility_tpRemainingTenorYears,NA);
Facility_tpRemainingAverageTenorBullet_title='Remaining Average Tenor - Bullet';
Facility_tpRemainingAverageTenorNoBullet_value=If(Facility_tpRepaymentChoice==3,Facility_tpRemainingAverageTenorScheme,If(Facility_tpRepaymentChoice==2,Facility_tpAnnuityRAT,If(Facility_tpRepaymentChoice==1,Facility_tpLinearRAT,OnER(HSum(Facility_tpWeightedAmountRepaymentRem,DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1),DateToT(Facility_tpEndDateMax10,1))/(12*HSum(Facility_tpRepayment,DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1),DateToT(Facility_tpEndDateMax10,1))),NA))));
Facility_tpRemainingAverageTenorNoBullet_title='Remaining Average Tenor - No Bullet';
Facility_tpRemainingAverageTenorTHsum_value=OnER(HSum(Facility_tpWeightedAmountRepaymentRem,DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1),DateToT(Facility_tpEndDateMax10,1)),NA);
Facility_tpRemainingAverageTenorTHsum_title='Remaining Average Tenor Teller';
Facility_tpRemainingAverageTenorNHsum_value=OnER(12*HSum(Facility_tpRepayment,DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1),DateToT(Facility_tpEndDateMax10,1)),NA);
Facility_tpRemainingAverageTenorNHsum_title='Remaining Average Tenor Noemer';
Facility_tpLimit_value=If(Facility_tpRepaymentChoice==4||Facility_tpWithdrawalChoice==2,Facility_tpPrincipalLimit,If(Facility_tpRepaymentChoice==0,Facility_tpPrincipalLimit,If(Facility_tpRepaymentChoice==1,Facility_tpLimitLinear,If(Facility_tpRepaymentChoice==2,Facility_tpLimitAnnuity,If(Facility_tpRepaymentChoice==3,Facility_tpLimitScheme,Facility_tpPrincipalLimit)))));
Facility_tpLimit_title='Limit (For upcoming 12 months after Current Date)';
Facility_tpLimitAnnuity_value=(Facility_tpPrincipalLimit*Facility_tpRepaymentFrequency-Facility_tpLimitAnnuityRepayment)/MinMax(Facility_tpAnnuityPPMTRATTotalPeriods,1,Facility_tpRepaymentFrequency,NA);
Facility_tpLimitAnnuity_title='Limit annuity';
Facility_tpLimitLinear_value=(Facility_tpPrincipalLimit*Facility_tpRepaymentFrequency-Facility_tpLimitLinearRepayment)/MinMax(Facility_tpAnnuityPPMTRATTotalPeriods,1,Facility_tpRepaymentFrequency,NA);
Facility_tpLimitLinear_title='Limit Linear';
Facility_tpLimitScheme_value=(Facility_tpPrincipalLimit*Facility_tpRepaymentFrequency-Facility_tpLimitAnnuityRepayment)/MinMax(Facility_tpAnnuityPPMTRATTotalPeriods,1,Facility_tpRepaymentFrequency,NA);
Facility_tpLimitScheme_title='Limit Scheme';
Facility_tpLimitLinearRepayment_value=SumFor(X,Facility_tpPeriodDifferenceGrace+1,Facility_tpNumberOfPeriodsNoGrace,1,Facility_tpLinear*Round(MinMax(Facility_tpAnnuityMonthsSinceStartDate+Facility_tpRepaymentFrequency-X,0,Facility_tpRepaymentFrequency),0));
Facility_tpLimitLinearRepayment_title='Limit Linear Repayment Amount';
Facility_tpLimitAnnuityRepayment_value=SumFor(X,1,Facility_tpNumberOfPeriods,1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*MinMax(Facility_tpAnnuityMonthsSinceStartDate+Facility_tpRepaymentFrequency-Facility_tpPeriodDifferenceGrace-X,0,Facility_tpRepaymentFrequency,0));
Facility_tpLimitAnnuityRepayment_title='Limit Annuity Repayment Amount';
Facility_tpLimitSchemeRepayment_value=TupleSum(Facility_tpManual_LimitWeightedRepayment);
Facility_tpLimitSchemeRepayment_title='Limit Scheme Repayment Amount';
Facility_tpNumberOfPeriods_value=If(Facility_tpRepaymentChoice==0,1,OnER(RoundUp((DateToYear(Facility_tpEndDate-1)*12+DateToMonth(Facility_tpEndDate-1)+If(DateToDay(Facility_tpEndDate)>DateToDay(Facility_tpStartDate)||DateToDay(Facility_tpEndDate)==1,1,0)-(DateToYear(Facility_tpStartDate)*12+DateToMonth(Facility_tpStartDate))-Facility_tpGracePeriod)*(Facility_tpRepaymentFrequency/12),0),NA));
Facility_tpNumberOfPeriods_title='Number Of Periods';
Facility_tpNumberOfPeriodsNoGrace_value=If(Facility_tpRepaymentChoice==0,1,OnER(RoundUp((DateToYear(Facility_tpEndDate-1)*12+DateToMonth(Facility_tpEndDate-1)+If(DateToDay(Facility_tpEndDate)>DateToDay(Facility_tpStartDate)||DateToDay(Facility_tpEndDate)==1,1,0)-(DateToYear(Facility_tpStartDate)*12+DateToMonth(Facility_tpStartDate)))*(Facility_tpRepaymentFrequency/12),0),NA));
Facility_tpNumberOfPeriodsNoGrace_title='Number Of Periods Without Grace';
Facility_tpWithdrawalChoice_value=If(Facility_tpProductuptakeDetailsUptakeType=='OneTime',0,If(Facility_tpProductuptakeDetailsUptakeType=='FixedTerms',1,If(Facility_tpProductuptakeDetailsUptakeType=='WithdrawalRevolving',2,If(Facility_tpProductuptakeDetailsUptakeType=='IrregularWithdrawalSchedule',3,If(Facility_tpProductuptakeDetailsUptakeType=='ConditionalWithdrawalSchedule',3,NA)))));
Facility_tpWithdrawalChoice_title='Withdrawal Type';
Facility_tpWithdrawalChoice_choices=[{'name':' 0','value':'ONCE'},{'name':'1','value':'PERIODICAL'},{'name':'2','value':'REVOLVING'},{'name':'3','value':'SCHEME'}];
Facility_tpRepaymentChoice_value=If(Facility_tpProductredemptionDetailsRedemptionType=='InterestOnly',0,If(Facility_tpProductredemptionDetailsRedemptionType=='Linear',1,If(Facility_tpProductredemptionDetailsRedemptionType=='Annuity',2,If(Facility_tpProductredemptionDetailsRedemptionType=='IrregularRepaymentSchedule',3,If(Facility_tpProductredemptionDetailsRedemptionType=='RepaymentRevolving',4,NA)))));
Facility_tpRepaymentChoice_title='Repayment Type';
Facility_tpRepaymentChoice_choices=[{'name':' 0','value':'BULLET'},{'name':'1','value':'LINEAR'},{'name':'2','value':'ANNUITY'},{'name':'3','value':'SCHEME'},{'name':'4','value':'REVOLVING'}];
Facility_tpRepaymentFrequency_value=OnER(Val(Facility_tpProductredemptionDetailsPeriodicity),NA);
Facility_tpRepaymentFrequency_title='Repayment frequency';
Facility_tpRepaymentFrequency_choices=[{'name':' 1','value':'YEARLY'},{'name':'2','value':'HALF YEARLY'},{'name':'4','value':'QUARTERLY'},{'name':'12','value':'MONTHLY'},{'name':''}];
Facility_tpAnnuityInterestRateDefault_value=1;
Facility_tpAnnuityInterestRateDefault_title='Annuity Interest Rate (Default/Funding+Marge)';
Facility_tpAnnuityInterestRateDefault_choices=[{'name':' 1','value':'YES'},{'name':'0','value':'NO'}];
Facility_tpAnnuityInterestRate_value=If(Facility_tpAnnuityInterestRateDefault,.05,(Facility_tpBaseRate2+Facility_tpCustomerSpread2+Facility_tpCustomerSpreadAddMargin2)*1e-4);
Facility_tpAnnuityInterestRate_title='Annuity Interest Rate';
Facility_tpBalloon_value=0;
Facility_tpBalloon_title='Balloon ()';
Facility_tpGracePeriod_value=Facility_tpProductredemptionDetailsFirstRedemptionAfterXMonths;
Facility_tpGracePeriod_title='Grace Period (mnd)';
Facility_tpStartDate_value=Facility_tpProductStartDate;
Facility_tpStartDate_title='Start date';
Facility_tpCurrentDate_value=If(DataEntered(Facility_tpCurrentDate),Facility_tpCurrentDate,CurrentDate);
Facility_tpCurrentDate_title='Current date';
Facility_tpEndDate_value=If(MatrixLookup('ProductType',Facility_tpType,9)==1,NA,Facility_tpProductEndDate);
Facility_tpEndDateMax10_value=If(Facility_tpEndDate>AddMonth(DMYtoDate(DateToDay(Facility_tpStartDate),DateToMonth(Facility_tpStartDate),DateToYear(Facility_tpStartDate)),84),AddMonth(DMYtoDate(DateToDay(Facility_tpStartDate),DateToMonth(Facility_tpStartDate),DateToYear(Facility_tpStartDate)),120),Facility_tpEndDate);
Facility_tpEndDateMax10_title='End date Maximum 10 years';
Facility_tpExpectedAverageOutstanding2_value=Facility_tpExpectedAverageOutstanding;
Facility_RepaymentSchemeSub26_value=undefined;
Facility_RepaymentSchemeSub26_title='Expected Average Outstanding Scheme';
Facility_tpPercentageUsedOfExpectedAverageOutstanding_value=Facility_tpProductWithdrawalDetailsPercentageUsedOfLimit;
Facility_tpPercentageUsedOfExpectedAverageOutstanding_title='Percentage used of the Expected Average Outstanding (Revolving Items)';
Facility_RepaymentSchemeSub28_value=undefined;
Facility_RepaymentSchemeSub28_title='Tuples Manual Scheme';
Facility_tpManual_value=undefined;
Facility_tpManual_title='Manual Scheme';
Facility_tpManual_tpMonthIdentifier_value=undefined;
Facility_tpManual_tpMonthIdentifier_title='Month Identifier';
Facility_tpManual_tpFirstDayMonth_value=undefined;
Facility_tpManual_tpFirstDayMonth_title='Date of Repayment / Withdrawel';
Facility_tpManual_tpMonthsSinceStartDate_value='If(Facility_tpManual_tpFirstDayMonth==NA,NA,(DateToYear(Facility_tpManual_tpFirstDayMonth)-DateToYear(Facility_tpStartDate))*12+DateToMonth(Facility_tpManual_tpFirstDayMonth)-DateToMonth(Facility_tpStartDate))+If(Facility_tpManual_tpMonthsSinceStartDate==NA,NA,1)';
Facility_tpManual_tpMonthsSinceStartDate_title='Months Since StartDate';
Facility_tpManual_tpMonthsSinceCurrentDate_value=If(Facility_tpManual_tpFirstDayMonth==NA,NA,If(DMYtoDate(1,DateToMonth(Facility_tpManual_tpFirstDayMonth),DateToYear(Facility_tpManual_tpFirstDayMonth))<DMYtoDate(1,DateToMonth(Facility_tpCurrentDate),DateToYear(Facility_tpCurrentDate)),NA,(DateToYear(Facility_tpManual_tpFirstDayMonth)-DateToYear(Facility_tpCurrentDate))*12+DateToMonth(Facility_tpManual_tpFirstDayMonth)-DateToMonth(Facility_tpCurrentDate)+1));
Facility_tpManual_tpMonthsSinceCurrentDate_title='Months Since CurrentDate';
Facility_tpManual_tpMonthsSinceCurrentDateHelpVarAvgOutstanding_value=If(Facility_tpManual_tpMonthsSinceCurrentDate>12,0,If(Facility_tpManual_tpMonthsSinceCurrentDate==NA,0,1));
Facility_tpManual_tpMonthsSinceCurrentDateHelpVarAvgOutstanding_title='Months Since CurrentDate - Help var exp. avg outstanding';
Facility_tpManual_tpRepaymentAmount_value=undefined;
Facility_tpManual_tpRepaymentAmount_title='Repayment Amount';
Facility_tpManual_tpRepaymentAmountRem_value=Facility_tpManual_tpRepaymentAmount*Facility_tpManual_tpMonthsSinceCurrentDate;
Facility_tpManual_tpRepaymentAmountRem_title='Repayment Amount Rem';
Facility_tpManual_tpRepaymentWeighted_value='Facility_tpManual_tpMonthsSinceStartDate*Facility_tpManual_tpRepaymentAmount';
Facility_tpManual_tpRepaymentWeighted_title='Repayment Weighted';
Facility_tpManual_tpRepaymentWeightedRem_value=Facility_tpManual_tpMonthsSinceCurrentDate*Facility_tpManual_tpRepaymentAmount;
Facility_tpManual_tpRepaymentWeightedRem_title='Repayment Weighted Rem';
Facility_tpManual_tpWithdrawalAmount_value='If(Facility_tpManual_tpMonthsSinceStartDate==1,Facility_tpPrincipalLimit,Facility_tpManual_tpWithdrawalAmount)';
Facility_tpManual_tpWithdrawalAmount_title='Withdrawal Amount';
Facility_tpManual_tpRepaymentAmountRemHelpVar_value=If(Facility_tpManual_tpMonthsSinceCurrentDate>0,1,0);
Facility_tpManual_tpRepaymentAmountRemHelpVar_title='Repayment Check for RAT';
Facility_tpManual_tpRepaymentAmountRemHelpVar1_value=Facility_tpManual_tpRepaymentAmount*Facility_tpManual_tpRepaymentAmountRemHelpVar;
Facility_tpManual_tpRepaymentAmountRemHelpVar1_title='Repayment Check for Within RAT';
Facility_tpManual_ExpectedAverageOutstandingWithdrawal_value='Facility_tpManual_tpWithdrawalAmount*Facility_tpManual_tpOutstandingBalanceWeightWithdrawal';
Facility_tpManual_ExpectedAverageOutstandingWithdrawal_title='Expected Average Outstanding Withdrawal';
Facility_tpManual_ExpectedAverageOutstandingWithdrawalAnnuity_value='If(Facility_tpManual_tpMonthsSinceStartDate<1,Facility_tpManual_tpWithdrawalAmount*Facility_tpManual_tpOutstandingBalanceWeightWithdrawal,Facility_tpManual_tpWithdrawalAmount*Facility_tpManual_tpOutstandingBalanceWeightWithdrawal*If(Facility_tpOriginalTenor-Facility_tpRemainingTenor>=Facility_tpManual_tpMonthsSinceStartDate,1,0))';
Facility_tpManual_ExpectedAverageOutstandingWithdrawalAnnuity_title='Expected Average Outstanding Withdrawal Annuity';
Facility_tpManual_ExpectedAverageOutstandingRepayment_value=Facility_tpManual_tpRepaymentAmount*Facility_tpManual_tpOutstandingBalanceWeightRepayment;
Facility_tpManual_ExpectedAverageOutstandingRepayment_title='Expected Average Outstanding Weighted Repayment';
Facility_tpManual_tpOutstandingBalanceWeightRepayment_value=MinMax(12-If(Facility_tpStartDate>Facility_tpCurrentDate,Facility_tpManual_tpMonthsSinceStartDate,Facility_tpManual_tpMonthsSinceCurrentDate),0,12,NA);
Facility_tpManual_tpOutstandingBalanceWeightRepayment_title='Outstanding Balance - Weight Repayment';
Facility_tpManual_tpOutstandingBalanceWeightWithdrawal_value=MinMax(If(Facility_tpCurrentDate>Facility_tpManual_tpFirstDayMonth,12,13-If(Facility_tpStartDate>Facility_tpCurrentDate,Facility_tpManual_tpMonthsSinceStartDate,Facility_tpManual_tpMonthsSinceCurrentDate)),0,12);
Facility_tpManual_tpOutstandingBalanceWeightWithdrawal_title='Outstanding Balance - Weight Withdrawal';
Facility_tpManual_tpOutstandingBalanceExpAvgOut_value=Facility_tpEAOWithdrawalScheme-Facility_tpExpectedAverageOutstandingRemHelp;
Facility_tpManual_tpOutstandingBalanceExpAvgOut_title='Outstanding Balance - Exp Avg Out';
Facility_tpManual_tpLiquiditySpreadBpsTRepayment_value='MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate,1),Facility_tpFixedInterestPeriod)+(MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorUpperBound\',Facility_tpManual_tpMonthsSinceStartDate,1),Facility_tpFixedInterestPeriod)-MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate,1),Facility_tpFixedInterestPeriod))*OnER((Facility_tpManual_tpMonthsSinceStartDate-MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate,1))/(MatrixLookup(\'LiquidityPremiumTenorUpperBound\',Facility_tpManual_tpMonthsSinceStartDate,1)-MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate,1)),0)';
Facility_tpManual_tpLiquiditySpreadBpsTRepayment_title='Liquidity Spread - Liquidity Spread Interpolated Bps';
Facility_tpManual_tpLiquiditySpreadRepayment_value='Facility_tpManual_tpWeightedFundingRepayment*Facility_tpManual_tpLiquiditySpreadBpsTRepayment';
Facility_tpManual_tpLiquiditySpreadRepayment_title='Liquidity Spread - Liquidity Spread - Repayment';
Facility_tpManual_tpWeightedFundingRepayment_value='Facility_tpManual_tpRepaymentAmount*Facility_tpManual_tpMonthsSinceStartDate/12';
Facility_tpManual_tpWeightedFundingRepayment_title='Liquidity Spread - Weighted Funding - Repayment';
Facility_tpManual_tpLiquiditySpreadBpsTWithdrawal_value='MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1),Facility_tpFixedInterestPeriod)+(MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorUpperBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1),Facility_tpFixedInterestPeriod)-MatrixLookup(If(Facility_tpBaseCurrency==\'EUR\',\'LiquidityPremiumEUR\',If(Facility_tpBaseCurrency==\'GBP\',\'LiquidityPremiumGBP\',If(Facility_tpBaseCurrency==\'USD\',\'LiquidityPremiumUSD\',\'LiquidityPremiumOther\'))),MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1),Facility_tpFixedInterestPeriod))*OnER((Facility_tpManual_tpMonthsSinceStartDate-1-MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1))/(MatrixLookup(\'LiquidityPremiumTenorUpperBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1)-MatrixLookup(\'LiquidityPremiumTenorLowerBound\',Facility_tpManual_tpMonthsSinceStartDate-1,1)),0)';
Facility_tpManual_tpLiquiditySpreadBpsTWithdrawal_title='Liquidity Spread - Liquidity Spread Interpolated Bps - Withdrawal';
Facility_tpManual_tpLiquiditySpreadWithdrawal_value='Facility_tpManual_tpWeightedFundingWithdrawal*Facility_tpManual_tpLiquiditySpreadBpsTWithdrawal';
Facility_tpManual_tpLiquiditySpreadWithdrawal_title='Liquidity Spread - Liquidity Spread - Withdrawal';
Facility_tpManual_tpWeightedFundingWithdrawal_value='Facility_tpManual_tpWithdrawalAmount*(Facility_tpManual_tpMonthsSinceStartDate-1)/12';
Facility_tpManual_tpWeightedFundingWithdrawal_title='Liquidity Spread - Weighted Funding - Withdrawal';
Facility_tpManual_LimitWeightedRepayment_value=Facility_tpManual_tpRepaymentAmount*Facility_tpManual_tpLimitWeightRepayment;
Facility_tpManual_LimitWeightedRepayment_title='Limit - Weighted Repayment';
Facility_tpManual_tpLimitWeightRepayment_value=MinMax(13-If(Facility_tpStartDate>Facility_tpCurrentDate,Facility_tpManual_tpMonthsSinceStartDate,Facility_tpManual_tpMonthsSinceCurrentDate),0,12,NA);
Facility_tpManual_tpLimitWeightRepayment_title='Limit - Repayment Weight';
Facility_tpSumOfWeightedRepaymentOATNominator_value='TupleSum(Facility_tpManual_tpRepaymentWeighted)';
Facility_tpSumOfWeightedRepaymentOATNominator_title='Sum of Weighted Repayment OAT Nominator';
Facility_tpSumOfRepaymentOATDenominator_value=12*TupleSum(Facility_tpManual_tpRepaymentAmount);
Facility_tpSumOfRepaymentOATDenominator_title='Sum of Repayment OAT Denominator';
Facility_tpOriginalAverageTenorScheme_value='Facility_tpSumOfWeightedRepaymentOATNominator/Facility_tpSumOfRepaymentOATDenominator';
Facility_tpOriginalAverageTenorScheme_title='Original Average Tenor';
Facility_tpSumOfRepaymentRAT_value=TupleSum(Facility_tpManual_tpRepaymentAmountRemHelpVar1);
Facility_tpSumOfRepaymentRAT_title='Sum of Weighted Repayment RAT TupleSum';
Facility_tpSumOfRepaymentRATWeight_value=Facility_tpSumOfWeightedRepaymentRATNominator/(Facility_tpSumOfRepaymentRAT*Facility_tpExpectedAverageOutstandingCount);
Facility_tpSumOfRepaymentRATWeight_title='Sum of Weighted Repayment RAT Weight';
Facility_tpSumOfWeightedRepaymentRATNominator_value=TupleSum(Facility_tpManual_tpRepaymentWeightedRem);
Facility_tpSumOfWeightedRepaymentRATNominator_title='Sum of Weighted Repayment RAT Nominator';
Facility_tpRemainingAverageTenorScheme_value=If(Facility_tpSumOfRepaymentRATWeight*Facility_tpExpectedAverageOutstandingCount/12>=Facility_tpOriginalAverageTenorScheme,Facility_tpOriginalAverageTenorScheme,Facility_tpSumOfRepaymentRATWeight*Facility_tpExpectedAverageOutstandingCount/12);
Facility_tpRemainingAverageTenorScheme_title='Remaining Average Tenor';
Facility_tpEAOWithdrawalScheme_value=If(Facility_tpWithdrawalChoice==0,Facility_tpPrincipalLimit*12,If(Facility_tpWithdrawalChoice==3,TupleSum(Facility_tpManual_ExpectedAverageOutstandingWithdrawal),0));
Facility_tpEAOWithdrawalScheme_title='Expected Average Outstanding Withdrawal Help';
Facility_tpExpectedAverageOutstandingWithdrawalAnnuityHelp_value='TupleSum(Facility_tpManual_ExpectedAverageOutstandingWithdrawalAnnuity)';
Facility_tpExpectedAverageOutstandingWithdrawalAnnuityHelp_title='Expected Average Outstanding Withdrawal Annuity Help';
Facility_tpExpectedAverageOutstandingRemHelp_value=TupleSum(Facility_tpManual_ExpectedAverageOutstandingRepayment);
Facility_tpExpectedAverageOutstandingRemHelp_title='Expected Average Outstanding Rem Help';
Facility_tpExpectedAverageOutstandingCount_value=If(Facility_tpEndDate<Facility_tpCurrentDate,NA,(DateToYear(Facility_tpEndDate)-DateToYear(Facility_tpCurrentDate))*12+DateToMonth(Facility_tpEndDate)-DateToMonth(Facility_tpCurrentDate));
Facility_tpExpectedAverageOutstandingCount_title='Expected Average Outstanding Count';
Facility_tpExpectedAverageOutstandingCountMaxEAO_value=MinMax(Facility_tpExpectedAverageOutstandingCount,0,12,NA);
Facility_tpExpectedAverageOutstandingCountMaxEAO_title='Expected Average Outstanding Count Max EAO';
Facility_tpOutstandingBalanceExpAvgOutDenom_value=MinMax(Facility_tpProductduration-Facility_tpExpectedAverageOutstandingCount,0,12,0);
Facility_tpOutstandingBalanceExpAvgOutDenom_title='Expected Average Outstanding Denom';
Facility_tpExpectedAverageOutstandingScheme_value=(Facility_tpEAOWithdrawalScheme-Facility_tpExpectedAverageOutstandingRemHelp)/Facility_tpExpectedAverageOutstandingCountMaxEAO;
Facility_tpAnnuityLinear_value=undefined;
Facility_tpAnnuityLinear_title='Annuity + Linear';
Facility_tpAnnuityParameters_value=undefined;
Facility_tpAnnuityParameters_title='Annuity Parameters';
Facility_tpAnnuityLinearSub2_value=undefined;
Facility_tpAnnuityLinearSub2_title='Annuity Start Date';
Facility_tpAnnuityLinearSub3_value=undefined;
Facility_tpAnnuityLinearSub3_title='Annuity Current Date';
Facility_tpAnnuityLinearSub4_value=undefined;
Facility_tpAnnuityLinearSub4_title='Annuity End Date';
Facility_tpAnnuityFirstDayMonth_value=Facility_tpCurrentDate;
Facility_tpAnnuityFirstDayMonth_title='Annuity Date of Repayment / Withdrawel';
Facility_tpAnnuityMonthsSinceStartDate_value=OnZero(RoundUp(OnNeg(If(Facility_tpStartDate==NA,NA,(DateToYear(Facility_tpCurrentDate)-DateToYear(Facility_tpStartDate))*12+DateToMonth(Facility_tpCurrentDate)-DateToMonth(Facility_tpStartDate))+If(Facility_tpAnnuityMonthsSinceStartDate==NA,NA,1),0)/Facility_tpAnnuityRepaymentFreqHelpVar,0),1);
Facility_tpAnnuityMonthsSinceStartDate_title='Annuity Months Since Start Date';
Facility_tpAnnuityMonthsSinceCurrentDate_value=OnNeg(Facility_tpAnnuityMonthsSinceStartDate-1,0);
Facility_tpAnnuityMonthsSinceCurrentDate_title='Annuity Months Since Current Date';
Facility_tpAnnuityMonthsSinceCurrentDateHelpVar_value=If(Facility_tpAnnuityMonthsSinceCurrentDate>12,0,If(Facility_tpAnnuityMonthsSinceCurrentDate==NA,0,1));
Facility_tpAnnuityMonthsSinceCurrentDateHelpVar_title='Annuity Months Since Current Date Help Var';
Facility_tpAnnuityRepaymentFreqHelpVar_value=Case(Facility_tpRepaymentFrequency,[1,12||2,6||4,3||12,1]);
Facility_tpAnnuityRepaymentFreqHelpVar_title='Annuity Months RepaymentFreq Help Var';
Facility_tpAnnuityLinearSub10_value=undefined;
Facility_tpAnnuityLinearSub10_title='Rate';
Facility_tpAnnuityLinearSub11_value=undefined;
Facility_tpAnnuityLinearSub11_title='Period';
Facility_tpPeriodForRATGrace_value=Facility_tpAnnuityMonthsSinceStartDate-(Facility_tpNumberOfPeriodsNoGrace-Facility_tpNumberOfPeriods);
Facility_tpPeriodForRATGrace_title='Period For RAT Grace';
Facility_tpPeriodDifferenceGrace_value=Facility_tpNumberOfPeriodsNoGrace-Facility_tpNumberOfPeriods;
Facility_tpPeriodDifferenceGrace_title='Period For RAT Grace Difference';
Facility_tpAnnuityLinearSub14_value=undefined;
Facility_tpAnnuityLinearSub14_title='N Period';
Facility_tpAnnuityLinearSub15_value=undefined;
Facility_tpAnnuityLinearSub16_value=undefined;
Facility_tpAnnuityLinearSub16_title='Balloon';
Facility_tpAnnuityRepaymentAmount_value=PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,Facility_tpAnnuityMonthsSinceStartDate,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon);
Facility_tpAnnuityRepaymentAmount_title='Annuity Repayment Amount (PPMT)';
Facility_tpAnnuityWithdrawalAmount_value=If(Facility_tpAnnuityMonthsSinceStartDate==1,Facility_tpPrincipalLimit,Facility_tpAnnuityWithdrawalAmount);
Facility_tpAnnuityWithdrawalAmount_title='Annuity Withdrawal Amount';
Facility_tpAnnuityPPMTRATTotalPeriods_value=RoundUp(Facility_tpNumberOfPeriodsNoGrace-Facility_tpAnnuityMonthsSinceCurrentDate);
Facility_tpAnnuityPPMTRATTotalPeriods_title='Annuity PPMT RAT Total Periods';
Facility_tpAnnuityPPMTRATTotalPeriodsMax_value=MinMax(Facility_tpAnnuityPPMTRATTotalPeriods,0,Facility_tpRepaymentFrequency,NA);
Facility_tpAnnuityPPMTRATTotalPeriodsMax_title='Annuity PPMT RAT Total Periods Max';
Facility_tpAnnuityPPMTRATTotalMonths_value=Facility_tpAnnuityPPMTRATTotalPeriods*Facility_tpAnnuityRepaymentFreqHelpVar;
Facility_tpAnnuityPPMTRATTotalMonths_title='Annuity PPMT RAT Total Monthts';
Facility_tpAnnuityPPMTRATMonth_value=RoundUp(If(DMYtoDate(1,DateToMonth(Facility_tpAnnuityFirstDayMonth),DateToYear(Facility_tpAnnuityFirstDayMonth))<DMYtoDate(1,DateToMonth(Facility_tpCurrentDate),DateToYear(Facility_tpCurrentDate)),NA,(DateToYear(Facility_tpAnnuityFirstDayMonth)-DateToYear(Facility_tpCurrentDate))*12+DateToMonth(Facility_tpAnnuityFirstDayMonth)-DateToMonth(Facility_tpCurrentDate)+1)/Facility_tpAnnuityRepaymentFreqHelpVar,0);
Facility_tpAnnuityPPMTRATMonth_title='Annuity PPMT RAT Month';
Facility_tpAnnuityOATHelpVarWeightSumWithGrace_value=SumFor(X,Facility_tpNumberOfPeriodsNoGrace-Facility_tpNumberOfPeriods+1,Facility_tpNumberOfPeriodsNoGrace,1,X*PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X-(Facility_tpNumberOfPeriodsNoGrace-Facility_tpNumberOfPeriods+1)+1,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*Facility_tpAnnuityRepaymentFreqHelpVar);
Facility_tpAnnuityOATHelpVarWeightSumWithGrace_title='Annuity OAT per period SUM';
Facility_tpAnnuityOATHelpVarWeightSumGrace_value=undefined;
Facility_tpAnnuityOATHelpVarWeightSumGrace_title='Annuity OAT HelpVar Weight Sum No Grace';
Facility_tpAnnuityOATHelpVar_value=Facility_tpAnnuityOATHelpVarWeightSumWithGrace/(Facility_tpPrincipalLimit*Facility_tpOriginalTenor);
Facility_tpAnnuityOATHelpVar_title='Annuity OAT HelpVar Weight Sum With Grace';
Facility_tpAnnuityOAT_value=Facility_tpAnnuityOATHelpVar*Facility_tpOriginalTenor/12;
Facility_tpAnnuityOAT_title='Annuity OAT HelpVar';
Facility_tpAnnuityRATHelpVarWeightSumWithGrace_value=SumFor(X,1,Facility_tpNumberOfPeriods-(Facility_tpAnnuityMonthsSinceCurrentDate-Facility_tpPeriodDifferenceGrace),1,X*PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,Facility_tpPeriodForRATGrace-1+X,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*Facility_tpAnnuityRepaymentFreqHelpVar);
Facility_tpAnnuityRATHelpVarWeightSumWithGrace_title='Annuity RAT HelpVar Weight Sum No Grace';
Facility_tpAnnuityRATHelpVarSumRepayment_value=SumFor(X,1,Facility_tpNumberOfPeriods-(Facility_tpAnnuityMonthsSinceCurrentDate-Facility_tpPeriodDifferenceGrace),1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,Facility_tpPeriodForRATGrace-1+X,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon));
Facility_tpAnnuityRATHelpVarSumRepayment_title='Annuity RAT HelpVar Sum Repayment';
Facility_tpAnnuityRATHelpVar_value=Facility_tpAnnuityRATHelpVarWeightSumWithGrace/(Facility_tpAnnuityRATHelpVarSumRepayment*Facility_tpAnnuityPPMTRATTotalMonths);
Facility_tpAnnuityRATHelpVar_title='Annuity RAT HelpVar Weight Sum With Grace';
Facility_tpAnnuityRAT_value=Facility_tpAnnuityRATHelpVar*Facility_tpAnnuityPPMTRATTotalMonths/12;
Facility_tpAnnuityRAT_title='Annuity RAT HelpVar';
Facility_tpAnnuityOutstandingPointInTime_value=Facility_tpPrincipalLimit-SumFor(X,0,Facility_tpAnnuityMonthsSinceStartDate-1,1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon));
Facility_tpAnnuityOutstandingPointInTime_title='Annuity Outstanding Point in Time';
Facility_tpEAORepaymentAnnuity_value=SumFor(X,1,Facility_tpNumberOfPeriods,1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*MinMax(Facility_tpAnnuityMonthsSinceStartDate-1+Facility_tpRepaymentFrequency-Facility_tpPeriodDifferenceGrace-X,0,Facility_tpRepaymentFrequency,0));
Facility_tpEAORepaymentAnnuity_title='Annuity Outstanding Repayment Sum';
Facility_tpAnnuityOutstandingWithdrawalSum_value=Facility_tpPrincipalLimit*Facility_tpRepaymentFrequency;
Facility_tpAnnuityOutstandingWithdrawalSum_title='Annuity Outstanding Withdrawal Sum';
Facility_tpLinear_value=Facility_tpPrincipalLimit/Facility_tpNumberOfPeriods;
Facility_tpLinear_title='Linear Repayment';
Facility_tpLinearWithdrawal_value=undefined;
Facility_tpLinearWithdrawal_title='Linear Withdrawal';
Facility_tpLinearOATHelpVarWeightSumWithGrace_value=SumFor(X,Facility_tpNumberOfPeriodsNoGrace-Facility_tpNumberOfPeriods+1,Facility_tpNumberOfPeriodsNoGrace,1,X*Facility_tpLinear*Facility_tpAnnuityRepaymentFreqHelpVar);
Facility_tpLinearOATHelpVarWeightSumWithGrace_title='Linear OAT HelpVar Weight Sum No Grace';
Facility_tpLinearOATHelpVarWeightSumGrace_value=Facility_tpLinearOATHelpVarWeightSumWithGrace-Round(Facility_tpGracePeriod/Facility_tpAnnuityRepaymentFreqHelpVar,0)*Facility_tpLinear*Facility_tpAnnuityRepaymentFreqHelpVar;
Facility_tpLinearOATHelpVarWeightSumGrace_title='Linear OAT HelpVar Weight Sum With Grace';
Facility_tpLinearOATHelpVar_value=Facility_tpLinearOATHelpVarWeightSumWithGrace/(Facility_tpPrincipalLimit*Facility_tpOriginalTenor);
Facility_tpLinearOATHelpVar_title='Linear OAT HelpVar';
Facility_tpLinearOAT_value=Facility_tpLinearOATHelpVar*Facility_tpOriginalTenor/12;
Facility_tpLinearOAT_title='Linear OAT';
Facility_tpLinearRATHelpVarWeightSumWithGrace_value=SumFor(X,1,Facility_tpAnnuityPPMTRATTotalPeriods,1,X*Facility_tpLinear*Facility_tpAnnuityRepaymentFreqHelpVar);
Facility_tpLinearRATHelpVarWeightSumWithGrace_title='Linear RAT HelpVar Weight Sum No Grace';
Facility_tpLinearRATHelpVarSumRepayment_value=SumFor(X,1,Facility_tpAnnuityPPMTRATTotalPeriods,1,Facility_tpLinear*(X-X+1));
Facility_tpLinearRATHelpVarSumRepayment_title='Linear RAT HelpVar Sum Repayment';
Facility_tpLinearRATHelpVar_value=Facility_tpLinearRATHelpVarWeightSumWithGrace/(Facility_tpLinearRATHelpVarSumRepayment*Facility_tpAnnuityPPMTRATTotalMonths);
Facility_tpLinearRATHelpVar_title='Linear RAT HelpVar Weight Sum With Grace';
Facility_tpLinearRAT_value=Facility_tpLinearRATHelpVar*Facility_tpAnnuityPPMTRATTotalMonths/12;
Facility_tpLinearRAT_title='Linear RAT';
Facility_tpEAORevolving_value=Facility_tpPrincipalLimit*Facility_tpProductWithdrawalDetailsPercentageUsedOfLimit;
Facility_tpEAORevolving_title='Expected average outstanding Revolving';
Facility_tpEAOOnceLinear_value=(Facility_tpLinearOutstandingWithdrawalSum-Facility_tpEAORepaymentLinear)/MinMax(Facility_tpAnnuityPPMTRATTotalPeriods,1,Facility_tpRepaymentFrequency,NA);
Facility_tpEAOOnceLinear_title='Expected average outstanding for once withdrawal&&linear repayment';
Facility_tpEAOSchemeLinear_value=(Facility_tpEAOWithdrawalScheme-Facility_tpEAORepaymentLinearForSchemeWithdrawal)/MinMax(Facility_tpRemainingTenor,1,12,NA);
Facility_tpEAOSchemeLinear_title='Expected average outstanding for manual withdrawal&&linear repayment';
Facility_tpEAOOnceAnnuity_value=(Facility_tpAnnuityOutstandingWithdrawalSum-Facility_tpEAORepaymentAnnuity)/MinMax(Facility_tpNumberOfPeriods-Facility_tpAnnuityMonthsSinceStartDate,1,Facility_tpRepaymentFrequency,NA);
Facility_tpEAOOnceAnnuity_title='Expected average outstanding for once withdrawal&&annuity repayment';
Facility_tpEAOSchemeAnnuity_value=(Facility_tpExpectedAverageOutstandingScheme-Facility_tpEAORepaymentAnnuity)/MinMax(Facility_tpRemainingTenor,1,Facility_tpRepaymentFrequency,NA);
Facility_tpEAOSchemeAnnuity_title='Expected average outstanding for manual withdrawal&&annuity repayment';
Facility_tpLinearOutstandingPointInTime_value=Facility_tpPrincipalLimit-SumFor(X,1,Facility_tpAnnuityMonthsSinceStartDate-1,1,Facility_tpLinear*(X+1-X));
Facility_tpLinearOutstandingPointInTime_title='Linear Outstanding Point in Time';
Facility_tpEAORepaymentLinear_value=SumFor(X,Facility_tpPeriodDifferenceGrace+1,Facility_tpNumberOfPeriodsNoGrace,1,Facility_tpLinear*Round(MinMax((Facility_tpAnnuityMonthsSinceStartDate-1+Facility_tpRepaymentFrequency-X)*If(Facility_tpWithdrawalChoice==3,Facility_tpAnnuityRepaymentFreqHelpVar,1),0,If(Facility_tpWithdrawalChoice==3,12,Facility_tpRepaymentFrequency),0),0));
Facility_tpEAORepaymentLinear_title='Linear Outstanding Repayment Sum';
Facility_tpEAORepaymentLinearForSchemeWithdrawal_value=SumFor(X,12/Facility_tpRepaymentFrequency+Facility_tpGracePeriod,Facility_tpOriginalTenor,12/Facility_tpRepaymentFrequency,Facility_tpLinear*MinMax(12-(X-(Facility_tpOriginalTenor-Facility_tpRemainingTenor)),0,12));
Facility_tpLinearOutstandingWithdrawalSum_value=Facility_tpPrincipalLimit*Facility_tpRepaymentFrequency;
Facility_tpLinearOutstandingWithdrawalSum_title='Linear Outstanding Withdrawal Sum';
Facility_tpHiddenRepaymentScheme_value=undefined;
Facility_tpHiddenRepaymentScheme_title='Hidden variables for repayment scheme';
Facility_tpWeightedAmountRepayment_value=x.notrend?undefined:Facility_tpRepayment*Facility_tpHulpVarWeightOfRepayment;
Facility_tpWeightedAmountRepayment_title='Weighted Repayment Amount';
Facility_tpWeightedAmountRepaymentRem_value=x.notrend?undefined:Facility_tpRepayment*Facility_tpHulpVarWeightOfRepaymentRemaining;
Facility_tpWeightedAmountRepaymentRem_title='Weighted Repayment Amount Remaining';
Facility_tpWithdrawal_value=If(Facility_tpWithdrawalChoice==0,Facility_tpWithdrawalOneTime,If(Facility_tpWithdrawalChoice==1,Facility_tpWithdrawalFixedTerms,If(Facility_tpWithdrawalChoice==2,Facility_tpWithdrawalRevolving,If(Facility_tpWithdrawalChoice==3,Facility_tpWithdrawalsAmount,NA))));
Facility_tpWithdrawal_title='Withdrawal';
Facility_tpRepayment_value=x.notrend?undefined:If(Facility_tpRepaymentChoice==0||Facility_tpRepaymentChoice==4,Facility_tpRepaymentBalloon,If(Facility_tpRepaymentChoice==1,Facility_tpRepaymentLinear+Facility_tpRepaymentBalloon,If(Facility_tpRepaymentChoice==2,Facility_tpRepaymentAnnuity+Facility_tpRepaymentBalloon,If(Facility_tpRepaymentChoice==3,If(T==DateToT(Facility_tpEndDateMax10,1),Facility_tpOutstandingBalance[prev],Facility_tpRepaymentsAmount[prev])))));
Facility_tpRepayment_title='Repayment';
Facility_tpOutstandingBalance_value=x.notrend?Facility_tpWithdrawal-Facility_tpRepayment:OnNeg(OnZero(HSum(Facility_tpWithdrawal,DateToT(Facility_tpStartDate,1),T)-HSum(Facility_tpRepayment,DateToT(Facility_tpStartDate,1),T),NA),NA);
Facility_tpOutstandingBalance_title='Outstanding Balance';
Facility_tpOutstandingBalanceHulpVar_value=x.notrend?undefined:If(Facility_tpRepaymentChoice==0,Facility_tpOutstandingBalance,If(Facility_tpHulpVarFrequency<Facility_tpHulpVarFrequency[GetT(T,1)],Facility_tpOutstandingBalance,Facility_tpOutstandingBalance*NA));
Facility_tpOutstandingBalanceHulpVar_title='Outstanding Balance Hulp Average calculation';
Facility_tpHulpVarFrequency_value=x.notrend?undefined:If(T>DateToT(Facility_tpEndDateMax10,1),NA,If(T==DateToT(Facility_tpEndDateMax10,1),Facility_tpHulpVarFrequency[prev]+1,Round((T-DateToT(Facility_tpStartDate,1)-Facility_tpGracePeriod)/(TsY/Facility_tpRepaymentFrequency)+.5,0)-1));
Facility_tpHulpVarFrequency_title='Hulp Var Tenors';
Facility_tpWithdrawalOneTime_value=x.notrend?undefined:If(DateToT(Facility_tpStartDate,1)==T,Facility_tpPrincipalLimit,NA);
Facility_tpWithdrawalOneTime_title='Withdrawal One Time';
Facility_tpWithdrawalFixedTerms_value=undefined;
Facility_tpWithdrawalFixedTerms_title='Withdrawal Fixed Terms';
Facility_tpWithdrawalRevolving_value=x.notrend?NA:If(DateToT(Facility_tpStartDate,1)==T,Facility_tpPrincipalLimit,NA);
Facility_tpWithdrawalRevolving_title='Withdrawal Revolving';
Facility_tpWithdrawalsAmount_value=undefined;
Facility_tpWithdrawalsAmount_title='Withdrawals Scheme';
Facility_tpRepaymentLinear_value=x.notrend?undefined:If(Facility_tpAfterGraceperiod,OnZero(Min((Facility_tpHulpVarRepayment[prev]!=Facility_tpHulpVarRepayment)*((Facility_tpPrincipalLimit-Facility_tpBalloon)/Facility_tpNumberOfPeriods),Facility_tpOutstandingBalance[prev]),NA),NA);
Facility_tpRepaymentLinear_title='Repayment Scheme Linear';
Facility_tpRepaymentAnnuity_value=x.notrend?undefined:If(Facility_tpAfterGraceperiod,If(Facility_tpHulpVarRepayment[prev]!=Facility_tpHulpVarRepayment,(Facility_tpHulpVarRepayment[prev]!=Facility_tpHulpVarRepayment)*PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,Facility_tpHulpVarRepayment,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon),NA),NA);
Facility_tpRepaymentAnnuity_title='Repayment Scheme Annuity';
Facility_tpRepaymentBalloon_value=x.notrend?undefined:If(T==DateToT(Facility_tpEndDateMax10,1),If(Facility_tpRepaymentChoice==0,Facility_tpOutstandingBalance[prev],If(Facility_tpRepaymentChoice==1||Facility_tpRepaymentChoice==2,Facility_tpOutstandingBalance[prev]-If(Facility_tpRepaymentChoice==1,Facility_tpRepaymentLinear,If(Facility_tpRepaymentChoice==2,Facility_tpRepaymentAnnuity,NA)),NA)));
Facility_tpRepaymentBalloon_title='Repayment Balloon';
Facility_tpRepaymentRevolving_value=undefined;
Facility_tpRepaymentRevolving_title='Repayment Revolving';
Facility_tpRepaymentsAmount_value=undefined;
Facility_tpRepaymentsAmount_title='Repayments Scheme';
Facility_tpAfterGraceperiod_value=x.notrend?undefined:If(T<DateToT(Facility_tpStartDate,1)||T>DateToT(Facility_tpEndDateMax10,1),NA,If(T>=DateToT(AddMonth(Facility_tpStartDate,Facility_tpGracePeriod),1),1,0));
Facility_tpAfterGraceperiod_title='After Grace period (Y/N)';
Facility_tpHulpVarRepayment_value=x.notrend?undefined:If(T>DateToT(Facility_tpEndDateMax10,1)+1,NA,OnNeg(OnZero(Min(Round((T-DateToT(Facility_tpStartDate,1)-Facility_tpGracePeriod)/(TsY/Facility_tpRepaymentFrequency)+.5,0)-1,Facility_tpOutstandingBalance[prev]),NA),NA));
Facility_tpHulpVarRepayment_title='Repayment At A Certain Time';
Facility_tpHulpVarRemainingWeighted_value=x.notrend?undefined:If(T>=DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1)&&T>DateToT(Facility_tpStartDate,1)+Facility_tpGracePeriod,OnNeg(OnZero(Min(Round((T-If(DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1)>DateToT(Facility_tpStartDate,1)+Facility_tpGracePeriod,DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1),DateToT(Facility_tpStartDate,1)+Facility_tpGracePeriod+1))/(TsY/Facility_tpRepaymentFrequency)+.5,0),Facility_tpOutstandingBalance[prev]),NA),NA),NA);
Facility_tpHulpVarRemainingWeighted_title='Repayment Term for weighted remaining tenor';
Facility_tpHulpVarWeightOfRepayment_value=x.notrend?undefined:If(T>DateToT(Facility_tpEndDateMax10,1)||T<DateToT(Facility_tpStartDate,1),NA,T-DateToT(Facility_tpStartDate,1));
Facility_tpHulpVarWeightOfRepayment_title='Weight of repayment Original Tenor';
Facility_tpHulpVarWeightOfRepaymentRemaining_value=x.notrend?undefined:If(T>DateToT(Facility_tpEndDateMax10,1)||T<DateToT(If(Facility_tpCurrentDate<=Facility_tpStartDate,Facility_tpStartDate,Facility_tpCurrentDate),1),NA,T-DateToT(If(Facility_tpCurrentDate<=Facility_tpStartDate,Facility_tpStartDate,Facility_tpCurrentDate),1));
Facility_tpHulpVarWeightOfRepaymentRemaining_title='Weight of repayment Remaining Tenor';
Facility_tpHulpVarRepaymentScheme_value=x.notrend?undefined:If(Facility_tpRepaymentChoice==3&&Facility_tpRepayment!=NA,T-DateToT(Facility_tpStartDate,1),NA);
Facility_tpHulpVarRepaymentScheme_title='Repayment At A Certain Time via Scheme';
Facility_tpHulpVarRepaymentSchemeWeighted_value=x.notrend?undefined:If(Facility_tpRepaymentChoice==3&&Facility_tpRepayment!=NA,If(T>=DateToT(Facility_tpCurrentDate,1)+If(DateToDay(Facility_tpCurrentDate)==1,0,1)&&T>DateToT(Facility_tpStartDate,1)+Facility_tpGracePeriod,T-DateToT(Facility_tpCurrentDate,1),NA),NA);
Facility_tpHulpVarRepaymentSchemeWeighted_title='Repayment Term for weighted remaining tenor via Scheme';
Facility_tpDirectLiquidityPremiumPerT_value=undefined;
Facility_tpDirectLiquidityPremiumPerT_title='Direct Liquidity Premium Per T';
Facility_tpFundingAmountPerT_value=undefined;
Facility_tpFundingAmountPerT_title='Funding Amount Per T';
Facility_tpWeightedFundingAmountPerT_value=undefined;
Facility_tpWeightedFundingAmountPerT_title='Funding Weighted Amount Per T';
Facility_tpPeriodPerT_value=undefined;
Facility_tpPeriodPerT_title='Period of T into years';
Facility_tpLiquiditySpreadBpsT_value=undefined;
Facility_tpLiquiditySpreadBpsT_title='Interpolated Bps for Liq. Sprd';
Facility_tpLiquiditySpread_value=undefined;
Facility_tpLiquiditySpread_title='Liq. Sprd. Amount Per T';
Facility_tpGuarantor_value=undefined;
Facility_tpGuarantor_title=String('Third party Guarantees');
Facility_tpGuarantorAGICOrSBI_value=0;
Facility_tpGuarantorSBI_value=undefined;
Facility_tpGuarantorSBIName_value=String(MatrixLookup('SBIMapping',''+Facility_tpGuarantorSBI,1));
Facility_tpGuarantorAGICChoice_value=undefined;
Facility_tpGuarantorAGIC_value=undefined;
Facility_tpGuarantorPercentageGuaranteed_value=undefined;
Facility_tpGuarantorPercentageGuaranteed_title='Percentage guanranteed';
Facility_tpGuarantorRatingChoice_value=undefined;
Facility_tpGuarantorRating_value=String(Case(Facility_tpGuarantorRatingChoice,[200,'0'||210,'1'||220,'2'||221,'2-'||222,'2+'||230,'3'||231,'3-'||232,'3+'||240,'4'||241,'4-'||242,'4+'||250,'5'||251,'5-'||252,'5+'||260,'6'||261,'6+'||270,'7']));
Facility_tpGuarantorRating_title='UCR Rating Guarantor';
Facility_tpGuarantorPDModelChoice_value=undefined;
Facility_tpGuarantorPDModel_value=String(SubStr(Case(Facility_tpGuarantorPDModelChoice,[1,'PAAL - ABN AMRO Lease PD PL'||2,'PAFI - Acquisition Finance (Leveraged) (S+P) PD'||3,'PAIR - Airlines (Asset backed) (S+P) PD'||4,'PBNK - Commercial Banks (S+P) PD'||5,'PCBS - Consumer CRG model'||6,'PCLM - Mainbrand Consumer&&Business PD'||7,'PCRE - Commercial Real Estate PD'||8,'PDCR - DCRM PD'||9,'PDIA - Diamond Score PD'||10,'PFSH - Regulated Investment Funds PD (Highly Leveraged)'||11,'PFSI - Regulated Investment Funds PD'||12,'PFSL - Regulated Investment Funds PD (leveraged)'||13,'PFSP - Pension Funds PD'||14,'PFSU - Regulated Investment Funds PD (Unleveraged)'||15,'PGCG - Global Commodities Group Int PD'||16,'PGSM - Global SME PD'||17,'PHCN - Health Care PD'||18,'PIBK - Investment Banks (S+P) PD'||19,'PINC - Insurance combined (2.1)'||20,'PINL - Insurance Life (2.1)'||21,'PINN - Insurance Non - Life (2.1)'||22,'PLCR - Large Corporates Rating PD'||23,'PMAS - Shipping (Marsoft) PD'||24,'PMBO - MBO/MBI PD'||25,'PNMA - No Model Available (Expert process)'||26,'POGM - Oil + Gas (Gathering + Processing) (S+P) PD'||27,'POGU - Oil + Gas (Exploration + Production) (S+P) PD'||28,'POLE - Operational Leasing (Asset backed) (S+P) PD'||29,'PPBP - Private Score PD Lombard'||30,'PPRI - Private Score PD'||31,'PPUB - Public Sector Entities PD'||32,'PREG - Regulatory Rating'||33,'PRMG - Ex-F Non-Mainbrand Mortgages PD'||34,'PSHP - Shipping (Asset backed) (S+P) PD'||35,'PSOV - Sovereigns PD'||36,'PSUR - Start ups PD'||37,'PUTI - Energy utilities PD'||38,'PBBS - Business CRG model'||39,'PCFP - Cash Flow PD ']),0,4));
Facility_tpGuarantorPDModel_title='PD Model Tekst';
Facility_tpGuarantorPD_value=MatrixLookup('PD',Facility_tpGuarantorRating,1)*Facility_tpPDMultiplierUnder1Year;
Facility_tpGuarantorPDMoC_value=Facility_tpGuarantorPD*Facility_tpGuarantorMoCFactor;
Facility_tpGuarantorMoCFactor_value=MatrixLookup('MOCFactorPD',Facility_tpGuarantorPDModel,1);
FacilitySub7_value=undefined;
FacilitySub7_title='Profit&&Losses - Facility';
FacilitySub7Sub1_value=undefined;
FacilitySub7Sub1_title='Risk Adjusted Return - Income';
FacilitySub7Sub1Sub1_value=undefined;
FacilitySub7Sub1Sub1_title='Risk Adjusted Return - Income - Interest Income';
FacilitySub7Sub1Sub2_value=undefined;
FacilitySub7Sub1Sub2_title='Risk Adjusted Return - Income - Credit Related Fee';
FacilitySub7Sub1Sub3_value=undefined;
FacilitySub7Sub2_value=undefined;
FacilitySub7Sub2_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs';
FacilitySub7Sub3_value=undefined;
FacilitySub7Sub3_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Direct Liquidity Premium';
FacilitySub7Sub4_value=undefined;
FacilitySub7Sub4_title='Risk Adjusted Return - Interest Expenses - Subordinated Debt Capital Charge';
FacilitySub7Sub5_value=undefined;
FacilitySub7Sub5_title='Risk Adjusted Return - Interest Expenses - Equity Funding Adjustment';
FacilitySub7Sub6_value=undefined;
FacilitySub7Sub6_title='Risk Adjusted Return - Other Expenses - Operational Costs';
FacilitySub7Sub7_value=undefined;
FacilitySub7Sub7_title='Risk Adjusted Return - Other Expenses - Internal Expected Loss';
FacilitySub7Sub8_value=undefined;
FacilitySub7Sub8_title='Risk Adjusted Return - Other Expenses - Tax';
FacilitySub7Sub9_value=undefined;
FacilitySub7Sub10_value=undefined;
FacilitySub7Sub10Sub1_value=undefined;
FacilitySub7Sub10Sub2_value=undefined;
FacilitySub7Sub11_value=undefined;
FacilitySub7Sub11Sub1_value=undefined;
FacilitySub7Sub11Sub2_value=undefined;
FacilitySub7Sub11Sub3_value=undefined;
FacilitySub7Sub12_value=undefined;
FacilitySub7Sub12Sub1_value=undefined;
FacilitySub7Sub12Sub2_value=undefined;
FacilitySub7Sub12Sub2_title='Regulatory Profit - Equity Capital Charge';
FacilitySub7Sub12Sub3_value=undefined;
FacilitySub7Sub13_value=undefined;
FacilitySub7Sub13Sub1_value=undefined;
FacilitySub7Sub13Sub2_value=undefined;
FacilitySub7Sub13Sub2Sub1_value=undefined;
FacilitySub7Sub13Sub2Sub2_value=undefined;
FacilitySub7Sub14_value=undefined;
FacilitySub7Sub14Sub1_value=undefined;
FacilitySub7Sub14Sub2_value=undefined;
FacilitySub7Sub14Sub3_value=undefined;
FacilitySub7Sub14Sub4_value=undefined;
FacilitySub7Sub14Sub4_title='Risk Weighted Assets';
FacilitySub7Sub14Sub5_value=undefined;
Facility_tpTargetRaRoRaCSection_value=undefined;
Facility_tpRequiredInterestMarginBps_value=If(TargetRaRoRaCDriven,GoalSeek(Facility_tpRaRoRaC,Facility_tpTargetRaRoRac,Facility_tpCustomerSpread,Facility_tpStartValue,Facility_tpEndValue,Facility_tpSmallestDelta,Facility_tpMaxRuntimeMs),NA);
Facility_tpRequiredInterestMarginBps_title='Goalseek RaRoRaC Outcome';
Facility_tpTargetVariable_value=undefined;
Facility_tpTargetVariable_title='TargetVariable - Facility_tpRaRoRaC';
Facility_tpTargetValue_value=undefined;
Facility_tpTargetValue_title='TargetValue - Facility Target RaRoRaC';
Facility_tpStartValue_value=0;
Facility_tpStartValue_title='RangeStartValue';
Facility_tpEndValue_value=5e3;
Facility_tpEndValue_title='RangeEndValue';
Facility_tpSmallestDelta_value=1;
Facility_tpSmallestDelta_title='SmallestDelta';
Facility_tpMaxRuntimeMs_value=6e3;
Facility_tpMaxRuntimeMs_title='MaxRuntimeMs';
Facility_tpEconomicCapital_value=Facility_tpOperationalRisk+Facility_tpCreditRisk+Facility_tpBusinessRisk;
Facility_tpOperationalRisk_value=Facility_tpORCreditRisk;
Facility_tpORCreditRisk_value=Borrower_tpARCAddOn*AgreementDiversificationOR*(Facility_tpOREC/1e4)*(Facility_tpCreditIncome-Facility_tpDirectLiquidityPremium);
Facility_tpORCreditRisk_title='Economic Capital - Operational Risk - Credit Risk';
Facility_tpOREC_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,3);
Facility_tpOREC_title='Economic Capital - Operational Risk - || EC';
Facility_tpBusinessRisk_value=Facility_tpBRCreditRisk;
Facility_tpBRCreditRisk_value=Borrower_tpARCAddOn*AgreementDiversificationBR*(Facility_tpBREC/1e4)*(Facility_tpCreditIncome-Facility_tpDirectLiquidityPremium);
Facility_tpBRCreditRisk_title='Economic Capital - Business Risk - Credit Risk';
Facility_tpBREC_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,9);
Facility_tpBREC_title='Economic Capital - Business Risk - BR EC';
Facility_tpCreditRisk_value=Facility_tpCreditRiskUnguaranteed+Facility_tpCreditRiskGuaranteed;
Facility_tpCreditRiskUnguaranteed_value=OnER(Min(Facility_tpEADUnguaranteed,(Borrower_tpARCAddOn*Facility_tpEADUnguaranteed*Facility_tpLGDMoC*Facility_tpBorrower_tpRiskWeight*Borrower_tpCalibrationFactor*Facility_tpECMultiplier-Facility_tpIELMoCUnguaranteed)*AgreementDiversificationCR),NA);
Facility_tpCreditRiskUnguaranteed_title='Economic Capital - Credit Risk Unguaranteed';
Facility_tpCreditRiskGuaranteed_value=OnER(Min(Facility_tpEADGuaranteed,(Borrower_tpARCAddOn*Facility_tpEADGuaranteed*Facility_tpLGDMoC*Facility_tpRiskWeightGuarantor*Facility_tpCalibrationFactorGuarantor*Facility_tpECMultiplierGuarantor-Facility_tpIELMoCGuaranteed)*AgreementDiversificationCR),NA);
Facility_tpCreditRiskGuaranteed_title='Economic Capital - Credit Risk Guaranteed';
Facility_tpRiskWeightGuarantor_value=CumNormal((InvNormal(Facility_tpGuarantorPDMoC)-(Facility_tpRhoGuarantor^.5)*InvNormal(1-Borrower_tpConfidenceLevel))/(1-Facility_tpRhoGuarantor^.5));
Facility_tpRiskWeightGuarantor_title='Risk Weight Guarantor';
Facility_tpRhoGuarantor_value=MatrixLookup('EquityIndex',Facility_tpEquityIndexGuarantor,4);
Facility_tpRhoGuarantor_title='Rho Guarantor';
Facility_tpCalibrationFactorGuarantor_value=MatrixLookup('CalibrationFactor',Facility_tpCalibrationFactorIDGuarantor,3);
Facility_tpCalibrationFactorGuarantor_title='Calibration Factor Guarantor';
Facility_tpCalibrationFactorIDGuarantor_value=String(Facility_tpGuarantorRating+'_'+Borrower_tpClientGroup);
Facility_tpCalibrationFactorIDGuarantor_title='Calibration Factor ID Guarantor';
Facility_tpEAD_value=If(Facility_tpHeadroom==1,Facility_tpEADUnguaranteedHR+Facility_tpEADGuaranteedHR,Facility_tpEADUnguaranteedHRZero+Facility_tpEADGuaranteedHRZero);
Facility_tpEADGeneral_value=undefined;
Facility_tpEADGeneral_title='Economic Capital - Credit Risk - General';
Facility_tpHeadroom_value=If(Facility_tpLimit-Facility_tpExpectedAverageOutstanding>0,1,0);
Facility_tpHeadroom_title='Economic Capital - Credit Risk - Headroom';
Facility_tpOutstandingUnguaranteed_value=Facility_tpExpectedAverageOutstanding*(1-Facility_tpGuarantorPercentageGuaranteed);
Facility_tpOutstandingUnguaranteed_title='Economic Capital - Credit Risk - Outstanding Unguaranteed';
Facility_tpOutstandingGuaranteed_value=Facility_tpExpectedAverageOutstanding*Facility_tpGuarantorPercentageGuaranteed;
Facility_tpOutstandingGuaranteed_title='Economic Capital - Credit Risk - Outstanding Guaranteed';
Facility_tpPrincipalLimitUnguaranteed_value=Facility_tpPrincipalLimit*(1-Facility_tpGuarantorPercentageGuaranteed);
Facility_tpPrincipalLimitUnguaranteed_title='Economic Capital - Credit Risk - Principal Limit Unguaranteed';
Facility_tpPrincipalLimitGuaranteed_value=Facility_tpPrincipalLimit*Facility_tpGuarantorPercentageGuaranteed;
Facility_tpPrincipalLimitGuaranteed_title='Economic Capital - Credit Risk - Principal Limit Guaranteed';
Facility_tpEADUnguaranteed_value=If(Facility_tpHeadroom==1,Facility_tpEADUnguaranteedHR,Facility_tpEADUnguaranteedHRZero);
Facility_tpEADUnguaranteed_title='Economic Capital - Credit Risk - Exposure At Default Standard';
Facility_tpEADUnguaranteedHR_value=Facility_tpLEF*(Facility_tpOutstandingUnguaranteed+Facility_tpUGD*(1+Facility_tpMOCEAD*Facility_tpAF)*Max(Facility_tpPrincipalLimitUnguaranteed-Facility_tpOutstandingUnguaranteed,0));
Facility_tpEADUnguaranteedHR_title='Economic Capital - Credit Risk - Exposure At Default';
Facility_tpEADUnguaranteedHRZero_value=Facility_tpLEF*(Facility_tpOutstandingUnguaranteed+Facility_tpPGO*(1+Facility_tpMOCEAD*Facility_tpAF)*Facility_tpOutstandingUnguaranteed);
Facility_tpEADUnguaranteedHRZero_title='Economic Capital - Credit Risk - Exposure At Default Zero Headroom';
Facility_tpEADGuaranteed_value=If(Facility_tpHeadroom==1,Facility_tpEADGuaranteedHR,Facility_tpEADGuaranteedHRZero);
Facility_tpEADGuaranteed_title='Economic Capital - Credit Risk - Exposure At Default Guaranteed';
Facility_tpEADGuaranteedHR_value=Facility_tpLEF*(Facility_tpOutstandingGuaranteed+Facility_tpUGD*(1+Facility_tpMOCEAD*Facility_tpAF)*Max(Facility_tpPrincipalLimitGuaranteed-Facility_tpOutstandingGuaranteed,0));
Facility_tpEADGuaranteedHRZero_value=Facility_tpLEF*(Facility_tpOutstandingGuaranteed+Facility_tpPGO*(1+Facility_tpMOCEAD*Facility_tpAF)*Facility_tpOutstandingGuaranteed);
Facility_tpLEF_value=If(Facility_tpBorrower_tpPLorNPL==1,MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,10),MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,8));
Facility_tpLEF_title='Economic Capital - Credit Risk - LEF';
Facility_tpUGD_value=If(Facility_tpHeadroom,If(Facility_tpBorrower_tpPLorNPL==1,MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,9),MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,7)),NA);
Facility_tpUGD_title='Economic Capital - Credit Risk - UGD ()';
Facility_tpPGO_value=If(Facility_tpHeadroom==0,If(Facility_tpBorrower_tpPLorNPL==1,MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,9),MatrixLookup('LEFfactors',Facility_tpIDLEFfactors,7)),NA);
Facility_tpPGO_title='Economic Capital - Credit Risk - PGO ()';
Facility_tpMOCEAD_value=If(Facility_tpPrincipalLimit>75e3,MatrixLookup('CalculationParameters','MOC_EAD_NPL',2),MatrixLookup('CalculationParameters','MOC_EAD_PL',2));
Facility_tpMOCEAD_title='Economic Capital - Credit Risk - MOCEAD';
Facility_tpAF_value=MatrixLookup('CalculationParameters','AggregationFactor',2);
Facility_tpAF_title='Economic Capital - Credit Risk - AF';
Facility_tpIDLEFfactors_value=String(Facility_tpType+'_'+Facility_tpLowerlimit+'_'+Facility_tpUsageLimit+'_'+Facility_tpUGDPGO);
Facility_tpIDLEFfactors_title='Economic Capital - Credit Risk - Search ID LEFfactors';
Facility_tpLowerlimit_value=If(MatrixLookup('ProductType',Facility_tpType,8)==1,If(Facility_tpHeadroom,Case(Facility_tpLimit,[1e5,0||35e4,1e5||1e6,35e4||3e6,1e6||3e6,3e6]),Case(Facility_tpPrincipalLimit,[7e4,0||3e5,7e4||1e6,3e5||1e6,1e6])),0);
Facility_tpLowerlimit_title='Economic Capital - Credit Risk - Search ID Lower limit';
Facility_tpUsageLimit_value=If(MatrixLookup('ProductType',Facility_tpType,10)==1,0,If(Facility_tpHeadroom,Case(Facility_tpExpectedAverageOutstanding/Facility_tpLimit*100,[80,0||80,81]),0));
Facility_tpUsageLimit_title='Economic Capital - Credit Risk - Search ID Usage limit';
Facility_tpUGDPGO_value=String(If(Facility_tpHeadroom,'UGD','PGO'));
Facility_tpUGDPGO_title='Economic Capital - Credit Risk - Search ID UGD/PGO';
Facility_tpECMultiplier_value=Facility_tpECMultiplierLowerBound+(Facility_tpECMultiplierUpperBound-Facility_tpECMultiplierLowerBound)*OnER((Facility_tpRemainingAverageTenor+1-Facility_tpECMultiplierTenorLowerBound)/(Facility_tpECMultiplierTenorUpperBound-Facility_tpECMultiplierTenorLowerBound),0);
Facility_tpECMultiplier_title='Economic Capital Multiplier';
Facility_tpECMultiplierGuarantor_value=Facility_tpECMultiplierLowerBoundGuarantor+(Facility_tpECMultiplierUpperBoundGuarantor-Facility_tpECMultiplierLowerBoundGuarantor)*OnER((Facility_tpRemainingAverageTenor+1-Facility_tpECMultiplierTenorLowerBound)/(Facility_tpECMultiplierTenorUpperBound-Facility_tpECMultiplierTenorLowerBound),0);
Facility_tpECMultiplierGuarantor_title='Economic Capital Multiplier Guarantor';
Facility_tpECMultiplierTenorLowerBound_value=MatrixLookup('ECMultiplierTenorLowerBound',If(Facility_tpRemainingAverageTenor<=1,1,If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1)),1);
Facility_tpECMultiplierTenorLowerBound_title='Economic Capital Multiplier Lower Tenor';
Facility_tpECMultiplierTenorUpperBound_value=MatrixLookup('ECMultiplierTenorUpperBound',If(Facility_tpRemainingAverageTenor<=1,1,If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1)),1);
Facility_tpECMultiplierTenorUpperBound_title='Economic Capital Multiplier Upper Tenor';
Facility_tpECMultiplierLowerBound_value=MatrixLookup('ECMultiplier',''+Borrower_tpRating,Facility_tpECMultiplierTenorLowerBound);
Facility_tpECMultiplierLowerBound_title='Economic Capital Multiplier Lower Bound';
Facility_tpECMultiplierUpperBound_value=MatrixLookup('ECMultiplier',''+Borrower_tpRating,Facility_tpECMultiplierTenorUpperBound);
Facility_tpECMultiplierUpperBound_title='Economic Capital Multiplier Upper Bound';
Facility_tpECMultiplierLowerBoundGuarantor_value=MatrixLookup('ECMultiplier',''+Facility_tpGuarantorRating,Facility_tpECMultiplierTenorLowerBound);
Facility_tpECMultiplierLowerBoundGuarantor_title='Economic Capital Multiplier Lower Bound Guarantor';
Facility_tpECMultiplierUpperBoundGuarantor_value=MatrixLookup('ECMultiplier',''+Facility_tpGuarantorRating,Facility_tpECMultiplierTenorUpperBound);
Facility_tpECMultiplierUpperBoundGuarantor_title='Economic Capital Multiplier Upper Bound Guarantor';
Facility_tpIELMoC_value=Facility_tpIELMoCUnguaranteed+Facility_tpIELMoCGuaranteed;
Facility_tpIELMoC_title='Economic Capital - Credit Risk - Internal Expected Loss';
Facility_tpIELMoCUnguaranteed_value=Facility_tpEADUnguaranteed*Facility_tpBorrower_tpPDMoC*Facility_tpLGDMoC*Facility_tpELMultiplierECUnguaranteed*Facility_tpDeannualize;
Facility_tpIELMoCUnguaranteed_title='Economic Capital - Credit Risk - Internal Expected Loss - Unguaranteed';
Facility_tpELMultiplierECUnguaranteed_value=If(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM>0,MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMECUnguaranteed,1)+(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM)*(MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDUpperMECUnguaranteed,1)-MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMECUnguaranteed,1)),MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDECUnguaranteed,1));
Facility_tpELMultiplierECUnguaranteed_title='Expected Loss Multiplier';
Facility_tpELMultiplierLowerM_value=Case(Facility_tpRemainingAverageTenor,[1,0||2,1||3,2||4,3||5,4||6,5||7,6||8,7||9,8||10,9||11,10||12,11||13,12||14,13||15,14||15]);
Facility_tpELMultiplierLowerM_title='Expected Loss - Lower M';
Facility_tpELMultiplierUpperM_value=Case(Facility_tpRemainingAverageTenor,[1,1||2,2||3,3||4,4||5,5||6,6||7,7||8,8||9,9||10,10||11,11||12,12||13,13||14,14||15,15||15]);
Facility_tpELMultiplierUpperM_title='Expected Loss - Upper M';
Facility_tpELMultiplierIDECUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDECUnguaranteed_title='Expected Loss Multiplier ID Economic Capital - Unguaranteed';
Facility_tpELMultiplierIDLowerMECUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpELMultiplierLowerM+1>16,16,Facility_tpELMultiplierLowerM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDLowerMECUnguaranteed_title='Expected Loss Multiplier ID Economic Capital - Unguaranteed - Lower M';
Facility_tpELMultiplierIDUpperMECUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpELMultiplierUpperM+1>16,16,Facility_tpELMultiplierUpperM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDUpperMECUnguaranteed_title='Expected Loss Multiplier ID Economic Capital - Unguaranteed - Upper M';
Facility_tpIELMoCGuaranteed_value=OnEr(Facility_tpEADGuaranteed*Facility_tpJointPDMoC*Facility_tpLGDMoC*Facility_tpELMultiplierECGuaranteed*Facility_tpDeannualize,NA);
Facility_tpIELMoCGuaranteed_title='Economic Capital - Credit Risk - Internal Expected Loss - Guaranteed';
Facility_tpELMultiplierECGuaranteed_value=If(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM>0,MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMECGuaranteed,1)+(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM)*(MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDUpperMECGuaranteed,1)-MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMECGuaranteed,1)),MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDECGuaranteed,1));
Facility_tpELMultiplierECGuaranteed_title='Expected Loss Multiplier Guaranteed';
Facility_tpELMultiplierIDECGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDECGuaranteed_title='Expected Loss Multiplier ID Economic Capital - Guaranteed';
Facility_tpELMultiplierIDLowerMECGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpELMultiplierLowerM+1>16,16,Facility_tpELMultiplierLowerM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDLowerMECGuaranteed_title='Expected Loss Multiplier ID Economic Capital - Guaranteed - Lower M';
Facility_tpELMultiplierIDUpperMECGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpELMultiplierUpperM+1>16,16,Facility_tpELMultiplierUpperM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGDMoC,2)*100,0,0));
Facility_tpELMultiplierIDUpperMECGuaranteed_title='Expected Loss Multiplier ID Economic Capital - Guaranteed - Upper M';
Facility_tpJointPDMoC_value=BivarNormal(InvNormal(Facility_tpBorrower_tpPDMoC),InvNormal(Facility_tpGuarantorPDMoC),Facility_tpIntraSectorCorrelationBorrower*Facility_tpIntraSectorCorrelationGuarantor*Facility_tpEquityCorrelation);
Facility_tpJointPDMoC_title='Joint PD MoC';
Facility_tpEquityIndexBorrower_value=If(Borrower_tpAGICOrSBI==0,MatrixLookup('AGICMapping',''+Borrower_tpAGIC,2),MatrixLookup('SBIMapping',''+Borrower_tpSBI,2));
Facility_tpEquityIndexBorrower_title='Equity Index Borrower';
Facility_tpEquityIndexGuarantor_value=If(Facility_tpGuarantorAGICOrSBI==0,MatrixLookup('AGICMapping',''+Facility_tpGuarantorAGIC,2),MatrixLookup('SBIMapping',''+Facility_tpGuarantorSBI,2));
Facility_tpEquityIndexGuarantor_title='Equity Index Guarantor';
Facility_tpIntraSectorCorrelationBorrower_value=MatrixLookup('EquityIndex',Facility_tpEquityIndexBorrower,3);
Facility_tpIntraSectorCorrelationBorrower_title='Intrasector Correlation Borrower';
Facility_tpIntraSectorCorrelationGuarantor_value=MatrixLookup('EquityIndex',Facility_tpEquityIndexGuarantor,3);
Facility_tpIntraSectorCorrelationGuarantor_title='Intrasector Correlation Guarantor';
Facility_tpEquityCorrelationID_value=String(Str(Facility_tpEquityIndexBorrower)+'_'+Str(Facility_tpEquityIndexGuarantor));
Facility_tpEquityCorrelationID_title='Inter-sector Correlation Factor ID';
Facility_tpEquityCorrelation_value=MatrixLookup('EquityCorrelation',Facility_tpEquityCorrelationID,1);
Facility_tpEquityCorrelation_title='Inter-sector Correlation Factor';
Facility_tpInvNormalBorrower_value=InvNormal(Facility_tpBorrower_tpPDMoC);
Facility_tpInvNormalBorrower_title='Inverse Normal Borrower';
Facility_tpInvNormalGuarantor_value=InvNormal(Facility_tpGuarantorPDMoC);
Facility_tpInvNormalGuarantor_title='Inverse Normal Guarantor';
Facility_tpRiskAdjustedReturn_value=OnEr(Facility_tpCreditIncome-Facility_tpOtherExpenses-Facility_tpInterestExpenses-Facility_tpTax,NA);
Facility_tpCreditIncome_value=Facility_tpInterestIncome+Facility_tpCreditRelatedFee;
Facility_tpCreditRelatedFee_value=OnER(Facility_tpCommitmentFee+Facility_tpUtilisationFee+Facility_tpAnnualFee+Facility_tpOneOffFee,NA);
Facility_tpCommitmentFee_value=Facility_tpCommitmentFeeBp*(Facility_tpLimit-Facility_tpExpectedAverageOutstanding)*1e-4*Facility_tpDeannualize;
Facility_tpCommitmentFee_title='Risk Adjusted Return - Income - Credit Related Fee - Commitment Fee';
Facility_tpAnnualFee_value=OnER(If(Facility_tpType=='F1',Facility_tpCreditFeeBp/1e4*Facility_tpExpectedAverageOutstanding,NA),NA);
Facility_tpAnnualFee_title='Risk Adjusted Return - Income - Credit Related Fee - Annual Fee';
Facility_tpAnnualFeeBp_value=Facility_tpAnnualFee/Facility_tpExpectedAverageOutstanding;
Facility_tpAnnualFeeBp_title='Annual Fee (Bp)';
Facility_tpOneOffFee_value=If(Facility_tpOriginalTenorYears<=1,Facility_tpOneOffFeeAmount,If(Facility_tpOriginalTenorYears<=5,Facility_tpOneOffFeeAmount/Facility_tpOriginalTenorYears,Facility_tpOneOffFeeAmount/5));
Facility_tpOneOffFee_title='Risk Adjusted Return - Income - Credit Related Fee - One Off Fee ()';
Facility_tpOneOffFeeAmount_value=Facility_tpOneOffFeeAmount2;
Facility_tpOneOffFeeAmount_title='Risk Adjusted Return - Income - Credit Related Fee - One Off Fee Amount ()';
Facility_tpOneOffFeeBp_value=Facility_tpOneOffFee/Facility_tpEAD*1e4;
Facility_tpOneOffFeeBp_title='One Off Fee (Bp)';
Facility_tpUtilisationFee_value=If(Facility_tpRevolvingProduct,Facility_tpUtilisationFeeBp*Facility_tpExpectedAverageOutstanding*1e-4,0)*Facility_tpDeannualize;
Facility_tpUtilisationFee_title='Utilisation Fee';
Facility_tpUtilisationFeeBp_value=If(Facility_tpExpectedAverageOutstanding/Facility_tpLimit<=0,0,If(Facility_tpExpectedAverageOutstanding/Facility_tpLimit<=Facility_tpUtilisationFeeBpLimit1,0,If(Facility_tpExpectedAverageOutstanding/Facility_tpLimit<=Facility_tpUtilisationFeeBpLimit2,Facility_tpUtilisationFeeBpLimit1Bp,If(Facility_tpExpectedAverageOutstanding/Facility_tpLimit<=Facility_tpUtilisationFeeBpLimit3,Facility_tpUtilisationFeeBpLimit1Bp+Facility_tpUtilisationFeeBpLimit2Bp,If(Facility_tpExpectedAverageOutstanding/Facility_tpLimit<=Facility_tpUtilisationFeeBpLimit4,Facility_tpUtilisationFeeBpLimit1Bp+Facility_tpUtilisationFeeBpLimit2Bp+Facility_tpUtilisationFeeBpLimit3Bp,Facility_tpUtilisationFeeBpLimit1Bp+Facility_tpUtilisationFeeBpLimit2Bp+Facility_tpUtilisationFeeBpLimit3Bp+Facility_tpUtilisationFeeBpLimit4Bp)))));
Facility_tpUtilisationFeeBp_title='Utilisation Fee (Bps)';
Facility_tpUtilisationFeeBpLimit1_value=0;
Facility_tpUtilisationFeeBpLimit1_title='Utilisation Fee - utilization limit 1';
Facility_tpUtilisationFeeBpLimit2_value=.3333;
Facility_tpUtilisationFeeBpLimit2_title='Utilisation Fee - utilization limit 2';
Facility_tpUtilisationFeeBpLimit3_value=.5;
Facility_tpUtilisationFeeBpLimit3_title='Utilisation Fee - utilization limit 3';
Facility_tpUtilisationFeeBpLimit4_value=.6667;
Facility_tpUtilisationFeeBpLimit4_title='Utilisation Fee - utilization limit 4';
Facility_tpUtilisationFeeBpLimit1Bp_value=0;
Facility_tpUtilisationFeeBpLimit1Bp_title='Utilisation Fee - utilization limit 1 - Bps';
Facility_tpUtilisationFeeBpLimit2Bp_value=0;
Facility_tpUtilisationFeeBpLimit2Bp_title='Utilisation Fee - utilization limit 2 - Bps';
Facility_tpUtilisationFeeBpLimit3Bp_value=0;
Facility_tpUtilisationFeeBpLimit3Bp_title='Utilisation Fee - utilization limit 3 - Bps';
Facility_tpUtilisationFeeBpLimit4Bp_value=0;
Facility_tpUtilisationFeeBpLimit4Bp_title='Utilisation Fee - utilization limit 4 - Bps';
Facility_tpInterestIncome_value=(Facility_tpCustomerSpread+Facility_tpCustomerSpreadAddMargin)*Facility_tpExpectedAverageOutstanding/1e4*Facility_tpDeannualize;
Facility_tpCustomerSpread_value=If(TargetRaRoRaCDriven,Round(Facility_tpRequiredInterestMarginBps,1),Facility_tpCustomerSpread2);
Facility_tpCustomerSpread_title='Customer Spread (Bp)';
Facility_tpCustomerSpreadAddMargin_value=MatrixLookup('CustomerSpreadAddMargin',Facility_tpProductinterestDetailsInterestProductName,1);
Facility_tpCustomerSpreadAddMargin_title='Risk Adjusted Return - Income - Interest Income - Customer Spread Additional Margin (Bps)';
Facility_tpCommercialMargin_value=Facility_tpCustomerSpread-Facility_tpLiquiditySpreadBps;
Facility_tpCommercialMargin_title='Commercial Margin (Bp)';
Facility_tpOptionCostsIndLiqPrem_value=Facility_tpIndirectLiquidityCosts+Facility_tpPipelineRisk+Facility_tpPrepaymentCosts;
Facility_tpOptionCostsIndLiqPrem_title='Option Costs/Ind. Liq. Costs';
Facility_tpOtherExpenses_value=Facility_tpInternalExpectedLoss+Facility_tpOperationalCosts;
Facility_tpOtherExpenses_title='Risk Adjusted Return - Other Expenses';
Facility_tpInternalExpectedLoss_value=(Facility_tpInternalExpectedLossUnguaranteed+Facility_tpInternalExpectedLossGuaranteed)*Facility_tpDeannualize;
Facility_tpInternalExpectedLossUnguaranteed_value=Facility_tpEADUnguaranteed*Facility_tpBorrower_tpPD*Facility_tpLGD*Facility_tpELMultiplierRARUnguaranteed;
Facility_tpInternalExpectedLossUnguaranteed_title='Risk Adjusted Return - Other Expenses - Internal Expected Loss - Unguaranteed';
Facility_tpELMultiplierRARUnguaranteed_value=If(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM>0,MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMRARUnguaranteed,1)+(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM)*(MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDUpperMRARUnguaranteed,1)-MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMRARUnguaranteed,1)),MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDRARUnguaranteed,1));
Facility_tpELMultiplierRARUnguaranteed_title='Expected Loss Multiplier - Risk Adjusted Return - Unguaranteed';
Facility_tpELMultiplierIDRARUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDRARUnguaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Unguaranteed';
Facility_tpELMultiplierIDLowerMRARUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpELMultiplierLowerM+1>16,16,Facility_tpELMultiplierLowerM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDLowerMRARUnguaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Unguaranteed - Lower M';
Facility_tpELMultiplierIDUpperMRARUnguaranteed_value=String(''+Borrower_tpRating+'_'+Str(If(Facility_tpELMultiplierUpperM+1>16,16,Facility_tpELMultiplierUpperM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDUpperMRARUnguaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Unguaranteed - Upper M';
Facility_tpInternalExpectedLossGuaranteed_value=Facility_tpEADGuaranteed*Facility_tpJointPD*Facility_tpLGD*Facility_tpELMultiplierRARGuaranteed;
Facility_tpInternalExpectedLossGuaranteed_title='Risk Adjusted Return - Other Expenses - Internal Expected Loss - Guaranteed';
Facility_tpELMultiplierRARGuaranteed_value=If(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM>0,MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMRARGuaranteed,1)+(Facility_tpRemainingAverageTenor-Facility_tpELMultiplierLowerM)*(MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDUpperMRARGuaranteed,1)-MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDLowerMRARGuaranteed,1)),MatrixLookup('ELMultiplier',Facility_tpELMultiplierIDRARGuaranteed,1));
Facility_tpELMultiplierRARGuaranteed_title='Expected Loss Multiplier - Risk Adjusted Return - Guaranteed';
Facility_tpELMultiplierIDRARGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpRemainingAverageTenor+1>16,16,Facility_tpRemainingAverageTenor+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDRARGuaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Guaranteed';
Facility_tpELMultiplierIDLowerMRARGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpELMultiplierLowerM+1>16,16,Facility_tpELMultiplierLowerM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDLowerMRARGuaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Guaranteed - Lower M';
Facility_tpELMultiplierIDUpperMRARGuaranteed_value=String(''+Facility_tpGuarantorRating+'_'+Str(If(Facility_tpELMultiplierUpperM+1>16,16,Facility_tpELMultiplierUpperM+1),0,0)+'_'+Str(RoundUp(Facility_tpLGD,2)*100,0,0));
Facility_tpELMultiplierIDUpperMRARGuaranteed_title='Expected Loss Multiplier ID - Risk Adjusted Return - Guaranteed - Upper M';
Facility_tpJointPD_value=BivarNormal(InvNormal(Facility_tpBorrower_tpPD),InvNormal(Facility_tpGuarantorPD),Facility_tpIntraSectorCorrelationBorrower*Facility_tpIntraSectorCorrelationGuarantor*Facility_tpEquityCorrelation);
Facility_tpJointPD_title='Joint PD';
Facility_tpOperationalCosts_value=Facility_tpCostOverVolume+Facility_tpCostPerServiceConcept+Facility_tpCostPerContract;
Facility_tpCostPerContract_value=MatrixLookup('CostPerContract',Facility_tpCostPerContractID,5)*Facility_tpDeannualize;
Facility_tpCostPerContract_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost per Contract';
Facility_tpCostPerContractID_value=String(Facility_tpType+'_'+Borrower_tpRating+'_'+Borrower_tpClientGroup);
Facility_tpCostPerContractID_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost per Contract ID';
Facility_tpCostOverVolume_value=Facility_tpExpectedAverageOutstanding*(Facility_tpCostOverVolumeBp/1e4)*Facility_tpDeannualize;
Facility_tpCostOverVolume_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost over Volume';
Facility_tpCostOverVolumeBp_value=MatrixLookup('CostOverVolume',Facility_tpType+'_'+Borrower_tpClientGroup,3);
Facility_tpCostOverVolumeBp_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost over Volume (Bps)';
Facility_tpCostPerServiceConcept_value=If(Borrower_tpSumExpectedAverageOutstanding==0,Borrower_tpFixedCostOperatingConcept*Facility_tpPercentageOperatingConcept/Borrower_tpNrOfFacilities,Borrower_tpFixedCostOperatingConcept*Facility_tpPercentageOperatingConcept/Borrower_tpSumExpectedAverageOutstanding*Facility_tpExpectedAverageOutstanding);
Facility_tpCostPerServiceConcept_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost per Service Concept';
Facility_tpPercentageOperatingConcept_value=AgreementPercentageOperatingConcept;
Facility_tpPercentageOperatingConcept_title='Risk Adjusted Return - Other Expenses - Operational Costs - Cost per Service Concept - Percentage Operating Concept';
Facility_tpTax_value=OnER((Facility_tpCreditIncome-Facility_tpInternalExpectedLoss-Facility_tpOperationalCosts-Facility_tpInterestExpenses)*Borrower_tpTaxRate,NA);
Facility_tpInterestExpenses_value=Facility_tpFundsTransferPricing+Facility_tpIndirectLiquidityCosts+Facility_tpSubordinatedDebtCapitalCharge-Facility_tpEquityFundingAdjustment;
Facility_tpInterestExpenses_title='Risk Adjusted Return - Interest Expenses';
Facility_tpFundsTransferPricing_value=Facility_tpDirectLiquidityPremium+Facility_tpPrepaymentCosts+Facility_tpPipelineRisk;
Facility_tpFundsTransferPricing_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing';
Facility_tpBaseRate_value=Facility_tpBaseRate2;
Facility_tpBaseRate_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Base Rate (Bps)';
Facility_tpDirectLiquidityPremium_value=If(MatrixLookup('ProductType',Facility_tpType,4)==0,0,Facility_tpExpectedAverageOutstanding*Facility_tpLiquiditySpreadBps/1e4);
Facility_tpLiquiditySpreadBps_value=If(MatrixLookup('ProductType',Facility_tpType,4)==0,0,If(Facility_tpOriginalTenor<12,Facility_tpLiquiditySpreadBpsUnder1year,Facility_tpLiquiditySpreadBpsGeneral));
Facility_tpLiquiditySpreadBps_title='Liquidity Spread (Bp)';
Facility_tpLiquiditySpreadBpsUnder1year_value=If(MatrixLookup('ProductType',Facility_tpType,9)==1,Facility_tpLiquiditySpreadRevolvingCredit,If(Facility_tpRepaymentChoice==0&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentBullet/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==1&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentLinear/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==2&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentAnnuity/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==3&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentScheme/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==0&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentBullet-Facility_tpLiquiditySpreadWithdrawalScheme)/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==1&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentLinear-Facility_tpLiquiditySpreadWithdrawalScheme)/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==2&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentAnnuity-Facility_tpLiquiditySpreadWithdrawalScheme)/Facility_tpExpectedAverageOutstanding,If(Facility_tpRepaymentChoice==3&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentScheme-Facility_tpLiquiditySpreadWithdrawalScheme)/Facility_tpExpectedAverageOutstanding,NA)))))))));
Facility_tpLiquiditySpreadBpsUnder1year_title='Liquidity Spread (Bp) Under 1 Year';
Facility_tpLiquiditySpreadBpsGeneral_value=If(MatrixLookup('ProductType',Facility_tpType,9)==1,Facility_tpLiquiditySpreadRevolvingCredit,If(Facility_tpRepaymentChoice==0&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentBullet/Facility_tpWeightedFundingRepaymentBullet,If(Facility_tpRepaymentChoice==1&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentLinear/Facility_tpWeightedFundingRepaymentLinear,If(Facility_tpRepaymentChoice==2&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentAnnuity/Facility_tpWeightedFundingRepaymentAnnuity,If(Facility_tpRepaymentChoice==3&&Facility_tpWithdrawalChoice==0,Facility_tpLiquiditySpreadRepaymentScheme/Facility_tpWeightedFundingRepaymentScheme,If(Facility_tpRepaymentChoice==0&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentBullet-Facility_tpLiquiditySpreadWithdrawalScheme)/(Facility_tpWeightedFundingRepaymentBullet-Facility_tpWeightedFundingWithdrawalScheme),If(Facility_tpRepaymentChoice==1&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentLinear-Facility_tpLiquiditySpreadWithdrawalScheme)/(Facility_tpWeightedFundingRepaymentLinear-Facility_tpWeightedFundingWithdrawalScheme),If(Facility_tpRepaymentChoice==2&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentAnnuity-Facility_tpLiquiditySpreadWithdrawalScheme)/(Facility_tpWeightedFundingRepaymentAnnuity-Facility_tpWeightedFundingWithdrawalScheme),If(Facility_tpRepaymentChoice==3&&Facility_tpWithdrawalChoice==3,(Facility_tpLiquiditySpreadRepaymentScheme-Facility_tpLiquiditySpreadWithdrawalScheme)/(Facility_tpWeightedFundingRepaymentScheme-Facility_tpWeightedFundingWithdrawalScheme),NA)))))))));
Facility_tpLiquiditySpreadBpsGeneral_title='Liquidity Spread (Bp) On Weighted Funding Amount';
Facility_tpRepaymentFrequencyLiqSpread_value=If(Facility_tpWithdrawalChoice==3,12,Facility_tpRepaymentFrequency);
Facility_tpRepaymentFrequencyLiqSpread_title='Repayment Frequency for liquidity spread calc';
Facility_tpConvertToMonths_value=If(Facility_tpWithdrawalChoice==3,12/Facility_tpRepaymentFrequency,1);
Facility_tpConvertToMonths_title='Convert X to months for scheme withdrawal&&repayment';
Facility_tpGracePeriodInPeriods_value=RoundUp(Facility_tpGracePeriod/(12/Facility_tpRepaymentFrequency),0);
Facility_tpGracePeriodInPeriods_title='Grace period expressed in periods (rounded up)';
Facility_tpWeightedFundingRepaymentBullet_value=Facility_tpPrincipalLimit*Facility_tpOriginalTenor/12;
Facility_tpWeightedFundingRepaymentBullet_title='Weighted Funding Repayment Bullet';
Facility_tpLiquiditySpreadRepaymentBullet_value=Facility_tpPrincipalLimit*Facility_tpOriginalTenor/12*(MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorLowerBound',Facility_tpOriginalTenor,1),Facility_tpFixedInterestPeriod)+(MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorUpperBound',Facility_tpOriginalTenor,1),Facility_tpFixedInterestPeriod)-MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorLowerBound',Facility_tpOriginalTenor,1),Facility_tpFixedInterestPeriod))*OnER((Facility_tpOriginalTenor-MatrixLookup('LiquidityPremiumTenorLowerBound',Facility_tpOriginalTenor,1))/(MatrixLookup('LiquidityPremiumTenorUpperBound',Facility_tpOriginalTenor,1)-MatrixLookup('LiquidityPremiumTenorLowerBound',Facility_tpOriginalTenor,1)),0));
Facility_tpLiquiditySpreadRepaymentBullet_title='Liquidity Spread Repayment Bullet';
Facility_tpWeightedFundingRepaymentLinear_value=SumFor(X,1+Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriodsNoGrace,1,Facility_tpLinear*(X*Facility_tpConvertToMonths/Facility_tpRepaymentFrequencyLiqSpread));
Facility_tpWeightedFundingRepaymentLinear_title='Weighted Funding Repayment Linear';
Facility_tpLiquiditySpreadRepaymentLinear_value=SumFor(X,1+Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriodsNoGrace,1,Facility_tpLinear*(X*Facility_tpConvertToMonths/Facility_tpRepaymentFrequencyLiqSpread)*(MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod)+(MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorUpperBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod)-MatrixLookup(If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod))*OnER((X*12/Facility_tpRepaymentFrequency-MatrixLookup('LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1))/(MatrixLookup('LiquidityPremiumTenorUpperBound',X*12/Facility_tpRepaymentFrequency,1)-MatrixLookup('LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1)),0)));
Facility_tpLiquiditySpreadRepaymentLinear_title='Liquidity Spread Repayment Linear';
Facility_tpWeightedFundingRepaymentAnnuity_value=SumFor(X,1+Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriodsNoGrace,1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X-Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*(X*Facility_tpConvertToMonths/Facility_tpRepaymentFrequencyLiqSpread));
Facility_tpWeightedFundingRepaymentAnnuity_title='Weighted Funding Repayment Annuity';
Facility_tpLiquiditySpreadRepaymentAnnuity_value=SumFor(X,1+Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriodsNoGrace,1,PPMT(Facility_tpAnnuityInterestRate/Facility_tpRepaymentFrequency,X-Facility_tpGracePeriodInPeriods,Facility_tpNumberOfPeriods,-Facility_tpPrincipalLimit,Facility_tpBalloon)*(X*Facility_tpConvertToMonths/Facility_tpRepaymentFrequencyLiqSpread)*(MatrixLookup('AAB_Parameters.xls',If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod)+(MatrixLookup('AAB_Parameters.xls',If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorUpperBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod)-MatrixLookup('AAB_Parameters.xls',If(Facility_tpBaseCurrency=='EUR','LiquidityPremiumEUR',If(Facility_tpBaseCurrency=='GBP','LiquidityPremiumGBP',If(Facility_tpBaseCurrency=='USD','LiquidityPremiumUSD','LiquidityPremiumOther'))),MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1),Facility_tpFixedInterestPeriod))*OnER((X*12/Facility_tpRepaymentFrequency-MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1))/(MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorUpperBound',X*12/Facility_tpRepaymentFrequency,1)-MatrixLookup('AAB_Parameters.xls','LiquidityPremiumTenorLowerBound',X*12/Facility_tpRepaymentFrequency,1)),0)));
Facility_tpLiquiditySpreadRepaymentAnnuity_title='Liquidity Spread Repayment Annuity';
Facility_tpWeightedFundingRepaymentScheme_value='TupleSum(Facility_tpManual_tpWeightedFundingRepayment)';
Facility_tpWeightedFundingRepaymentScheme_title='Weighted Funding Repayment Scheme';
Facility_tpLiquiditySpreadRepaymentScheme_value='TupleSum(Facility_tpManual_tpLiquiditySpreadRepayment)';
Facility_tpLiquiditySpreadRepaymentScheme_title='Liquidity Spread Repayment Scheme';
Facility_tpWeightedFundingWithdrawalScheme_value='TupleSum(Facility_tpManual_tpWeightedFundingWithdrawal)';
Facility_tpWeightedFundingWithdrawalScheme_title='Weighted Funding Withdrawal Scheme';
Facility_tpLiquiditySpreadWithdrawalScheme_value='TupleSum(Facility_tpManual_tpLiquiditySpreadWithdrawal)';
Facility_tpLiquiditySpreadWithdrawalScheme_title='Liquidity Spread Withdrawal Scheme';
Facility_tpLiquiditySpreadRevolvingCredit_value=If(Facility_tpInterestRateIndexBasis==1,0,MatrixLookup('LiquidityPremiumRevolvingCredit',Facility_tpProductinterestDetailsInterestProductName,If(Facility_tpBaseCurrency=='EUR',1,If(Facility_tpBaseCurrency=='GBP',2,If(Facility_tpBaseCurrency=='USD',3,4)))));
Facility_tpPrepaymentCosts_value=Facility_tpPrepaymentPremium*Facility_tpPrepaymentPrec*Facility_tpPrincipalLimit/1e4*Facility_tpDeannualize;
Facility_tpPrepaymentCosts_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Prepayment Costs';
Facility_tpPrepaymentPremium_value=MatrixLookup('ProductType',Facility_tpType,1);
Facility_tpPrepaymentPremium_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Prepayment Premium (Bps)';
Facility_tpPipelineRisk_value=Facility_tpOfferOptionPremium*Facility_tpPrincipalLimit/1e4*Facility_tpDeannualize;
Facility_tpPipelineRisk_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Pipeline Risk';
Facility_tpOfferOptionPremium_value=If(Facility_tpPipelineRiskUpperM-Facility_tpPipelineRiskLowerM==0,Facility_tpPipelineRiskLowerPremium,Facility_tpPipelineRiskLowerPremium+(Facility_tpPipelineRiskUpperPremium-Facility_tpPipelineRiskLowerPremium)*((Facility_tpRemainingAverageTenor-Facility_tpPipelineRiskLowerM)/(Facility_tpPipelineRiskUpperM-Facility_tpPipelineRiskLowerM)));
Facility_tpOfferOptionPremium_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Offer Option Premium (Bps)';
Facility_tpPipelineRiskLowerM_value=Case(Facility_tpRemainingAverageTenor,[1,0||2,1||3,2||5,3||10,5||50,10||50]);
Facility_tpPipelineRiskLowerM_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Lower M';
Facility_tpPipelineRiskUpperM_value=Case(Facility_tpRemainingAverageTenor,[1,1||2,2||3,3||5,5||10,10||50,50||50]);
Facility_tpPipelineRiskUpperM_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Upper M';
Facility_tpPipelineRiskLowerPremium_value=MatrixLookup('OfferOptionPremium',Facility_tpOfferPeriod+'_'+Str(Facility_tpPipelineRiskLowerM,0,0),5);
Facility_tpPipelineRiskLowerPremium_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Lower Premium (Bps)';
Facility_tpPipelineRiskUpperPremium_value=MatrixLookup('OfferOptionPremium',Facility_tpOfferPeriod+'_'+Str(Facility_tpPipelineRiskUpperM,0,0),5);
Facility_tpPipelineRiskUpperPremium_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Upper Premium (Bps)';
Facility_tpPipelineRiskUpperPremiumID_value=String(Facility_tpOfferPeriod+'_'+Str(Facility_tpPipelineRiskUpperM,0,0));
Facility_tpPipelineRiskUpperPremiumID_title='Risk Adjusted Return - Interest Expenses - Funds Transfer Pricing - Upper Premium ID';
Facility_tpIndirectLiquidityCosts_value=(Facility_tpIndirectLiquidityCostsFI+Facility_tpIndirectLiquidityCostsComRe+Facility_tpIndirectLiquidityCostsUncomRe+Facility_tpIndirectLiquidityCostsComCom+Facility_tpIndirectLiquidityCostsUncomCom+Facility_tpIndirectLiquidityCostsNotRe+Facility_tpIndirectLiquidityCostsCom31dt+Facility_tpIndirectLiquidityCostsUncom31dt)*Facility_tpDeannualize;
Facility_tpIndirectLiquidityCostsGeneral_value=undefined;
Facility_tpIndirectLiquidityCostsGeneral_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs - General';
Facility_tpBufferCostPerYearBP_value=MatrixLookup('CalculationParameters','BUFFERCOSTPERJAARBP',2);
Facility_tpBufferCostPerYearBP_title='Risk Adjusted Return - Interest Expenses - Buffer Cost Per Year BP';
Facility_tpFI_value=If(Borrower_tpAGICOrSBI==0,MatrixLookup('AGICMapping',''+Borrower_tpAGIC,3),MatrixLookup('SBIMapping',''+Borrower_tpSBI,3));
Facility_tpFI_title='Risk Adjusted Return - Interest Expenses - Financial Institution';
Facility_tpRedrawable_value=MatrixLookup('ProductType',Facility_tpType,5);
Facility_tpRedrawable_title='Risk Adjusted Return - Interest Expenses - Can be redrawn';
Facility_tp31DgDebet2_value=Facility_tp31DgDebet;
Facility_tp31DgDebet2_title='Risk Adjusted Return - Interest Expenses - 31dg Debet';
Facility_tpCombined_value=MatrixLookup('ProductType',Facility_tpType,2);
Facility_tpCombined_title='Risk Adjusted Return - Interest Expenses - Combined';
Facility_tpUncommitted_value=Facility_tpUncommitted2;
Facility_tpUncommitted_title='Risk Adjusted Return - Interest Expenses - Uncommitted';
Facility_tpCreditOrLiquidity_value=String(MatrixLookup('ProductType',Facility_tpType,3));
Facility_tpCreditOrLiquidity_title='Risk Adjusted Return - Interest Expenses - Credit || liquidity facility';
Facility_tpIndirectLiquidityCostsFI_value=If(Facility_tpFI,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowFI*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsFI_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Financial Institution';
Facility_tpOutflowFI_value=MatrixLookup('OutflowPercFinancialInstitutions',Borrower_tpFinancialInstitution+'_'+Facility_tpCreditOrLiquidity,3);
Facility_tpOutflowFI_title='Risk Adjusted Return - Interest Expenses - Outflow FI';
Facility_tpIndirectLiquidityCostsComRe_value=If(Facility_tpFI==0&&Facility_tpRedrawable==1&&Facility_tp31DgDebet==0&&Facility_tpCombined==0&&Facility_tpUncommitted==0,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowCommittedRedraw*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsComRe_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Committed + re-drawn';
Facility_tpOutflowCommittedRedraw_value=MatrixLookup('OutflowPercCommitted',Borrower_tpClientGroup,2);
Facility_tpOutflowCommittedRedraw_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Committed&&Redrawable';
Facility_tpIndirectLiquidityCostsUncomRe_value=If(Facility_tpFI==0&&Facility_tpRedrawable==1&&Facility_tp31DgDebet==0&&Facility_tpCombined==0&&Facility_tpUncommitted==1,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowUncommittedRedraw*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsUncomRe_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Uncomitted + re-drawn';
Facility_tpOutflowUncommittedRedraw_value=MatrixLookup('OutflowPercUncommitted',Borrower_tpClientGroup,1);
Facility_tpOutflowUncommittedRedraw_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Uncommitted&&Redrawable';
Facility_tpIndirectLiquidityCostsCom31dt_value=If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==1&&Facility_tpCombined==0&&Facility_tpUncommitted==0,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowCommitted31Dgn*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsCom31dt_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Committed +31dt';
Facility_tpOutflowCommitted31Dgn_value=MatrixLookup('OutflowPercCommitted',Borrower_tpClientGroup,4);
Facility_tpOutflowCommitted31Dgn_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Committed&&31 Dgn';
Facility_tpIndirectLiquidityCostsUncom31dt_value=If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==1&&Facility_tpCombined==0&&Facility_tpUncommitted==1,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowUncommitted31Dgn*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsUncom31dt_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Uncomitted + 31 dt';
Facility_tpOutflowUncommitted31Dgn_value=MatrixLookup('OutflowPercUncommitted',Borrower_tpClientGroup,3);
Facility_tpOutflowUncommitted31Dgn_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Uncommitted&&31 Dgn';
Facility_tpIndirectLiquidityCostsComCom_value=If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==0&&Facility_tpCombined==1&&Facility_tpUncommitted==0,(Facility_tpOriginalLimit-Facility_tpExpectedAverageOutstanding)*Facility_tpOutflowCommittedCombined*(Facility_tpBufferCostPerYearBP/1e4),NA);
Facility_tpIndirectLiquidityCostsComCom_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Committed + combined';
Facility_tpOutflowCommittedCombined_value=MatrixLookup('OutflowPercCommitted',Borrower_tpClientGroup,3);
Facility_tpOutflowCommittedCombined_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Committed&&Combined Product';
Facility_tpIndirectLiquidityCostsUncomCom_value=If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==0&&Facility_tpCombined==1&&Facility_tpUncommitted==1,Facility_tpTermLoanYearlyIndirectLiqCosts,NA);
Facility_tpIndirectLiquidityCostsUncomCom_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Uncomitted + combined';
Facility_tpOutflowUncommittedCombined_value=MatrixLookup('OutflowPercUncommitted',Borrower_tpClientGroup,2);
Facility_tpOutflowUncommittedCombined_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Uncommitted&&Combined';
Facility_tpIndirectLiquidityCostsNotRe_value=If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==0&&Facility_tpCombined==0,Facility_tpTermLoanYearlyIndirectLiqCosts,NA);
Facility_tpIndirectLiquidityCostsNotRe_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs- Not redrawable';
Facility_tpOutflowCommittedNotRedraw_value=MatrixLookup('OutflowPercCommitted',Borrower_tpClientGroup,1);
Facility_tpOutflowCommittedNotRedraw_title='Risk Adjusted Return - Interest Expenses - Outflow Percentage Committed&&Nonredrawable';
Facility_tpIndirectLiquidityCostsExtended_value=undefined;
Facility_tpIndirectLiquidityCostsExtended_title='Risk Adjusted Return - Interest Expenses - Indirect Liquidity Costs - Uitgebreide calc';
Facility_tpAbsoluteBufferCosts_value=Facility_tpOriginalLimit*If(Facility_tpFI==0&&Facility_tpRedrawable==0&&Facility_tp31DgDebet==0&&Facility_tpCombined==1&&Facility_tpUncommitted==1,Facility_tpOutflowUncommittedCombined,Facility_tpOutflowCommittedNotRedraw)*(Facility_tpBufferCostPerYearBP/1e4)/12;
Facility_tpAbsoluteBufferCosts_title='Risk Adjusted Return - Interest Expenses - Absolute Buffer Cost ()';
Facility_tpYearlyIndirectLiqCosts_value=Round(If(Facility_tpProductredemptionDetailsRedemptionType=='InterestOnly',Facility_tpYearlyIndirectLiqCostsBullet,If(Facility_tpProductredemptionDetailsRedemptionType=='Linear'||Facility_tpProductredemptionDetailsRedemptionType=='Annuity',Facility_tpYearlyIndirectLiqCostsLinearAnnuity,If(Facility_tpProductredemptionDetailsRedemptionType=='IrregularRepaymentSchedule',Facility_tpYearlyIndirectLiqCostsScheme,NA))),0);
Facility_tpYearlyIndirectLiqCosts_title='Risk Adjusted Return - Interest Expenses - Yearly Indirect Liq. Costs (Bps)';
Facility_tpYearlyIndirectLiqCostsBullet_value=If(Facility_tpProductredemptionDetailsRedemptionType=='InterestOnly',Facility_tpAbsoluteBufferCosts/Facility_tpOriginalTenorYears/Facility_tpOriginalLimit*1e4,NA);
Facility_tpYearlyIndirectLiqCostsBullet_title='Risk Adjusted Return - Interest Expenses - Yearly Indirect Liq. Costs (Bps) Bullet';
Facility_tpYearlyIndirectLiqCostsLinearAnnuity_value=If(Facility_tpProductredemptionDetailsRedemptionType=='Linear'||Facility_tpProductredemptionDetailsRedemptionType=='Annuity',Facility_tpAbsoluteBufferCosts*1e4/(Facility_tpOriginalTenor*Facility_tpOriginalLimit/12-.5*((Facility_tpOriginalTenor-Facility_tpGracePeriod)/12)*(Facility_tpOriginalLimit-Facility_tpBalloon)),NA);
Facility_tpYearlyIndirectLiqCostsLinearAnnuity_title='Risk Adjusted Return - Interest Expenses - Yearly Indirect Liq. Costs (Bps) Lin/Annuity';
Facility_tpYearlyIndirectLiqCostsScheme_value=If(Facility_tpProductredemptionDetailsRedemptionType=='IrregularRepaymentSchedule',Facility_tpAbsoluteBufferCosts/Facility_tpWeightedLimitOutstanding*1e4,NA);
Facility_tpYearlyIndirectLiqCostsScheme_title='Risk Adjusted Return - Interest Expenses - Yearly Indirect Liq. Costs (Bps) Scheme';
Facility_tpTermLoanYearlyIndirectLiqCosts_value=If(Facility_tpOriginalTenor>12,Facility_tpYearlyIndirectLiqCosts*1e-4*Facility_tpExpectedAverageOutstanding,Facility_tpYearlyIndirectLiqCosts*1e-4*Facility_tpExpectedAverageOutstanding*(Facility_tpOriginalTenor/12));
Facility_tpTermLoanYearlyIndirectLiqCosts_title='Risk Adjusted Return - Interest Expenses - Term Loan Yearly Indirect Liq. Costs ()';
Facility_tpOriginalLimit_value=Facility_tpPrincipalLimit;
Facility_tpOriginalLimit_title='Risk Adjusted Return - Interest Expenses - Original Limit ()';
Facility_tpWeightedLimitOutstanding_value=Facility_tpPrincipalLimit;
Facility_tpWeightedLimitOutstanding_title='Risk Adjusted Return - Interest Expenses - Weighted Limited Outstanding';
Facility_tpSubordinatedDebtCapitalCharge_value=OnER(Facility_tpRWA*Facility_tpSubDebtRatio*(Facility_tpCostOfSubordination/1e4)*Facility_tpDeannualize,NA);
Facility_tpSubDebtRatio_value=AgreementSubDebtRatio;
Facility_tpSubDebtRatio_title='Risk Adjusted Return - Interest Expenses - Subordinated Debt Capital Charge - Subordinated Debt Ratio ()';
Facility_tpCostOfSubordination_value=AgreementCostOfSubordination;
Facility_tpCostOfSubordination_title='Risk Adjusted Return - Interest Expenses - Subordinated Debt Capital Charge - Cost of Subordination (Bps)';
Facility_tpEquityFundingAdjustment_value=OnER((Facility_tpRWA*Borrower_tpEquityRatio-AgreementAvailableAmountOfEquity)*(Facility_tpEquityFundingAdjustmentRate/1e4),NA);
Facility_tpEquityFundingAdjustmentRate_value=MatrixLookup('CalculationParameters','3MAANDSEURIBORBP',2)+Facility_tpLiquiditySpreadBps;
Facility_tpEquityFundingAdjustmentRate_title='Risk Adjusted Return - Interest Expenses - Equity Funding Adjustment - Adjustment Rate';
Facility_tpInterestRateIndexBasis_value=OnEr(MatrixLookup('CustomerSpreadAddMargin',Facility_tpProductinterestDetailsInterestProductName,2),NA);
Facility_tpInterestRateIndexBasis_title='Risk Adjusted Return - Interest Expenses - Equity Funding Adjustment - Interest Rate Index Basis';
Facility_tpEquityCapitalCharge_value=OnER(Facility_tpRequiredAmountofEquity*Borrower_tpCostofEquity*Facility_tpDeannualize,NA);
Facility_tpRequiredAmountofEquity_value=OnER(Facility_tpRWA*Borrower_tpEquityRatio,NA);
Facility_tpRequiredAmountofEquity_title='Regulatory Profit - Equity Capital Charge - Required Amount of Equity';
Facility_tpRWA_value=OnER(Facility_tpRWACreditRisk+Facility_tpRWAOperationalRisk,NA);
Facility_tpRWACreditRisk_value=OnER(Facility_tpRWACreditRiskGuaranteed+Facility_tpRWACreditRiskUnguaranteed,NA);
Facility_tpRWACreditRisk_title='Risk Weighted Assets - Credit Risk';
Facility_tpRWACreditRiskUnguaranteed_value=Facility_tpRW*Facility_tpEADUnguaranteed;
Facility_tpRWACreditRiskUnguaranteed_title='Risk Weighted Assets - Credit Risk - Standard/Ungaranteed';
Facility_tpMaxMaturityRWA_value=MatrixLookup('CalculationParameters','MAX_MATURITY_RWA',2);
Facility_tpMaxMaturityRWA_title='Risk Weighted Assets - Max Maturity RWA';
Facility_tpMinMaturityRWA_value=MatrixLookup('CalculationParameters','MIN_MATURITY_RWA',2);
Facility_tpMinMaturityRWA_title='Risk Weighted Assets - Min Maturity RWA';
Facility_tpShortTermException_value=MatrixLookup('ProductType',Facility_tpType,7);
Facility_tpShortTermException_title='Risk Weighted Assets - Short Term Exception';
Facility_tpR_value=If(Facility_tpFI==0,Facility_tpR2,If(Facility_tpFI==1&&Borrower_tpAssetSize<=7e4&&Borrower_tpUnderSupervision==1,Facility_tpR2,Facility_tpR1));
Facility_tpR_title='Risk Weighted Assets - Correlation Factor (R)';
Facility_tpR1_value=(.12*(1-Exp(-50*Facility_tpBorrower_tpPDMoC))/(1-Exp(-50))+.24*((1-(1-Exp(-50*Facility_tpBorrower_tpPDMoC)))/(1-Exp(-50))))*1.25;
Facility_tpR1_title='Risk Weighted Assets - Correlation Factor (R1)';
Facility_tpR2_value=.12*(1-Exp(-50*Facility_tpBorrower_tpPDMoC))/(1-Exp(-50))+.24*((1-(1-Exp(-50*Facility_tpBorrower_tpPDMoC)))/(1-Exp(-50)))-.04*(1-(MAX(5,MIN(50,Borrower_tpAssetSize))-5)/45);
Facility_tpR2_title='Risk Weighted Assets - Correlation Factor (R2)';
Facility_tpb_value=OnER(.11852-.05478*LN(Facility_tpBorrower_tpPDMoC)^2,NA);
Facility_tpb_title='Risk Weighted Assets - Maturity Adjustment Factor (b)';
Facility_tpMWRA_value=OnER(IF(Facility_tpShortTermException,Max(Min(Facility_tpMaxMaturityRWA,Facility_tpRemainingAverageTenor),1/365),Max(Min(Facility_tpMaxMaturityRWA,Facility_tpRemainingAverageTenor),Facility_tpMinMaturityRWA)),NA);
Facility_tpMWRA_title='Risk Weighted Assets - MWRA Factor';
Facility_tpK_value=OnER((Facility_tpDLGDMoC*CumNormal((1-Facility_tpR^-.5)*InvNormal(Facility_tpBorrower_tpPDMoC)+(Facility_tpR/(1-Facility_tpR)^.5)*InvNormal(.999))-Facility_tpBorrower_tpPDMoC*Facility_tpDLGDMoC)*(1-1.5*Facility_tpb^-1)*(1+(Facility_tpMWRA-2.5)*Facility_tpb),NA);
Facility_tpK_title='Risk Weighted Assets - Capital Requirement (K)';
Facility_tpRW_value=OnER(Facility_tpK*12.5*1.06,NA);
Facility_tpRW_title='Risk Weighted Assets - Risk Weight Factor (RW)';
Facility_tpRWACreditRiskGuaranteed_value=Facility_tpRWGuaranteed*Facility_tpEADGuaranteed;
Facility_tpRWACreditRiskGuaranteed_title='Risk Weighted Assets - Credit Risk - Guarantees';
Facility_tpPDMoCGuaranteed_value=If(Facility_tpGuarantorPercentageGuaranteed>0&&Facility_tpGuarantorPDMoC<Facility_tpBorrower_tpPDMoC,Facility_tpGuarantorPDMoC,Facility_tpBorrower_tpPDMoC);
Facility_tpPDMoCGuaranteed_title='Risk Weighted Assets - PD Moc Min';
Facility_tpDLGDMoCGuaranteed_value=Facility_tpDLGDMoC;
Facility_tpDLGDMoCGuaranteed_title='Risk Weighted Assets - D LGD MoC Min';
Facility_tpRGuaranteed_value=If(Borrower_tpFinancialInstitutionChoice==0,Facility_tpR2Guaranteed,If(Facility_tpFI==1&&Borrower_tpAssetSize<=7e4&&Borrower_tpUnderSupervision==1,Facility_tpR2Guaranteed,Facility_tpR1Guaranteed));
Facility_tpR1Guaranteed_value=(.12*(1-Exp(-50*Facility_tpPDMoCGuaranteed))/(1-Exp(-50))+.24*((1-(1-Exp(-50*Facility_tpPDMoCGuaranteed)))/(1-Exp(-50))))*1.25;
Facility_tpR2Guaranteed_value=.12*(1-Exp(-50*Facility_tpPDMoCGuaranteed))/(1-Exp(-50))+.24*((1-(1-Exp(-50*Facility_tpPDMoCGuaranteed)))/(1-Exp(-50)))-.04*(1-(MAX(5,MIN(50,Borrower_tpAssetSize))-5)/45);
Facility_tpbGuaranteed_value=OnER(.11852-.05478*LN(Facility_tpPDMoCGuaranteed)^2,NA);
Facility_tpMWRAGuaranteed_value=OnER(IF(Facility_tpShortTermException,Max(Min(Facility_tpMaxMaturityRWA,Facility_tpRemainingAverageTenor),1/365),Max(Min(Facility_tpMaxMaturityRWA,Facility_tpRemainingAverageTenor),Facility_tpMinMaturityRWA)),NA);
Facility_tpKGuaranteed_value=OnER((Facility_tpDLGDMoCGuaranteed*CumNormal((1-Facility_tpRGuaranteed^-.5)*InvNormal(Facility_tpPDMoCGuaranteed)+(Facility_tpRGuaranteed/(1-Facility_tpRGuaranteed)^.5)*InvNormal(.999))-Facility_tpPDMoCGuaranteed*Facility_tpDLGDMoCGuaranteed)*(1-1.5*Facility_tpbGuaranteed^-1)*(1+(Facility_tpMWRAGuaranteed-2.5)*Facility_tpbGuaranteed),NA);
Facility_tpRWGuaranteed_value=OnER(Facility_tpKGuaranteed*12.5*1.06,NA);
Facility_tpRWAOperationalRisk_value=Facility_tpRWAOpR*(Facility_tpCreditIncome-Facility_tpDirectLiquidityPremium);
Facility_tpRWAOperationalRisk_title='Risk Weighted Assets - Operational Risk';
Facility_tpRWAOpR_value=MatrixLookup('ClientGroup',Borrower_tpClientGroup,7);
Facility_tpRWAOpR_title='Risk Weighted Assets - RWA OpR ()';
Facility_tpDataExportedToForce_value=undefined;
Facility_tpDataExportedToForce_title='Exported Data';
Facility_tpDataExportedToForceSub1_value=undefined;
Facility_tpDataExportedToForceSub2_value=undefined;
Facility_tpDataExportedToForceSub2_title='Return on Equity';
Facility_tpDataExportedToForceSub3_value=undefined;
Facility_tpDataExportedToForceSub4_value=undefined;
Facility_tpRequiredCustomerSpread_value=Facility_tpCustomerSpread/1e4;
Facility_tpRequiredCustomerSpread_title='Required Customer Spread';
Facility_tpRequiredMarketSpread_value=MatrixLookup('MarketSpread',Facility_tpProductinterestDetailsInterestProductName,Facility_tpTypeIndex);
Facility_tpRequiredMarketSpread_title='Required Market Spread';
Facility_tpTypeIndex_value=MatrixLookup('VertaaltabelProductType',Facility_tpType,2);
Facility_tpTypeIndex_title='Facility Type Index';
Facility_tpRequiredLiquiditySpread_value=Facility_tpLiquiditySpreadBps/1e4;
Facility_tpRequiredLiquiditySpread_title='Required Liquidity Spread';
FacilityTotal_value=TupleSum(Facility_tpPrincipalLimit);
FacilityTotal_title='Total';
Other_value=undefined;
Other_title='Other';
VersionInfoText_value=String(Q_MODELTYPE+' '+Q_MODELVERSION+' (Matrix '+Q_MATRIXVERSION+')');
VersionInfoText_title='Versions';
WindowsUserName_value='Ronald van Aalderen';
WindowsUserName_title='Gemaakt door';
CurrentDate_value=42768.572977187;
CurrentDate_title='Generated at';
FinanFullVersion_value='03.02.056.023';
FinanFullVersion_title='Gemaakt XML-applicatie version';
Q_MAP01_HULPVARIABELEN_value=undefined;
Q_MAP01_HULPVARIABELEN_title='Hulpvariabelen';
Q_MAP01_REQUIREDVARS_value=Count(X,SelectDescendants(Q_MAP01,Q_MAP01_HULPVARIABELEN),InputRequired(X));
Q_MAP01_REQUIREDVARS_title='Aantal verplichte velden (1)';
Q_MAP01_ENTEREDREQUIREDVARS_value=Count(X,SelectDescendants(Q_MAP01,Q_MAP01_HULPVARIABELEN),InputRequired(X)&&DataAvailable(X));
Q_MAP01_ENTEREDREQUIREDVARS_title='Aantal ingevulde verplichte velden (1)';
Q_MAP01_SUMFOR_value=SumFor(X,1,12,1,PPMT(1,X,24,-1e5,0));
Q_MAP01_SUMFOR_title='test variable for SumFor';
Q_RESULT_value=undefined;
Q_RESULT_title='Results';
Q_RESULTSUB1_value=undefined;
Q_ROLE_value=0;
Q_ROLE_title='Role';
Q_ROLE_choices=[{'name':' 0','value':'Tester'},{'name':'2','value':'RM'},{'name':'3','value':'FB'}];
Q_STATUS_value=0;
Q_STATUS_choices=[{'name':' 0','value':'Open'},{'name':'1','value':'Final'}];
Q_STATUS_FINAL_ON_value=undefined;
Q_STATUS_FINAL_ON_title='Made final on, ';
Q_STATUS_FINAL_BY_value=undefined;
Q_STATUS_FINAL_BY_title='Made final by (username), ';
Q_STATUS_FINAL_BY_NAME_value=undefined;
Q_STATUS_FINAL_BY_NAME_title='Made final by (fullname), ';
Q_STATUS_STARTED_ON_value=undefined;
Q_STATUS_STARTED_ON_title='Created on, ';
Q_STATUS_STARTED_BY_value=undefined;
Q_STATUS_STARTED_BY_title='Created by (username), ';
Q_STATUS_STARTED_BY_NAME_value=undefined;
Q_STATUS_STARTED_BY_NAME_title='Created by (fullname), ';
Q_STATUS_MODIFIED_ON_value=Now;
Q_STATUS_MODIFIED_ON_title='Last modification, ';
Q_MODELVERSION_value='01.34.002.000';
Q_MODELVERSION_title='Model version';
Q_MODELTYPE_value='AABPRICING';
Q_MODELTYPE_title='Model type';
Q_MATRIXVERSION_value=String(MatrixLookup('Version',1,3));
Q_MATRIXVERSION_title='Matrix version';
Q_PREVIOUS_BUTTON_VISIBLE_value=2;
Q_PREVIOUS_BUTTON_VISIBLE_title='Previous';
Q_PREVIOUS_BUTTON_VISIBLE_choices=[{'name':' 0','value':'Nooit'},{'name':'2','value':'Altijd'}];
Q_NEXT_BUTTON_VISIBLE_value=2;
Q_NEXT_BUTTON_VISIBLE_title='Next';
Q_NEXT_BUTTON_VISIBLE_choices=[{'name':' 0','value':'Nooit'},{'name':'1','value':'Alleen wanneer stap volledig is'},{'name':'2','value':'Altijd'}];
Q_CONCEPT_REPORT_VISIBLE_value=1;
Q_CONCEPT_REPORT_VISIBLE_title='Draft report';
Q_CONCEPT_REPORT_VISIBLE_choices=[{'name':' 0','value':'Nee'},{'name':'1','value':'Ja'}];
Q_FINAL_REPORT_VISIBLE_value=0;
Q_FINAL_REPORT_VISIBLE_title='Final report';
Q_MAKE_FINAL_VISIBLE_value=0;
Q_MAKE_FINAL_VISIBLE_title='Make it final';
Hulpvariabelen_value=undefined;
Hulpvariabelen_title='Overige berekeningen';
Q_WARNING_GLOBAL_value=String(If(Length(scKnockoutsCombi[doc])>0,'\r\nEr zijn knockouts van toepassing, '+scKnockoutsCombi,''));
Q_WARNING_GLOBAL_title='Knockout(s)';
scKnockoutsCombi_value=undefined;
scKnockoutsCombi_title='Knockouts tekst';
scRestricties_value=String(If(Length(scRestrictiesCombi[doc])>0,'\r\n\r\nDe volgende variabelen zijn niet correct gevuld, '+scRestrictiesCombi,''));
scRestricties_title='Restricties';
scRestrictiesCombi_value=undefined;
scRestrictiesCombi_title='Restricties tekst';
