'use strict';

var cov_1eev4y3nr6 = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\excel-connect\\excel-connect.js',
	    hash = '6c087c2907e380e7afa32da7d33465890a3a0218',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\excel-connect\\excel-connect.js',
		statementMap: {
			'0': {
				start: {
					line: 11,
					column: 30
				},
				end: {
					line: 11,
					column: 79
				}
			},
			'1': {
				start: {
					line: 26,
					column: 18
				},
				end: {
					line: 42,
					column: 1
				}
			},
			'2': {
				start: {
					line: 27,
					column: 14
				},
				end: {
					line: 27,
					column: 16
				}
			},
			'3': {
				start: {
					line: 28,
					column: 14
				},
				end: {
					line: 28,
					column: 16
				}
			},
			'4': {
				start: {
					line: 29,
					column: 1
				},
				end: {
					line: 40,
					column: 2
				}
			},
			'5': {
				start: {
					line: 30,
					column: 2
				},
				end: {
					line: 39,
					column: 3
				}
			},
			'6': {
				start: {
					line: 31,
					column: 3
				},
				end: {
					line: 31,
					column: 13
				}
			},
			'7': {
				start: {
					line: 32,
					column: 3
				},
				end: {
					line: 37,
					column: 4
				}
			},
			'8': {
				start: {
					line: 33,
					column: 4
				},
				end: {
					line: 36,
					column: 5
				}
			},
			'9': {
				start: {
					line: 34,
					column: 5
				},
				end: {
					line: 34,
					column: 15
				}
			},
			'10': {
				start: {
					line: 35,
					column: 5
				},
				end: {
					line: 35,
					column: 10
				}
			},
			'11': {
				start: {
					line: 38,
					column: 3
				},
				end: {
					line: 38,
					column: 8
				}
			},
			'12': {
				start: {
					line: 41,
					column: 1
				},
				end: {
					line: 41,
					column: 26
				}
			},
			'13': {
				start: {
					line: 43,
					column: 34
				},
				end: {
					line: 45,
					column: 1
				}
			},
			'14': {
				start: {
					line: 44,
					column: 1
				},
				end: {
					line: 44,
					column: 52
				}
			},
			'15': {
				start: {
					line: 47,
					column: 21
				},
				end: {
					line: 53,
					column: 1
				}
			},
			'16': {
				start: {
					line: 48,
					column: 18
				},
				end: {
					line: 48,
					column: 20
				}
			},
			'17': {
				start: {
					line: 49,
					column: 1
				},
				end: {
					line: 51,
					column: 2
				}
			},
			'18': {
				start: {
					line: 50,
					column: 2
				},
				end: {
					line: 50,
					column: 109
				}
			},
			'19': {
				start: {
					line: 52,
					column: 1
				},
				end: {
					line: 52,
					column: 16
				}
			},
			'20': {
				start: {
					line: 55,
					column: 22
				},
				end: {
					line: 66,
					column: 1
				}
			},
			'21': {
				start: {
					line: 56,
					column: 19
				},
				end: {
					line: 56,
					column: 21
				}
			},
			'22': {
				start: {
					line: 57,
					column: 1
				},
				end: {
					line: 64,
					column: 2
				}
			},
			'23': {
				start: {
					line: 58,
					column: 21
				},
				end: {
					line: 58,
					column: 23
				}
			},
			'24': {
				start: {
					line: 59,
					column: 2
				},
				end: {
					line: 59,
					column: 90
				}
			},
			'25': {
				start: {
					line: 60,
					column: 2
				},
				end: {
					line: 63,
					column: 3
				}
			},
			'26': {
				start: {
					line: 61,
					column: 23
				},
				end: {
					line: 61,
					column: 41
				}
			},
			'27': {
				start: {
					line: 62,
					column: 3
				},
				end: {
					line: 62,
					column: 80
				}
			},
			'28': {
				start: {
					line: 65,
					column: 1
				},
				end: {
					line: 65,
					column: 17
				}
			},
			'29': {
				start: {
					line: 68,
					column: 24
				},
				end: {
					line: 95,
					column: 1
				}
			},
			'30': {
				start: {
					line: 69,
					column: 15
				},
				end: {
					line: 69,
					column: 17
				}
			},
			'31': {
				start: {
					line: 70,
					column: 19
				},
				end: {
					line: 70,
					column: 45
				}
			},
			'32': {
				start: {
					line: 71,
					column: 1
				},
				end: {
					line: 93,
					column: 2
				}
			},
			'33': {
				start: {
					line: 73,
					column: 31
				},
				end: {
					line: 73,
					column: 46
				}
			},
			'34': {
				start: {
					line: 74,
					column: 2
				},
				end: {
					line: 77,
					column: 3
				}
			},
			'35': {
				start: {
					line: 75,
					column: 3
				},
				end: {
					line: 75,
					column: 40
				}
			},
			'36': {
				start: {
					line: 76,
					column: 3
				},
				end: {
					line: 76,
					column: 11
				}
			},
			'37': {
				start: {
					line: 78,
					column: 2
				},
				end: {
					line: 81,
					column: 3
				}
			},
			'38': {
				start: {
					line: 79,
					column: 3
				},
				end: {
					line: 79,
					column: 47
				}
			},
			'39': {
				start: {
					line: 80,
					column: 3
				},
				end: {
					line: 80,
					column: 11
				}
			},
			'40': {
				start: {
					line: 82,
					column: 41
				},
				end: {
					line: 82,
					column: 81
				}
			},
			'41': {
				start: {
					line: 83,
					column: 2
				},
				end: {
					line: 86,
					column: 3
				}
			},
			'42': {
				start: {
					line: 84,
					column: 3
				},
				end: {
					line: 84,
					column: 52
				}
			},
			'43': {
				start: {
					line: 85,
					column: 3
				},
				end: {
					line: 85,
					column: 11
				}
			},
			'44': {
				start: {
					line: 87,
					column: 20
				},
				end: {
					line: 87,
					column: 53
				}
			},
			'45': {
				start: {
					line: 88,
					column: 2
				},
				end: {
					line: 92,
					column: 3
				}
			},
			'46': {
				start: {
					line: 94,
					column: 1
				},
				end: {
					line: 94,
					column: 13
				}
			},
			'47': {
				start: {
					line: 97,
					column: 21
				},
				end: {
					line: 120,
					column: 1
				}
			},
			'48': {
				start: {
					line: 98,
					column: 16
				},
				end: {
					line: 98,
					column: 18
				}
			},
			'49': {
				start: {
					line: 99,
					column: 22
				},
				end: {
					line: 99,
					column: 41
				}
			},
			'50': {
				start: {
					line: 100,
					column: 1
				},
				end: {
					line: 116,
					column: 2
				}
			},
			'51': {
				start: {
					line: 101,
					column: 16
				},
				end: {
					line: 101,
					column: 41
				}
			},
			'52': {
				start: {
					line: 102,
					column: 17
				},
				end: {
					line: 102,
					column: 33
				}
			},
			'53': {
				start: {
					line: 103,
					column: 19
				},
				end: {
					line: 103,
					column: 46
				}
			},
			'54': {
				start: {
					line: 104,
					column: 20
				},
				end: {
					line: 104,
					column: 58
				}
			},
			'55': {
				start: {
					line: 105,
					column: 17
				},
				end: {
					line: 105,
					column: 19
				}
			},
			'56': {
				start: {
					line: 106,
					column: 2
				},
				end: {
					line: 106,
					column: 45
				}
			},
			'57': {
				start: {
					line: 106,
					column: 29
				},
				end: {
					line: 106,
					column: 45
				}
			},
			'58': {
				start: {
					line: 107,
					column: 2
				},
				end: {
					line: 111,
					column: 3
				}
			},
			'59': {
				start: {
					line: 112,
					column: 2
				},
				end: {
					line: 115,
					column: 3
				}
			},
			'60': {
				start: {
					line: 113,
					column: 3
				},
				end: {
					line: 113,
					column: 29
				}
			},
			'61': {
				start: {
					line: 114,
					column: 3
				},
				end: {
					line: 114,
					column: 72
				}
			},
			'62': {
				start: {
					line: 114,
					column: 40
				},
				end: {
					line: 114,
					column: 72
				}
			},
			'63': {
				start: {
					line: 119,
					column: 1
				},
				end: {
					line: 119,
					column: 14
				}
			},
			'64': {
				start: {
					line: 124,
					column: 2
				},
				end: {
					line: 124,
					column: 27
				}
			},
			'65': {
				start: {
					line: 125,
					column: 2
				},
				end: {
					line: 125,
					column: 19
				}
			},
			'66': {
				start: {
					line: 129,
					column: 2
				},
				end: {
					line: 156,
					column: 4
				}
			},
			'67': {
				start: {
					line: 131,
					column: 17
				},
				end: {
					line: 131,
					column: 39
				}
			},
			'68': {
				start: {
					line: 132,
					column: 21
				},
				end: {
					line: 132,
					column: 23
				}
			},
			'69': {
				start: {
					line: 133,
					column: 3
				},
				end: {
					line: 141,
					column: 5
				}
			},
			'70': {
				start: {
					line: 134,
					column: 22
				},
				end: {
					line: 134,
					column: 59
				}
			},
			'71': {
				start: {
					line: 135,
					column: 21
				},
				end: {
					line: 135,
					column: 56
				}
			},
			'72': {
				start: {
					line: 136,
					column: 29
				},
				end: {
					line: 136,
					column: 49
				}
			},
			'73': {
				start: {
					line: 137,
					column: 4
				},
				end: {
					line: 140,
					column: 5
				}
			},
			'74': {
				start: {
					line: 138,
					column: 5
				},
				end: {
					line: 138,
					column: 30
				}
			},
			'75': {
				start: {
					line: 139,
					column: 5
				},
				end: {
					line: 139,
					column: 54
				}
			},
			'76': {
				start: {
					line: 139,
					column: 16
				},
				end: {
					line: 139,
					column: 54
				}
			},
			'77': {
				start: {
					line: 142,
					column: 3
				},
				end: {
					line: 155,
					column: 29
				}
			},
			'78': {
				start: {
					line: 143,
					column: 4
				},
				end: {
					line: 147,
					column: 6
				}
			},
			'79': {
				start: {
					line: 144,
					column: 5
				},
				end: {
					line: 146,
					column: 97
				}
			},
			'80': {
				start: {
					line: 145,
					column: 6
				},
				end: {
					line: 145,
					column: 33
				}
			},
			'81': {
				start: {
					line: 146,
					column: 21
				},
				end: {
					line: 146,
					column: 96
				}
			},
			'82': {
				start: {
					line: 149,
					column: 24
				},
				end: {
					line: 149,
					column: 26
				}
			},
			'83': {
				start: {
					line: 150,
					column: 4
				},
				end: {
					line: 153,
					column: 7
				}
			},
			'84': {
				start: {
					line: 150,
					column: 38
				},
				end: {
					line: 153,
					column: 6
				}
			},
			'85': {
				start: {
					line: 151,
					column: 5
				},
				end: {
					line: 151,
					column: 165
				}
			},
			'86': {
				start: {
					line: 151,
					column: 41
				},
				end: {
					line: 151,
					column: 165
				}
			},
			'87': {
				start: {
					line: 152,
					column: 5
				},
				end: {
					line: 152,
					column: 51
				}
			},
			'88': {
				start: {
					line: 154,
					column: 4
				},
				end: {
					line: 154,
					column: 24
				}
			},
			'89': {
				start: {
					line: 155,
					column: 19
				},
				end: {
					line: 155,
					column: 28
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 26,
						column: 18
					},
					end: {
						line: 26,
						column: 19
					}
				},
				loc: {
					start: {
						line: 26,
						column: 29
					},
					end: {
						line: 42,
						column: 1
					}
				},
				line: 26
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 43,
						column: 34
					},
					end: {
						line: 43,
						column: 35
					}
				},
				loc: {
					start: {
						line: 43,
						column: 56
					},
					end: {
						line: 45,
						column: 1
					}
				},
				line: 43
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 47,
						column: 21
					},
					end: {
						line: 47,
						column: 22
					}
				},
				loc: {
					start: {
						line: 47,
						column: 40
					},
					end: {
						line: 53,
						column: 1
					}
				},
				line: 47
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 55,
						column: 22
					},
					end: {
						line: 55,
						column: 23
					}
				},
				loc: {
					start: {
						line: 55,
						column: 51
					},
					end: {
						line: 66,
						column: 1
					}
				},
				line: 55
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 68,
						column: 24
					},
					end: {
						line: 68,
						column: 25
					}
				},
				loc: {
					start: {
						line: 68,
						column: 32
					},
					end: {
						line: 95,
						column: 1
					}
				},
				line: 68
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 97,
						column: 21
					},
					end: {
						line: 97,
						column: 22
					}
				},
				loc: {
					start: {
						line: 97,
						column: 29
					},
					end: {
						line: 120,
						column: 1
					}
				},
				line: 97
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 123,
						column: 1
					},
					end: {
						line: 123,
						column: 2
					}
				},
				loc: {
					start: {
						line: 123,
						column: 15
					},
					end: {
						line: 126,
						column: 2
					}
				},
				line: 123
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 128,
						column: 1
					},
					end: {
						line: 128,
						column: 2
					}
				},
				loc: {
					start: {
						line: 128,
						column: 62
					},
					end: {
						line: 157,
						column: 2
					}
				},
				line: 128
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 129,
						column: 21
					},
					end: {
						line: 129,
						column: 22
					}
				},
				loc: {
					start: {
						line: 129,
						column: 40
					},
					end: {
						line: 156,
						column: 3
					}
				},
				line: 129
			},
			'9': {
				name: '(anonymous_9)',
				decl: {
					start: {
						line: 133,
						column: 17
					},
					end: {
						line: 133,
						column: 18
					}
				},
				loc: {
					start: {
						line: 133,
						column: 25
					},
					end: {
						line: 141,
						column: 4
					}
				},
				line: 133
			},
			'10': {
				name: '(anonymous_10)',
				decl: {
					start: {
						line: 142,
						column: 29
					},
					end: {
						line: 142,
						column: 30
					}
				},
				loc: {
					start: {
						line: 142,
						column: 48
					},
					end: {
						line: 148,
						column: 4
					}
				},
				line: 142
			},
			'11': {
				name: '(anonymous_11)',
				decl: {
					start: {
						line: 143,
						column: 23
					},
					end: {
						line: 143,
						column: 24
					}
				},
				loc: {
					start: {
						line: 143,
						column: 47
					},
					end: {
						line: 147,
						column: 5
					}
				},
				line: 143
			},
			'12': {
				name: '(anonymous_12)',
				decl: {
					start: {
						line: 144,
						column: 55
					},
					end: {
						line: 144,
						column: 56
					}
				},
				loc: {
					start: {
						line: 144,
						column: 65
					},
					end: {
						line: 146,
						column: 6
					}
				},
				line: 144
			},
			'13': {
				name: '(anonymous_13)',
				decl: {
					start: {
						line: 146,
						column: 14
					},
					end: {
						line: 146,
						column: 15
					}
				},
				loc: {
					start: {
						line: 146,
						column: 21
					},
					end: {
						line: 146,
						column: 96
					}
				},
				line: 146
			},
			'14': {
				name: '(anonymous_14)',
				decl: {
					start: {
						line: 148,
						column: 12
					},
					end: {
						line: 148,
						column: 13
					}
				},
				loc: {
					start: {
						line: 148,
						column: 27
					},
					end: {
						line: 155,
						column: 4
					}
				},
				line: 148
			},
			'15': {
				name: '(anonymous_15)',
				decl: {
					start: {
						line: 150,
						column: 24
					},
					end: {
						line: 150,
						column: 25
					}
				},
				loc: {
					start: {
						line: 150,
						column: 38
					},
					end: {
						line: 153,
						column: 6
					}
				},
				line: 150
			},
			'16': {
				name: '(anonymous_16)',
				decl: {
					start: {
						line: 150,
						column: 70
					},
					end: {
						line: 150,
						column: 71
					}
				},
				loc: {
					start: {
						line: 150,
						column: 83
					},
					end: {
						line: 153,
						column: 5
					}
				},
				line: 150
			},
			'17': {
				name: '(anonymous_17)',
				decl: {
					start: {
						line: 155,
						column: 12
					},
					end: {
						line: 155,
						column: 13
					}
				},
				loc: {
					start: {
						line: 155,
						column: 19
					},
					end: {
						line: 155,
						column: 28
					}
				},
				line: 155
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 30,
						column: 2
					},
					end: {
						line: 39,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 30,
						column: 2
					},
					end: {
						line: 39,
						column: 3
					}
				}, {
					start: {
						line: 30,
						column: 2
					},
					end: {
						line: 39,
						column: 3
					}
				}],
				line: 30
			},
			'1': {
				loc: {
					start: {
						line: 33,
						column: 4
					},
					end: {
						line: 36,
						column: 5
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 33,
						column: 4
					},
					end: {
						line: 36,
						column: 5
					}
				}, {
					start: {
						line: 33,
						column: 4
					},
					end: {
						line: 36,
						column: 5
					}
				}],
				line: 33
			},
			'2': {
				loc: {
					start: {
						line: 74,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 74,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				}, {
					start: {
						line: 74,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				}],
				line: 74
			},
			'3': {
				loc: {
					start: {
						line: 78,
						column: 2
					},
					end: {
						line: 81,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 78,
						column: 2
					},
					end: {
						line: 81,
						column: 3
					}
				}, {
					start: {
						line: 78,
						column: 2
					},
					end: {
						line: 81,
						column: 3
					}
				}],
				line: 78
			},
			'4': {
				loc: {
					start: {
						line: 83,
						column: 2
					},
					end: {
						line: 86,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 83,
						column: 2
					},
					end: {
						line: 86,
						column: 3
					}
				}, {
					start: {
						line: 83,
						column: 2
					},
					end: {
						line: 86,
						column: 3
					}
				}],
				line: 83
			},
			'5': {
				loc: {
					start: {
						line: 128,
						column: 30
					},
					end: {
						line: 128,
						column: 60
					}
				},
				type: 'default-arg',
				locations: [{
					start: {
						line: 128,
						column: 39
					},
					end: {
						line: 128,
						column: 60
					}
				}],
				line: 128
			},
			'6': {
				loc: {
					start: {
						line: 137,
						column: 4
					},
					end: {
						line: 140,
						column: 5
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 137,
						column: 4
					},
					end: {
						line: 140,
						column: 5
					}
				}, {
					start: {
						line: 137,
						column: 4
					},
					end: {
						line: 140,
						column: 5
					}
				}],
				line: 137
			},
			'7': {
				loc: {
					start: {
						line: 137,
						column: 8
					},
					end: {
						line: 137,
						column: 83
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 137,
						column: 8
					},
					end: {
						line: 137,
						column: 40
					}
				}, {
					start: {
						line: 137,
						column: 44
					},
					end: {
						line: 137,
						column: 83
					}
				}],
				line: 137
			},
			'8': {
				loc: {
					start: {
						line: 139,
						column: 5
					},
					end: {
						line: 139,
						column: 54
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 139,
						column: 5
					},
					end: {
						line: 139,
						column: 54
					}
				}, {
					start: {
						line: 139,
						column: 5
					},
					end: {
						line: 139,
						column: 54
					}
				}],
				line: 139
			},
			'9': {
				loc: {
					start: {
						line: 151,
						column: 5
					},
					end: {
						line: 151,
						column: 165
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 151,
						column: 5
					},
					end: {
						line: 151,
						column: 165
					}
				}, {
					start: {
						line: 151,
						column: 5
					},
					end: {
						line: 151,
						column: 165
					}
				}],
				line: 151
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0,
			'29': 0,
			'30': 0,
			'31': 0,
			'32': 0,
			'33': 0,
			'34': 0,
			'35': 0,
			'36': 0,
			'37': 0,
			'38': 0,
			'39': 0,
			'40': 0,
			'41': 0,
			'42': 0,
			'43': 0,
			'44': 0,
			'45': 0,
			'46': 0,
			'47': 0,
			'48': 0,
			'49': 0,
			'50': 0,
			'51': 0,
			'52': 0,
			'53': 0,
			'54': 0,
			'55': 0,
			'56': 0,
			'57': 0,
			'58': 0,
			'59': 0,
			'60': 0,
			'61': 0,
			'62': 0,
			'63': 0,
			'64': 0,
			'65': 0,
			'66': 0,
			'67': 0,
			'68': 0,
			'69': 0,
			'70': 0,
			'71': 0,
			'72': 0,
			'73': 0,
			'74': 0,
			'75': 0,
			'76': 0,
			'77': 0,
			'78': 0,
			'79': 0,
			'80': 0,
			'81': 0,
			'82': 0,
			'83': 0,
			'84': 0,
			'85': 0,
			'86': 0,
			'87': 0,
			'88': 0,
			'89': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0],
			'6': [0, 0],
			'7': [0, 0],
			'8': [0, 0],
			'9': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}(); /**
      * Bridge between excel files and LME
      * The MatrixLookup function is found in math
      */


Object.defineProperty(exports, "__esModule", {
	value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _log = require('log6');

var _exceljs = require('exceljs');

var _exceljs2 = _interopRequireDefault(_exceljs);

var _promise = require('promise');

var _promise2 = _interopRequireDefault(_promise);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var default_resources_map = (cov_1eev4y3nr6.s[0]++, _path2.default.join(__dirname, '../git-connect/resources/'));

/**
 * Result after excel parsing.
 * rangenaam: {
 *   var1: {
 *      0 : value
 *      1 : value
 *   }
 *   var2:{
 *      0 : value
 *      1 : value
 *   }
 * }
 */
cov_1eev4y3nr6.s[1]++;
var findStart = function findStart(range) {
	cov_1eev4y3nr6.f[0]++;

	var yStart = (cov_1eev4y3nr6.s[2]++, -1);
	var xStart = (cov_1eev4y3nr6.s[3]++, -1);
	cov_1eev4y3nr6.s[4]++;
	for (var y = 0; y < range.ranges.length; y++) {
		cov_1eev4y3nr6.s[5]++;

		if (range.ranges[y]) {
			cov_1eev4y3nr6.b[0][0]++;
			cov_1eev4y3nr6.s[6]++;

			yStart = y;
			cov_1eev4y3nr6.s[7]++;
			for (var x = 0; x < range.ranges[y].length; x++) {
				cov_1eev4y3nr6.s[8]++;

				if (range.ranges[y][x]) {
					cov_1eev4y3nr6.b[1][0]++;
					cov_1eev4y3nr6.s[9]++;

					xStart = x;
					cov_1eev4y3nr6.s[10]++;
					break;
				} else {
					cov_1eev4y3nr6.b[1][1]++;
				}
			}
			cov_1eev4y3nr6.s[11]++;
			break;
		} else {
			cov_1eev4y3nr6.b[0][1]++;
		}
	}
	cov_1eev4y3nr6.s[12]++;
	return { xStart: xStart, yStart: yStart };
};
cov_1eev4y3nr6.s[13]++;
var getCellValueFromRangeCell = function getCellValueFromRangeCell(range, rangeCell) {
	cov_1eev4y3nr6.f[1]++;
	cov_1eev4y3nr6.s[14]++;

	return range.sheet.getCell(rangeCell.address).value;
};

cov_1eev4y3nr6.s[15]++;
var findYasNames = function findYasNames(range, bounds) {
	cov_1eev4y3nr6.f[2]++;

	var yAsNames = (cov_1eev4y3nr6.s[16]++, {});
	cov_1eev4y3nr6.s[17]++;
	for (var y = bounds.yStart; y < range.ranges.length; y++) {
		cov_1eev4y3nr6.s[18]++;

		yAsNames[getCellValueFromRangeCell(range, range.ranges[y][bounds.xStart])] = range.ranges[y][bounds.xStart];
	}
	cov_1eev4y3nr6.s[19]++;
	return yAsNames;
};

cov_1eev4y3nr6.s[20]++;
var findXasValues = function findXasValues(range, yasNames, bounds) {
	cov_1eev4y3nr6.f[3]++;

	var xAsValues = (cov_1eev4y3nr6.s[21]++, {});
	cov_1eev4y3nr6.s[22]++;
	for (var y = bounds.yStart; y < range.ranges.length; y++) {
		var currentXAs = (cov_1eev4y3nr6.s[23]++, {});
		cov_1eev4y3nr6.s[24]++;
		xAsValues[getCellValueFromRangeCell(range, range.ranges[y][bounds.xStart])] = currentXAs;
		cov_1eev4y3nr6.s[25]++;
		for (var x = bounds.xStart; x < range.ranges[y].length; x++) {
			var cellAddress = (cov_1eev4y3nr6.s[26]++, range.ranges[y][x]);
			cov_1eev4y3nr6.s[27]++;
			currentXAs[x - bounds.xStart] = getCellValueFromRangeCell(range, cellAddress);
		}
	}
	cov_1eev4y3nr6.s[28]++;
	return xAsValues;
};

cov_1eev4y3nr6.s[29]++;
var getDefinedNames = function getDefinedNames(wb) {
	cov_1eev4y3nr6.f[4]++;

	var names = (cov_1eev4y3nr6.s[30]++, {});
	var matrixMap = (cov_1eev4y3nr6.s[31]++, wb._definedNames.matrixMap);
	cov_1eev4y3nr6.s[32]++;
	for (var name in matrixMap) {
		//checks concerning assumptions made during creating code.
		var matrixMapDefinedName = (cov_1eev4y3nr6.s[33]++, matrixMap[name]);
		cov_1eev4y3nr6.s[34]++;
		if (!matrixMapDefinedName) {
			cov_1eev4y3nr6.b[2][0]++;
			cov_1eev4y3nr6.s[35]++;

			(0, _log.warn)('invalid named range [' + name + ']');
			cov_1eev4y3nr6.s[36]++;
			continue;
		} else {
			cov_1eev4y3nr6.b[2][1]++;
		}
		cov_1eev4y3nr6.s[37]++;
		if (!matrixMapDefinedName.sheets) {
			cov_1eev4y3nr6.b[3][0]++;
			cov_1eev4y3nr6.s[38]++;

			(0, _log.warn)('invalid named range sheets [' + name + ']');
			cov_1eev4y3nr6.s[39]++;
			continue;
		} else {
			cov_1eev4y3nr6.b[3][1]++;
		}
		var matrixMapDefinedNamesSheetKeys = (cov_1eev4y3nr6.s[40]++, Object.keys(matrixMapDefinedName.sheets));
		cov_1eev4y3nr6.s[41]++;
		if (matrixMapDefinedNamesSheetKeys.length > 1) {
			cov_1eev4y3nr6.b[4][0]++;
			cov_1eev4y3nr6.s[42]++;

			(0, _log.warn)('invalid named range sheet count [' + name + ']');
			cov_1eev4y3nr6.s[43]++;
			continue;
		} else {
			cov_1eev4y3nr6.b[4][1]++;
		}
		var sheetName = (cov_1eev4y3nr6.s[44]++, matrixMapDefinedNamesSheetKeys[0]);
		cov_1eev4y3nr6.s[45]++;
		names[name] = {
			name: name,
			sheet: wb.getWorksheet(sheetName),
			ranges: matrixMapDefinedName.sheets[sheetName]
		};
	}
	cov_1eev4y3nr6.s[46]++;
	return names;
};

cov_1eev4y3nr6.s[47]++;
var readFunction = function readFunction(wb) {
	cov_1eev4y3nr6.f[5]++;

	var matrix = (cov_1eev4y3nr6.s[48]++, {});
	var definedNames = (cov_1eev4y3nr6.s[49]++, getDefinedNames(wb));
	cov_1eev4y3nr6.s[50]++;
	for (var definedName in definedNames) {
		var range = (cov_1eev4y3nr6.s[51]++, definedNames[definedName]);
		var bounds = (cov_1eev4y3nr6.s[52]++, findStart(range));
		var yasNames = (cov_1eev4y3nr6.s[53]++, findYasNames(range, bounds));
		var xasValues = (cov_1eev4y3nr6.s[54]++, findXasValues(range, yasNames, bounds));
		var sorted = (cov_1eev4y3nr6.s[55]++, []);
		cov_1eev4y3nr6.s[56]++;
		for (var key in xasValues) {
			cov_1eev4y3nr6.s[57]++;
			sorted.push(key);
		}cov_1eev4y3nr6.s[58]++;
		matrix[definedName] = {
			name: range.name,
			table: {},
			bounds: bounds, yasNames: yasNames, x_sort: sorted, xasValues: xasValues
		};
		cov_1eev4y3nr6.s[59]++;
		for (var xas_key in xasValues) {
			cov_1eev4y3nr6.s[60]++;

			matrix[definedName].x = [];
			cov_1eev4y3nr6.s[61]++;
			for (var keyX in xasValues[xas_key]) {
				cov_1eev4y3nr6.s[62]++;
				matrix[definedName].x.push(keyX);
			}
		}
	}
	// use workbook
	// This variable should be available in the client.
	cov_1eev4y3nr6.s[63]++;
	return matrix;
};

var ExcelConnect = function () {
	function ExcelConnect() {
		(0, _classCallCheck3.default)(this, ExcelConnect);
		cov_1eev4y3nr6.f[6]++;
		cov_1eev4y3nr6.s[64]++;

		this.name = 'xlsx-lookup';
		cov_1eev4y3nr6.s[65]++;
		this.entries = {};
	}

	(0, _createClass3.default)(ExcelConnect, [{
		key: 'loadExcelFile',
		value: function loadExcelFile(excelFileName) {
			var folder = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : (cov_1eev4y3nr6.b[5][0]++, default_resources_map);
			cov_1eev4y3nr6.f[7]++;
			cov_1eev4y3nr6.s[66]++;

			return new _promise2.default(function (success, fail) {
				cov_1eev4y3nr6.f[8]++;

				//check if an file exists
				var files = (cov_1eev4y3nr6.s[67]++, _fs2.default.readdirSync(folder));
				var fileNames = (cov_1eev4y3nr6.s[68]++, []);
				cov_1eev4y3nr6.s[69]++;
				files.forEach(function (file) {
					cov_1eev4y3nr6.f[9]++;

					var full_path = (cov_1eev4y3nr6.s[70]++, _path2.default.resolve(_path2.default.join(folder, file)));
					var filename = (cov_1eev4y3nr6.s[71]++, full_path.replace(/\(\w+\)/gmi, ''));
					var file_information = (cov_1eev4y3nr6.s[72]++, _path2.default.parse(filename));
					cov_1eev4y3nr6.s[73]++;
					if ((cov_1eev4y3nr6.b[7][0]++, file_information.ext === '.xlsx') && (cov_1eev4y3nr6.b[7][1]++, file_information.name === excelFileName)) {
						cov_1eev4y3nr6.b[6][0]++;
						cov_1eev4y3nr6.s[74]++;

						fileNames.push(full_path);
						cov_1eev4y3nr6.s[75]++;
						if (_log.DEBUG) {
								cov_1eev4y3nr6.b[8][0]++;
								cov_1eev4y3nr6.s[76]++;
								(0, _log.debug)('Found excel file: ', full_path);
							} else {
							cov_1eev4y3nr6.b[8][1]++;
						}
					} else {
						cov_1eev4y3nr6.b[6][1]++;
					}
				});
				cov_1eev4y3nr6.s[77]++;
				_promise2.default.all(fileNames.map(function (filename) {
					cov_1eev4y3nr6.f[10]++;
					cov_1eev4y3nr6.s[78]++;

					return new _promise2.default(function (success, fail) {
						cov_1eev4y3nr6.f[11]++;
						cov_1eev4y3nr6.s[79]++;

						new _exceljs2.default.Workbook().xlsx.readFile(filename).then(function (data) {
							cov_1eev4y3nr6.f[12]++;
							cov_1eev4y3nr6.s[80]++;

							success(readFunction(data));
						}).catch(function (err) {
							cov_1eev4y3nr6.f[13]++;
							cov_1eev4y3nr6.s[81]++;
							return fail('Error reading XLSX ' + filename + ' for ' + excelFileName, err.toString());
						});
					});
				})).then(function (excel_files) {
					cov_1eev4y3nr6.f[14]++;

					var totalMatrix = (cov_1eev4y3nr6.s[82]++, {});
					cov_1eev4y3nr6.s[83]++;
					excel_files.forEach(function (excel_file) {
						cov_1eev4y3nr6.f[15]++;
						cov_1eev4y3nr6.s[84]++;
						return Object.keys(excel_file).forEach(function (tableName) {
							cov_1eev4y3nr6.f[16]++;
							cov_1eev4y3nr6.s[85]++;

							if (totalMatrix[tableName] != null) {
									cov_1eev4y3nr6.b[9][0]++;
									cov_1eev4y3nr6.s[86]++;
									(0, _log.debug)('Duplicate table \'' + tableName + '\' found while accumulating excel-sheets into one, last found named table will be used.');
								} else {
								cov_1eev4y3nr6.b[9][1]++;
							}cov_1eev4y3nr6.s[87]++;
							totalMatrix[tableName] = excel_file[tableName];
						});
					});
					cov_1eev4y3nr6.s[88]++;
					success(totalMatrix);
				}).catch(function (err) {
					cov_1eev4y3nr6.f[17]++;
					cov_1eev4y3nr6.s[89]++;
					return fail(err);
				});
			});
		}
	}]);
	return ExcelConnect;
}();

exports.default = new ExcelConnect();