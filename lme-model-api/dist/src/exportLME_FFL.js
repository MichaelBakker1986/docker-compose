'use strict';

var cov_dwhpvrzpt = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\exportLME_FFL.js',
	    hash = '717e25fdf2cf3d4b4402c10cbd826978cd53a8cb',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\exportLME_FFL.js',
		statementMap: {
			'0': {
				start: {
					line: 17,
					column: 18
				},
				end: {
					line: 17,
					column: 33
				}
			},
			'1': {
				start: {
					line: 18,
					column: 17
				},
				end: {
					line: 18,
					column: 23
				}
			},
			'2': {
				start: {
					line: 20,
					column: 0
				},
				end: {
					line: 20,
					column: 51
				}
			},
			'3': {
				start: {
					line: 23,
					column: 0
				},
				end: {
					line: 23,
					column: 54
				}
			},
			'4': {
				start: {
					line: 23,
					column: 34
				},
				end: {
					line: 23,
					column: 54
				}
			},
			'5': {
				start: {
					line: 25,
					column: 34
				},
				end: {
					line: 25,
					column: 126
				}
			},
			'6': {
				start: {
					line: 25,
					column: 49
				},
				end: {
					line: 25,
					column: 126
				}
			},
			'7': {
				start: {
					line: 26,
					column: 18
				},
				end: {
					line: 26,
					column: 54
				}
			},
			'8': {
				start: {
					line: 28,
					column: 0
				},
				end: {
					line: 61,
					column: 2
				}
			},
			'9': {
				start: {
					line: 29,
					column: 1
				},
				end: {
					line: 29,
					column: 77
				}
			},
			'10': {
				start: {
					line: 31,
					column: 1
				},
				end: {
					line: 35,
					column: 2
				}
			},
			'11': {
				start: {
					line: 32,
					column: 2
				},
				end: {
					line: 32,
					column: 74
				}
			},
			'12': {
				start: {
					line: 34,
					column: 2
				},
				end: {
					line: 34,
					column: 58
				}
			},
			'13': {
				start: {
					line: 36,
					column: 15
				},
				end: {
					line: 36,
					column: 105
				}
			},
			'14': {
				start: {
					line: 37,
					column: 1
				},
				end: {
					line: 37,
					column: 23
				}
			},
			'15': {
				start: {
					line: 38,
					column: 19
				},
				end: {
					line: 38,
					column: 34
				}
			},
			'16': {
				start: {
					line: 39,
					column: 17
				},
				end: {
					line: 49,
					column: 2
				}
			},
			'17': {
				start: {
					line: 43,
					column: 4
				},
				end: {
					line: 43,
					column: 72
				}
			},
			'18': {
				start: {
					line: 50,
					column: 9
				},
				end: {
					line: 50,
					column: 147
				}
			},
			'19': {
				start: {
					line: 51,
					column: 1
				},
				end: {
					line: 51,
					column: 80
				}
			},
			'20': {
				start: {
					line: 52,
					column: 1
				},
				end: {
					line: 52,
					column: 39
				}
			},
			'21': {
				start: {
					line: 54,
					column: 1
				},
				end: {
					line: 54,
					column: 44
				}
			},
			'22': {
				start: {
					line: 55,
					column: 1
				},
				end: {
					line: 55,
					column: 33
				}
			},
			'23': {
				start: {
					line: 56,
					column: 13
				},
				end: {
					line: 56,
					column: 90
				}
			},
			'24': {
				start: {
					line: 57,
					column: 1
				},
				end: {
					line: 57,
					column: 21
				}
			},
			'25': {
				start: {
					line: 59,
					column: 1
				},
				end: {
					line: 59,
					column: 11
				}
			},
			'26': {
				start: {
					line: 60,
					column: 1
				},
				end: {
					line: 60,
					column: 16
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 25,
						column: 34
					},
					end: {
						line: 25,
						column: 35
					}
				},
				loc: {
					start: {
						line: 25,
						column: 49
					},
					end: {
						line: 25,
						column: 126
					}
				},
				line: 25
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 28,
						column: 39
					},
					end: {
						line: 28,
						column: 40
					}
				},
				loc: {
					start: {
						line: 28,
						column: 51
					},
					end: {
						line: 58,
						column: 1
					}
				},
				line: 28
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 42,
						column: 15
					},
					end: {
						line: 42,
						column: 16
					}
				},
				loc: {
					start: {
						line: 42,
						column: 30
					},
					end: {
						line: 44,
						column: 4
					}
				},
				line: 42
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 58,
						column: 9
					},
					end: {
						line: 58,
						column: 10
					}
				},
				loc: {
					start: {
						line: 58,
						column: 18
					},
					end: {
						line: 61,
						column: 1
					}
				},
				line: 58
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 23,
						column: 0
					},
					end: {
						line: 23,
						column: 54
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 23,
						column: 0
					},
					end: {
						line: 23,
						column: 54
					}
				}, {
					start: {
						line: 23,
						column: 0
					},
					end: {
						line: 23,
						column: 54
					}
				}],
				line: 23
			},
			'1': {
				loc: {
					start: {
						line: 25,
						column: 49
					},
					end: {
						line: 25,
						column: 126
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 25,
						column: 81
					},
					end: {
						line: 25,
						column: 114
					}
				}, {
					start: {
						line: 25,
						column: 117
					},
					end: {
						line: 25,
						column: 126
					}
				}],
				line: 25
			},
			'2': {
				loc: {
					start: {
						line: 31,
						column: 1
					},
					end: {
						line: 35,
						column: 2
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 31,
						column: 1
					},
					end: {
						line: 35,
						column: 2
					}
				}, {
					start: {
						line: 31,
						column: 1
					},
					end: {
						line: 35,
						column: 2
					}
				}],
				line: 31
			},
			'3': {
				loc: {
					start: {
						line: 43,
						column: 11
					},
					end: {
						line: 43,
						column: 72
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 43,
						column: 49
					},
					end: {
						line: 43,
						column: 58
					}
				}, {
					start: {
						line: 43,
						column: 61
					},
					end: {
						line: 43,
						column: 72
					}
				}],
				line: 43
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}(); /**
      * Convert Model into front-end distribution
      * node exportLME_FFL {modelName}
      */


var _index = require('../../lme-core/index');

var _index2 = _interopRequireDefault(_index);

var _babelify = require('babelify');

var _babelify2 = _interopRequireDefault(_babelify);

var _fs = require('fs');

var _browserify = require('browserify');

var _browserify2 = _interopRequireDefault(_browserify);

var _CustomImport = require('../../lme-core/resources/CustomImport.json');

var _CustomImport2 = _interopRequireDefault(_CustomImport);

var _log = require('log6');

var _lme = require('./lme');

var _index3 = require('../../ffl/index');

var _browserifyFastjson = require('browserify-fastjson');

var _browserifyFastjson2 = _interopRequireDefault(_browserifyFastjson);

var _ExcelApi = require('./ExcelApi');

var _ExcelApi2 = _interopRequireDefault(_ExcelApi);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var modelName = (cov_dwhpvrzpt.s[0]++, process.argv[2]);
var fileType = (cov_dwhpvrzpt.s[1]++, '.ffl');

cov_dwhpvrzpt.s[2]++;
_index2.default.registerParser(_index3.RegisterPlainFFLDecorator);

//quick-fix resolve XSLX modelName
cov_dwhpvrzpt.s[3]++;
if (!'_tmp_'.startsWith('_tmp_')) {
		cov_dwhpvrzpt.b[0][0]++;
		cov_dwhpvrzpt.s[4]++;
		throw Error('error');
	} else {
	cov_dwhpvrzpt.b[0][1]++;
}cov_dwhpvrzpt.s[5]++;
var excel_file_name_quick_fix = function excel_file_name_quick_fix(modelName) {
	cov_dwhpvrzpt.f[0]++;
	cov_dwhpvrzpt.s[6]++;
	return modelName.startsWith('_tmp_') ? (cov_dwhpvrzpt.b[1][0]++, modelName.split('_').slice(-1)[0]) : (cov_dwhpvrzpt.b[1][1]++, modelName);
};
var xlsx_name = (cov_dwhpvrzpt.s[7]++, excel_file_name_quick_fix(modelName));

cov_dwhpvrzpt.s[8]++;
_ExcelApi2.default.loadExcelFile(xlsx_name).then(function (matrix) {
	cov_dwhpvrzpt.f[1]++;
	cov_dwhpvrzpt.s[9]++;

	_index.SolutionFacade.addVariables([{ name: 'MATRIX_VALUES', expression: matrix }]);
	var LME = void 0;
	cov_dwhpvrzpt.s[10]++;
	if (modelName.includes('SCORECARDTESTMODEL')) {
		cov_dwhpvrzpt.b[2][0]++;
		cov_dwhpvrzpt.s[11]++;

		LME = new _lme.LmeAPI(_CustomImport2.default, new _index.Context({ modelName: modelName }), _index.DETAIL_INTERVAL);
	} else {
		cov_dwhpvrzpt.b[2][1]++;
		cov_dwhpvrzpt.s[12]++;

		LME = new _lme.LmeAPI(null, new _index.Context({ modelName: modelName }), null);
	}
	var rawData = (cov_dwhpvrzpt.s[13]++, (0, _fs.readFileSync)(__dirname + '/../../git-connect/resources/' + modelName + fileType, _index.ENCODING));
	cov_dwhpvrzpt.s[14]++;
	LME.importFFL(rawData);
	var lmeExport = (cov_dwhpvrzpt.s[15]++, LME.exportLME());
	var options = (cov_dwhpvrzpt.s[16]++, {
		insertGlobals: true,
		insertGlobalVars: {
			JSON_MODEL: function JSON_MODEL(file, dir) {
				cov_dwhpvrzpt.f[2]++;
				cov_dwhpvrzpt.s[17]++;

				return file.endsWith('lmeAPIWrapper.js') ? (cov_dwhpvrzpt.b[3][0]++, lmeExport) : (cov_dwhpvrzpt.b[3][1]++, 'undefined');
			}
		},
		gzip: true,
		minify: true,
		debug: false
	});
	var b = (cov_dwhpvrzpt.s[18]++, (0, _browserify2.default)(options).ignore('escodegen').ignore('esprima').ignore('log6').ignore('tracer').ignore('ast-node-utils').ignore('*ast-node-utils*'));
	cov_dwhpvrzpt.s[19]++;
	b.add(__dirname + '/../../lme-core/exchange_modules/presentation/webexport.js');
	cov_dwhpvrzpt.s[20]++;
	b.add(__dirname + '/lmeAPIWrapper.js');

	cov_dwhpvrzpt.s[21]++;
	b.transform(_babelify2.default, { presets: ['env'] });
	cov_dwhpvrzpt.s[22]++;
	b.transform(_browserifyFastjson2.default);
	var res = (cov_dwhpvrzpt.s[23]++, (0, _fs.createWriteStream)(__dirname + '/../../git-connect/resources/' + modelName + '.js'));
	cov_dwhpvrzpt.s[24]++;
	b.bundle().pipe(res);
}).catch(function (err) {
	cov_dwhpvrzpt.f[3]++;
	cov_dwhpvrzpt.s[25]++;

	(0, _log.error)(err);
	cov_dwhpvrzpt.s[26]++;
	process.exit(1);
});