'use strict';

var cov_67fn5e0a1 = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\JBehaveController.js',
	    hash = '6a56d8a6e48406f30179db762fd1618ac6322a15',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\JBehaveController.js',
		statementMap: {
			'0': {
				start: {
					line: 4,
					column: 7
				},
				end: {
					line: 9,
					column: 56
				}
			},
			'1': {
				start: {
					line: 12,
					column: 1
				},
				end: {
					line: 12,
					column: 21
				}
			},
			'2': {
				start: {
					line: 13,
					column: 1
				},
				end: {
					line: 13,
					column: 19
				}
			},
			'3': {
				start: {
					line: 14,
					column: 1
				},
				end: {
					line: 14,
					column: 33
				}
			},
			'4': {
				start: {
					line: 15,
					column: 1
				},
				end: {
					line: 15,
					column: 31
				}
			},
			'5': {
				start: {
					line: 16,
					column: 14
				},
				end: {
					line: 16,
					column: 18
				}
			},
			'6': {
				start: {
					line: 17,
					column: 1
				},
				end: {
					line: 17,
					column: 33
				}
			},
			'7': {
				start: {
					line: 19,
					column: 1
				},
				end: {
					line: 40,
					column: 2
				}
			},
			'8': {
				start: {
					line: 20,
					column: 15
				},
				end: {
					line: 20,
					column: 23
				}
			},
			'9': {
				start: {
					line: 21,
					column: 2
				},
				end: {
					line: 39,
					column: 4
				}
			},
			'10': {
				start: {
					line: 22,
					column: 3
				},
				end: {
					line: 22,
					column: 77
				}
			},
			'11': {
				start: {
					line: 23,
					column: 3
				},
				end: {
					line: 23,
					column: 49
				}
			},
			'12': {
				start: {
					line: 24,
					column: 14
				},
				end: {
					line: 24,
					column: 37
				}
			},
			'13': {
				start: {
					line: 25,
					column: 3
				},
				end: {
					line: 38,
					column: 5
				}
			},
			'14': {
				start: {
					line: 29,
					column: 4
				},
				end: {
					line: 37,
					column: 6
				}
			},
			'15': {
				start: {
					line: 30,
					column: 5
				},
				end: {
					line: 30,
					column: 42
				}
			},
			'16': {
				start: {
					line: 31,
					column: 5
				},
				end: {
					line: 31,
					column: 103
				}
			},
			'17': {
				start: {
					line: 32,
					column: 5
				},
				end: {
					line: 32,
					column: 82
				}
			},
			'18': {
				start: {
					line: 33,
					column: 5
				},
				end: {
					line: 33,
					column: 48
				}
			},
			'19': {
				start: {
					line: 34,
					column: 5
				},
				end: {
					line: 36,
					column: 6
				}
			},
			'20': {
				start: {
					line: 35,
					column: 6
				},
				end: {
					line: 35,
					column: 39
				}
			},
			'21': {
				start: {
					line: 41,
					column: 1
				},
				end: {
					line: 43,
					column: 3
				}
			},
			'22': {
				start: {
					line: 42,
					column: 2
				},
				end: {
					line: 42,
					column: 50
				}
			},
			'23': {
				start: {
					line: 44,
					column: 1
				},
				end: {
					line: 65,
					column: 2
				}
			},
			'24': {
				start: {
					line: 45,
					column: 20
				},
				end: {
					line: 45,
					column: 22
				}
			},
			'25': {
				start: {
					line: 46,
					column: 19
				},
				end: {
					line: 46,
					column: 34
				}
			},
			'26': {
				start: {
					line: 47,
					column: 2
				},
				end: {
					line: 47,
					column: 24
				}
			},
			'27': {
				start: {
					line: 48,
					column: 20
				},
				end: {
					line: 48,
					column: 118
				}
			},
			'28': {
				start: {
					line: 49,
					column: 2
				},
				end: {
					line: 57,
					column: 3
				}
			},
			'29': {
				start: {
					line: 50,
					column: 3
				},
				end: {
					line: 55,
					column: 5
				}
			},
			'30': {
				start: {
					line: 56,
					column: 3
				},
				end: {
					line: 56,
					column: 43
				}
			},
			'31': {
				start: {
					line: 58,
					column: 2
				},
				end: {
					line: 62,
					column: 3
				}
			},
			'32': {
				start: {
					line: 59,
					column: 3
				},
				end: {
					line: 61,
					column: 5
				}
			},
			'33': {
				start: {
					line: 63,
					column: 2
				},
				end: {
					line: 63,
					column: 21
				}
			},
			'34': {
				start: {
					line: 64,
					column: 2
				},
				end: {
					line: 64,
					column: 20
				}
			},
			'35': {
				start: {
					line: 68,
					column: 0
				},
				end: {
					line: 79,
					column: 1
				}
			},
			'36': {
				start: {
					line: 69,
					column: 14
				},
				end: {
					line: 69,
					column: 18
				}
			},
			'37': {
				start: {
					line: 70,
					column: 1
				},
				end: {
					line: 78,
					column: 3
				}
			},
			'38': {
				start: {
					line: 71,
					column: 2
				},
				end: {
					line: 71,
					column: 34
				}
			},
			'39': {
				start: {
					line: 73,
					column: 2
				},
				end: {
					line: 77,
					column: 3
				}
			},
			'40': {
				start: {
					line: 74,
					column: 3
				},
				end: {
					line: 74,
					column: 139
				}
			},
			'41': {
				start: {
					line: 76,
					column: 3
				},
				end: {
					line: 76,
					column: 45
				}
			}
		},
		fnMap: {
			'0': {
				name: 'JBehaveController',
				decl: {
					start: {
						line: 11,
						column: 9
					},
					end: {
						line: 11,
						column: 26
					}
				},
				loc: {
					start: {
						line: 11,
						column: 83
					},
					end: {
						line: 66,
						column: 1
					}
				},
				line: 11
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 19,
						column: 27
					},
					end: {
						line: 19,
						column: 28
					}
				},
				loc: {
					start: {
						line: 19,
						column: 38
					},
					end: {
						line: 40,
						column: 2
					}
				},
				line: 19
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 21,
						column: 13
					},
					end: {
						line: 21,
						column: 14
					}
				},
				loc: {
					start: {
						line: 21,
						column: 24
					},
					end: {
						line: 39,
						column: 3
					}
				},
				line: 21
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 28,
						column: 6
					},
					end: {
						line: 28,
						column: 7
					}
				},
				loc: {
					start: {
						line: 28,
						column: 21
					},
					end: {
						line: 38,
						column: 4
					}
				},
				line: 28
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 29,
						column: 18
					},
					end: {
						line: 29,
						column: 19
					}
				},
				loc: {
					start: {
						line: 29,
						column: 29
					},
					end: {
						line: 37,
						column: 5
					}
				},
				line: 29
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 41,
						column: 24
					},
					end: {
						line: 41,
						column: 25
					}
				},
				loc: {
					start: {
						line: 41,
						column: 36
					},
					end: {
						line: 43,
						column: 2
					}
				},
				line: 41
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 44,
						column: 25
					},
					end: {
						line: 44,
						column: 26
					}
				},
				loc: {
					start: {
						line: 44,
						column: 36
					},
					end: {
						line: 65,
						column: 2
					}
				},
				line: 44
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 49,
						column: 24
					},
					end: {
						line: 49,
						column: 25
					}
				},
				loc: {
					start: {
						line: 49,
						column: 40
					},
					end: {
						line: 57,
						column: 3
					}
				},
				line: 49
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 58,
						column: 21
					},
					end: {
						line: 58,
						column: 22
					}
				},
				loc: {
					start: {
						line: 58,
						column: 37
					},
					end: {
						line: 62,
						column: 3
					}
				},
				line: 58
			},
			'9': {
				name: '(anonymous_9)',
				decl: {
					start: {
						line: 68,
						column: 42
					},
					end: {
						line: 68,
						column: 43
					}
				},
				loc: {
					start: {
						line: 68,
						column: 63
					},
					end: {
						line: 79,
						column: 1
					}
				},
				line: 68
			},
			'10': {
				name: '(anonymous_10)',
				decl: {
					start: {
						line: 70,
						column: 45
					},
					end: {
						line: 70,
						column: 46
					}
				},
				loc: {
					start: {
						line: 70,
						column: 73
					},
					end: {
						line: 72,
						column: 2
					}
				},
				line: 70
			},
			'11': {
				name: '(anonymous_11)',
				decl: {
					start: {
						line: 72,
						column: 9
					},
					end: {
						line: 72,
						column: 10
					}
				},
				loc: {
					start: {
						line: 72,
						column: 23
					},
					end: {
						line: 78,
						column: 2
					}
				},
				line: 72
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 31,
						column: 27
					},
					end: {
						line: 31,
						column: 103
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 31,
						column: 51
					},
					end: {
						line: 31,
						column: 88
					}
				}, {
					start: {
						line: 31,
						column: 91
					},
					end: {
						line: 31,
						column: 103
					}
				}],
				line: 31
			},
			'1': {
				loc: {
					start: {
						line: 34,
						column: 5
					},
					end: {
						line: 36,
						column: 6
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 34,
						column: 5
					},
					end: {
						line: 36,
						column: 6
					}
				}, {
					start: {
						line: 34,
						column: 5
					},
					end: {
						line: 36,
						column: 6
					}
				}],
				line: 34
			},
			'2': {
				loc: {
					start: {
						line: 54,
						column: 12
					},
					end: {
						line: 54,
						column: 94
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 54,
						column: 78
					},
					end: {
						line: 54,
						column: 85
					}
				}, {
					start: {
						line: 54,
						column: 88
					},
					end: {
						line: 54,
						column: 94
					}
				}],
				line: 54
			},
			'3': {
				loc: {
					start: {
						line: 54,
						column: 12
					},
					end: {
						line: 54,
						column: 75
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 54,
						column: 12
					},
					end: {
						line: 54,
						column: 41
					}
				}, {
					start: {
						line: 54,
						column: 45
					},
					end: {
						line: 54,
						column: 75
					}
				}],
				line: 54
			},
			'4': {
				loc: {
					start: {
						line: 73,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 73,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				}, {
					start: {
						line: 73,
						column: 2
					},
					end: {
						line: 77,
						column: 3
					}
				}],
				line: 73
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0,
			'29': 0,
			'30': 0,
			'31': 0,
			'32': 0,
			'33': 0,
			'34': 0,
			'35': 0,
			'36': 0,
			'37': 0,
			'38': 0,
			'39': 0,
			'40': 0,
			'41': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.JBehaveController = undefined;

var _StoryParser = require('../../model-tests/StoryParser');

var newStoryTemplate = (cov_67fn5e0a1.s[0]++, '{model_name} Score Basic\n' + '@Author {author_name}\n' + '@themes {model_name} Score basic\n' + '\n' + 'Scenario: Verify {model_name} Score calculations\n' + 'Given a document of the model type {model_name}');

function JBehaveController($scope, $http, modelEngine, right_editor, user_session) {
	cov_67fn5e0a1.f[0]++;
	cov_67fn5e0a1.s[1]++;

	this.$scope = $scope;
	cov_67fn5e0a1.s[2]++;
	this.$http = $http;
	cov_67fn5e0a1.s[3]++;
	this.user_session = user_session;
	cov_67fn5e0a1.s[4]++;
	this.modelEngine = modelEngine;
	var self = (cov_67fn5e0a1.s[5]++, this);
	cov_67fn5e0a1.s[6]++;
	this.right_editor = right_editor;

	cov_67fn5e0a1.s[7]++;
	$scope.saveJBehaveStory = function () {
		cov_67fn5e0a1.f[1]++;

		var type = (cov_67fn5e0a1.s[8]++, '.story');
		cov_67fn5e0a1.s[9]++;
		Pace.track(function () {
			cov_67fn5e0a1.f[2]++;
			cov_67fn5e0a1.s[10]++;

			$scope.saveFeedback = 'Saving story ' + $scope.session.fflModelPath + '… ';
			cov_67fn5e0a1.s[11]++;
			$scope.saveFeedbackTitle = 'Working on it... ';
			var data = (cov_67fn5e0a1.s[12]++, right_editor.getValue());
			cov_67fn5e0a1.s[13]++;
			$.post('saveJBehaveStory/' + $scope.session.fflModelPath, {
				data: data,
				type: type
			}, function (data) {
				cov_67fn5e0a1.f[3]++;
				cov_67fn5e0a1.s[14]++;

				$scope.$apply(function () {
					cov_67fn5e0a1.f[4]++;
					cov_67fn5e0a1.s[15]++;

					$scope.saveFeedbackTitle = 'Finished';
					cov_67fn5e0a1.s[16]++;
					$scope.saveFeedback = data.status == 'fail' ? (cov_67fn5e0a1.b[0][0]++, 'Failed saving story :' + data.reason) : (cov_67fn5e0a1.b[0][1]++, 'Done work.');
					cov_67fn5e0a1.s[17]++;
					$scope.downloadJsLink = 'resources/' + $scope.session.fflModelPath + '.story';
					cov_67fn5e0a1.s[18]++;
					$scope.session.disablePreviewButton = false;
					cov_67fn5e0a1.s[19]++;
					if (data.status === 'success') {
						cov_67fn5e0a1.b[1][0]++;
						cov_67fn5e0a1.s[20]++;

						$('#modal-success').modal('hide');
					} else {
						cov_67fn5e0a1.b[1][1]++;
					}
				});
			});
		});
	};
	cov_67fn5e0a1.s[21]++;
	$('.data-story').click(function (e) {
		cov_67fn5e0a1.f[5]++;
		cov_67fn5e0a1.s[22]++;

		self.updateStory(self.user_session.fflModelPath);
	});
	cov_67fn5e0a1.s[23]++;
	$scope.runJBehaveTest = function () {
		cov_67fn5e0a1.f[6]++;

		var annotations = (cov_67fn5e0a1.s[24]++, []);
		var workbook = (cov_67fn5e0a1.s[25]++, modelEngine.lme);
		cov_67fn5e0a1.s[26]++;
		workbook.clearValues(); //Quick-fix to clear state, we should just create a copy of the current one.
		var storyParser = (cov_67fn5e0a1.s[27]++, new _StoryParser.StoryParser(self.right_editor.getValue(), self.user_session.fflModelPath + '.story', workbook));
		cov_67fn5e0a1.s[28]++;
		storyParser.message = function (event) {
			cov_67fn5e0a1.f[7]++;
			cov_67fn5e0a1.s[29]++;

			annotations.push({
				row: event.line - 1,
				column: 0,
				text: event.result.message, // Or the Json reply from the parser
				type: (cov_67fn5e0a1.b[3][0]++, event.result.status == 'fail') || (cov_67fn5e0a1.b[3][1]++, event.result.status == 'error') ? (cov_67fn5e0a1.b[2][0]++, 'error') : (cov_67fn5e0a1.b[2][1]++, 'info') // also warning and information
			});
			cov_67fn5e0a1.s[30]++;
			right_editor.setAnnotations(annotations);
		};
		cov_67fn5e0a1.s[31]++;
		storyParser.then = function (event) {
			cov_67fn5e0a1.f[8]++;
			cov_67fn5e0a1.s[32]++;

			$scope.session.messages.data.push({
				text: 'jBehave tests done ' + storyParser.results.rate().toFixed(1) + '% passed'
			});
		};
		cov_67fn5e0a1.s[33]++;
		storyParser.start();
		cov_67fn5e0a1.s[34]++;
		storyParser.call();
	};
}

cov_67fn5e0a1.s[35]++;
JBehaveController.prototype.updateStory = function (model_name) {
	cov_67fn5e0a1.f[9]++;

	var self = (cov_67fn5e0a1.s[36]++, this);
	cov_67fn5e0a1.s[37]++;
	$.get('resources/' + model_name + '.story', function (data, status, xhr) {
		cov_67fn5e0a1.f[10]++;
		cov_67fn5e0a1.s[38]++;

		self.right_editor.setValue(data);
	}).fail(function (err) {
		cov_67fn5e0a1.f[11]++;
		cov_67fn5e0a1.s[39]++;

		if (err.status == 404) {
			cov_67fn5e0a1.b[4][0]++;
			cov_67fn5e0a1.s[40]++;

			self.right_editor.setValue(newStoryTemplate.replace(/{model_name}/g, model_name).replace(/{author_name}/g, self.user_session.user.name));
		} else {
			cov_67fn5e0a1.b[4][1]++;
			cov_67fn5e0a1.s[41]++;

			self.right_editor.setValue(err.statusText);
		}
	});
};

exports.JBehaveController = JBehaveController;