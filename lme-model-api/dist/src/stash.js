'use strict';

var cov_1gvvbtr22u = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\stash.js',
	    hash = '341fde58cd00525a9f701f2b9be7d3b09253d569',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\lme-model-api\\src\\stash.js',
		statementMap: {
			'0': {
				start: {
					line: 16,
					column: 13
				},
				end: {
					line: 16,
					column: 44
				}
			},
			'1': {
				start: {
					line: 17,
					column: 28
				},
				end: {
					line: 17,
					column: 67
				}
			},
			'2': {
				start: {
					line: 18,
					column: 15
				},
				end: {
					line: 18,
					column: 80
				}
			},
			'3': {
				start: {
					line: 20,
					column: 17
				},
				end: {
					line: 20,
					column: 36
				}
			},
			'4': {
				start: {
					line: 23,
					column: 0
				},
				end: {
					line: 25,
					column: 52
				}
			},
			'5': {
				start: {
					line: 24,
					column: 12
				},
				end: {
					line: 24,
					column: 41
				}
			},
			'6': {
				start: {
					line: 25,
					column: 13
				},
				end: {
					line: 25,
					column: 51
				}
			},
			'7': {
				start: {
					line: 32,
					column: 19
				},
				end: {
					line: 32,
					column: 43
				}
			},
			'8': {
				start: {
					line: 33,
					column: 2
				},
				end: {
					line: 47,
					column: 3
				}
			},
			'9': {
				start: {
					line: 34,
					column: 3
				},
				end: {
					line: 34,
					column: 59
				}
			},
			'10': {
				start: {
					line: 35,
					column: 3
				},
				end: {
					line: 44,
					column: 4
				}
			},
			'11': {
				start: {
					line: 36,
					column: 19
				},
				end: {
					line: 36,
					column: 103
				}
			},
			'12': {
				start: {
					line: 37,
					column: 4
				},
				end: {
					line: 37,
					column: 49
				}
			},
			'13': {
				start: {
					line: 37,
					column: 23
				},
				end: {
					line: 37,
					column: 49
				}
			},
			'14': {
				start: {
					line: 38,
					column: 17
				},
				end: {
					line: 38,
					column: 23
				}
			},
			'15': {
				start: {
					line: 39,
					column: 4
				},
				end: {
					line: 39,
					column: 144
				}
			},
			'16': {
				start: {
					line: 40,
					column: 4
				},
				end: {
					line: 40,
					column: 42
				}
			},
			'17': {
				start: {
					line: 43,
					column: 4
				},
				end: {
					line: 43,
					column: 95
				}
			},
			'18': {
				start: {
					line: 46,
					column: 3
				},
				end: {
					line: 46,
					column: 90
				}
			},
			'19': {
				start: {
					line: 51,
					column: 2
				},
				end: {
					line: 73,
					column: 4
				}
			},
			'20': {
				start: {
					line: 53,
					column: 16
				},
				end: {
					line: 53,
					column: 22
				}
			},
			'21': {
				start: {
					line: 54,
					column: 3
				},
				end: {
					line: 57,
					column: 4
				}
			},
			'22': {
				start: {
					line: 55,
					column: 4
				},
				end: {
					line: 55,
					column: 123
				}
			},
			'23': {
				start: {
					line: 56,
					column: 4
				},
				end: {
					line: 56,
					column: 17
				}
			},
			'24': {
				start: {
					line: 58,
					column: 17
				},
				end: {
					line: 58,
					column: 129
				}
			},
			'25': {
				start: {
					line: 59,
					column: 3
				},
				end: {
					line: 70,
					column: 5
				}
			},
			'26': {
				start: {
					line: 60,
					column: 19
				},
				end: {
					line: 60,
					column: 40
				}
			},
			'27': {
				start: {
					line: 61,
					column: 24
				},
				end: {
					line: 61,
					column: 132
				}
			},
			'28': {
				start: {
					line: 62,
					column: 4
				},
				end: {
					line: 62,
					column: 157
				}
			},
			'29': {
				start: {
					line: 64,
					column: 22
				},
				end: {
					line: 64,
					column: 36
				}
			},
			'30': {
				start: {
					line: 65,
					column: 4
				},
				end: {
					line: 69,
					column: 5
				}
			},
			'31': {
				start: {
					line: 66,
					column: 5
				},
				end: {
					line: 66,
					column: 42
				}
			},
			'32': {
				start: {
					line: 68,
					column: 5
				},
				end: {
					line: 68,
					column: 85
				}
			},
			'33': {
				start: {
					line: 72,
					column: 3
				},
				end: {
					line: 72,
					column: 84
				}
			},
			'34': {
				start: {
					line: 82,
					column: 21
				},
				end: {
					line: 82,
					column: 23
				}
			},
			'35': {
				start: {
					line: 83,
					column: 22
				},
				end: {
					line: 83,
					column: 24
				}
			},
			'36': {
				start: {
					line: 84,
					column: 2
				},
				end: {
					line: 94,
					column: 3
				}
			},
			'37': {
				start: {
					line: 85,
					column: 3
				},
				end: {
					line: 85,
					column: 58
				}
			},
			'38': {
				start: {
					line: 87,
					column: 20
				},
				end: {
					line: 87,
					column: 80
				}
			},
			'39': {
				start: {
					line: 88,
					column: 25
				},
				end: {
					line: 88,
					column: 37
				}
			},
			'40': {
				start: {
					line: 89,
					column: 3
				},
				end: {
					line: 89,
					column: 59
				}
			},
			'41': {
				start: {
					line: 90,
					column: 3
				},
				end: {
					line: 90,
					column: 53
				}
			},
			'42': {
				start: {
					line: 93,
					column: 3
				},
				end: {
					line: 93,
					column: 41
				}
			},
			'43': {
				start: {
					line: 95,
					column: 2
				},
				end: {
					line: 141,
					column: 3
				}
			},
			'44': {
				start: {
					line: 96,
					column: 3
				},
				end: {
					line: 96,
					column: 36
				}
			},
			'45': {
				start: {
					line: 97,
					column: 3
				},
				end: {
					line: 97,
					column: 49
				}
			},
			'46': {
				start: {
					line: 98,
					column: 3
				},
				end: {
					line: 133,
					column: 4
				}
			},
			'47': {
				start: {
					line: 99,
					column: 19
				},
				end: {
					line: 99,
					column: 141
				}
			},
			'48': {
				start: {
					line: 100,
					column: 4
				},
				end: {
					line: 129,
					column: 5
				}
			},
			'49': {
				start: {
					line: 101,
					column: 5
				},
				end: {
					line: 101,
					column: 25
				}
			},
			'50': {
				start: {
					line: 102,
					column: 5
				},
				end: {
					line: 102,
					column: 102
				}
			},
			'51': {
				start: {
					line: 104,
					column: 18
				},
				end: {
					line: 104,
					column: 24
				}
			},
			'52': {
				start: {
					line: 105,
					column: 5
				},
				end: {
					line: 128,
					column: 6
				}
			},
			'53': {
				start: {
					line: 106,
					column: 6
				},
				end: {
					line: 106,
					column: 134
				}
			},
			'54': {
				start: {
					line: 107,
					column: 6
				},
				end: {
					line: 107,
					column: 93
				}
			},
			'55': {
				start: {
					line: 108,
					column: 6
				},
				end: {
					line: 108,
					column: 62
				}
			},
			'56': {
				start: {
					line: 110,
					column: 6
				},
				end: {
					line: 127,
					column: 7
				}
			},
			'57': {
				start: {
					line: 111,
					column: 18
				},
				end: {
					line: 111,
					column: 94
				}
			},
			'58': {
				start: {
					line: 112,
					column: 22
				},
				end: {
					line: 112,
					column: 43
				}
			},
			'59': {
				start: {
					line: 113,
					column: 27
				},
				end: {
					line: 113,
					column: 144
				}
			},
			'60': {
				start: {
					line: 114,
					column: 7
				},
				end: {
					line: 114,
					column: 164
				}
			},
			'61': {
				start: {
					line: 115,
					column: 7
				},
				end: {
					line: 115,
					column: 61
				}
			},
			'62': {
				start: {
					line: 117,
					column: 7
				},
				end: {
					line: 117,
					column: 17
				}
			},
			'63': {
				start: {
					line: 118,
					column: 25
				},
				end: {
					line: 118,
					column: 39
				}
			},
			'64': {
				start: {
					line: 119,
					column: 7
				},
				end: {
					line: 126,
					column: 8
				}
			},
			'65': {
				start: {
					line: 120,
					column: 8
				},
				end: {
					line: 120,
					column: 70
				}
			},
			'66': {
				start: {
					line: 122,
					column: 8
				},
				end: {
					line: 125,
					column: 9
				}
			},
			'67': {
				start: {
					line: 132,
					column: 4
				},
				end: {
					line: 132,
					column: 105
				}
			},
			'68': {
				start: {
					line: 135,
					column: 3
				},
				end: {
					line: 135,
					column: 65
				}
			},
			'69': {
				start: {
					line: 135,
					column: 14
				},
				end: {
					line: 135,
					column: 65
				}
			},
			'70': {
				start: {
					line: 136,
					column: 3
				},
				end: {
					line: 140,
					column: 4
				}
			},
			'71': {
				start: {
					line: 137,
					column: 4
				},
				end: {
					line: 137,
					column: 84
				}
			},
			'72': {
				start: {
					line: 139,
					column: 4
				},
				end: {
					line: 139,
					column: 108
				}
			},
			'73': {
				start: {
					line: 142,
					column: 2
				},
				end: {
					line: 142,
					column: 22
				}
			},
			'74': {
				start: {
					line: 146,
					column: 16
				},
				end: {
					line: 146,
					column: 81
				}
			},
			'75': {
				start: {
					line: 147,
					column: 2
				},
				end: {
					line: 163,
					column: 3
				}
			},
			'76': {
				start: {
					line: 148,
					column: 18
				},
				end: {
					line: 148,
					column: 37
				}
			},
			'77': {
				start: {
					line: 149,
					column: 3
				},
				end: {
					line: 149,
					column: 73
				}
			},
			'78': {
				start: {
					line: 151,
					column: 3
				},
				end: {
					line: 162,
					column: 4
				}
			},
			'79': {
				start: {
					line: 152,
					column: 4
				},
				end: {
					line: 152,
					column: 104
				}
			},
			'80': {
				start: {
					line: 152,
					column: 15
				},
				end: {
					line: 152,
					column: 104
				}
			},
			'81': {
				start: {
					line: 153,
					column: 4
				},
				end: {
					line: 159,
					column: 5
				}
			},
			'82': {
				start: {
					line: 154,
					column: 20
				},
				end: {
					line: 154,
					column: 61
				}
			},
			'83': {
				start: {
					line: 155,
					column: 5
				},
				end: {
					line: 155,
					column: 75
				}
			},
			'84': {
				start: {
					line: 158,
					column: 5
				},
				end: {
					line: 158,
					column: 57
				}
			},
			'85': {
				start: {
					line: 161,
					column: 4
				},
				end: {
					line: 161,
					column: 60
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 24,
						column: 6
					},
					end: {
						line: 24,
						column: 7
					}
				},
				loc: {
					start: {
						line: 24,
						column: 12
					},
					end: {
						line: 24,
						column: 41
					}
				},
				line: 24
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 25,
						column: 7
					},
					end: {
						line: 25,
						column: 8
					}
				},
				loc: {
					start: {
						line: 25,
						column: 13
					},
					end: {
						line: 25,
						column: 51
					}
				},
				line: 25
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 28,
						column: 1
					},
					end: {
						line: 28,
						column: 2
					}
				},
				loc: {
					start: {
						line: 28,
						column: 15
					},
					end: {
						line: 29,
						column: 2
					}
				},
				line: 28
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 31,
						column: 1
					},
					end: {
						line: 31,
						column: 2
					}
				},
				loc: {
					start: {
						line: 31,
						column: 36
					},
					end: {
						line: 48,
						column: 2
					}
				},
				line: 31
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 50,
						column: 1
					},
					end: {
						line: 50,
						column: 2
					}
				},
				loc: {
					start: {
						line: 50,
						column: 40
					},
					end: {
						line: 74,
						column: 2
					}
				},
				line: 50
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 52,
						column: 8
					},
					end: {
						line: 52,
						column: 9
					}
				},
				loc: {
					start: {
						line: 52,
						column: 14
					},
					end: {
						line: 71,
						column: 3
					}
				},
				line: 52
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 59,
						column: 29
					},
					end: {
						line: 59,
						column: 30
					}
				},
				loc: {
					start: {
						line: 59,
						column: 37
					},
					end: {
						line: 63,
						column: 4
					}
				},
				line: 59
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 63,
						column: 12
					},
					end: {
						line: 63,
						column: 13
					}
				},
				loc: {
					start: {
						line: 63,
						column: 21
					},
					end: {
						line: 70,
						column: 4
					}
				},
				line: 63
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 71,
						column: 11
					},
					end: {
						line: 71,
						column: 12
					}
				},
				loc: {
					start: {
						line: 71,
						column: 20
					},
					end: {
						line: 73,
						column: 3
					}
				},
				line: 71
			},
			'9': {
				name: '(anonymous_9)',
				decl: {
					start: {
						line: 76,
						column: 1
					},
					end: {
						line: 76,
						column: 2
					}
				},
				loc: {
					start: {
						line: 76,
						column: 56
					},
					end: {
						line: 143,
						column: 2
					}
				},
				line: 76
			},
			'10': {
				name: '(anonymous_10)',
				decl: {
					start: {
						line: 145,
						column: 1
					},
					end: {
						line: 145,
						column: 2
					}
				},
				loc: {
					start: {
						line: 145,
						column: 28
					},
					end: {
						line: 164,
						column: 2
					}
				},
				line: 145
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 16,
						column: 13
					},
					end: {
						line: 16,
						column: 44
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 16,
						column: 13
					},
					end: {
						line: 16,
						column: 29
					}
				}, {
					start: {
						line: 16,
						column: 33
					},
					end: {
						line: 16,
						column: 44
					}
				}],
				line: 16
			},
			'1': {
				loc: {
					start: {
						line: 17,
						column: 28
					},
					end: {
						line: 17,
						column: 67
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 17,
						column: 28
					},
					end: {
						line: 17,
						column: 59
					}
				}, {
					start: {
						line: 17,
						column: 63
					},
					end: {
						line: 17,
						column: 67
					}
				}],
				line: 17
			},
			'2': {
				loc: {
					start: {
						line: 18,
						column: 15
					},
					end: {
						line: 18,
						column: 80
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 18,
						column: 15
					},
					end: {
						line: 18,
						column: 33
					}
				}, {
					start: {
						line: 18,
						column: 38
					},
					end: {
						line: 18,
						column: 79
					}
				}],
				line: 18
			},
			'3': {
				loc: {
					start: {
						line: 37,
						column: 4
					},
					end: {
						line: 37,
						column: 49
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 37,
						column: 4
					},
					end: {
						line: 37,
						column: 49
					}
				}, {
					start: {
						line: 37,
						column: 4
					},
					end: {
						line: 37,
						column: 49
					}
				}],
				line: 37
			},
			'4': {
				loc: {
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 57,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 57,
						column: 4
					}
				}, {
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 57,
						column: 4
					}
				}],
				line: 54
			},
			'5': {
				loc: {
					start: {
						line: 65,
						column: 4
					},
					end: {
						line: 69,
						column: 5
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 65,
						column: 4
					},
					end: {
						line: 69,
						column: 5
					}
				}, {
					start: {
						line: 65,
						column: 4
					},
					end: {
						line: 69,
						column: 5
					}
				}],
				line: 65
			},
			'6': {
				loc: {
					start: {
						line: 76,
						column: 41
					},
					end: {
						line: 76,
						column: 54
					}
				},
				type: 'default-arg',
				locations: [{
					start: {
						line: 76,
						column: 48
					},
					end: {
						line: 76,
						column: 54
					}
				}],
				line: 76
			},
			'7': {
				loc: {
					start: {
						line: 99,
						column: 106
					},
					end: {
						line: 99,
						column: 138
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 99,
						column: 124
					},
					end: {
						line: 99,
						column: 130
					}
				}, {
					start: {
						line: 99,
						column: 133
					},
					end: {
						line: 99,
						column: 138
					}
				}],
				line: 99
			},
			'8': {
				loc: {
					start: {
						line: 100,
						column: 4
					},
					end: {
						line: 129,
						column: 5
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 100,
						column: 4
					},
					end: {
						line: 129,
						column: 5
					}
				}, {
					start: {
						line: 100,
						column: 4
					},
					end: {
						line: 129,
						column: 5
					}
				}],
				line: 100
			},
			'9': {
				loc: {
					start: {
						line: 105,
						column: 5
					},
					end: {
						line: 128,
						column: 6
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 105,
						column: 5
					},
					end: {
						line: 128,
						column: 6
					}
				}, {
					start: {
						line: 105,
						column: 5
					},
					end: {
						line: 128,
						column: 6
					}
				}],
				line: 105
			},
			'10': {
				loc: {
					start: {
						line: 105,
						column: 9
					},
					end: {
						line: 105,
						column: 25
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 105,
						column: 9
					},
					end: {
						line: 105,
						column: 16
					}
				}, {
					start: {
						line: 105,
						column: 20
					},
					end: {
						line: 105,
						column: 25
					}
				}],
				line: 105
			},
			'11': {
				loc: {
					start: {
						line: 119,
						column: 7
					},
					end: {
						line: 126,
						column: 8
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 119,
						column: 7
					},
					end: {
						line: 126,
						column: 8
					}
				}, {
					start: {
						line: 119,
						column: 7
					},
					end: {
						line: 126,
						column: 8
					}
				}],
				line: 119
			},
			'12': {
				loc: {
					start: {
						line: 135,
						column: 3
					},
					end: {
						line: 135,
						column: 65
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 135,
						column: 3
					},
					end: {
						line: 135,
						column: 65
					}
				}, {
					start: {
						line: 135,
						column: 3
					},
					end: {
						line: 135,
						column: 65
					}
				}],
				line: 135
			},
			'13': {
				loc: {
					start: {
						line: 136,
						column: 3
					},
					end: {
						line: 140,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 136,
						column: 3
					},
					end: {
						line: 140,
						column: 4
					}
				}, {
					start: {
						line: 136,
						column: 3
					},
					end: {
						line: 140,
						column: 4
					}
				}],
				line: 136
			},
			'14': {
				loc: {
					start: {
						line: 151,
						column: 3
					},
					end: {
						line: 162,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 151,
						column: 3
					},
					end: {
						line: 162,
						column: 4
					}
				}, {
					start: {
						line: 151,
						column: 3
					},
					end: {
						line: 162,
						column: 4
					}
				}],
				line: 151
			},
			'15': {
				loc: {
					start: {
						line: 152,
						column: 4
					},
					end: {
						line: 152,
						column: 104
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 152,
						column: 4
					},
					end: {
						line: 152,
						column: 104
					}
				}, {
					start: {
						line: 152,
						column: 4
					},
					end: {
						line: 152,
						column: 104
					}
				}],
				line: 152
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0,
			'29': 0,
			'30': 0,
			'31': 0,
			'32': 0,
			'33': 0,
			'34': 0,
			'35': 0,
			'36': 0,
			'37': 0,
			'38': 0,
			'39': 0,
			'40': 0,
			'41': 0,
			'42': 0,
			'43': 0,
			'44': 0,
			'45': 0,
			'46': 0,
			'47': 0,
			'48': 0,
			'49': 0,
			'50': 0,
			'51': 0,
			'52': 0,
			'53': 0,
			'54': 0,
			'55': 0,
			'56': 0,
			'57': 0,
			'58': 0,
			'59': 0,
			'60': 0,
			'61': 0,
			'62': 0,
			'63': 0,
			'64': 0,
			'65': 0,
			'66': 0,
			'67': 0,
			'68': 0,
			'69': 0,
			'70': 0,
			'71': 0,
			'72': 0,
			'73': 0,
			'74': 0,
			'75': 0,
			'76': 0,
			'77': 0,
			'78': 0,
			'79': 0,
			'80': 0,
			'81': 0,
			'82': 0,
			'83': 0,
			'84': 0,
			'85': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0],
			'6': [0],
			'7': [0, 0],
			'8': [0, 0],
			'9': [0, 0],
			'10': [0, 0],
			'11': [0, 0],
			'12': [0, 0],
			'13': [0, 0],
			'14': [0, 0],
			'15': [0, 0]
		},
		_coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _childProcessPromise = require('child-process-promise');

var _log = require('log6');

var _ModelStorage = require('./ModelStorage');

var _ModelStorage2 = _interopRequireDefault(_ModelStorage);

var _uuid = require('uuid4');

var _uuid2 = _interopRequireDefault(_uuid);

var _ResourceManager = require('../../git-connect/ResourceManager');

var _index = require('../../financiallanguageconverter/DatastoreCluster/index');

var _Register = require('../../lme-core/src/Register');

var _FFLToRegister = require('../../ffl/FFLToRegister');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var host = (cov_1gvvbtr22u.s[0]++, (cov_1gvvbtr22u.b[0][0]++, process.env.HOST) || (cov_1gvvbtr22u.b[0][1]++, '127.0.0.1'));
var internal_proxy_port = (cov_1gvvbtr22u.s[1]++, (cov_1gvvbtr22u.b[1][0]++, process.env.INTERNAL_PROXY_PORT) || (cov_1gvvbtr22u.b[1][1]++, 7081));
var domain = (cov_1gvvbtr22u.s[2]++, (cov_1gvvbtr22u.b[2][0]++, process.env.DOMAIN) || (cov_1gvvbtr22u.b[2][1]++, host + ':' + internal_proxy_port + '/id/guest'));

var develop = (cov_1gvvbtr22u.s[3]++, !process.env.DOMAIN);

//make git ls-files-root alias
cov_1gvvbtr22u.s[4]++;
(0, _childProcessPromise.exec)('git config --global alias.ls-files-root "! git ls-files"').then(function () {
	cov_1gvvbtr22u.f[0]++;
	cov_1gvvbtr22u.s[5]++;
	return (0, _log.debug)('Added "git ls-files"');
}).catch(function () {
	cov_1gvvbtr22u.f[1]++;
	cov_1gvvbtr22u.s[6]++;
	return (0, _log.error)('Cannot symlink "git ls-files"');
});

var Stash = function () {
	function Stash() {
		(0, _classCallCheck3.default)(this, Stash);
		cov_1gvvbtr22u.f[2]++;
	}

	(0, _createClass3.default)(Stash, [{
		key: 'preview',
		value: function () {
			var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(user_id, name, data) {
				var tempHash, result, userID;
				return _regenerator2.default.wrap(function _callee$(_context) {
					while (1) {
						switch (_context.prev = _context.next) {
							case 0:
								cov_1gvvbtr22u.f[3]++;
								tempHash = (cov_1gvvbtr22u.s[7]++, '_tmp_' + (0, _uuid2.default)() + '_' + name);
								cov_1gvvbtr22u.s[8]++;
								_context.prev = 3;
								cov_1gvvbtr22u.s[9]++;
								_context.next = 7;
								return (0, _ResourceManager.writeModelAsString)({ model_name: tempHash, data: data });

							case 7:
								cov_1gvvbtr22u.s[10]++;
								_context.prev = 8;
								cov_1gvvbtr22u.s[11]++;
								_context.next = 12;
								return (0, _childProcessPromise.exec)('node -r babel-register ' + __dirname + '/FFLWebpackConverter.js ' + tempHash);

							case 12:
								result = _context.sent;
								cov_1gvvbtr22u.s[12]++;

								if (!result.stderr) {
									_context.next = 20;
									break;
								}

								cov_1gvvbtr22u.b[3][0]++;
								cov_1gvvbtr22u.s[13]++;
								throw Error(result.stderr);

							case 20:
								cov_1gvvbtr22u.b[3][1]++;

							case 21:
								userID = (cov_1gvvbtr22u.s[14]++, (0, _uuid2.default)());
								cov_1gvvbtr22u.s[15]++;

								console.info('<span>Temporary model update:</span><a href="http://' + domain + '/scorecard.html#' + tempHash + '&' + userID + '">' + name + '</a><span></span>');
								cov_1gvvbtr22u.s[16]++;
								return _context.abrupt('return', { fail: false, hash: tempHash });

							case 28:
								_context.prev = 28;
								_context.t0 = _context['catch'](8);
								cov_1gvvbtr22u.s[17]++;
								return _context.abrupt('return', { fail: true, message: 'Failed to write or compile javascript\n ' + _context.t0.toString() });

							case 32:
								_context.next = 38;
								break;

							case 34:
								_context.prev = 34;
								_context.t1 = _context['catch'](3);
								cov_1gvvbtr22u.s[18]++;
								return _context.abrupt('return', { fail: true, message: 'Failed to write file to resources folder ' + _context.t1.stack });

							case 38:
							case 'end':
								return _context.stop();
						}
					}
				}, _callee, this, [[3, 34], [8, 28]]);
			}));

			function preview(_x, _x2, _x3) {
				return _ref.apply(this, arguments);
			}

			return preview;
		}()
	}, {
		key: 'commitJBehaveFile',
		value: function commitJBehaveFile(user_id, name, data) {
			cov_1gvvbtr22u.f[4]++;
			cov_1gvvbtr22u.s[19]++;

			return (0, _ResourceManager.writeJBehaveAsString)({ name: name, data: data }).then(function () {
				cov_1gvvbtr22u.f[5]++;

				var userID = (cov_1gvvbtr22u.s[20]++, (0, _uuid2.default)());
				cov_1gvvbtr22u.s[21]++;
				if (develop) {
					cov_1gvvbtr22u.b[4][0]++;
					cov_1gvvbtr22u.s[22]++;

					console.info('<span>Story update:</span><a href="http://' + domain + 'ide.html#' + name + '&' + userID + '">' + name + '</a><span></span>');
					cov_1gvvbtr22u.s[23]++;
					return 'Done';
				} else {
					cov_1gvvbtr22u.b[4][1]++;
				}
				var command = (cov_1gvvbtr22u.s[24]++, 'git pull &&  git commit -a -m "Story update [' + name + '] by ' + user_id + '@' + host + '" && git push && git rev-parse HEAD');
				cov_1gvvbtr22u.s[25]++;
				return (0, _childProcessPromise.exec)(command).then(function (ok) {
					cov_1gvvbtr22u.f[6]++;

					var output = (cov_1gvvbtr22u.s[26]++, ok.stdout.split('\n'));
					var stashCommit = (cov_1gvvbtr22u.s[27]++, '<a href="https://stash.topicus.nl/projects/FF/repos/fesjs/commits/' + output[output.length - 2] + '"> DIFF </a>');
					cov_1gvvbtr22u.s[28]++;
					console.info('<a href="http://' + domain + 'ide.html#' + name + '&' + userID + '"> ' + name + ' </a><span> Updated </span>' + stashCommit + '<span> By ' + user_id + '@' + host + '</span>');
				}).catch(function (err) {
					cov_1gvvbtr22u.f[7]++;

					var errorData = (cov_1gvvbtr22u.s[29]++, err.toString());
					cov_1gvvbtr22u.s[30]++;
					if (errorData.indexOf('No changes detected') > -1) {
						cov_1gvvbtr22u.b[5][0]++;
						cov_1gvvbtr22u.s[31]++;

						return 'No changes detected in file.';
					} else {
						cov_1gvvbtr22u.b[5][1]++;
						cov_1gvvbtr22u.s[32]++;

						throw Error('GIT commit failed while pushing file to repository:[' + errorData + ']');
					}
				});
			}).catch(function (err) {
				cov_1gvvbtr22u.f[8]++;
				cov_1gvvbtr22u.s[33]++;

				throw Error('Failed to write file to resources folder. [' + err.toString() + ']');
			});
		}
	}, {
		key: 'commit',
		value: function () {
			var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(user_id, model_name, data) {
				var type = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_1gvvbtr22u.b[6][0]++, '.ffl');
				var delta_result, method_result, contract, modelRegister, result, userID, ok, output, stashCommit, errorData;
				return _regenerator2.default.wrap(function _callee2$(_context2) {
					while (1) {
						switch (_context2.prev = _context2.next) {
							case 0:
								cov_1gvvbtr22u.f[9]++;

								/*
         * Save delta's to the DB to keep track of history.
         * Later this will be used to resolve the FFL
         * The FFL file will always be pushed to master also
         */
								delta_result = (cov_1gvvbtr22u.s[34]++, {});
								method_result = (cov_1gvvbtr22u.s[35]++, {});
								cov_1gvvbtr22u.s[36]++;
								_context2.prev = 4;
								cov_1gvvbtr22u.s[37]++;

								delta_result = _ModelStorage2.default.saveDelta(model_name, data);

								contract = (cov_1gvvbtr22u.s[38]++, new _index.Contractor({ auth_id: model_name, data_id: model_name }));
								modelRegister = (cov_1gvvbtr22u.s[39]++, new _Register.Register());
								cov_1gvvbtr22u.s[40]++;

								new _FFLToRegister.FFLToRegister(modelRegister, data).parseProperties();
								cov_1gvvbtr22u.s[41]++;
								_context2.next = 14;
								return contract.applyContractChanges(modelRegister);

							case 14:
								_context2.next = 20;
								break;

							case 16:
								_context2.prev = 16;
								_context2.t0 = _context2['catch'](4);
								cov_1gvvbtr22u.s[42]++;

								(0, _log.warn)('Failed saving delta to DB', _context2.t0);

							case 20:
								cov_1gvvbtr22u.s[43]++;
								_context2.prev = 21;
								cov_1gvvbtr22u.s[44]++;
								_context2.next = 25;
								return (0, _ResourceManager.clean_resources_workspace)();

							case 25:
								cov_1gvvbtr22u.s[45]++;
								_context2.next = 28;
								return (0, _ResourceManager.writeModelAsString)({ model_name: model_name, data: data });

							case 28:
								cov_1gvvbtr22u.s[46]++;
								_context2.prev = 29;
								cov_1gvvbtr22u.s[47]++;
								_context2.next = 33;
								return (0, _childProcessPromise.exec)('node -r babel-register ' + __dirname + '/FFLWebpackConverter.js ' + model_name + ' ' + (type === '.ffl' ? (cov_1gvvbtr22u.b[7][0]++, 'FFL2') : (cov_1gvvbtr22u.b[7][1]++, 'FFL')));

							case 33:
								result = _context2.sent;
								cov_1gvvbtr22u.s[48]++;

								if (!result.stderr) {
									_context2.next = 43;
									break;
								}

								cov_1gvvbtr22u.b[8][0]++;
								cov_1gvvbtr22u.s[49]++;

								(0, _log.error)(result.stderr);
								cov_1gvvbtr22u.s[50]++;
								method_result = { fail: true, message: 'Failed to compile javascript because: ' + result.stderr };
								_context2.next = 86;
								break;

							case 43:
								cov_1gvvbtr22u.b[8][1]++;
								userID = (cov_1gvvbtr22u.s[51]++, (0, _uuid2.default)());
								cov_1gvvbtr22u.s[52]++;

								if (!((cov_1gvvbtr22u.b[10][0]++, develop) && (cov_1gvvbtr22u.b[10][1]++, false))) {
									_context2.next = 56;
									break;
								}

								cov_1gvvbtr22u.b[9][0]++;
								cov_1gvvbtr22u.s[53]++;

								console.info('<span>ffl model update:</span><a href="http://' + domain + '/#' + model_name + '&' + userID + '">' + model_name + '</a><span></span>');
								cov_1gvvbtr22u.s[54]++;
								(0, _log.info)('[' + user_id + '] modified model file: [' + model_name + ']. Begin pushing to repository.'); //=> '/tmp/foo'
								cov_1gvvbtr22u.s[55]++;
								method_result = { fail: false, message: 'develop mode' };
								_context2.next = 86;
								break;

							case 56:
								cov_1gvvbtr22u.b[9][1]++;
								cov_1gvvbtr22u.s[56]++;
								_context2.prev = 58;
								cov_1gvvbtr22u.s[57]++;
								_context2.next = 62;
								return (0, _ResourceManager.commit_resources)('Model update [' + model_name + '] by ' + user_id + '@' + host);

							case 62:
								ok = _context2.sent;
								output = (cov_1gvvbtr22u.s[58]++, ok.stdout.split('\n'));
								stashCommit = (cov_1gvvbtr22u.s[59]++, '<a href="https://stash.topicus.nl/projects/FF/repos/financialmodel/commits/' + output[output.length - 2] + '"> DIFF </a>');
								cov_1gvvbtr22u.s[60]++;

								console.info('<a href="http://' + domain + '#' + model_name + '&' + userID + '"> ' + model_name + ' </a><span> Updated </span>' + stashCommit + '<span> By ' + user_id + '@' + host + '</span>');
								cov_1gvvbtr22u.s[61]++;
								method_result = { fail: false, changes: delta_result };
								_context2.next = 86;
								break;

							case 71:
								_context2.prev = 71;
								_context2.t1 = _context2['catch'](58);
								cov_1gvvbtr22u.s[62]++;

								(0, _log.error)(_context2.t1);
								errorData = (cov_1gvvbtr22u.s[63]++, _context2.t1.toString());
								cov_1gvvbtr22u.s[64]++;

								if (!errorData.includes('No changes detected')) {
									_context2.next = 83;
									break;
								}

								cov_1gvvbtr22u.b[11][0]++;
								cov_1gvvbtr22u.s[65]++;
								return _context2.abrupt('return', { fail: true, message: 'No changes detected in file.' });

							case 83:
								cov_1gvvbtr22u.b[11][1]++;
								cov_1gvvbtr22u.s[66]++;

								method_result = {
									fail: true,
									message: 'GIT commit failed while pushing file to repository:[' + errorData + ']'
								};

							case 86:
								_context2.next = 92;
								break;

							case 88:
								_context2.prev = 88;
								_context2.t2 = _context2['catch'](29);
								cov_1gvvbtr22u.s[67]++;

								method_result = { fail: true, message: 'Failed to write or compile javascript. [' + _context2.t2.toString() + ']' };

							case 92:
								_context2.next = 100;
								break;

							case 94:
								_context2.prev = 94;
								_context2.t3 = _context2['catch'](21);
								cov_1gvvbtr22u.s[68]++;

								if (_log.DEBUG) {
										cov_1gvvbtr22u.b[12][0]++;
										cov_1gvvbtr22u.s[69]++;
										(0, _log.debug)('Failed to connect to git-repo ' + _context2.t3.stack);
									} else {
									cov_1gvvbtr22u.b[12][1]++;
								}cov_1gvvbtr22u.s[70]++;
								if (_context2.t3.toString().includes('Connection timed out')) {
									cov_1gvvbtr22u.b[13][0]++;
									cov_1gvvbtr22u.s[71]++;

									method_result = { fail: true, message: 'Unable to connect to model repository' };
								} else {
									cov_1gvvbtr22u.b[13][1]++;
									cov_1gvvbtr22u.s[72]++;

									method_result = { fail: true, message: 'Failed to write file to resources folder. [' + _context2.t3.toString() + ']' };
								}

							case 100:
								cov_1gvvbtr22u.s[73]++;
								return _context2.abrupt('return', method_result);

							case 102:
							case 'end':
								return _context2.stop();
						}
					}
				}, _callee2, this, [[4, 16], [21, 94], [29, 88], [58, 71]]);
			}));

			function commit(_x4, _x5, _x6) {
				return _ref2.apply(this, arguments);
			}

			return commit;
		}()
	}, {
		key: 'models',
		value: function () {
			var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(branch, path) {
				var command, result, _result;

				return _regenerator2.default.wrap(function _callee3$(_context3) {
					while (1) {
						switch (_context3.prev = _context3.next) {
							case 0:
								cov_1gvvbtr22u.f[10]++;
								command = (cov_1gvvbtr22u.s[74]++, 'cd ' + _ResourceManager.FILE_SYSTEM_RESOURCES_PATH + ' && git ls-files-root *.' + path);
								cov_1gvvbtr22u.s[75]++;
								_context3.prev = 3;
								cov_1gvvbtr22u.s[76]++;
								_context3.next = 7;
								return (0, _childProcessPromise.exec)(command);

							case 7:
								result = _context3.sent;
								cov_1gvvbtr22u.s[77]++;
								return _context3.abrupt('return', result.stdout.replace(/.*[\/\\](.*)\.ffl/gmi, '$1').split('\n'));

							case 12:
								_context3.prev = 12;
								_context3.t0 = _context3['catch'](3);
								cov_1gvvbtr22u.s[78]++;

								if (!(_context3.t0.code === 1)) {
									_context3.next = 35;
									break;
								}

								cov_1gvvbtr22u.b[14][0]++;
								cov_1gvvbtr22u.s[79]++;

								if (_log.DEBUG) {
										cov_1gvvbtr22u.b[15][0]++;
										cov_1gvvbtr22u.s[80]++;
										(0, _log.debug)('while requesting ffl-models, cannot connect to remote git, falling back to local');
									} else {
									cov_1gvvbtr22u.b[15][1]++;
								}cov_1gvvbtr22u.s[81]++;
								_context3.prev = 20;
								cov_1gvvbtr22u.s[82]++;
								_context3.next = 24;
								return (0, _childProcessPromise.exec)('git ls-files-root *.' + path);

							case 24:
								_result = _context3.sent;
								cov_1gvvbtr22u.s[83]++;
								return _context3.abrupt('return', _result.stdout.replace(/.*[\/\\](.*)\.ffl/gmi, '$1').split('\n'));

							case 29:
								_context3.prev = 29;
								_context3.t1 = _context3['catch'](20);
								cov_1gvvbtr22u.s[84]++;
								throw Error('Cannot list files at all ' + _context3.t1.stack);

							case 33:
								_context3.next = 38;
								break;

							case 35:
								cov_1gvvbtr22u.b[14][1]++;
								cov_1gvvbtr22u.s[85]++;
								throw Error('Failed to read local models. ' + _context3.t0.stack);

							case 38:
							case 'end':
								return _context3.stop();
						}
					}
				}, _callee3, this, [[3, 12], [20, 29]]);
			}));

			function models(_x8, _x9) {
				return _ref3.apply(this, arguments);
			}

			return models;
		}()
	}]);
	return Stash;
}();

exports.default = new Stash();