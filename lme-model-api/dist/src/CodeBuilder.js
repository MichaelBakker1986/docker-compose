'use strict';

var cov_111isxeps2 = function () {
	var path = 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-model-api\\src\\CodeBuilder.js',
	    hash = '1e5de8acba760b94792ba36d4c8e23d1111754d0',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-model-api\\src\\CodeBuilder.js',
		statementMap: {
			'0': {
				start: {
					line: 5,
					column: 18
				},
				end: {
					line: 5,
					column: 32
				}
			},
			'1': {
				start: {
					line: 6,
					column: 18
				},
				end: {
					line: 6,
					column: 20
				}
			},
			'2': {
				start: {
					line: 13,
					column: 19
				},
				end: {
					line: 13,
					column: 42
				}
			},
			'3': {
				start: {
					line: 14,
					column: 19
				},
				end: {
					line: 14,
					column: 49
				}
			},
			'4': {
				start: {
					line: 16,
					column: 2
				},
				end: {
					line: 21,
					column: 4
				}
			},
			'5': {
				start: {
					line: 17,
					column: 3
				},
				end: {
					line: 20,
					column: 5
				}
			},
			'6': {
				start: {
					line: 18,
					column: 4
				},
				end: {
					line: 19,
					column: 80
				}
			},
			'7': {
				start: {
					line: 18,
					column: 13
				},
				end: {
					line: 18,
					column: 24
				}
			},
			'8': {
				start: {
					line: 19,
					column: 9
				},
				end: {
					line: 19,
					column: 80
				}
			},
			'9': {
				start: {
					line: 25,
					column: 19
				},
				end: {
					line: 25,
					column: 42
				}
			},
			'10': {
				start: {
					line: 26,
					column: 17
				},
				end: {
					line: 26,
					column: 36
				}
			},
			'11': {
				start: {
					line: 27,
					column: 2
				},
				end: {
					line: 56,
					column: 3
				}
			},
			'12': {
				start: {
					line: 28,
					column: 3
				},
				end: {
					line: 53,
					column: 5
				}
			},
			'13': {
				start: {
					line: 54,
					column: 3
				},
				end: {
					line: 54,
					column: 40
				}
			},
			'14': {
				start: {
					line: 55,
					column: 3
				},
				end: {
					line: 55,
					column: 33
				}
			},
			'15': {
				start: {
					line: 57,
					column: 2
				},
				end: {
					line: 57,
					column: 28
				}
			},
			'16': {
				start: {
					line: 61,
					column: 2
				},
				end: {
					line: 61,
					column: 39
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 9,
						column: 1
					},
					end: {
						line: 9,
						column: 2
					}
				},
				loc: {
					start: {
						line: 9,
						column: 15
					},
					end: {
						line: 10,
						column: 2
					}
				},
				line: 9
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 12,
						column: 1
					},
					end: {
						line: 12,
						column: 2
					}
				},
				loc: {
					start: {
						line: 12,
						column: 23
					},
					end: {
						line: 22,
						column: 2
					}
				},
				line: 12
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 16,
						column: 21
					},
					end: {
						line: 16,
						column: 22
					}
				},
				loc: {
					start: {
						line: 16,
						column: 41
					},
					end: {
						line: 21,
						column: 3
					}
				},
				line: 16
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 17,
						column: 16
					},
					end: {
						line: 17,
						column: 17
					}
				},
				loc: {
					start: {
						line: 17,
						column: 32
					},
					end: {
						line: 20,
						column: 4
					}
				},
				line: 17
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 24,
						column: 1
					},
					end: {
						line: 24,
						column: 2
					}
				},
				loc: {
					start: {
						line: 24,
						column: 27
					},
					end: {
						line: 58,
						column: 2
					}
				},
				line: 24
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 60,
						column: 1
					},
					end: {
						line: 60,
						column: 2
					}
				},
				loc: {
					start: {
						line: 60,
						column: 23
					},
					end: {
						line: 62,
						column: 2
					}
				},
				line: 60
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 18,
						column: 4
					},
					end: {
						line: 19,
						column: 80
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 18,
						column: 4
					},
					end: {
						line: 19,
						column: 80
					}
				}, {
					start: {
						line: 18,
						column: 4
					},
					end: {
						line: 19,
						column: 80
					}
				}],
				line: 18
			},
			'1': {
				loc: {
					start: {
						line: 27,
						column: 2
					},
					end: {
						line: 56,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 27,
						column: 2
					},
					end: {
						line: 56,
						column: 3
					}
				}, {
					start: {
						line: 27,
						column: 2
					},
					end: {
						line: 56,
						column: 3
					}
				}],
				line: 27
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.CodeBuilder = undefined;

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _memoryFs = require('memory-fs');

var _memoryFs2 = _interopRequireDefault(_memoryFs);

var _webpack = require('webpack');

var _webpack2 = _interopRequireDefault(_webpack);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var memory_fs = (cov_111isxeps2.s[0]++, new _memoryFs2.default());
var compilers = (cov_111isxeps2.s[1]++, {});

var CodeBuilder = exports.CodeBuilder = function () {
	function CodeBuilder() {
		(0, _classCallCheck3.default)(this, CodeBuilder);
		cov_111isxeps2.f[0]++;
	}

	(0, _createClass3.default)(CodeBuilder, [{
		key: 'build',
		value: function () {
			var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(filename) {
				var basename, compiler;
				return _regenerator2.default.wrap(function _callee$(_context) {
					while (1) {
						switch (_context.prev = _context.next) {
							case 0:
								cov_111isxeps2.f[1]++;
								basename = (cov_111isxeps2.s[2]++, _path2.default.basename(filename));
								compiler = (cov_111isxeps2.s[3]++, this.resolveCompiler(filename));
								cov_111isxeps2.s[4]++;
								return _context.abrupt('return', new Promise(function (accept, reject) {
									cov_111isxeps2.f[2]++;
									cov_111isxeps2.s[5]++;

									compiler.run(function (err, stats) {
										cov_111isxeps2.f[3]++;
										cov_111isxeps2.s[6]++;

										if (err) {
												cov_111isxeps2.b[0][0]++;
												cov_111isxeps2.s[7]++;
												reject(err);
											} else {
												cov_111isxeps2.b[0][1]++;
												cov_111isxeps2.s[8]++;
												accept(memory_fs.readFileSync(__dirname + '/dist/' + basename, 'utf8'));
											}
									});
								}));

							case 5:
							case 'end':
								return _context.stop();
						}
					}
				}, _callee, this);
			}));

			function build(_x) {
				return _ref.apply(this, arguments);
			}

			return build;
		}()
	}, {
		key: 'resolveCompiler',
		value: function resolveCompiler(filename) {
			cov_111isxeps2.f[4]++;

			var basename = (cov_111isxeps2.s[9]++, _path2.default.basename(filename));
			var compiler = (cov_111isxeps2.s[10]++, compilers[filename]);
			cov_111isxeps2.s[11]++;
			if (!compiler) {
				cov_111isxeps2.b[1][0]++;
				cov_111isxeps2.s[12]++;

				compiler = (0, _webpack2.default)({
					context: __dirname + './',
					entry: [filename],
					mode: 'development',
					node: {
						fs: 'empty',
						child_process: 'empty'
					},
					output: {
						publicPath: 'http://localhost:10500/',
						path: _path2.default.resolve(__dirname, './dist'),
						filename: basename
					},
					module: {
						rules: [{
							test: /\.js$/,
							include: [_path2.default.join(__dirname, 'client')],
							exclude: /node_modules/,
							loader: 'babel-loader'
						}]
					},
					plugins: [new _webpack2.default.NamedModulesPlugin(), new _webpack2.default.NoEmitOnErrorsPlugin()]
				});
				cov_111isxeps2.s[13]++;
				compiler.outputFileSystem = memory_fs;
				cov_111isxeps2.s[14]++;
				compilers[filename] = compiler;
			} else {
				cov_111isxeps2.b[1][1]++;
			}
			cov_111isxeps2.s[15]++;
			return compilers[filename];
		}
	}, {
		key: 'getCompiler',
		value: function getCompiler(filename) {
			cov_111isxeps2.f[5]++;
			cov_111isxeps2.s[16]++;

			return this.resolveCompiler(filename);
		}
	}]);
	return CodeBuilder;
}();