Facility_tpLiquiditySpreadRepaymentAnnuity =
SumFor(
	X,
	1 + Facility_tpGracePeriodInPeriods,
	Facility_tpNumberOfPeriodsNoGrace,
	1,
	PPMT(
		Facility_tpAnnuityInterestRate / Facility_tpRepaymentFrequency,
		X - Facility_tpGracePeriodInPeriods,
		Facility_tpNumberOfPeriods,
		INV(
			Facility_tpPrincipalLimit
		),
		Facility_tpBalloon
	) * (
		X * Facility_tpConvertToMonths / Facility_tpRepaymentFrequencyLiqSpread
) * (
		MatrixLookup(
			If(
				Facility_tpBaseCurrency = "EUR",
				"LiquidityPremiumEUR",
				If(
					Facility_tpBaseCurrency = "GBP",
					"LiquidityPremiumGBP",
					If(
						Facility_tpBaseCurrency = "USD",
						"LiquidityPremiumUSD",
						"LiquidityPremiumOther"
					)
				)
			),
			MatrixLookup(
				"LiquidityPremiumTenorLowerBound",
				X * 12 / Facility_tpRepaymentFrequency,
				1
			),
			Facility_tpFixedInterestPeriod
		) + (
			MatrixLookup(
				If(
					Facility_tpBaseCurrency = "EUR",
					"LiquidityPremiumEUR",
					If(
						Facility_tpBaseCurrency = "GBP",
						"LiquidityPremiumGBP",
						If(
							Facility_tpBaseCurrency = "USD",
							"LiquidityPremiumUSD",
							"LiquidityPremiumOther"
						)
					)
				),
				MatrixLookup(
					"LiquidityPremiumTenorUpperBound",
					X * 12 / Facility_tpRepaymentFrequency,
					1
				),
				Facility_tpFixedInterestPeriod
			) -
			MatrixLookup(
				If(
					Facility_tpBaseCurrency = "EUR",
					"LiquidityPremiumEUR",
					If(
						Facility_tpBaseCurrency = "GBP",
						"LiquidityPremiumGBP",
						If(
							Facility_tpBaseCurrency = "USD",
							"LiquidityPremiumUSD",
							"LiquidityPremiumOther"
						)
					)
				),
				MatrixLookup(
					"LiquidityPremiumTenorLowerBound",
					X * 12 / Facility_tpRepaymentFrequency,
					1
				),
				Facility_tpFixedInterestPeriod
			)
) *
		OnER(
			(
				(
					X * 12 / Facility_tpRepaymentFrequency -
					MatrixLookup(
						"LiquidityPremiumTenorLowerBound",
						X * 12 / Facility_tpRepaymentFrequency,
						1
					)
) / (
					MatrixLookup(
						"LiquidityPremiumTenorUpperBound",
						X * 12 / Facility_tpRepaymentFrequency,
						1
					) -
					MatrixLookup(
						"LiquidityPremiumTenorLowerBound",
						X * 12 / Facility_tpRepaymentFrequency,
						1
					)
)
),
			0
		)
)
)