'use strict';

var cov_9jxq1ombk = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\lme-core\\src\\FunctionMap.js',
	    hash = '92311452ab07877b7ee48f2fea687ab4943814a8',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\lme-core\\src\\FunctionMap.js',
		statementMap: {
			'0': {
				start: {
					line: 19,
					column: 0
				},
				end: {
					line: 24,
					column: 1
				}
			},
			'1': {
				start: {
					line: 22,
					column: 12
				},
				end: {
					line: 22,
					column: 39
				}
			},
			'2': {
				start: {
					line: 23,
					column: 1
				},
				end: {
					line: 23,
					column: 36
				}
			},
			'3': {
				start: {
					line: 25,
					column: 0
				},
				end: {
					line: 32,
					column: 1
				}
			},
			'4': {
				start: {
					line: 26,
					column: 12
				},
				end: {
					line: 26,
					column: 39
				}
			},
			'5': {
				start: {
					line: 27,
					column: 1
				},
				end: {
					line: 31,
					column: 63
				}
			},
			'6': {
				start: {
					line: 28,
					column: 15
				},
				end: {
					line: 28,
					column: 34
				}
			},
			'7': {
				start: {
					line: 29,
					column: 2
				},
				end: {
					line: 29,
					column: 21
				}
			},
			'8': {
				start: {
					line: 31,
					column: 6
				},
				end: {
					line: 31,
					column: 63
				}
			},
			'9': {
				start: {
					line: 31,
					column: 17
				},
				end: {
					line: 31,
					column: 63
				}
			},
			'10': {
				start: {
					line: 40,
					column: 0
				},
				end: {
					line: 54,
					column: 1
				}
			},
			'11': {
				start: {
					line: 41,
					column: 12
				},
				end: {
					line: 41,
					column: 45
				}
			},
			'12': {
				start: {
					line: 42,
					column: 24
				},
				end: {
					line: 42,
					column: 104
				}
			},
			'13': {
				start: {
					line: 47,
					column: 21
				},
				end: {
					line: 47,
					column: 86
				}
			},
			'14': {
				start: {
					line: 48,
					column: 1
				},
				end: {
					line: 48,
					column: 81
				}
			},
			'15': {
				start: {
					line: 48,
					column: 30
				},
				end: {
					line: 48,
					column: 81
				}
			},
			'16': {
				start: {
					line: 50,
					column: 28
				},
				end: {
					line: 50,
					column: 98
				}
			},
			'17': {
				start: {
					line: 52,
					column: 1
				},
				end: {
					line: 53,
					column: 34
				}
			},
			'18': {
				start: {
					line: 52,
					column: 28
				},
				end: {
					line: 52,
					column: 98
				}
			},
			'19': {
				start: {
					line: 53,
					column: 6
				},
				end: {
					line: 53,
					column: 34
				}
			},
			'20': {
				start: {
					line: 62,
					column: 21
				},
				end: {
					line: 86,
					column: 1
				}
			},
			'21': {
				start: {
					line: 64,
					column: 20
				},
				end: {
					line: 64,
					column: 40
				}
			},
			'22': {
				start: {
					line: 65,
					column: 18
				},
				end: {
					line: 65,
					column: 37
				}
			},
			'23': {
				start: {
					line: 66,
					column: 22
				},
				end: {
					line: 66,
					column: 71
				}
			},
			'24': {
				start: {
					line: 67,
					column: 18
				},
				end: {
					line: 67,
					column: 50
				}
			},
			'25': {
				start: {
					line: 68,
					column: 12
				},
				end: {
					line: 68,
					column: 30
				}
			},
			'26': {
				start: {
					line: 70,
					column: 1
				},
				end: {
					line: 70,
					column: 128
				}
			},
			'27': {
				start: {
					line: 71,
					column: 1
				},
				end: {
					line: 85,
					column: 2
				}
			},
			'28': {
				start: {
					line: 72,
					column: 21
				},
				end: {
					line: 72,
					column: 27
				}
			},
			'29': {
				start: {
					line: 72,
					column: 39
				},
				end: {
					line: 72,
					column: 41
				}
			},
			'30': {
				start: {
					line: 74,
					column: 2
				},
				end: {
					line: 80,
					column: 3
				}
			},
			'31': {
				start: {
					line: 75,
					column: 3
				},
				end: {
					line: 75,
					column: 36
				}
			},
			'32': {
				start: {
					line: 77,
					column: 3
				},
				end: {
					line: 77,
					column: 18
				}
			},
			'33': {
				start: {
					line: 78,
					column: 3
				},
				end: {
					line: 78,
					column: 27
				}
			},
			'34': {
				start: {
					line: 79,
					column: 3
				},
				end: {
					line: 79,
					column: 13
				}
			},
			'35': {
				start: {
					line: 83,
					column: 2
				},
				end: {
					line: 83,
					column: 182
				}
			},
			'36': {
				start: {
					line: 84,
					column: 2
				},
				end: {
					line: 84,
					column: 14
				}
			},
			'37': {
				start: {
					line: 90,
					column: 26
				},
				end: {
					line: 108,
					column: 1
				}
			},
			'38': {
				start: {
					line: 92,
					column: 50
				},
				end: {
					line: 92,
					column: 63
				}
			},
			'39': {
				start: {
					line: 100,
					column: 2
				},
				end: {
					line: 106,
					column: 3
				}
			},
			'40': {
				start: {
					line: 101,
					column: 3
				},
				end: {
					line: 101,
					column: 25
				}
			},
			'41': {
				start: {
					line: 101,
					column: 16
				},
				end: {
					line: 101,
					column: 25
				}
			},
			'42': {
				start: {
					line: 102,
					column: 16
				},
				end: {
					line: 102,
					column: 35
				}
			},
			'43': {
				start: {
					line: 104,
					column: 3
				},
				end: {
					line: 104,
					column: 65
				}
			},
			'44': {
				start: {
					line: 104,
					column: 27
				},
				end: {
					line: 104,
					column: 65
				}
			},
			'45': {
				start: {
					line: 105,
					column: 3
				},
				end: {
					line: 105,
					column: 20
				}
			}
		},
		fnMap: {
			'0': {
				name: 'Fm',
				decl: {
					start: {
						line: 15,
						column: 9
					},
					end: {
						line: 15,
						column: 11
					}
				},
				loc: {
					start: {
						line: 15,
						column: 14
					},
					end: {
						line: 16,
						column: 1
					}
				},
				line: 15
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 19,
						column: 22
					},
					end: {
						line: 19,
						column: 23
					}
				},
				loc: {
					start: {
						line: 19,
						column: 57
					},
					end: {
						line: 24,
						column: 1
					}
				},
				line: 19
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 25,
						column: 22
					},
					end: {
						line: 25,
						column: 23
					}
				},
				loc: {
					start: {
						line: 25,
						column: 54
					},
					end: {
						line: 32,
						column: 1
					}
				},
				line: 25
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 40,
						column: 33
					},
					end: {
						line: 40,
						column: 34
					}
				},
				loc: {
					start: {
						line: 40,
						column: 71
					},
					end: {
						line: 54,
						column: 1
					}
				},
				line: 40
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 62,
						column: 21
					},
					end: {
						line: 62,
						column: 22
					}
				},
				loc: {
					start: {
						line: 62,
						column: 83
					},
					end: {
						line: 86,
						column: 1
					}
				},
				line: 62
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 71,
						column: 8
					},
					end: {
						line: 71,
						column: 9
					}
				},
				loc: {
					start: {
						line: 71,
						column: 19
					},
					end: {
						line: 85,
						column: 2
					}
				},
				line: 71
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 92,
						column: 18
					},
					end: {
						line: 92,
						column: 19
					}
				},
				loc: {
					start: {
						line: 92,
						column: 50
					},
					end: {
						line: 92,
						column: 63
					}
				},
				line: 92
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 95,
						column: 18
					},
					end: {
						line: 95,
						column: 19
					}
				},
				loc: {
					start: {
						line: 95,
						column: 59
					},
					end: {
						line: 107,
						column: 2
					}
				},
				line: 95
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 100,
						column: 9
					},
					end: {
						line: 100,
						column: 10
					}
				},
				loc: {
					start: {
						line: 100,
						column: 31
					},
					end: {
						line: 106,
						column: 3
					}
				},
				line: 100
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 22,
						column: 12
					},
					end: {
						line: 22,
						column: 39
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 22,
						column: 12
					},
					end: {
						line: 22,
						column: 22
					}
				}, {
					start: {
						line: 22,
						column: 26
					},
					end: {
						line: 22,
						column: 39
					}
				}],
				line: 22
			},
			'1': {
				loc: {
					start: {
						line: 26,
						column: 12
					},
					end: {
						line: 26,
						column: 39
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 26,
						column: 12
					},
					end: {
						line: 26,
						column: 22
					}
				}, {
					start: {
						line: 26,
						column: 26
					},
					end: {
						line: 26,
						column: 39
					}
				}],
				line: 26
			},
			'2': {
				loc: {
					start: {
						line: 27,
						column: 1
					},
					end: {
						line: 31,
						column: 63
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 27,
						column: 1
					},
					end: {
						line: 31,
						column: 63
					}
				}, {
					start: {
						line: 27,
						column: 1
					},
					end: {
						line: 31,
						column: 63
					}
				}],
				line: 27
			},
			'3': {
				loc: {
					start: {
						line: 31,
						column: 6
					},
					end: {
						line: 31,
						column: 63
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 31,
						column: 6
					},
					end: {
						line: 31,
						column: 63
					}
				}, {
					start: {
						line: 31,
						column: 6
					},
					end: {
						line: 31,
						column: 63
					}
				}],
				line: 31
			},
			'4': {
				loc: {
					start: {
						line: 41,
						column: 12
					},
					end: {
						line: 41,
						column: 45
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 41,
						column: 12
					},
					end: {
						line: 41,
						column: 25
					}
				}, {
					start: {
						line: 41,
						column: 29
					},
					end: {
						line: 41,
						column: 45
					}
				}],
				line: 41
			},
			'5': {
				loc: {
					start: {
						line: 47,
						column: 30
					},
					end: {
						line: 47,
						column: 69
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 47,
						column: 30
					},
					end: {
						line: 47,
						column: 47
					}
				}, {
					start: {
						line: 47,
						column: 51
					},
					end: {
						line: 47,
						column: 69
					}
				}],
				line: 47
			},
			'6': {
				loc: {
					start: {
						line: 48,
						column: 1
					},
					end: {
						line: 48,
						column: 81
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 48,
						column: 1
					},
					end: {
						line: 48,
						column: 81
					}
				}, {
					start: {
						line: 48,
						column: 1
					},
					end: {
						line: 48,
						column: 81
					}
				}],
				line: 48
			},
			'7': {
				loc: {
					start: {
						line: 52,
						column: 1
					},
					end: {
						line: 53,
						column: 34
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 52,
						column: 1
					},
					end: {
						line: 53,
						column: 34
					}
				}, {
					start: {
						line: 52,
						column: 1
					},
					end: {
						line: 53,
						column: 34
					}
				}],
				line: 52
			},
			'8': {
				loc: {
					start: {
						line: 83,
						column: 61
					},
					end: {
						line: 83,
						column: 97
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 83,
						column: 61
					},
					end: {
						line: 83,
						column: 81
					}
				}, {
					start: {
						line: 83,
						column: 85
					},
					end: {
						line: 83,
						column: 97
					}
				}],
				line: 83
			},
			'9': {
				loc: {
					start: {
						line: 83,
						column: 101
					},
					end: {
						line: 83,
						column: 134
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 83,
						column: 101
					},
					end: {
						line: 83,
						column: 118
					}
				}, {
					start: {
						line: 83,
						column: 122
					},
					end: {
						line: 83,
						column: 134
					}
				}],
				line: 83
			},
			'10': {
				loc: {
					start: {
						line: 101,
						column: 3
					},
					end: {
						line: 101,
						column: 25
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 101,
						column: 3
					},
					end: {
						line: 101,
						column: 25
					}
				}, {
					start: {
						line: 101,
						column: 3
					},
					end: {
						line: 101,
						column: 25
					}
				}],
				line: 101
			},
			'11': {
				loc: {
					start: {
						line: 104,
						column: 3
					},
					end: {
						line: 104,
						column: 65
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 104,
						column: 3
					},
					end: {
						line: 104,
						column: 65
					}
				}, {
					start: {
						line: 104,
						column: 3
					},
					end: {
						line: 104,
						column: 65
					}
				}],
				line: 104
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0,
			'29': 0,
			'30': 0,
			'31': 0,
			'32': 0,
			'33': 0,
			'34': 0,
			'35': 0,
			'36': 0,
			'37': 0,
			'38': 0,
			'39': 0,
			'40': 0,
			'41': 0,
			'42': 0,
			'43': 0,
			'44': 0,
			'45': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0],
			'6': [0, 0],
			'7': [0, 0],
			'8': [0, 0],
			'9': [0, 0],
			'10': [0, 0],
			'11': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _log = require('log6');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * The map that contains parsed model-functions
 * * FormulaId '0' is not a valid ID!
 *
 * x = time object
 * y = tuple object
 * z = timeline object
 * value = new value
 * v = entered values
 * map = model
 */

function Fm() {
	cov_9jxq1ombk.f[0]++;
}

//don't directly use this method, use JSWorkBook instead.
cov_9jxq1ombk.s[0]++;
Fm.prototype.apiGet = function (formula, x, y, z, v, map) {
	cov_9jxq1ombk.f[1]++;

	//temp fix fallback for ID, index is the Virtual ID, not persisted in the database
	//should be checked outside this function call
	var id = (cov_9jxq1ombk.s[1]++, (cov_9jxq1ombk.b[0][0]++, formula.id) || (cov_9jxq1ombk.b[0][1]++, formula.index));
	cov_9jxq1ombk.s[2]++;
	return map[id](id, x, y, z, v, map);
};
cov_9jxq1ombk.s[3]++;
Fm.prototype.apiSet = function (formula, x, y, z, value, v) {
	cov_9jxq1ombk.f[2]++;

	var id = (cov_9jxq1ombk.s[4]++, (cov_9jxq1ombk.b[1][0]++, formula.id) || (cov_9jxq1ombk.b[1][1]++, formula.index));
	cov_9jxq1ombk.s[5]++;
	if (v[id] !== undefined) {
		cov_9jxq1ombk.b[2][0]++;

		var hash = (cov_9jxq1ombk.s[6]++, x.hash + y.hash + z);
		cov_9jxq1ombk.s[7]++;
		v[id][hash] = value;
	} else {
			cov_9jxq1ombk.b[2][1]++;
			cov_9jxq1ombk.s[8]++;
			if (_log.DEBUG) {
					cov_9jxq1ombk.b[3][0]++;
					cov_9jxq1ombk.s[9]++;
					(0, _log.debug)('[%s] does not exist in the model.', id);
				} else {
				cov_9jxq1ombk.b[3][1]++;
			}
		}
};
/**
 * TODO: support for variable types.
 *  - primitive and objects
 *  - also function types that don't need to be executed.
 *  100 + m[10002]   when m[10002] = 1(but can be entered.)
 *  100 + 1          when m[10002] = 1(and locked.)
 */
cov_9jxq1ombk.s[10]++;
Fm.prototype.initializeFormula = function (newFormula, map, audittrail) {
	cov_9jxq1ombk.f[3]++;

	var id = (cov_9jxq1ombk.s[11]++, (cov_9jxq1ombk.b[4][0]++, newFormula.id) || (cov_9jxq1ombk.b[4][1]++, newFormula.index));
	var stringFunction = (cov_9jxq1ombk.s[12]++, 'return ' + newFormula.parsed + ' /*\n' + newFormula.name + ':' + newFormula.original + '  */ ');

	//we going to use .bind for function-scope variable binding. First of all we going to bind all CHOICES!
	//In the choice we can use this.options[]....

	var modelFunction = (cov_9jxq1ombk.s[13]++, Function((cov_9jxq1ombk.b[5][0]++, newFormula.params) || (cov_9jxq1ombk.b[5][1]++, 'f, x, y, z, v, m'), stringFunction));
	cov_9jxq1ombk.s[14]++;
	if (newFormula.self != null) {
			cov_9jxq1ombk.b[6][0]++;
			cov_9jxq1ombk.s[15]++;
			modelFunction = modelFunction.bind(newFormula.self);
		} else {
		cov_9jxq1ombk.b[6][1]++;
	}var javaScriptFunction = (cov_9jxq1ombk.s[16]++, formulaDecorators[newFormula.type](modelFunction, id, newFormula.name));

	cov_9jxq1ombk.s[17]++;
	if (global.IDE_DEBUGMODUS) {
			cov_9jxq1ombk.b[7][0]++;
			cov_9jxq1ombk.s[18]++;
			map[id] = debugwrapper(javaScriptFunction, id, newFormula, audittrail);
		} else {
			cov_9jxq1ombk.b[7][1]++;
			cov_9jxq1ombk.s[19]++;
			map[id] = javaScriptFunction;
		}
};
/**
 * The debug wrapper is used by unit-tests and IDE
 * It supports engine audit-trail
 * Inject source FFL into the parsed functions
 * @param javaScriptFunction
 * @returns {Function}
 */
cov_9jxq1ombk.s[20]++;
var debugwrapper = function debugwrapper(javaScriptFunction, id, newFormula, audit_trail_argument) {
	cov_9jxq1ombk.f[4]++;


	var audittrail = (cov_9jxq1ombk.s[21]++, audit_trail_argument);
	var original = (cov_9jxq1ombk.s[22]++, newFormula.original);
	var variableName = (cov_9jxq1ombk.s[23]++, newFormula.name.split('_').slice(1, -1).join('_'));
	var property = (cov_9jxq1ombk.s[24]++, newFormula.name.split('_').pop());
	var ff = (cov_9jxq1ombk.s[25]++, javaScriptFunction);

	cov_9jxq1ombk.s[26]++;
	audittrail.addRow(['MODEL', 'INFO', variableName, property, '', '', '', 'Ok', newFormula.original, id, newFormula.parsed, '-']);
	cov_9jxq1ombk.s[27]++;
	return function () {
		cov_9jxq1ombk.f[5]++;

		var value = void 0,
		    state = (cov_9jxq1ombk.s[28]++, 'INFO'),
		    message = (cov_9jxq1ombk.s[29]++, '');

		cov_9jxq1ombk.s[30]++;
		try {
			cov_9jxq1ombk.s[31]++;

			value = ff.apply(this, arguments);
		} catch (err) {
			cov_9jxq1ombk.s[32]++;

			state = 'ERROR';
			cov_9jxq1ombk.s[33]++;
			message = err.toString();
			cov_9jxq1ombk.s[34]++;
			value = NA;
		}
		//*growing too fast for V05*//
		//*For static functions args[1] and args[2] can be anythng*//
		cov_9jxq1ombk.s[35]++;
		audittrail.addRow(['DATA', state, variableName, property, (cov_9jxq1ombk.b[8][0]++, arguments[2].display) || (cov_9jxq1ombk.b[8][1]++, arguments[2]), (cov_9jxq1ombk.b[9][0]++, arguments[1].hash) || (cov_9jxq1ombk.b[9][1]++, arguments[1]), value, message, original, id, typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)]);
		cov_9jxq1ombk.s[36]++;
		return value;
	};
};
//we do need this functions to be here, so the FormulaBootstrap can directly call the function on its map instead of
//for now we just use static functions and user editable function that will not cache.
// the ApiGet. we don't need the CacheLocked and the NoCacheUnlocked they are just for further optimizations.
var formulaDecorators = (cov_9jxq1ombk.s[37]++, {
	//nothing to to, just return the inner function
	noCacheLocked: function noCacheLocked(innerFunction, formulaName) {
		cov_9jxq1ombk.f[6]++;
		cov_9jxq1ombk.s[38]++;
		return innerFunction;
	},
	//Unlocked formula's can be user entered.
	//Encapsulates that part.
	noCacheUnlocked: function noCacheUnlocked(innerFunction, formulaName, varName) {
		cov_9jxq1ombk.f[7]++;
		cov_9jxq1ombk.s[39]++;

		//add a user value cache
		//f = formulaId
		//y,x,z dimensions Tuple,Column,Layer
		//v = enteredValues
		return function (f, x, y, z, v, m) {
			cov_9jxq1ombk.f[8]++;
			cov_9jxq1ombk.s[40]++;

			if (x.dummy) {
					cov_9jxq1ombk.b[10][0]++;
					cov_9jxq1ombk.s[41]++;
					return NA;
				} else {
				cov_9jxq1ombk.b[10][1]++;
			}var hash = (cov_9jxq1ombk.s[42]++, x.hash + y.hash + z);
			//check if user entered a value
			cov_9jxq1ombk.s[43]++;
			if (v[f][hash] == null) {
					cov_9jxq1ombk.b[11][0]++;
					cov_9jxq1ombk.s[44]++;
					return innerFunction(f, x, y, z, v, m);
				} else {
				cov_9jxq1ombk.b[11][1]++;
			}cov_9jxq1ombk.s[45]++;
			return v[f][hash]; //return entered value
		};
	}
});
exports.default = Fm.prototype;