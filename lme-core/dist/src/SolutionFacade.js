'use strict';

var cov_10jkdyl5yl = function () {
	var path = 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-core\\src\\SolutionFacade.js',
	    hash = '78b11c879650ee534b8d6f4abf2842b40e92a8c3',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-core\\src\\SolutionFacade.js',
		statementMap: {
			'0': {
				start: {
					line: 13,
					column: 19
				},
				end: {
					line: 25,
					column: 1
				}
			},
			'1': {
				start: {
					line: 26,
					column: 18
				},
				end: {
					line: 26,
					column: 20
				}
			},
			'2': {
				start: {
					line: 27,
					column: 21
				},
				end: {
					line: 27,
					column: 36
				}
			},
			'3': {
				start: {
					line: 27,
					column: 27
				},
				end: {
					line: 27,
					column: 36
				}
			},
			'4': {
				start: {
					line: 28,
					column: 21
				},
				end: {
					line: 28,
					column: 48
				}
			},
			'5': {
				start: {
					line: 29,
					column: 22
				},
				end: {
					line: 29,
					column: 50
				}
			},
			'6': {
				start: {
					line: 30,
					column: 28
				},
				end: {
					line: 30,
					column: 61
				}
			},
			'7': {
				start: {
					line: 34,
					column: 2
				},
				end: {
					line: 34,
					column: 84
				}
			},
			'8': {
				start: {
					line: 38,
					column: 22
				},
				end: {
					line: 38,
					column: 58
				}
			},
			'9': {
				start: {
					line: 39,
					column: 2
				},
				end: {
					line: 39,
					column: 149
				}
			},
			'10': {
				start: {
					line: 39,
					column: 27
				},
				end: {
					line: 39,
					column: 149
				}
			},
			'11': {
				start: {
					line: 40,
					column: 19
				},
				end: {
					line: 40,
					column: 56
				}
			},
			'12': {
				start: {
					line: 41,
					column: 2
				},
				end: {
					line: 41,
					column: 42
				}
			},
			'13': {
				start: {
					line: 42,
					column: 2
				},
				end: {
					line: 42,
					column: 121
				}
			},
			'14': {
				start: {
					line: 43,
					column: 2
				},
				end: {
					line: 43,
					column: 17
				}
			},
			'15': {
				start: {
					line: 47,
					column: 17
				},
				end: {
					line: 47,
					column: 53
				}
			},
			'16': {
				start: {
					line: 48,
					column: 2
				},
				end: {
					line: 48,
					column: 73
				}
			},
			'17': {
				start: {
					line: 48,
					column: 22
				},
				end: {
					line: 48,
					column: 73
				}
			},
			'18': {
				start: {
					line: 49,
					column: 2
				},
				end: {
					line: 49,
					column: 40
				}
			},
			'19': {
				start: {
					line: 53,
					column: 2
				},
				end: {
					line: 58,
					column: 3
				}
			},
			'20': {
				start: {
					line: 54,
					column: 23
				},
				end: {
					line: 54,
					column: 69
				}
			},
			'21': {
				start: {
					line: 55,
					column: 3
				},
				end: {
					line: 55,
					column: 57
				}
			},
			'22': {
				start: {
					line: 55,
					column: 27
				},
				end: {
					line: 55,
					column: 57
				}
			},
			'23': {
				start: {
					line: 56,
					column: 3
				},
				end: {
					line: 56,
					column: 79
				}
			},
			'24': {
				start: {
					line: 56,
					column: 35
				},
				end: {
					line: 56,
					column: 79
				}
			},
			'25': {
				start: {
					line: 57,
					column: 3
				},
				end: {
					line: 57,
					column: 61
				}
			},
			'26': {
				start: {
					line: 65,
					column: 28
				},
				end: {
					line: 65,
					column: 30
				}
			},
			'27': {
				start: {
					line: 66,
					column: 2
				},
				end: {
					line: 71,
					column: 4
				}
			},
			'28': {
				start: {
					line: 67,
					column: 19
				},
				end: {
					line: 67,
					column: 126
				}
			},
			'29': {
				start: {
					line: 68,
					column: 3
				},
				end: {
					line: 70,
					column: 4
				}
			},
			'30': {
				start: {
					line: 69,
					column: 4
				},
				end: {
					line: 69,
					column: 51
				}
			},
			'31': {
				start: {
					line: 72,
					column: 2
				},
				end: {
					line: 72,
					column: 26
				}
			},
			'32': {
				start: {
					line: 83,
					column: 14
				},
				end: {
					line: 83,
					column: 44
				}
			},
			'33': {
				start: {
					line: 85,
					column: 19
				},
				end: {
					line: 85,
					column: 62
				}
			},
			'34': {
				start: {
					line: 87,
					column: 2
				},
				end: {
					line: 87,
					column: 130
				}
			},
			'35': {
				start: {
					line: 89,
					column: 2
				},
				end: {
					line: 89,
					column: 87
				}
			},
			'36': {
				start: {
					line: 98,
					column: 19
				},
				end: {
					line: 98,
					column: 87
				}
			},
			'37': {
				start: {
					line: 99,
					column: 2
				},
				end: {
					line: 99,
					column: 114
				}
			},
			'38': {
				start: {
					line: 99,
					column: 45
				},
				end: {
					line: 99,
					column: 114
				}
			},
			'39': {
				start: {
					line: 100,
					column: 2
				},
				end: {
					line: 100,
					column: 53
				}
			},
			'40': {
				start: {
					line: 100,
					column: 19
				},
				end: {
					line: 100,
					column: 53
				}
			},
			'41': {
				start: {
					line: 101,
					column: 20
				},
				end: {
					line: 101,
					column: 173
				}
			},
			'42': {
				start: {
					line: 102,
					column: 2
				},
				end: {
					line: 102,
					column: 55
				}
			},
			'43': {
				start: {
					line: 103,
					column: 2
				},
				end: {
					line: 103,
					column: 17
				}
			},
			'44': {
				start: {
					line: 107,
					column: 19
				},
				end: {
					line: 107,
					column: 121
				}
			},
			'45': {
				start: {
					line: 108,
					column: 2
				},
				end: {
					line: 108,
					column: 79
				}
			},
			'46': {
				start: {
					line: 109,
					column: 2
				},
				end: {
					line: 109,
					column: 17
				}
			},
			'47': {
				start: {
					line: 124,
					column: 0
				},
				end: {
					line: 124,
					column: 76
				}
			},
			'48': {
				start: {
					line: 125,
					column: 0
				},
				end: {
					line: 125,
					column: 54
				}
			},
			'49': {
				start: {
					line: 126,
					column: 0
				},
				end: {
					line: 126,
					column: 42
				}
			},
			'50': {
				start: {
					line: 127,
					column: 0
				},
				end: {
					line: 127,
					column: 50
				}
			},
			'51': {
				start: {
					line: 128,
					column: 0
				},
				end: {
					line: 128,
					column: 56
				}
			},
			'52': {
				start: {
					line: 129,
					column: 0
				},
				end: {
					line: 129,
					column: 38
				}
			},
			'53': {
				start: {
					line: 130,
					column: 0
				},
				end: {
					line: 130,
					column: 36
				}
			},
			'54': {
				start: {
					line: 131,
					column: 0
				},
				end: {
					line: 131,
					column: 42
				}
			},
			'55': {
				start: {
					line: 132,
					column: 0
				},
				end: {
					line: 132,
					column: 44
				}
			},
			'56': {
				start: {
					line: 133,
					column: 0
				},
				end: {
					line: 133,
					column: 56
				}
			},
			'57': {
				start: {
					line: 134,
					column: 0
				},
				end: {
					line: 134,
					column: 51
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 27,
						column: 21
					},
					end: {
						line: 27,
						column: 22
					}
				},
				loc: {
					start: {
						line: 27,
						column: 27
					},
					end: {
						line: 27,
						column: 36
					}
				},
				line: 27
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 33,
						column: 1
					},
					end: {
						line: 33,
						column: 2
					}
				},
				loc: {
					start: {
						line: 33,
						column: 37
					},
					end: {
						line: 35,
						column: 2
					}
				},
				line: 33
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 37,
						column: 1
					},
					end: {
						line: 37,
						column: 2
					}
				},
				loc: {
					start: {
						line: 37,
						column: 55
					},
					end: {
						line: 44,
						column: 2
					}
				},
				line: 37
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 46,
						column: 1
					},
					end: {
						line: 46,
						column: 2
					}
				},
				loc: {
					start: {
						line: 46,
						column: 52
					},
					end: {
						line: 50,
						column: 2
					}
				},
				line: 46
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 52,
						column: 1
					},
					end: {
						line: 52,
						column: 2
					}
				},
				loc: {
					start: {
						line: 52,
						column: 75
					},
					end: {
						line: 59,
						column: 2
					}
				},
				line: 52
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 64,
						column: 1
					},
					end: {
						line: 64,
						column: 2
					}
				},
				loc: {
					start: {
						line: 64,
						column: 62
					},
					end: {
						line: 73,
						column: 2
					}
				},
				line: 64
			},
			'6': {
				name: '(anonymous_6)',
				decl: {
					start: {
						line: 66,
						column: 34
					},
					end: {
						line: 66,
						column: 35
					}
				},
				loc: {
					start: {
						line: 66,
						column: 47
					},
					end: {
						line: 71,
						column: 3
					}
				},
				line: 66
			},
			'7': {
				name: '(anonymous_7)',
				decl: {
					start: {
						line: 81,
						column: 1
					},
					end: {
						line: 81,
						column: 2
					}
				},
				loc: {
					start: {
						line: 81,
						column: 141
					},
					end: {
						line: 90,
						column: 2
					}
				},
				line: 81
			},
			'8': {
				name: '(anonymous_8)',
				decl: {
					start: {
						line: 95,
						column: 1
					},
					end: {
						line: 95,
						column: 2
					}
				},
				loc: {
					start: {
						line: 95,
						column: 118
					},
					end: {
						line: 104,
						column: 2
					}
				},
				line: 95
			},
			'9': {
				name: '(anonymous_9)',
				decl: {
					start: {
						line: 106,
						column: 1
					},
					end: {
						line: 106,
						column: 2
					}
				},
				loc: {
					start: {
						line: 106,
						column: 62
					},
					end: {
						line: 110,
						column: 2
					}
				},
				line: 106
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 39,
						column: 2
					},
					end: {
						line: 39,
						column: 149
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 39,
						column: 2
					},
					end: {
						line: 39,
						column: 149
					}
				}, {
					start: {
						line: 39,
						column: 2
					},
					end: {
						line: 39,
						column: 149
					}
				}],
				line: 39
			},
			'1': {
				loc: {
					start: {
						line: 48,
						column: 2
					},
					end: {
						line: 48,
						column: 73
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 48,
						column: 2
					},
					end: {
						line: 48,
						column: 73
					}
				}, {
					start: {
						line: 48,
						column: 2
					},
					end: {
						line: 48,
						column: 73
					}
				}],
				line: 48
			},
			'2': {
				loc: {
					start: {
						line: 55,
						column: 3
					},
					end: {
						line: 55,
						column: 57
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 55,
						column: 3
					},
					end: {
						line: 55,
						column: 57
					}
				}, {
					start: {
						line: 55,
						column: 3
					},
					end: {
						line: 55,
						column: 57
					}
				}],
				line: 55
			},
			'3': {
				loc: {
					start: {
						line: 56,
						column: 3
					},
					end: {
						line: 56,
						column: 79
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 56,
						column: 3
					},
					end: {
						line: 56,
						column: 79
					}
				}, {
					start: {
						line: 56,
						column: 3
					},
					end: {
						line: 56,
						column: 79
					}
				}],
				line: 56
			},
			'4': {
				loc: {
					start: {
						line: 68,
						column: 3
					},
					end: {
						line: 70,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 68,
						column: 3
					},
					end: {
						line: 70,
						column: 4
					}
				}, {
					start: {
						line: 68,
						column: 3
					},
					end: {
						line: 70,
						column: 4
					}
				}],
				line: 68
			},
			'5': {
				loc: {
					start: {
						line: 68,
						column: 7
					},
					end: {
						line: 68,
						column: 118
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 68,
						column: 7
					},
					end: {
						line: 68,
						column: 28
					}
				}, {
					start: {
						line: 68,
						column: 32
					},
					end: {
						line: 68,
						column: 62
					}
				}, {
					start: {
						line: 68,
						column: 66
					},
					end: {
						line: 68,
						column: 91
					}
				}, {
					start: {
						line: 68,
						column: 95
					},
					end: {
						line: 68,
						column: 118
					}
				}],
				line: 68
			},
			'6': {
				loc: {
					start: {
						line: 99,
						column: 2
					},
					end: {
						line: 99,
						column: 114
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 99,
						column: 2
					},
					end: {
						line: 99,
						column: 114
					}
				}, {
					start: {
						line: 99,
						column: 2
					},
					end: {
						line: 99,
						column: 114
					}
				}],
				line: 99
			},
			'7': {
				loc: {
					start: {
						line: 99,
						column: 6
					},
					end: {
						line: 99,
						column: 43
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 99,
						column: 6
					},
					end: {
						line: 99,
						column: 22
					}
				}, {
					start: {
						line: 99,
						column: 26
					},
					end: {
						line: 99,
						column: 43
					}
				}],
				line: 99
			},
			'8': {
				loc: {
					start: {
						line: 99,
						column: 67
					},
					end: {
						line: 99,
						column: 114
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 99,
						column: 79
					},
					end: {
						line: 99,
						column: 99
					}
				}, {
					start: {
						line: 99,
						column: 102
					},
					end: {
						line: 99,
						column: 114
					}
				}],
				line: 99
			},
			'9': {
				loc: {
					start: {
						line: 100,
						column: 2
					},
					end: {
						line: 100,
						column: 53
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 100,
						column: 2
					},
					end: {
						line: 100,
						column: 53
					}
				}, {
					start: {
						line: 100,
						column: 2
					},
					end: {
						line: 100,
						column: 53
					}
				}],
				line: 100
			},
			'10': {
				loc: {
					start: {
						line: 107,
						column: 97
					},
					end: {
						line: 107,
						column: 120
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 107,
						column: 97
					},
					end: {
						line: 107,
						column: 109
					}
				}, {
					start: {
						line: 107,
						column: 113
					},
					end: {
						line: 107,
						column: 120
					}
				}],
				line: 107
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0,
			'29': 0,
			'30': 0,
			'31': 0,
			'32': 0,
			'33': 0,
			'34': 0,
			'35': 0,
			'36': 0,
			'37': 0,
			'38': 0,
			'39': 0,
			'40': 0,
			'41': 0,
			'42': 0,
			'43': 0,
			'44': 0,
			'45': 0,
			'46': 0,
			'47': 0,
			'48': 0,
			'49': 0,
			'50': 0,
			'51': 0,
			'52': 0,
			'53': 0,
			'54': 0,
			'55': 0,
			'56': 0,
			'57': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0, 0, 0],
			'6': [0, 0],
			'7': [0, 0],
			'8': [0, 0],
			'9': [0, 0],
			'10': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}(); /**
      * Solution encapsulation
      * FormulaId '0' is not a valid ID!
      */


Object.defineProperty(exports, "__esModule", {
	value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _esprima = require('esprima');

var esprima = _interopRequireWildcard(_esprima);

var _FormulaBootstrap = require('./FormulaBootstrap');

var _FormulaBootstrap2 = _interopRequireDefault(_FormulaBootstrap);

var _ParserService = require('./ParserService');

var _ParserService2 = _interopRequireDefault(_ParserService);

var _FormulaService = require('./FormulaService');

var _FormulaService2 = _interopRequireDefault(_FormulaService);

var _FunctionMap = require('./FunctionMap');

var _FunctionMap2 = _interopRequireDefault(_FunctionMap);

var _PropertiesAssembler = require('./PropertiesAssembler');

var _PropertiesAssembler2 = _interopRequireDefault(_PropertiesAssembler);

var _Solution = require('./Solution');

var _Solution2 = _interopRequireDefault(_Solution);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var properties = (cov_10jkdyl5yl.s[0]++, {
	value: 0,
	visible: 1,
	required: 2,
	locked: 3,
	entered: 4,
	validation: 5,
	title: 6,
	validateInput: 7,
	choices: 8,
	hint: 9,
	_testh: 10
});
var functions = (cov_10jkdyl5yl.s[1]++, {});
cov_10jkdyl5yl.s[2]++;
var getFunctions = function getFunctions() {
	cov_10jkdyl5yl.f[0]++;
	cov_10jkdyl5yl.s[3]++;
	return functions;
};
var addVariables = (cov_10jkdyl5yl.s[4]++, _FormulaService2.default.addVariables);
var initVariables = (cov_10jkdyl5yl.s[5]++, _FormulaService2.default.initVariables);
var fetchFormulaByIndex = (cov_10jkdyl5yl.s[6]++, _FormulaService2.default.findFormulaByIndex);

var SolutionFacade = function () {
	function SolutionFacade() {
		(0, _classCallCheck3.default)(this, SolutionFacade);
	}

	(0, _createClass3.default)(SolutionFacade, null, [{
		key: 'createSolution',
		value: function createSolution(solutionName) {
			cov_10jkdyl5yl.f[1]++;
			cov_10jkdyl5yl.s[7]++;

			return new _Solution2.default(_PropertiesAssembler2.default.createRootNode(solutionName).solutionName);
		}
	}, {
		key: 'importSolutionData',
		value: function importSolutionData(data, parserType, workbook) {
			cov_10jkdyl5yl.f[2]++;

			var foundParser = (cov_10jkdyl5yl.s[8]++, _ParserService2.default.findParser(parserType));
			cov_10jkdyl5yl.s[9]++;
			if (foundParser == null) {
					cov_10jkdyl5yl.b[0][0]++;
					cov_10jkdyl5yl.s[10]++;
					throw Error('Parser for type \'' + parserType + '\' is not found. You have to include it in the startup script (require/import)');
				} else {
				cov_10jkdyl5yl.b[0][1]++;
			}var solution = (cov_10jkdyl5yl.s[11]++, foundParser.parseData(data, workbook));
			cov_10jkdyl5yl.s[12]++;
			_PropertiesAssembler2.default.bulkInsert(solution);
			cov_10jkdyl5yl.s[13]++;
			SolutionFacade.initFormulaBootstrap(solution.getFormulaKeys(), false, workbook.context.ma, workbook.context.audittrail);
			cov_10jkdyl5yl.s[14]++;
			return solution;
		}
	}, {
		key: 'exportSolution',
		value: function exportSolution(parserType, rowId, workbook) {
			cov_10jkdyl5yl.f[3]++;

			var parser = (cov_10jkdyl5yl.s[15]++, _ParserService2.default.findParser(parserType));
			cov_10jkdyl5yl.s[16]++;
			if (parser == null) {
					cov_10jkdyl5yl.b[1][0]++;
					cov_10jkdyl5yl.s[17]++;
					throw Error('No such parser found:[' + parserType + ']');
				} else {
				cov_10jkdyl5yl.b[1][1]++;
			}cov_10jkdyl5yl.s[18]++;
			return parser.deParse(rowId, workbook);
		}
	}, {
		key: 'initFormulaBootstrap',
		value: function initFormulaBootstrap(formulas, resetParsedFormula, ma, audittrail) {
			cov_10jkdyl5yl.f[4]++;
			cov_10jkdyl5yl.s[19]++;

			for (var i = 0; i < formulas.length; i++) {
				var formulaInfo = (cov_10jkdyl5yl.s[20]++, _FormulaService2.default.findFormulaByIndex(formulas[i]));
				cov_10jkdyl5yl.s[21]++;
				if (resetParsedFormula) {
						cov_10jkdyl5yl.b[2][0]++;
						cov_10jkdyl5yl.s[22]++;
						formulaInfo.parsed = undefined;
					} else {
					cov_10jkdyl5yl.b[2][1]++;
				} //explicitly reset parsed. (The formula-bootstrap) will skip parsed formulas
				cov_10jkdyl5yl.s[23]++;
				if (formulaInfo.parsed == null) {
						cov_10jkdyl5yl.b[3][0]++;
						cov_10jkdyl5yl.s[24]++;
						_FormulaBootstrap2.default.parseAsFormula(formulaInfo);
					} else {
					cov_10jkdyl5yl.b[3][1]++;
				}cov_10jkdyl5yl.s[25]++;
				_FunctionMap2.default.initializeFormula(formulaInfo, ma, audittrail);
			}
		}

		/*
   *return given properties from a formula
   */

	}, {
		key: 'gatherFormulaProperties',
		value: function gatherFormulaProperties(modelName, properties, rowId) {
			cov_10jkdyl5yl.f[5]++;

			var formulaProperties = (cov_10jkdyl5yl.s[26]++, {});
			cov_10jkdyl5yl.s[27]++;
			Object.keys(properties).forEach(function (prop_name) {
				cov_10jkdyl5yl.f[6]++;

				var formula = (cov_10jkdyl5yl.s[28]++, _FormulaService2.default.findFormulaByIndex(_PropertiesAssembler2.default.getOrCreateProperty(modelName, rowId, prop_name).ref));
				cov_10jkdyl5yl.s[29]++;
				if ((cov_10jkdyl5yl.b[5][0]++, formula !== undefined) && (cov_10jkdyl5yl.b[5][1]++, formula.original !== undefined) && (cov_10jkdyl5yl.b[5][2]++, formula.original !== null) && (cov_10jkdyl5yl.b[5][3]++, formula.original !== '')) {
					cov_10jkdyl5yl.b[4][0]++;
					cov_10jkdyl5yl.s[30]++;

					formulaProperties[prop_name] = formula.original;
				} else {
					cov_10jkdyl5yl.b[4][1]++;
				}
			});
			cov_10jkdyl5yl.s[31]++;
			return formulaProperties;
		}

		/**
   * Called from JSWorkBook
   * Initializes Solution if not exists
   * Creates Formula/Property if not exists
   * Initialize FunctionMap
   */

	}, {
		key: 'createFormulaAndStructure',
		value: function createFormulaAndStructure(solutionName, formulaAsString, rowId, colId, displaytype, frequency, ma, audittrail, self_body, parent_id) {
			cov_10jkdyl5yl.f[7]++;

			//create a formula for the element
			var ast = (cov_10jkdyl5yl.s[32]++, esprima.parse(formulaAsString));
			//create Solution if not exists.
			var solution = (cov_10jkdyl5yl.s[33]++, SolutionFacade.createSolution(solutionName));
			//integrate Property with Formula
			cov_10jkdyl5yl.s[34]++;
			SolutionFacade.createUIFormulaLink(solution, rowId, colId, ast.body[0].expression, displaytype, frequency, self_body, parent_id);
			//integrate one formula from just created Solution
			cov_10jkdyl5yl.s[35]++;
			SolutionFacade.initFormulaBootstrap(solution.getFormulaKeys(), false, ma, audittrail);
		}

		/**
   * Called by parsers
   */

	}, {
		key: 'createUIFormulaLink',
		value: function createUIFormulaLink(solution, rowId, colId, body, displaytype, frequency, self_body, parent_id, ip_protected) {
			cov_10jkdyl5yl.f[8]++;

			//by default only value properties can be user entered
			//in simple (LOCKED = (colId !== 'value'))
			var property = (cov_10jkdyl5yl.s[36]++, _PropertiesAssembler2.default.getOrCreateProperty(solution.name, rowId, colId));
			cov_10jkdyl5yl.s[37]++;
			if ((cov_10jkdyl5yl.b[7][0]++, rowId !== 'root') && (cov_10jkdyl5yl.b[7][1]++, colId === 'value')) {
					cov_10jkdyl5yl.b[6][0]++;
					cov_10jkdyl5yl.s[38]++;
					property.parentName = parent_id ? (cov_10jkdyl5yl.b[8][0]++, parent_id + '_value') : (cov_10jkdyl5yl.b[8][1]++, 'root_value');
				} else {
				cov_10jkdyl5yl.b[6][1]++;
			}cov_10jkdyl5yl.s[39]++;
			if (displaytype) {
					cov_10jkdyl5yl.b[9][0]++;
					cov_10jkdyl5yl.s[40]++;
					property.displaytype = displaytype;
				} else {
				cov_10jkdyl5yl.b[9][1]++;
			}var formulaId = (cov_10jkdyl5yl.s[41]++, _FormulaService2.default.addModelFormula(property, solution.name, rowId, colId, ['value', 'title'].indexOf(colId) === -1, body, frequency, self_body, ip_protected));
			cov_10jkdyl5yl.s[42]++;
			solution.createNode(formulaId, displaytype, property);
			cov_10jkdyl5yl.s[43]++;
			return property;
		}
	}, {
		key: 'addFormulaDependency',
		value: function addFormulaDependency(formulaInfo, name, propertyName) {
			cov_10jkdyl5yl.f[9]++;

			var property = (cov_10jkdyl5yl.s[44]++, _PropertiesAssembler2.default.getOrCreateProperty(formulaInfo.name.split('_')[0], name, (cov_10jkdyl5yl.b[10][0]++, propertyName) || (cov_10jkdyl5yl.b[10][1]++, 'value')));
			cov_10jkdyl5yl.s[45]++;
			_FormulaService2.default.addFormulaDependency(formulaInfo, property.ref, property.name);
			cov_10jkdyl5yl.s[46]++;
			return property;
		}

		/*static getOrCreateProperty = PropertiesAssembler.getOrCreateProperty
   static contains = PropertiesAssembler.contains
   static getFunctions = getFunctions
   static addParser = ParserService.addParser
   static visitParsers = ParserService.visitParsers
   static properties = properties
   static functions = functions
   static addVariables = addVariables
   static initVariables = initVariables
   static fetchFormulaByIndex = fetchFormulaByIndex*/

	}]);
	return SolutionFacade;
}();

cov_10jkdyl5yl.s[47]++;


SolutionFacade.getOrCreateProperty = _PropertiesAssembler2.default.getOrCreateProperty;
cov_10jkdyl5yl.s[48]++;
SolutionFacade.contains = _PropertiesAssembler2.default.contains;
cov_10jkdyl5yl.s[49]++;
SolutionFacade.getFunctions = getFunctions;
cov_10jkdyl5yl.s[50]++;
SolutionFacade.addParser = _ParserService2.default.addParser;
cov_10jkdyl5yl.s[51]++;
SolutionFacade.visitParsers = _ParserService2.default.visitParsers;
cov_10jkdyl5yl.s[52]++;
SolutionFacade.properties = properties;
cov_10jkdyl5yl.s[53]++;
SolutionFacade.functions = functions;
cov_10jkdyl5yl.s[54]++;
SolutionFacade.addVariables = addVariables;
cov_10jkdyl5yl.s[55]++;
SolutionFacade.initVariables = initVariables;
cov_10jkdyl5yl.s[56]++;
SolutionFacade.fetchFormulaByIndex = fetchFormulaByIndex;
cov_10jkdyl5yl.s[57]++;
_FormulaBootstrap2.default.initStateBootstrap(SolutionFacade);
exports.default = SolutionFacade;