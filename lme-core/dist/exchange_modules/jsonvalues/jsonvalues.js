'use strict';

var cov_1urkdgnx3f = function () {
	var path = 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-core\\exchange_modules\\jsonvalues\\jsonvalues.js',
	    hash = '603019507a6ff9b342156fbb5eda7d5b5473b724',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\mbakk\\Documents\\fesjs\\lme-core\\exchange_modules\\jsonvalues\\jsonvalues.js',
		statementMap: {
			'0': {
				start: {
					line: 7,
					column: 19
				},
				end: {
					line: 23,
					column: 1
				}
			},
			'1': {
				start: {
					line: 11,
					column: 2
				},
				end: {
					line: 11,
					column: 38
				}
			},
			'2': {
				start: {
					line: 12,
					column: 2
				},
				end: {
					line: 12,
					column: 66
				}
			},
			'3': {
				start: {
					line: 15,
					column: 20
				},
				end: {
					line: 15,
					column: 50
				}
			},
			'4': {
				start: {
					line: 17,
					column: 2
				},
				end: {
					line: 20,
					column: 4
				}
			},
			'5': {
				start: {
					line: 18,
					column: 3
				},
				end: {
					line: 19,
					column: 68
				}
			},
			'6': {
				start: {
					line: 18,
					column: 48
				},
				end: {
					line: 18,
					column: 112
				}
			},
			'7': {
				start: {
					line: 19,
					column: 8
				},
				end: {
					line: 19,
					column: 68
				}
			},
			'8': {
				start: {
					line: 21,
					column: 2
				},
				end: {
					line: 21,
					column: 18
				}
			},
			'9': {
				start: {
					line: 25,
					column: 28
				},
				end: {
					line: 25,
					column: 82
				}
			},
			'10': {
				start: {
					line: 25,
					column: 38
				},
				end: {
					line: 25,
					column: 82
				}
			},
			'11': {
				start: {
					line: 26,
					column: 24
				},
				end: {
					line: 26,
					column: 78
				}
			},
			'12': {
				start: {
					line: 26,
					column: 34
				},
				end: {
					line: 26,
					column: 78
				}
			},
			'13': {
				start: {
					line: 33,
					column: 19
				},
				end: {
					line: 33,
					column: 38
				}
			},
			'14': {
				start: {
					line: 34,
					column: 1
				},
				end: {
					line: 34,
					column: 64
				}
			},
			'15': {
				start: {
					line: 34,
					column: 28
				},
				end: {
					line: 34,
					column: 64
				}
			},
			'16': {
				start: {
					line: 34,
					column: 45
				},
				end: {
					line: 34,
					column: 64
				}
			},
			'17': {
				start: {
					line: 36,
					column: 1
				},
				end: {
					line: 52,
					column: 2
				}
			},
			'18': {
				start: {
					line: 37,
					column: 16
				},
				end: {
					line: 37,
					column: 32
				}
			},
			'19': {
				start: {
					line: 38,
					column: 28
				},
				end: {
					line: 38,
					column: 45
				}
			},
			'20': {
				start: {
					line: 40,
					column: 2
				},
				end: {
					line: 42,
					column: 3
				}
			},
			'21': {
				start: {
					line: 41,
					column: 3
				},
				end: {
					line: 41,
					column: 29
				}
			},
			'22': {
				start: {
					line: 43,
					column: 16
				},
				end: {
					line: 43,
					column: 49
				}
			},
			'23': {
				start: {
					line: 45,
					column: 2
				},
				end: {
					line: 51,
					column: 3
				}
			},
			'24': {
				start: {
					line: 46,
					column: 22
				},
				end: {
					line: 46,
					column: 33
				}
			},
			'25': {
				start: {
					line: 47,
					column: 3
				},
				end: {
					line: 49,
					column: 4
				}
			},
			'26': {
				start: {
					line: 48,
					column: 4
				},
				end: {
					line: 48,
					column: 69
				}
			},
			'27': {
				start: {
					line: 50,
					column: 3
				},
				end: {
					line: 50,
					column: 59
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 10,
						column: 13
					},
					end: {
						line: 10,
						column: 14
					}
				},
				loc: {
					start: {
						line: 10,
						column: 38
					},
					end: {
						line: 13,
						column: 2
					}
				},
				line: 10
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 14,
						column: 13
					},
					end: {
						line: 14,
						column: 14
					}
				},
				loc: {
					start: {
						line: 14,
						column: 39
					},
					end: {
						line: 22,
						column: 2
					}
				},
				line: 14
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 17,
						column: 20
					},
					end: {
						line: 17,
						column: 21
					}
				},
				loc: {
					start: {
						line: 17,
						column: 38
					},
					end: {
						line: 20,
						column: 3
					}
				},
				line: 17
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 25,
						column: 28
					},
					end: {
						line: 25,
						column: 29
					}
				},
				loc: {
					start: {
						line: 25,
						column: 38
					},
					end: {
						line: 25,
						column: 82
					}
				},
				line: 25
			},
			'4': {
				name: '(anonymous_4)',
				decl: {
					start: {
						line: 26,
						column: 24
					},
					end: {
						line: 26,
						column: 25
					}
				},
				loc: {
					start: {
						line: 26,
						column: 34
					},
					end: {
						line: 26,
						column: 78
					}
				},
				line: 26
			},
			'5': {
				name: 'updateValues',
				decl: {
					start: {
						line: 32,
						column: 9
					},
					end: {
						line: 32,
						column: 21
					}
				},
				loc: {
					start: {
						line: 32,
						column: 37
					},
					end: {
						line: 53,
						column: 1
					}
				},
				line: 32
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 18,
						column: 3
					},
					end: {
						line: 19,
						column: 68
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 18,
						column: 3
					},
					end: {
						line: 19,
						column: 68
					}
				}, {
					start: {
						line: 18,
						column: 3
					},
					end: {
						line: 19,
						column: 68
					}
				}],
				line: 18
			},
			'1': {
				loc: {
					start: {
						line: 34,
						column: 28
					},
					end: {
						line: 34,
						column: 64
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 34,
						column: 28
					},
					end: {
						line: 34,
						column: 64
					}
				}, {
					start: {
						line: 34,
						column: 28
					},
					end: {
						line: 34,
						column: 64
					}
				}],
				line: 34
			},
			'2': {
				loc: {
					start: {
						line: 40,
						column: 2
					},
					end: {
						line: 42,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 40,
						column: 2
					},
					end: {
						line: 42,
						column: 3
					}
				}, {
					start: {
						line: 40,
						column: 2
					},
					end: {
						line: 42,
						column: 3
					}
				}],
				line: 40
			},
			'3': {
				loc: {
					start: {
						line: 45,
						column: 2
					},
					end: {
						line: 51,
						column: 3
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 45,
						column: 2
					},
					end: {
						line: 51,
						column: 3
					}
				}, {
					start: {
						line: 45,
						column: 2
					},
					end: {
						line: 51,
						column: 3
					}
				}],
				line: 45
			},
			'4': {
				loc: {
					start: {
						line: 47,
						column: 3
					},
					end: {
						line: 49,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 47,
						column: 3
					},
					end: {
						line: 49,
						column: 4
					}
				}, {
					start: {
						line: 47,
						column: 3
					},
					end: {
						line: 49,
						column: 4
					}
				}],
				line: 47
			},
			'5': {
				loc: {
					start: {
						line: 48,
						column: 19
					},
					end: {
						line: 48,
						column: 69
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 48,
						column: 42
					},
					end: {
						line: 48,
						column: 46
					}
				}, {
					start: {
						line: 48,
						column: 49
					},
					end: {
						line: 48,
						column: 69
					}
				}],
				line: 48
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}(); /*
      First, most basic export of values
      Just calling getAllValues() internally to export
      */


Object.defineProperty(exports, "__esModule", {
	value: true
});

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _index = require('../../index');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var jsonValues = (cov_1urkdgnx3f.s[0]++, {
	headername: 'jsonvalues',
	name: 'jsonvalues',
	parseData: function parseData(data, workbook) {
		cov_1urkdgnx3f.f[0]++;
		cov_1urkdgnx3f.s[1]++;

		updateValues(data, workbook.context);
		cov_1urkdgnx3f.s[2]++;
		return _index.SolutionFacade.createSolution(workbook.getSolutionName());
	},
	deParse: function deParse(rowId, workbook) {
		cov_1urkdgnx3f.f[1]++;

		var allValues = (cov_1urkdgnx3f.s[3]++, workbook.getAllChangedValues());
		//clean up the audit while de-parsing.
		cov_1urkdgnx3f.s[4]++;
		allValues.forEach(function (single_value) {
			cov_1urkdgnx3f.f[2]++;
			cov_1urkdgnx3f.s[5]++;

			if (single_value.varName.endsWith('_title')) {
					cov_1urkdgnx3f.b[0][0]++;
					cov_1urkdgnx3f.s[6]++;
					single_value.varName = correctPropertyName(single_value.varName);
				} else {
					cov_1urkdgnx3f.b[0][1]++;
					cov_1urkdgnx3f.s[7]++;
					single_value.varName = correctFileName(single_value.varName);
				}
		});
		cov_1urkdgnx3f.s[8]++;
		return allValues;
	}
});

cov_1urkdgnx3f.s[9]++;
var correctPropertyName = function correctPropertyName(name) {
	cov_1urkdgnx3f.f[3]++;
	cov_1urkdgnx3f.s[10]++;
	return name.replace(/^([^_]+_[\w]*_\w+)$/gmi, '$1');
};
cov_1urkdgnx3f.s[11]++;
var correctFileName = function correctFileName(name) {
	cov_1urkdgnx3f.f[4]++;
	cov_1urkdgnx3f.s[12]++;
	return name.replace(/^([^_]+_[\w]*)_\w+$/gmi, '$1');
};

/**
 * values are directly injected into the context, not through the API
 * They will not be saved in the audit.
 */
function updateValues(data, context) {
	cov_1urkdgnx3f.f[5]++;

	var docValues = (cov_1urkdgnx3f.s[13]++, context.getValues());
	cov_1urkdgnx3f.s[14]++;
	for (var key in docValues) {
		cov_1urkdgnx3f.s[15]++;
		if (!isNaN(key)) {
				cov_1urkdgnx3f.b[1][0]++;
				cov_1urkdgnx3f.s[16]++;
				docValues[key] = {};
			} else {
			cov_1urkdgnx3f.b[1][1]++;
		}
	}cov_1urkdgnx3f.s[17]++;
	for (var _key in data.values) {
		var value = (cov_1urkdgnx3f.s[18]++, data.values[_key]);

		var _ref = (cov_1urkdgnx3f.s[19]++, _key.split('#')[0]),
		    _ref2 = (0, _slicedToArray3.default)(_ref, 2),
		    nodeId = _ref2[0],
		    nodeColId = _ref2[1];

		cov_1urkdgnx3f.s[20]++;


		if (!nodeId.endsWith('_value')) {
			cov_1urkdgnx3f.b[2][0]++;
			cov_1urkdgnx3f.s[21]++;

			nodeId = nodeId + '_value';
		} else {
			cov_1urkdgnx3f.b[2][1]++;
		}
		var fetch = (cov_1urkdgnx3f.s[22]++, _index.PropertiesAssembler.fetch(nodeId));
		//we don't have to import values for variables we don't use.
		cov_1urkdgnx3f.s[23]++;
		if (fetch) {
			cov_1urkdgnx3f.b[3][0]++;

			var enteredValue = (cov_1urkdgnx3f.s[24]++, value.value);
			cov_1urkdgnx3f.s[25]++;
			if (fetch.datatype === _index.NUMBER) {
				cov_1urkdgnx3f.b[4][0]++;
				cov_1urkdgnx3f.s[26]++;

				enteredValue = enteredValue == null ? (cov_1urkdgnx3f.b[5][0]++, null) : (cov_1urkdgnx3f.b[5][1]++, Number(enteredValue));
			} else {
				cov_1urkdgnx3f.b[4][1]++;
			}
			cov_1urkdgnx3f.s[27]++;
			docValues[fetch.ref][parseInt(nodeColId)] = enteredValue;
		} else {
			cov_1urkdgnx3f.b[3][1]++;
		}
	}
}

exports.default = jsonValues;