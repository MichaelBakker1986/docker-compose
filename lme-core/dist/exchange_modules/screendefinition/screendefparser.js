'use strict';

var cov_21c2bkyhsg = function () {
	var path = 'C:\\Users\\michael\\Documents\\lme\\lme-core\\exchange_modules\\screendefinition\\screendefparser.js',
	    hash = 'd18ab1acff11f5785eca7685185b644bf2d5a4a6',
	    Function = function () {}.constructor,
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\michael\\Documents\\lme\\lme-core\\exchange_modules\\screendefinition\\screendefparser.js',
		statementMap: {
			'0': {
				start: {
					line: 5,
					column: 31
				},
				end: {
					line: 46,
					column: 1
				}
			},
			'1': {
				start: {
					line: 10,
					column: 13
				},
				end: {
					line: 10,
					column: 29
				}
			},
			'2': {
				start: {
					line: 11,
					column: 17
				},
				end: {
					line: 11,
					column: 92
				}
			},
			'3': {
				start: {
					line: 13,
					column: 2
				},
				end: {
					line: 21,
					column: 4
				}
			},
			'4': {
				start: {
					line: 14,
					column: 3
				},
				end: {
					line: 20,
					column: 4
				}
			},
			'5': {
				start: {
					line: 15,
					column: 17
				},
				end: {
					line: 15,
					column: 29
				}
			},
			'6': {
				start: {
					line: 16,
					column: 19
				},
				end: {
					line: 16,
					column: 49
				}
			},
			'7': {
				start: {
					line: 17,
					column: 4
				},
				end: {
					line: 19,
					column: 5
				}
			},
			'8': {
				start: {
					line: 18,
					column: 5
				},
				end: {
					line: 18,
					column: 108
				}
			},
			'9': {
				start: {
					line: 22,
					column: 2
				},
				end: {
					line: 22,
					column: 17
				}
			},
			'10': {
				start: {
					line: 25,
					column: 25
				},
				end: {
					line: 25,
					column: 82
				}
			},
			'11': {
				start: {
					line: 26,
					column: 23
				},
				end: {
					line: 26,
					column: 86
				}
			},
			'12': {
				start: {
					line: 27,
					column: 2
				},
				end: {
					line: 40,
					column: 4
				}
			},
			'13': {
				start: {
					line: 29,
					column: 16
				},
				end: {
					line: 33,
					column: 4
				}
			},
			'14': {
				start: {
					line: 34,
					column: 27
				},
				end: {
					line: 34,
					column: 126
				}
			},
			'15': {
				start: {
					line: 35,
					column: 3
				},
				end: {
					line: 39,
					column: 4
				}
			},
			'16': {
				start: {
					line: 36,
					column: 18
				},
				end: {
					line: 36,
					column: 40
				}
			},
			'17': {
				start: {
					line: 37,
					column: 21
				},
				end: {
					line: 37,
					column: 63
				}
			},
			'18': {
				start: {
					line: 38,
					column: 4
				},
				end: {
					line: 38,
					column: 60
				}
			},
			'19': {
				start: {
					line: 38,
					column: 36
				},
				end: {
					line: 38,
					column: 60
				}
			},
			'20': {
				start: {
					line: 41,
					column: 2
				},
				end: {
					line: 43,
					column: 3
				}
			},
			'21': {
				start: {
					line: 44,
					column: 2
				},
				end: {
					line: 44,
					column: 47
				}
			},
			'22': {
				start: {
					line: 49,
					column: 1
				},
				end: {
					line: 55,
					column: 2
				}
			},
			'23': {
				start: {
					line: 50,
					column: 3
				},
				end: {
					line: 52,
					column: 4
				}
			},
			'24': {
				start: {
					line: 51,
					column: 4
				},
				end: {
					line: 51,
					column: 20
				}
			},
			'25': {
				start: {
					line: 53,
					column: 3
				},
				end: {
					line: 53,
					column: 13
				}
			},
			'26': {
				start: {
					line: 59,
					column: 16
				},
				end: {
					line: 59,
					column: 141
				}
			},
			'27': {
				start: {
					line: 60,
					column: 21
				},
				end: {
					line: 60,
					column: 59
				}
			},
			'28': {
				start: {
					line: 61,
					column: 1
				},
				end: {
					line: 61,
					column: 109
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 9,
						column: 13
					},
					end: {
						line: 9,
						column: 14
					}
				},
				loc: {
					start: {
						line: 9,
						column: 38
					},
					end: {
						line: 23,
						column: 2
					}
				},
				line: 9
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 13,
						column: 34
					},
					end: {
						line: 13,
						column: 35
					}
				},
				loc: {
					start: {
						line: 13,
						column: 66
					},
					end: {
						line: 21,
						column: 3
					}
				},
				line: 13
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 24,
						column: 13
					},
					end: {
						line: 24,
						column: 14
					}
				},
				loc: {
					start: {
						line: 24,
						column: 39
					},
					end: {
						line: 45,
						column: 2
					}
				},
				line: 24
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 27,
						column: 43
					},
					end: {
						line: 27,
						column: 44
					}
				},
				loc: {
					start: {
						line: 27,
						column: 58
					},
					end: {
						line: 40,
						column: 3
					}
				},
				line: 27
			},
			'4': {
				name: 'stringifySolution',
				decl: {
					start: {
						line: 48,
						column: 9
					},
					end: {
						line: 48,
						column: 26
					}
				},
				loc: {
					start: {
						line: 48,
						column: 33
					},
					end: {
						line: 56,
						column: 1
					}
				},
				line: 48
			},
			'5': {
				name: '(anonymous_5)',
				decl: {
					start: {
						line: 49,
						column: 29
					},
					end: {
						line: 49,
						column: 30
					}
				},
				loc: {
					start: {
						line: 49,
						column: 48
					},
					end: {
						line: 54,
						column: 3
					}
				},
				line: 49
			},
			'6': {
				name: 'addnode',
				decl: {
					start: {
						line: 58,
						column: 9
					},
					end: {
						line: 58,
						column: 16
					}
				},
				loc: {
					start: {
						line: 58,
						column: 59
					},
					end: {
						line: 62,
						column: 1
					}
				},
				line: 58
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 11,
						column: 47
					},
					end: {
						line: 11,
						column: 91
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 11,
						column: 47
					},
					end: {
						line: 11,
						column: 61
					}
				}, {
					start: {
						line: 11,
						column: 65
					},
					end: {
						line: 11,
						column: 91
					}
				}],
				line: 11
			},
			'1': {
				loc: {
					start: {
						line: 14,
						column: 3
					},
					end: {
						line: 20,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 14,
						column: 3
					},
					end: {
						line: 20,
						column: 4
					}
				}, {
					start: {
						line: 14,
						column: 3
					},
					end: {
						line: 20,
						column: 4
					}
				}],
				line: 14
			},
			'2': {
				loc: {
					start: {
						line: 14,
						column: 7
					},
					end: {
						line: 14,
						column: 121
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 14,
						column: 7
					},
					end: {
						line: 14,
						column: 20
					}
				}, {
					start: {
						line: 14,
						column: 24
					},
					end: {
						line: 14,
						column: 42
					}
				}, {
					start: {
						line: 14,
						column: 46
					},
					end: {
						line: 14,
						column: 61
					}
				}, {
					start: {
						line: 14,
						column: 66
					},
					end: {
						line: 14,
						column: 83
					}
				}, {
					start: {
						line: 14,
						column: 87
					},
					end: {
						line: 14,
						column: 96
					}
				}, {
					start: {
						line: 14,
						column: 101
					},
					end: {
						line: 14,
						column: 121
					}
				}],
				line: 14
			},
			'3': {
				loc: {
					start: {
						line: 16,
						column: 19
					},
					end: {
						line: 16,
						column: 49
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 16,
						column: 19
					},
					end: {
						line: 16,
						column: 36
					}
				}, {
					start: {
						line: 16,
						column: 40
					},
					end: {
						line: 16,
						column: 49
					}
				}],
				line: 16
			},
			'4': {
				loc: {
					start: {
						line: 17,
						column: 4
					},
					end: {
						line: 19,
						column: 5
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 17,
						column: 4
					},
					end: {
						line: 19,
						column: 5
					}
				}, {
					start: {
						line: 17,
						column: 4
					},
					end: {
						line: 19,
						column: 5
					}
				}],
				line: 17
			},
			'5': {
				loc: {
					start: {
						line: 18,
						column: 39
					},
					end: {
						line: 18,
						column: 96
					}
				},
				type: 'cond-expr',
				locations: [{
					start: {
						line: 18,
						column: 49
					},
					end: {
						line: 18,
						column: 83
					}
				}, {
					start: {
						line: 18,
						column: 87
					},
					end: {
						line: 18,
						column: 96
					}
				}],
				line: 18
			},
			'6': {
				loc: {
					start: {
						line: 18,
						column: 49
					},
					end: {
						line: 18,
						column: 83
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 18,
						column: 49
					},
					end: {
						line: 18,
						column: 68
					}
				}, {
					start: {
						line: 18,
						column: 72
					},
					end: {
						line: 18,
						column: 83
					}
				}],
				line: 18
			},
			'7': {
				loc: {
					start: {
						line: 38,
						column: 4
					},
					end: {
						line: 38,
						column: 60
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 38,
						column: 4
					},
					end: {
						line: 38,
						column: 60
					}
				}, {
					start: {
						line: 38,
						column: 4
					},
					end: {
						line: 38,
						column: 60
					}
				}],
				line: 38
			},
			'8': {
				loc: {
					start: {
						line: 50,
						column: 3
					},
					end: {
						line: 52,
						column: 4
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 50,
						column: 3
					},
					end: {
						line: 52,
						column: 4
					}
				}, {
					start: {
						line: 50,
						column: 3
					},
					end: {
						line: 52,
						column: 4
					}
				}],
				line: 50
			},
			'9': {
				loc: {
					start: {
						line: 60,
						column: 21
					},
					end: {
						line: 60,
						column: 59
					}
				},
				type: 'binary-expr',
				locations: [{
					start: {
						line: 60,
						column: 21
					},
					end: {
						line: 60,
						column: 30
					}
				}, {
					start: {
						line: 60,
						column: 34
					},
					end: {
						line: 60,
						column: 50
					}
				}, {
					start: {
						line: 60,
						column: 54
					},
					end: {
						line: 60,
						column: 59
					}
				}],
				line: 60
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0,
			'16': 0,
			'17': 0,
			'18': 0,
			'19': 0,
			'20': 0,
			'21': 0,
			'22': 0,
			'23': 0,
			'24': 0,
			'25': 0,
			'26': 0,
			'27': 0,
			'28': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0],
			'2': [0, 0, 0, 0, 0, 0],
			'3': [0, 0],
			'4': [0, 0],
			'5': [0, 0],
			'6': [0, 0],
			'7': [0, 0],
			'8': [0, 0],
			'9': [0, 0, 0]
		},
		_coverageSchema: 'd34fc3e6b8297bcde183f5492bcb8fcb36775295'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _astNodeUtils = require('ast-node-utils');

var _index = require('../../index');

var _FinFormula = require('../../../ffl/FinFormula');

var _FinFormula2 = _interopRequireDefault(_FinFormula);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ScreenDefinitionParser = (cov_21c2bkyhsg.s[0]++, {
	headername: 'screendefinition',
	name: 'screendefinition',
	//expection json as String for screen definitions
	parseData: function parseData(json, workbook) {
		cov_21c2bkyhsg.f[0]++;

		var data = (cov_21c2bkyhsg.s[1]++, JSON.parse(json));
		var solution = (cov_21c2bkyhsg.s[2]++, _index.SolutionFacade.createSolution((cov_21c2bkyhsg.b[0][0]++, data.modelName) || (cov_21c2bkyhsg.b[0][1]++, workbook.getSolutionName())));

		cov_21c2bkyhsg.s[3]++;
		_index.JSVisitor.travelOne(data, null, function (keyArg, node, context) {
			cov_21c2bkyhsg.f[1]++;
			cov_21c2bkyhsg.s[4]++;

			if ((cov_21c2bkyhsg.b[2][0]++, node !== null) && (cov_21c2bkyhsg.b[2][1]++, node !== undefined) && (cov_21c2bkyhsg.b[2][2]++, keyArg !== null) && ((cov_21c2bkyhsg.b[2][3]++, node.variableName) || (cov_21c2bkyhsg.b[2][4]++, node.name)) && (cov_21c2bkyhsg.b[2][5]++, !Array.isArray(node))) {
				cov_21c2bkyhsg.b[1][0]++;

				var parent = (cov_21c2bkyhsg.s[5]++, node._parent);
				var nodeName = (cov_21c2bkyhsg.s[6]++, (cov_21c2bkyhsg.b[3][0]++, node.variableName) || (cov_21c2bkyhsg.b[3][1]++, node.name));
				cov_21c2bkyhsg.s[7]++;
				if (nodeName) {
					cov_21c2bkyhsg.b[4][0]++;
					cov_21c2bkyhsg.s[8]++;

					addnode(solution, nodeName, node, parent ? (cov_21c2bkyhsg.b[5][0]++, (cov_21c2bkyhsg.b[6][0]++, parent.variableName) || (cov_21c2bkyhsg.b[6][1]++, parent.name)) : (cov_21c2bkyhsg.b[5][1]++, undefined), undefined);
				} else {
					cov_21c2bkyhsg.b[4][1]++;
				}
			} else {
				cov_21c2bkyhsg.b[1][1]++;
			}
		});
		cov_21c2bkyhsg.s[9]++;
		return solution;
	},
	deParse: function deParse(rowId, workbook) {
		cov_21c2bkyhsg.f[2]++;

		var screenSolution = (cov_21c2bkyhsg.s[10]++, _index.SolutionFacade.createSolution(workbook.getSolutionName()));
		var rootProperty = (cov_21c2bkyhsg.s[11]++, _index.PropertiesAssembler.getRootProperty(workbook.getSolutionName()));
		cov_21c2bkyhsg.s[12]++;
		_index.PropertiesAssembler.visitProperty(rowId, function (elem) {
			cov_21c2bkyhsg.f[3]++;

			//create output node
			var uielem = (cov_21c2bkyhsg.s[13]++, {
				name: elem.rowId,
				displaytype: elem.displaytype,
				description: elem.title
			});
			var formulaProperties = (cov_21c2bkyhsg.s[14]++, _index.SolutionFacade.gatherFormulaProperties(workbook.getSolutionName(), workbook.properties, elem.rowId));
			cov_21c2bkyhsg.s[15]++;
			for (var key in formulaProperties) {
				var formula = (cov_21c2bkyhsg.s[16]++, formulaProperties[key]);
				var finFormula = (cov_21c2bkyhsg.s[17]++, _FinFormula2.default.javaScriptToFinGeneric(formula));
				cov_21c2bkyhsg.s[18]++;
				if (finFormula !== 'undefined') {
						cov_21c2bkyhsg.b[7][0]++;
						cov_21c2bkyhsg.s[19]++;
						uielem[key] = finFormula;
					} else {
					cov_21c2bkyhsg.b[7][1]++;
				}
			}
		});
		cov_21c2bkyhsg.s[20]++;
		screenSolution.root = {
			modelName: workbook.getSolutionName()
		};
		cov_21c2bkyhsg.s[21]++;
		return stringifySolution(screenSolution.root);
	}
});

function stringifySolution(root) {
	cov_21c2bkyhsg.f[4]++;
	cov_21c2bkyhsg.s[22]++;

	return JSON.stringify(root, function (key, val) {
		cov_21c2bkyhsg.f[5]++;
		cov_21c2bkyhsg.s[23]++;

		if (key === 'originalproperties') {
			cov_21c2bkyhsg.b[8][0]++;
			cov_21c2bkyhsg.s[24]++;

			return undefined;
		} else {
			cov_21c2bkyhsg.b[8][1]++;
		}
		cov_21c2bkyhsg.s[25]++;
		return val;
	}, 2);
}

function addnode(solution, rowId, node, parentId, referId) {
	cov_21c2bkyhsg.f[6]++;

	var uiNode = (cov_21c2bkyhsg.s[26]++, _index.SolutionFacade.createUIFormulaLink(solution, rowId, 'value', _astNodeUtils.ast.UNDEFINED(), 'AmountAnswerType', 'document', null, parentId));
	var titlestring = (cov_21c2bkyhsg.s[27]++, (cov_21c2bkyhsg.b[9][0]++, node.name) || (cov_21c2bkyhsg.b[9][1]++, node.description) || (cov_21c2bkyhsg.b[9][2]++, rowId));
	cov_21c2bkyhsg.s[28]++;
	_index.SolutionFacade.createUIFormulaLink(solution, rowId, 'title', _astNodeUtils.ast.STRING(titlestring), undefined, 'document');
}
exports.default = ScreenDefinitionParser;